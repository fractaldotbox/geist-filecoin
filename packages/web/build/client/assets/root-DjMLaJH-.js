var x_=Object.defineProperty;var Bo=n=>{throw TypeError(n)};var I_=(n,i,r)=>i in n?x_(n,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[i]=r;var T=(n,i,r)=>I_(n,typeof i!="symbol"?i+"":i,r),Ri=(n,i,r)=>i.has(n)||Bo("Cannot "+r);var Y=(n,i,r)=>(Ri(n,i,"read from private field"),r?r.call(n):i.get(n)),Ze=(n,i,r)=>i.has(n)?Bo("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,r),Di=(n,i,r,t)=>(Ri(n,i,"write to private field"),t?t.call(n,r):i.set(n,r),r),le=(n,i,r)=>(Ri(n,i,"access private method"),r);import{j as de,R as ur,w as T_,M as R_,L as D_,O as A_,S as $_,t as P_}from"./chunk-EF7DTUVF-BBWwU0kE.js";import{a as L_}from"./index-BkZpPgp-.js";import{u as F_,a as N_,w as z_,c as U_,e as H_,b as j_,s as O_,d as M_,f as Qt,h as Pt,g as Jt,p as me,i as Be,j as Ee,k as kt,l as B_,m as W_,n as qa,o as Js,q as ls,r as Oe,O as V_,E as Wo,S as Vo,t as Go,C as Qo,v as G_,x as Q_,y as J_,Y as Y_,z as ka,B as us,D as Bl,F as K_,G as Z_,H as Ca,I as xa,J as Ia,K as X_,L as Wl,M as In,N as Vl,P as Fs,Q as xt,R as Ta,T as ep,U as tp,V as Xr,W as np,X as hn,Z as sp,_ as rp,$ as ip,a0 as It,a1 as ap,a2 as Te,a3 as ut,a4 as Se,a5 as ei,a6 as un,a7 as Gl,a8 as _n,a9 as op,aa as Ql,ab as Tn,ac as Jl,ad as Lt,ae as Yl,af as cp,ag as ws,ah as fe,ai as Kl,aj as Et,ak as lp,al as Ft,am as wr,an as ti,ao as Zl,ap as ni,aq as Ra,ar as Da,as as Dr,at as Xl,au as ts,av as eu,aw as Dn,ax as up,ay as dp,az as Ht,aA as tu,aB as fp,aC as nu,aD as hp,aE as _p,aF as su,aG as pp,aH as mp,aI as Ns,aJ as Jo,aK as Yo,aL as yt,aM as Is,aN as ru,aO as Ue,aP as Ar,aQ as gp,aR as yp,aS as iu,aT as et,aU as mt,aV as au,aW as ou,aX as si,aY as bp,aZ as Ai,a_ as vp,a$ as wp,b0 as Sp,b1 as Ep,b2 as qp,b3 as kp,b4 as Cp,b5 as $i,b6 as Ko,b7 as Zo,b8 as ji,b9 as xp,ba as rn,bb as Sr,bc as Ip,bd as Tp,be as Rp,bf as Dp,bg as cu,bh as Ap,bi as $p,bj as Pp,bk as Lp,bl as Fp,bm as Np,bn as zp,bo as Xo,bp as Up,bq as lu,br as En,bs as ec,bt as Pi,bu as bs,bv as Hp,bw as jp,bx as tc,by as Op,bz as Li,bA as nc,bB as dr,bC as Mp,bD as uu,bE as fr,bF as bt,bG as $r,bH as Bp,bI as Wp,bJ as du,bK as fu,bL as Vp,bM as hu,bN as _u,bO as Aa,bP as pu,bQ as Pr,bR as Gp,bS as Qp,bT as Jp,bU as Fi,bV as Yp,bW as Bt,bX as Kp,bY as Zp,bZ as Xp,b_ as Un,b$ as $a,c0 as Ye,c1 as em,c2 as tm,c3 as nm,c4 as Lr,c5 as Wt,c6 as pn,c7 as mu,c8 as gu,c9 as sm,ca as Oi,cb as j,cc as $t,cd as ri,ce as We,cf as ii,cg as yu,ch as ai,ci as An,cj as zs,ck as ln,cl as Ys,cm as Ks,cn as Pa,co as wt,cp as ct,cq as Fr,cr as rm,cs as oi,ct as os,cu as Us,cv as $n,cw as im,cx as am,cy as La,cz as om,cA as cm,cB as Fe,cC as lm,cD as Hn,cE as Nr,cF as Re,cG as um,cH as bu,cI as Hs,cJ as Fa,cK as vu,cL as Pn,cM as dm,cN as qn,cO as ci,cP as Na,cQ as fm,cR as hm,cS as Ss,cT as sc,cU as rc,cV as _m,cW as zr,cX as pm,cY as mm,cZ as gm,c_ as Ur,c$ as ym,d0 as Ts,d1 as bn,d2 as li,d3 as St,d4 as we,d5 as za,d6 as ic,d7 as Me,d8 as bm,d9 as vm,da as Mi,db as wm,dc as wu,dd as Su,de as Sm,df as st,dg as Em,dh as qm,di as X,dj as ce,dk as Ln,dl as F,dm as Eu,dn as Ie,dp as He,dq as ui,dr as Zs,ds as km,dt as ie,du as Ua,dv as vt,dw as Ot,dx as ge,dy as Ha,dz as je,dA as cs,dB as Fn,dC as ja,dD as qu,dE as Cm,dF as qe,dG as xm,dH as Im,dI as Tm,dJ as Rm,dK as Dm,dL as Am,dM as $m,dN as Pm,dO as Bi,dP as Lm,dQ as di,dR as Fm,dS as jn,dT as Ne,dU as tt,dV as Er,dW as Pe,dX as fi,dY as Nm,dZ as ku,d_ as Cu,d$ as qt,e0 as Oa,e1 as ac,e2 as oc,e3 as pe,e4 as Ma,e5 as qr,e6 as Ba,e7 as zm,e8 as Um,e9 as Hr,ea as Hm,eb as Ni,ec as jm,ed as te,ee as gt,ef as Rt,eg as jt,eh as js,ei as xu,ej as Om,ek as Rs,el as Wi,em as Mm,en as Nn,eo as dn,ep as Bm,eq as Wm,er as Vm,es as Iu,et as kn,eu as Gm,ev as Qm,ew as cc,ex as lc,ey as uc,ez as Jm,eA as Tu,eB as Os,eC as Ru,eD as Du,eE as Au,eF as ns,eG as Ym,eH as Km,eI as hi,eJ as Zm,eK as $u,eL as Wa,eM as Va,eN as Pu,eO as Ds,eP as Xm,eQ as eg,eR as tg,eS as ng,eT as Lu,eU as Es,eV as Vi,eW as dc,eX as Gi,eY as Mt,eZ as sg,e_ as rg,e$ as ig,f0 as ag,f1 as hr,f2 as og,f3 as cg,f4 as fc,f5 as lg,f6 as Ga,f7 as Fu,f8 as qs,f9 as ug,fa as jr,fb as Ge,fc as Cn,fd as dg,fe as fg,ff as hg,fg as _g,fh as pg,fi as fn,fj as hc,fk as es,fl as mg,fm as gg,fn as yg,fo as bg,fp as vg,fq as _c,fr as wg,fs as Sg,ft as Eg,fu as qg,fv as kg,fw as pc,fx as kr,fy as Qi,fz as Cg,fA as Ji,fB as mc,fC as xg,fD as Ig,fE as Tg,fF as Rg,fG as Dg,fH as gc,fI as Ag,fJ as $g,fK as yc,fL as bc,fM as vc,fN as Pg,fO as Lg,fP as Nu,fQ as wc,fR as Fg,fS as Ng,fT as zg,fU as zu,fV as Ug,fW as Hg,fX as jg,fY as Og,fZ as Mg,f_ as Bg,f$ as Wg,g0 as Vg,g1 as Gg,g2 as Qg,g3 as Jg,A as Yg}from"./App-DShJULFf.js";const Uu=F_,Kg=N_,Zg=j_,Xg=U_,ey=H_,Hu=M_,ju=O_,ty=z_;class Ou{constructor(i){T(this,"value");this.value=i}}const Mu=(n,i)=>({ref:n,isNew:i,isChanged:!1,expected:n.versioned,newValue:n.versioned.value}),Bu=n=>n.newValue,Wu=(n,i)=>{n.isChanged=!0,n.newValue=i},ny=n=>{n.ref.versioned=new Ou(n.newValue)},sy=n=>n.ref.versioned!==n.expected,ry=n=>n.isChanged,Or="Invalid",Qa="ReadWrite",iy="ReadOnly",Vu=n=>{for(const i of n)ny(i[1])},Gu=n=>{let i=iy;for(const[,r]of n)if(i=sy(r)?Or:ry(r)?Qa:i,i===Or)return i;return i},ay=n=>{const i=new Map;for(const[,r]of n){for(const t of r.ref.todos)i.set(t[0],t[1]);r.ref.todos=new Map}return i},oy=n=>{const i=Array.from(n.entries()).sort((r,t)=>r[0]-t[0]);for(const[r,t]of i)t()},cy=(n,i,r)=>{let t=!1;for(const[,o]of i)o.ref.todos.has(n)||(o.ref.todos.set(n,r),t=!0);return t},Qu="WithSTMRuntime",Yi="OnFailure",Sc="OnRetry",Ki="OnSuccess",ly="Provide",Ju="Sync",Yu="Succeed",Ku="Retry",Zu="Fail",Xu="Die",ed="Interrupt",ss="Fail",rs="Die",is="Interrupt",Rn="Succeed",ds="Retry",Ja="Done",Ya="Suspend",Cr="Done",Zi="Interrupted",Mr="Running",_i="effect/STM/State",zn=Symbol.for(_i),Ka=n=>Pt(n,zn),td=n=>n._tag===Mr,uy=n=>n._tag===Cr,_r=n=>({[zn]:zn,_tag:Cr,exit:n,[Jt](){return me(Ee(_i),Be(Ee(Cr)),Be(Ee(n)),ls(this))},[Qt](i){return Ka(i)&&i._tag===Cr&&Js(n,i.exit)}}),dy=me(Ee(_i),Be(Ee(Zi)),Be(Ee("interrupted"))),fy={[zn]:zn,_tag:Zi,[Jt](){return dy},[Qt](n){return Ka(n)&&n._tag===Zi}},hy=me(Ee(_i),Be(Ee(Mr)),Be(Ee("running"))),_y={[zn]:zn,_tag:Mr,[Jt](){return hy},[Qt](n){return Ka(n)&&n._tag===Mr}},pr=n=>{switch(n._tag){case ss:return _r(qa(n.error));case rs:return _r(W_(n.defect));case is:return _r(B_(n.fiberId));case Rn:return _r(kt(n.value));case ds:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},fs="effect/TExit",hs=Symbol.for(fs),Xs={_A:n=>n,_E:n=>n},er=n=>Pt(n,hs),py=n=>n._tag===Rn,my=n=>n._tag===ds,gy=n=>({[hs]:Xs,_tag:ss,error:n,[Jt](){return me(Ee(fs),Be(Ee(ss)),Be(Ee(n)),ls(this))},[Qt](i){return er(i)&&i._tag===ss&&Js(n,i.error)}}),yy=n=>({[hs]:Xs,_tag:rs,defect:n,[Jt](){return me(Ee(fs),Be(Ee(rs)),Be(Ee(n)),ls(this))},[Qt](i){return er(i)&&i._tag===rs&&Js(n,i.defect)}}),by=n=>({[hs]:Xs,_tag:is,fiberId:n,[Jt](){return me(Ee(fs),Be(Ee(is)),Be(Ee(n)),ls(this))},[Qt](i){return er(i)&&i._tag===is&&Js(n,i.fiberId)}}),Ec=n=>({[hs]:Xs,_tag:Rn,value:n,[Jt](){return me(Ee(fs),Be(Ee(Rn)),Be(Ee(n)),ls(this))},[Qt](i){return er(i)&&i._tag===Rn&&Js(n,i.value)}}),vy=me(Ee(fs),Be(Ee(ds)),Be(Ee("retry"))),wy={[hs]:Xs,_tag:ds,[Jt](){return vy},[Qt](n){return er(n)&&my(n)}},Sy=n=>({_tag:Ja,exit:n}),nd=n=>({_tag:Ya,journal:n}),qc={ref:0},Ey=()=>{const n=qc.ref+1;return qc.ref=n,n},qy="effect/STM",ky=Symbol.for(qy),mr={_R:n=>n,_E:n=>n,_A:n=>n};var wl,Sl,El,ql;class Yt{constructor(i){T(this,"effect_instruction_i0");T(this,"_op",V_);T(this,"effect_instruction_i1");T(this,"effect_instruction_i2");T(this,ql);T(this,El);T(this,Sl);T(this,wl);this.effect_instruction_i0=i,this[Wo]=G_,this[Vo]=mr,this[Go]=mr,this[Qo]=mr}get[(ql=Wo,El=Vo,Sl=Go,wl=Qo,ky)](){return mr}[Qt](i){return this===i}[Jt](){return ls(this,Q_(this))}[Symbol.iterator](){return new J_(new Y_(this))}commit(){return Cy(this,np)}pipe(){return us(this,arguments)}}const Cy=(n,i,r)=>ka(t=>{const o=t.id(),l=t.getFiberRef(Bl),f=t.getFiberRef(K_),g=t.getFiberRef(Z_),w=Iy(o,n,l,f,g);switch(w._tag){case Ja:return i(w.exit),w.exit;case Ya:{const x=Ey(),D={value:_y},q=Ca(A=>sd(o,n,x,D,l,f,g,A));return xa(A=>me(A(q),Ia(z=>{let N=D.value;return td(N)&&(D.value=fy),N=D.value,uy(N)?(i(N.exit),N.exit):X_(z)})))}}}),xy=(n,i,r,t,o,l)=>{const f=new Map,g=new rd(i,f,n,t).run(),w=Gu(f);if(w===Qa)Vu(f);else if(w===Or)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(g._tag){case Rn:return r.value=pr(g),cn(kt(g.value),f,o,l);case ss:{r.value=pr(g);const x=Fs(g.error);return cn(In(x),f,o,l)}case rs:{r.value=pr(g);const x=Vl(g.defect);return cn(In(x),f,o,l)}case is:{r.value=pr(g);const x=Wl(n);return cn(In(x),f,o,l)}case ds:return nd(f)}},Iy=(n,i,r,t,o)=>{const l=new Map,f=new rd(i,l,n,r).run(),g=Gu(l);if(g===Qa&&py(f))Vu(l);else if(g===Or)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(f._tag){case Rn:return cn(kt(f.value),l,t,o);case ss:{const w=Fs(f.error);return cn(In(w),l,t,o)}case rs:{const w=Vl(f.defect);return cn(In(w),l,t,o)}case is:{const w=Wl(n);return cn(In(w),l,t,o)}case ds:return nd(l)}},sd=(n,i,r,t,o,l,f,g)=>{if(td(t.value)){const w=xy(n,i,t,o,l,f);switch(w._tag){case Ja:{Ty(w.exit,g);break}case Ya:{cy(r,w.journal,()=>sd(n,i,r,t,o,l,f,g));break}}}},cn=(n,i,r,t)=>{const o=ay(i);return o.size>0&&r.scheduleTask(()=>oy(o),t),Sy(n)},Ty=(n,i)=>{i(n)};class rd{constructor(i,r,t,o){T(this,"self");T(this,"journal");T(this,"fiberId");T(this,"contStack",[]);T(this,"env");this.self=i,this.journal=r,this.fiberId=t,this.env=o}getEnv(){return this.env}pushStack(i){this.contStack.push(i)}popStack(){return this.contStack.pop()}nextSuccess(){let i=this.popStack();for(;i!==void 0&&i.effect_instruction_i0!==Ki;)i=this.popStack();return i}nextFailure(){let i=this.popStack();for(;i!==void 0&&i.effect_instruction_i0!==Yi;)i=this.popStack();return i}nextRetry(){let i=this.popStack();for(;i!==void 0&&i.effect_instruction_i0!==Sc;)i=this.popStack();return i}run(){let i=this.self,r;for(;r===void 0&&i!==void 0;)try{const t=i;if(t)switch(t._op){case"Tag":{i=pi((o,l,f)=>ep(f,t));break}case"Left":{i=Xi(t.left);break}case"None":{i=Xi(new Ta);break}case"Right":{i=De(t.right);break}case"Some":{i=De(t.value);break}case"Commit":{switch(t.effect_instruction_i0){case Xu:{r=yy(xt(()=>t.effect_instruction_i1()));break}case Zu:{const o=this.nextFailure();o===void 0?r=gy(xt(()=>t.effect_instruction_i1())):i=xt(()=>o.effect_instruction_i2(xt(()=>t.effect_instruction_i1())));break}case Ku:{const o=this.nextRetry();o===void 0?r=wy:i=xt(()=>o.effect_instruction_i2());break}case ed:{r=by(this.fiberId);break}case Qu:{i=xt(()=>t.effect_instruction_i1(this));break}case Ki:case Yi:case Sc:{this.pushStack(t),i=t.effect_instruction_i1;break}case ly:{const o=this.env;this.env=xt(()=>t.effect_instruction_i2(o)),i=me(t.effect_instruction_i1,$y(Za(()=>this.env=o)));break}case Yu:{const o=t.effect_instruction_i1,l=this.nextSuccess();l===void 0?r=Ec(o):i=xt(()=>l.effect_instruction_i2(o));break}case Ju:{const o=xt(()=>t.effect_instruction_i1()),l=this.nextSuccess();l===void 0?r=Ec(o):i=xt(()=>l.effect_instruction_i2(o));break}}break}}}catch(t){i=Dy(t)}return r}}const Ry=Oe(2,(n,i)=>{const r=new Yt(Yi);return r.effect_instruction_i1=n,r.effect_instruction_i2=i,r}),Dy=n=>Ay(()=>n),Ay=n=>{const i=new Yt(Xu);return i.effect_instruction_i1=n,i},pi=n=>Tt(i=>De(n(i.journal,i.fiberId,i.getEnv()))),$y=Oe(2,(n,i)=>Ly(n,{onFailure:r=>kc(i,Xi(r)),onSuccess:r=>kc(i,De(r))})),Xi=n=>Py(()=>n),Py=n=>{const i=new Yt(Zu);return i.effect_instruction_i1=n,i},_s=Oe(2,(n,i)=>{const r=new Yt(Ki);return r.effect_instruction_i1=n,r.effect_instruction_i2=i,r}),Ly=Oe(2,(n,{onFailure:i,onSuccess:r})=>me(n,Ms(Xr),Ry(t=>me(i(t),Ms(tp))),_s(t=>{switch(t._tag){case"Left":return De(t.left);case"Right":return r(t.right)}}))),Tt=n=>{const i=new Yt(Qu);return i.effect_instruction_i1=n,i},nn=n=>{const i=new Yt(ed);return i.effect_instruction_i1=n,i},Ms=Oe(2,(n,i)=>me(n,_s(r=>Za(()=>i(r))))),Kn=new Yt(Ku),De=n=>{const i=new Yt(Yu);return i.effect_instruction_i1=n,i},Za=n=>{const i=new Yt(Ju);return i.effect_instruction_i1=n,i},kc=Oe(2,(n,i)=>me(n,_s(()=>i))),Cc="BackPressure",ea="Dropping",xc="Sliding",Fy=n=>_s(n,hn),Ny=(...n)=>zy(()=>{const r=(n.length===1?n[0]:n[1].bind(n[0]))(me),t=r.next(),o=l=>l.done?De(l.value):_s(sp(l.value),f=>o(r.next(f)));return o(t)}),zy=n=>Fy(Za(n)),Ic=De(void 0),Uy="effect/TRef",Hy=Symbol.for(Uy),jy={_A:n=>n};var kl;kl=Hy;class Oy{constructor(i){T(this,kl,jy);T(this,"todos");T(this,"versioned");this.versioned=new Ou(i),this.todos=new Map}modify(i){return pi(r=>{const t=Xa(this,r),[o,l]=i(Bu(t));return Wu(t,l),o})}pipe(){return us(this,arguments)}}const id=n=>pi(i=>{const r=new Oy(n);return i.set(r,Mu(r,!0)),r}),My=n=>n.modify(i=>[i,i]),By=Oe(2,(n,i)=>n.modify(()=>[void 0,i])),Wy=Oe(2,(n,i)=>n.modify(r=>[void 0,i(r)])),Xa=(n,i)=>{if(i.has(n))return i.get(n);const r=Mu(n,!1);return i.set(n,r),r},zt=Oe(2,(n,i)=>Bu(Xa(n,i))),Ut=Oe(3,(n,i,r)=>{const t=Xa(n,r);Wu(t,i)}),Vy="effect/TQueue/TEnqueue",Gy=Symbol.for(Vy),Qy="effect/TQueue/TDequeue",Jy=Symbol.for(Qy),Yy={_tag:ea},Ky={_Out:n=>n},Zy={_In:n=>n};var Cl,xl;xl=Jy,Cl=Gy;class Xy{constructor(i,r,t){T(this,"ref");T(this,"requestedCapacity");T(this,"strategy");T(this,xl,Ky);T(this,Cl,Zy);T(this,"size",Tt(i=>{const r=zt(this.ref,i.journal);return r===void 0?nn(i.fiberId):De(r.length)}));T(this,"isFull",Ms(this.size,i=>i===this.requestedCapacity));T(this,"isEmpty",Ms(this.size,i=>i===0));T(this,"shutdown",Tt(i=>(Ut(this.ref,void 0,i.journal),Ic)));T(this,"isShutdown",pi(i=>zt(this.ref,i)===void 0));T(this,"awaitShutdown",_s(this.isShutdown,i=>i?Ic:Kn));T(this,"peek",Tt(i=>{const r=zt(this.ref,i.journal);return r===void 0?nn(i.fiberId):r.length===0?Kn:De(r[0])}));T(this,"peekOption",Tt(i=>{const r=zt(this.ref,i.journal);return r===void 0?nn(i.fiberId):De(rp(r[0]))}));T(this,"take",Tt(i=>{const r=zt(this.ref,i.journal);if(r===void 0)return nn(i.fiberId);if(r.length===0)return Kn;const t=r.shift();return Ut(this.ref,r,i.journal),De(t)}));T(this,"takeAll",Tt(i=>{const r=zt(this.ref,i.journal);return r===void 0?nn(i.fiberId):(Ut(this.ref,[],i.journal),De(r))}));this.ref=i,this.requestedCapacity=r,this.strategy=t}capacity(){return this.requestedCapacity}offer(i){return Tt(r=>{const t=me(this.ref,zt(r.journal));if(t===void 0)return nn(r.fiberId);if(t.length<this.requestedCapacity)return t.push(i),Ut(this.ref,t,r.journal),De(!0);switch(this.strategy._tag){case Cc:return Kn;case ea:return De(!1);case xc:return t.length===0||(t.shift(),t.push(i),Ut(this.ref,t,r.journal)),De(!0)}})}offerAll(i){return Tt(r=>{const t=Array.from(i),o=zt(this.ref,r.journal);if(o===void 0)return nn(r.fiberId);if(o.length+t.length<=this.requestedCapacity)return Ut(this.ref,[...o,...t],r.journal),De(!0);switch(this.strategy._tag){case Cc:return Kn;case ea:{const l=t.slice(0,this.requestedCapacity-o.length);return Ut(this.ref,[...o,...l],r.journal),De(!1)}case xc:{const l=t.slice(0,this.requestedCapacity-o.length),f=o.length+l.length-this.requestedCapacity,g=o.slice(f);return Ut(this.ref,[...g,...l],r.journal),De(!0)}}})}takeUpTo(i){return Tt(r=>{const t=zt(this.ref,r.journal);if(t===void 0)return nn(r.fiberId);const[o,l]=ip(It(t),i);return Ut(this.ref,Array.from(l),r.journal),De(Array.from(o))})}}const eb=Oe(2,(n,i)=>n.offer(i)),tb=n=>n.peek,nb=n=>n.take,sb=()=>rb(Number.MAX_SAFE_INTEGER,Yy),rb=(n,i)=>Ms(id([]),r=>new Xy(r,n,i)),ib=eb,ab=tb,ob=nb,cb=sb,lb=ap,ta=Symbol.for("effect/FiberHandle"),ub=n=>Pt(n,ta),db={[ta]:ta,toString(){return Dr(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[Da](){return this.toJSON()},pipe(){return us(this,arguments)}},fb=n=>{const i=Object.create(db);return i.state={_tag:"Open",fiber:void 0},i.deferred=n,i},ad=()=>Te(ut(Se(),n=>fb(n)),n=>ei(i=>{const r=n.state;return r._tag==="Closed"?un:(n.state={_tag:"Closed"},r.fiber?Gl(op(Ql(r.fiber,Tn(i.id(),As))),n.deferred):_n(n.deferred,Lt))})),od=-1,As=Jl(od,0),hb=Zl(void 0,{emptyCase:ts,failCase:ts,dieCase:ts,interruptCase:(n,i)=>Xl(eu(i),od),sequentialCase:(n,i,r)=>i||r,parallelCase:(n,i,r)=>i||r}),_b=Oe(n=>ub(n[0]),(n,i,r)=>{if(n.state._tag==="Closed"){i.unsafeInterruptAsFork(Tn((r==null?void 0:r.interruptAs)??wr,As));return}else if(n.state.fiber!==void 0){if((r==null?void 0:r.onlyIfMissing)===!0){i.unsafeInterruptAsFork(Tn((r==null?void 0:r.interruptAs)??wr,As));return}else if(n.state.fiber===i)return;n.state.fiber.unsafeInterruptAsFork(Tn((r==null?void 0:r.interruptAs)??wr,As)),n.state.fiber=void 0}n.state.fiber=i,i.addObserver(t=>{n.state._tag==="Open"&&i===n.state.fiber&&(n.state.fiber=void 0),ti(t)&&((r==null?void 0:r.propagateInterruption)===!0?!hb(t.cause):!ni(t.cause))&&Ra(n.deferred,t)})}),pb=n=>xa(i=>ei(r=>n.state._tag==="Closed"||n.state.fiber===void 0?un:ws(i(Ql(n.state.fiber,Tn(r.id(),As))),fe(()=>{n.state._tag==="Open"&&(n.state.fiber=void 0)})))),mb=function(){let n;return()=>(n===void 0&&(n=Ft(Kl)),n)}(),Br=function(){const n=arguments[0];if(Yl(arguments[1]))return Tc(n,arguments[1],arguments[2]);const i=arguments[1];return r=>Tc(n,r,i)},Tc=(n,i,r)=>cp(t=>n.state._tag==="Closed"?Kl:n.state.fiber!==void 0&&(r==null?void 0:r.onlyIfMissing)===!0?fe(mb):Et(lp(i),o=>_b(n,o,{...r,interruptAs:t}))),na=Symbol.for("effect/FiberSet"),gb=n=>Pt(n,na),yb={[na]:na,[Symbol.iterator](){return this.state._tag==="Closed"?dp():this.state.backing[Symbol.iterator]()},toString(){return Dr(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Da](){return this.toJSON()},pipe(){return us(this,arguments)}},bb=(n,i)=>{const r=Object.create(yb);return r.state={_tag:"Open",backing:n},r.deferred=i,r},vb=()=>Te(ut(Se(),n=>bb(new Set,n)),n=>ei(i=>{const r=n.state;if(r._tag==="Closed")return un;n.state={_tag:"Closed"};const t=r.backing;return up(t,Tn(i.id(),ld)).pipe(Gl(n.deferred))})),cd=-1,ld=Jl(cd,0),wb=Zl(void 0,{emptyCase:ts,failCase:ts,dieCase:ts,interruptCase:(n,i)=>Xl(eu(i),cd),sequentialCase:(n,i,r)=>i||r,parallelCase:(n,i,r)=>i||r}),Sb=Oe(n=>gb(n[0]),(n,i,r)=>{if(n.state._tag==="Closed"){i.unsafeInterruptAsFork(Tn((r==null?void 0:r.interruptAs)??wr,ld));return}else if(n.state.backing.has(i))return;n.state.backing.add(i),i.addObserver(t=>{n.state._tag!=="Closed"&&(n.state.backing.delete(i),ti(t)&&((r==null?void 0:r.propagateInterruption)===!0?!wb(t.cause):!ni(t.cause))&&Ra(n.deferred,t))})}),Eb=n=>Dn(n.deferred),Rc=Symbol.for("effect/Pool"),qb={_E:n=>n,_A:n=>n},ud=n=>tu(i=>Ht(hp(),r=>{const t=_p(r,su),o=pp(n.acquire,w=>mp(r,w)),l=new xb(t,o,n.concurrency??1,n.min,n.max,n.strategy,Math.min(Math.max(n.targetUtilization??1,.1),1)),f=Ns(Jo(i(l.resize)),w=>t.addFinalizer(()=>Yo(w))),g=Ns(Jo(i(n.strategy.run(l))),w=>t.addFinalizer(()=>Yo(w)));return yt(l).pipe(Is(t.addFinalizer(()=>l.shutdown)),Is(f),Is(g))})),kb=n=>ud({...n,min:n.size,max:n.size,strategy:Ib()}),Cb=n=>Ht(n.timeToLiveStrategy==="creation"?Tb(n.timeToLive):Rb(n.timeToLive),i=>ud({...n,strategy:i}));var Il,Tl;class xb extends(Tl=si,Il=Rc,Tl){constructor(r,t,o,l,f,g,w){super();T(this,"scope");T(this,"acquire");T(this,"concurrency");T(this,"minSize");T(this,"maxSize");T(this,"strategy");T(this,"targetUtilization");T(this,Il);T(this,"isShuttingDown",!1);T(this,"semaphore");T(this,"items",new Set);T(this,"available",new Set);T(this,"availableLatch",bp(!1));T(this,"invalidated",new Set);T(this,"waiters",0);T(this,"allocate",vp(wp(),r=>this.acquire.pipe(Sp(r),Ep,Ht(t=>{const o={exit:t,finalizer:qp(r.close(t),Db),refCount:0,disableReclaim:!1};return this.items.add(o),this.available.add(o),iu(t._tag==="Success"?this.strategy.onAcquire(o):mt(o.finalizer,this.strategy.onAcquire(o)),o)})),(r,t)=>t._tag==="Failure"?r.close(t):et));T(this,"resizeLoop",Ue(()=>{if(this.activeSize>=this.targetSize)return et;const r=this.targetSize-this.activeSize;return this.strategy.reclaim(this).pipe(Ht(kp({onNone:()=>this.allocate,onSome:yt})),Cp(r,{concurrency:r}),Is(this.availableLatch.open),Ht(t=>t.some(o=>o.exit._tag==="Failure")?et:this.resizeLoop))}));T(this,"resizeSemaphore",Ai(1));T(this,"resize",this.resizeSemaphore.withPermits(1)(this.resizeLoop));T(this,"getPoolItem",tu(r=>r(this.semaphore.take(1)).pipe(mt(su),Ht(t=>Ue(()=>{if(this.waiters++,this.isShuttingDown)return $i;if(this.targetSize>this.activeSize){const o=this;return Ht(this.resizeSemaphore.withPermitsIfAvailable(1)(Ko(Zo(this.resize),this.scope)),function l(){return o.isShuttingDown?$i:o.available.size>0?yt(ji(o.available)):(o.availableLatch.unsafeClose(),Ht(o.availableLatch.await,l))})}return yt(ji(this.available))}).pipe(xp(rn(()=>this.waiters--)),Ns(o=>o.exit._tag==="Failure"?(this.items.delete(o),this.invalidated.delete(o),this.available.delete(o),this.semaphore.release(1)):(o.refCount++,this.available.delete(o),o.refCount<this.concurrency&&this.available.add(o),t.addFinalizer(()=>mt(Ue(()=>(o.refCount--,this.invalidated.has(o)?this.invalidatePoolItem(o):(this.available.add(o),Sr))),this.semaphore.release(1))))),Ip(()=>this.semaphore.release(1)))))));T(this,"get",Ht(Ue(()=>this.isShuttingDown?$i:this.getPoolItem),r=>r.exit));this.scope=r,this.acquire=t,this.concurrency=o,this.minSize=l,this.maxSize=f,this.strategy=g,this.targetUtilization=w,this[Rc]=qb,this.semaphore=Ai(o*f)}get currentUsage(){let r=this.waiters;for(const t of this.items)r+=t.refCount;return r}get targetSize(){if(this.isShuttingDown)return 0;const r=this.currentUsage/this.targetUtilization,t=Math.ceil(r/this.concurrency);return Math.min(Math.max(this.minSize,t),this.maxSize)}get activeSize(){return this.items.size-this.invalidated.size}commit(){return this.get}invalidate(r){return Ue(()=>{if(this.isShuttingDown)return et;for(const t of this.items)if(t.exit._tag==="Success"&&t.exit.value===r)return t.disableReclaim=!0,Tp(this.invalidatePoolItem(t));return et})}invalidatePoolItem(r){return Ue(()=>{if(this.items.has(r)){if(r.refCount===0)return this.items.delete(r),this.available.delete(r),this.invalidated.delete(r),mt(r.finalizer,Ko(Zo(this.resize),this.scope))}else return et;return this.invalidated.add(r),this.available.delete(r),et})}get shutdown(){return Ue(()=>{if(this.isShuttingDown)return et;this.isShuttingDown=!0;const r=this.items.size,t=Ai(r);return Rp(this.items,o=>o.refCount>0?(o.finalizer=Is(o.finalizer,t.release(1)),this.invalidated.add(o),t.take(1)):(this.items.delete(o),this.available.delete(o),this.invalidated.delete(o),o.finalizer)).pipe(mt(this.semaphore.releaseAll),mt(this.availableLatch.open),mt(t.take(r)))})}pipe(){return us(this,arguments)}}const Ib=()=>({run:n=>et,onAcquire:n=>et,reclaim:n=>Ar}),Tb=n=>fp(i=>nu(ru(),r=>{const t=cu(n),o=new WeakMap;return hn({run:l=>{const f=g=>Ue(()=>{if(!l.items.has(g)||l.invalidated.has(g))return et;const w=i.unsafeCurrentTimeMillis(),x=o.get(g),D=t-(w-x);return D>0?au(f(g),D):l.invalidatePoolItem(g)});return r.take.pipe(Ns(f),ou)},onAcquire:l=>Ue(()=>(o.set(l,i.unsafeCurrentTimeMillis()),r.offer(l))),reclaim:l=>Ar})})),Rb=n=>nu(ru(),i=>hn({run:r=>{const t=Ue(()=>r.activeSize-r.targetSize<=0?et:i.take.pipe(Ns(l=>r.invalidatePoolItem(l)),mt(t)));return t.pipe(au(n),ou)},onAcquire:r=>i.offer(r),reclaim(r){return Ue(()=>{if(r.invalidated.size===0)return Ar;const t=gp(yp(r.invalidated,o=>!o.disableReclaim));return t._tag==="None"?Ar:(r.invalidated.delete(t.value),t.value.refCount<r.concurrency&&r.available.add(t.value),iu(i.offer(t.value),t))})}})),Db=n=>ka(i=>{const r=i.getFiberRef(Dp);return r._tag==="Some"&&i.log("Unhandled error in pool finalizer",n,r),et}),Ab=Ap,$b=$p,Pb=Pp,Lb=Lp,Fb=Fp,sa=Symbol.for("effect/Mailbox"),Dc=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Sn=lu(),Ac=En(Sn),gr=En(!1),yr=En(!0),$c=[Sn,!0];var Rl,Dl;class Nb extends si{constructor(r,t,o){super();T(this,"scheduler");T(this,"capacity");T(this,"strategy");T(this,Dl,sa);T(this,Rl,Dc);T(this,"state",{_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set});T(this,"messages",[]);T(this,"messagesChunk",lu());T(this,"shutdown",rn(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Sn;const r=this.state.offers;if(this.finalize(this.state._tag==="Open"?Sr:this.state.exit),r.size>0){for(const t of r)t._tag==="Single"?t.resume(gr):t.resume(En(It(t.remaining.slice(t.offset))));r.clear()}return!0}));T(this,"end",this.done(Sr));T(this,"clear",Ue(()=>{if(this.state._tag==="Done")return Li(this.state.exit,Sn);const r=this.unsafeTakeAll();return this.releaseCapacity(),yt(r)}));T(this,"takeAll",Ue(()=>{if(this.state._tag==="Done")return Li(this.state.exit,$c);const r=this.unsafeTakeAll();return r.length===0?mt(this.awaitTake,this.takeAll):yt([r,this.releaseCapacity()])}));T(this,"take",Ue(()=>this.unsafeTake()??mt(this.awaitTake,this.take)));T(this,"await",fr(r=>this.state._tag==="Done"?r(this.state.exit):(this.state.awaiters.add(r),rn(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(r)}))));T(this,"size",rn(()=>this.unsafeSize()));T(this,"awaitTake",fr(r=>this.state._tag==="Done"?r(this.state.exit):(this.state.takers.add(r),rn(()=>{this.state._tag!=="Done"&&this.state.takers.delete(r)}))));T(this,"scheduleRunning",!1);T(this,"releaseTaker",()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const r=ji(this.state.takers);this.state.takers.delete(r),r(Sr)});this.scheduler=r,this.capacity=t,this.strategy=o}offer(r){return Ue(()=>{if(this.state._tag!=="Open")return gr;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return gr;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(r),this.releaseTaker(),yr):this.offerRemainingSingle(r);case"sliding":return this.unsafeTake(),this.messages.push(r),yr}return this.messages.push(r),this.scheduleReleaseTaker(),yr})}unsafeOffer(r){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(r),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(r),this.releaseTaker(),!0):!1:(this.messages.push(r),this.scheduleReleaseTaker(),!0)}offerAll(r){return Ue(()=>{if(this.state._tag!=="Open")return yt(ec(r));const t=this.unsafeOfferAllArray(r);return t.length===0?Ac:this.strategy==="dropping"?yt(It(t)):this.offerRemainingArray(t)})}unsafeOfferAll(r){return It(this.unsafeOfferAllArray(r))}unsafeOfferAllArray(r){if(this.state._tag!=="Open")return Pi(r);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=bs(this.messagesChunk,It(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(bs(ec(r)),Hp(this.capacity)):jp(r)?this.messagesChunk=bs(this.messagesChunk,r):this.messages=Pi(r),this.scheduleReleaseTaker(),[];const t=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(t===0)return Pi(r);const o=[];let l=0;for(const f of r)l<t?this.messages.push(f):o.push(f),l++;return this.scheduleReleaseTaker(),o}fail(r){return this.done(tc(r))}failCause(r){return this.done(Op(r))}unsafeDone(r){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(r),!0):(this.state={...this.state,_tag:"Closing",exit:r},!0)}done(r){return rn(()=>this.unsafeDone(r))}takeN(r){return Ue(()=>{if(this.state._tag==="Done")return Li(this.state.exit,$c);if(r<=0)return yt([Sn,!1]);r=Math.min(r,this.capacity);let t;if(r<=this.messagesChunk.length)t=nc(this.messagesChunk,r),this.messagesChunk=dr(this.messagesChunk,r);else if(r<=this.messages.length+this.messagesChunk.length)this.messagesChunk=bs(this.messagesChunk,It(this.messages)),this.messages=[],t=nc(this.messagesChunk,r),this.messagesChunk=dr(this.messagesChunk,r);else return mt(this.awaitTake,this.takeN(r));return yt([t,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return Mp(this.state.exit,tc(new Ta));let r;if(this.messagesChunk.length>0)r=uu(this.messagesChunk),this.messagesChunk=dr(this.messagesChunk,1);else if(this.messages.length>0)r=this.messages[0],this.messagesChunk=dr(It(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?En(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),En(r)}unsafeSize(){const r=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?bt():$r(r)}commit(){return this.takeAll}pipe(){return us(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return Dr(this)}[(Dl=sa,Rl=Dc,Da)](){return Dr(this)}offerRemainingSingle(r){return fr(t=>{if(this.state._tag!=="Open")return t(gr);const o={_tag:"Single",message:r,resume:t};return this.state.offers.add(o),rn(()=>{this.state._tag==="Open"&&this.state.offers.delete(o)})})}offerRemainingArray(r){return fr(t=>{if(this.state._tag!=="Open")return t(En(It(r)));const o={_tag:"Array",remaining:r,offset:0,resume:t};return this.state.offers.add(o),rn(()=>{this.state._tag==="Open"&&this.state.offers.delete(o)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let r=this.capacity-this.messages.length-this.messagesChunk.length;for(const t of this.state.offers){if(r===0)return!1;if(t._tag==="Single")this.messages.push(t.message),r--,t.resume(yr),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(r===0)return!1;this.messages.push(t.remaining[t.offset]),r--}t.resume(Ac),this.state.offers.delete(t)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){const r=this.messages.length>0?bs(this.messagesChunk,It(this.messages)):this.messagesChunk;return this.messagesChunk=Sn,this.messages=[],r}else if(this.messages.length>0){const r=It(this.messages);return this.messages=[],r}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,Bp(this.messages.pop());return Sn}finalize(r){if(this.state._tag==="Done")return;const t=this.state;this.state={_tag:"Done",exit:r};for(const o of t.takers)o(r);t.takers.clear();for(const o of t.awaiters)o(r);t.awaiters.clear()}}const zb=n=>ka(i=>yt(new Nb(i.currentScheduler,typeof n=="number"?n:(n==null?void 0:n.capacity)??Number.POSITIVE_INFINITY,typeof n=="number"?"suspend":(n==null?void 0:n.strategy)??"suspend"))),Ub=n=>{const i=Np(n.takeAll,([r,t])=>t?r.length===0?zp:Xo(r):Up(Xo(r),i));return i},Hb=sa,jb=n=>Pt(n,Hb),Ob=zb,Mb=Ub,Bb=kb,Wb=Cb,Vb=Ny,Gb=Kn,Pc=Symbol.for("effect/Subscribable"),Qb=Wp,Jb="effect/SubscriptionRef",Yb=Symbol.for(Jb),Kb={_A:n=>n};var Al,$l,Pl,Ll,Fl,Nl;class Zb extends(Nl=si,Fl=Pr,Ll=Pc,Pl=Qp,$l=Qb,Al=Yb,Nl){constructor(r,t,o){super();T(this,"ref");T(this,"pubsub");T(this,"semaphore");T(this,Fl,Pr);T(this,Ll,Pc);T(this,Pl,Gp);T(this,$l,Jp);T(this,Al,Kb);T(this,"get");this.ref=r,this.pubsub=t,this.semaphore=o,this.get=Fi(this.ref)}commit(){return this.get}get changes(){return me(Fi(this.ref),Bt(r=>ut(Kp(this.pubsub,{scoped:!0}),t=>Zp(Xp(r),t))),this.semaphore.withPermits(1),Yp)}modify(r){return this.modifyEffect(t=>Un(r(t)))}modifyEffect(r){return me(Fi(this.ref),Bt(r),Bt(([t,o])=>me(pu(this.ref,o),$a(t),_u(Aa(this.pubsub,o)))),this.semaphore.withPermits(1))}}const Xb=n=>me(du([fu(),Vp(n),hu(1)]),ut(([i,r,t])=>new Zb(r,i,t))),ev=Oe(2,(n,i)=>me(pu(n.ref,i),_u(Aa(n.pubsub,i)),n.semaphore.withPermits(1))),dd=Xb,xr=ev,eo=My,tv=id,fd=By,nv=Wy,sv=n=>i=>Ye(i,r=>fe(()=>n(r))),hd=n=>i=>em(i,r=>me(n(r),ut(()=>r))),rv=()=>tv([]),Lc=(n,i)=>nv(n,r=>tm(r,i)),Fc=n=>fd(n,[]),iv=(n,i,r)=>Vb(function*(){const t=yield*eo(n);if(t.length<i)return yield*Gb;{const o=t.splice(0,Math.min(r,t.length));return yield*fd(n,t),o}}),av=n=>eo(n),ov=n=>eo(n).pipe(ut(i=>i.length)),Nc=Oe(2,(n,i)=>me(n.changes,Wt(i),Lr(1),nm,ut(uu))),zc=Symbol.for("effect/Subscribable");var zl,Ul,Hl;class cv extends(Hl=si,Ul=zc,zl=Pr,Hl){constructor(r,t){super();T(this,"get");T(this,"changes");T(this,Ul,zc);T(this,zl,Pr);this.get=r,this.changes=t}commit(){return this.get}}const mi=n=>new cv(n.get,n.changes);Oe(2,(n,i)=>mi({get:ut(n.get,i),changes:pn(n.changes,i)}));Oe(2,(n,i)=>mi({get:Bt(n.get,i),changes:mu(n.changes,i)}));mi({get:gu,changes:sm});const lv=n=>`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}.${n.getMilliseconds().toString().padStart(3,"0")}`,uv=n=>Ab(Pb,Lb({formatDate:i=>`${lv(i)} ${n}`})),Uc={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var Hc={};const Bs=n=>{if(typeof process<"u"&&Hc!==void 0)return Hc[n];if(Uc!==void 0)return Uc[n]},vs=Bs("LS_TRACE_VERBOSE")!==void 0||Bs("VITE_LS_TRACE_VERBOSE")!==void 0,Vt=Oi(Bs("LS_DEV"))||Oi(Bs("VITE_LS_DEV"));Oi(Bs("CI"));const to=typeof navigator<"u"&&navigator.product==="ReactNative",dv=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],fv=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],hv=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],_v=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],jc=(n,i,r)=>{let t=n;return typeof i=="string"||Array.isArray(i)?t=n.toLocaleString(i,r):(i===!0||r!==void 0)&&(t=n.toLocaleString(void 0,r)),t};function pv(n,i){if(!Number.isFinite(n))throw new TypeError(`Expected a finite number, got ${typeof n}: ${n}`);i={bits:!1,binary:!1,space:!0,...i};const r=i.bits?i.binary?_v:hv:i.binary?fv:dv,t=i.space?" ":"";if(i.signed&&n===0)return` 0${t}${r[0]}`;const o=n<0,l=o?"-":i.signed?"+":"";o&&(n=-n);let f;if(i.minimumFractionDigits!==void 0&&(f={minimumFractionDigits:i.minimumFractionDigits}),i.maximumFractionDigits!==void 0&&(f={maximumFractionDigits:i.maximumFractionDigits,...f}),n<1){const D=jc(n,i.locale,f);return l+D+t+r[0]}const g=Math.min(Math.floor(i.binary?Math.log(n)/Math.log(1024):Math.log10(n)/3),r.length-1);n/=(i.binary?1024:1e3)**g,f||(n=n.toPrecision(3));const w=jc(Number(n),i.locale,f),x=r[g];return l+w+t+x}const On=n=>j(function*(){const i=yield*ri();return yield*We(r=>Fe(i,r)),yield*n(i).pipe(ii(i))}),mv=n=>Ys(()=>n()).pipe(Us(i=>Yl(i)?i:im(i)?$n(()=>i):Un(i))),gv=(...n)=>We(()=>La(...n)),ue=n=>$t(n,i=>j(function*(){if(ni(i))return;const r=yield*ai.pipe(An("NoSuchElementException",o=>Un(void 0))),t=i.toString().split(`
`)[0];yield*zs(t,i).pipe(o=>r===void 0?o:ln({spanId:r.spanContext().spanId,traceId:r.spanContext().traceId})(o))})),rt=(n,i)=>am(La(n).pipe(ln(i??{})),om,()=>cm(Fb)),no=({label:n,duration:i})=>r=>j(function*(){const t=yield*Ks();let o=!1;const l=Pa(i).pipe(Et(()=>(o=!0,wt(`${n}: Took longer than ${i}ms`))),ct(t),Ft),f=Date.now(),g=yield*r.pipe(Fr,rm(oi(function*(){const w=Date.now();yield*os(l),o&&(yield*wt(`${n}: Interrupted after ${w-f}ms`))})));if(o){const w=Date.now();yield*wt(`${n}: Actual duration: ${w-f}ms`)}return yield*os(l),yield*g}),yv=n=>i=>Et(i,r=>fe(()=>n(r))),_d=n=>i=>yu(fe(()=>performance.mark(`${n}:start`)),()=>i,()=>fe(()=>{performance.mark(`${n}:end`),performance.measure(n,`${n}:start`,`${n}:end`)})),pd=()=>{const n=lm();return n._tag==="None"||n.value.currentSpan===void 0?"No current fiber":""},bv=()=>console.log(pd());globalThis.getSpanTrace=pd;globalThis.logSpanTrace=bv;const vv=Symbol.for("@effect/platform/WorkerError"),Oc=vv;var jl,Ol;const an=class an extends(Ol=Hn()("WorkerError",{reason:Re("spawn","decode","send","unknown","encode"),cause:Nr}),jl=Oc,Ol){constructor(){super(...arguments);T(this,jl,Oc)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};T(an,"Cause",um({error:an,defect:Nr})),T(an,"encodeCause",bu(an.Cause)),T(an,"decodeCause",Hs(an.Cause));let Gt=an;const Mc=Symbol.for("@effect/platform/Worker/PlatformWorker"),so=Fa("@effect/platform/Worker/PlatformWorker"),Bc=Symbol.for("@effect/platform/Worker/WorkerManager"),Ws=Fa("@effect/platform/Worker/WorkerManager"),md=Fa("@effect/platform/Worker/Spawner"),wv=j(function*(){const n=yield*so;let i=0;return Ws.of({[Bc]:Bc,spawn({encode:r,initialMessage:t}){return j(function*(){const o=i++;let l=0;const f=new Map,g=mm(),w=r?b=>ws(g.clear,vu(r(b),qm,g)):Un,x=yield*Se(),D=yield*n.spawn(o);yield*D.run(b=>b[0]===0?gm(x,un):q(b[1])).pipe(ym(b=>qn(f.values(),y=>bn in y?Ts(y,b):y.failCause(b))),$t(wt),li(ju(1e3)),ln({package:"@effect/platform",module:"Worker"}),St,we),yield*We(()=>ws(qn(f.values(),b=>bn in b?ic(b):b.end,{discard:!0}),fe(()=>f.clear())));const q=b=>Ur(()=>{const y=f.get(b[0]);if(!y)return un;switch(b[1]){case 0:return bn in y?Me(y,b[2][0]):y.offerAll(b[2]);case 1:return b.length===2?bn in y?ic(y):y.end:bn in y?Me(y,b[2][0]):ws(y.offerAll(b[2]),y.end);case 2:case 3:{if(b[1]===2)return bn in y?za(y,b[2]):y.fail(b[2]);const h=Gt.decodeCause(b[2]);return bn in y?Ts(y,h):y.failCause(h)}}}),A=(b,y)=>ei(h=>{const S=h.getFiberRef(Bl),_=wu(S,Su).pipe(Sm(I=>I._tag==="Span")),E=l++;return y.pipe(Et(I=>(f.set(E,I),w(b).pipe(Et(R=>D.send([E,0,R,_._tag==="Some"?[_.value.traceId,_.value.spanId,_.value.sampled]:void 0],g.unsafeRead())),Ia(R=>jb(I)?I.failCause(R):Ts(I,R))))),ut(I=>({id:E,mailbox:I})))}),z=({id:b},y)=>{const h=fe(()=>f.delete(b));return ti(y)?ws(st(D.send([b,1])),h):h},N=b=>bm(lb(A(b,Ob()),({mailbox:y})=>Mb(y),z)),P=b=>yu(A(b,Se()),({mailbox:y})=>Dn(y),z);return yield*Dn(x),t&&(yield*fe(t).pipe(Bt(P),Na(b=>new Gt({reason:"spawn",cause:b})))),{id:o,execute:N,executeEffect:P}})}})}),Sv=hm(Ws,wv),gd=n=>j(function*(){const r=yield*(yield*Ws).spawn({...n,encode(l){return Na(fm(l),f=>new Gt({reason:"encode",cause:f}))}}),t=l=>{const f=Ss(sc(l)),g=Ss(rc(l));return me(r.execute(l),pm(w=>Bt(g(w),zr)),mu(f))},o=l=>{const f=Ss(sc(l)),g=Ss(rc(l));return _m(r.executeEffect(l),{onFailure:w=>Bt(g(w),zr),onSuccess:f})};return hn({id:r.id,execute:t,executeEffect:o})}),Ev=n=>j(function*(){const i=yield*Ws,r=new Set,t=me(gd(n),Et(f=>fe(()=>r.add(f))),Et(f=>We(()=>fe(()=>r.delete(f)))),n.onCreate?Et(n.onCreate):hn,vu(Ws,i)),o=yield*"timeToLive"in n?Wb({acquire:t,min:n.minSize,max:n.maxSize,concurrency:n.concurrency,targetUtilization:n.targetUtilization,timeToLive:n.timeToLive}):Bb({acquire:t,size:n.size,concurrency:n.concurrency,targetUtilization:n.targetUtilization}),l={backing:o,broadcast:f=>qn(r,g=>g.executeEffect(f),{concurrency:"unbounded",discard:!0}),execute:f=>dm(ut(o.get,g=>g.execute(f))),executeEffect:f=>Pn(Bt(o.get,g=>g.executeEffect(f)))};return yield*Pn(o.get),l}),qv=n=>ci(md,n),kv=()=>n=>so.of({[Mc]:Mc,spawn(i){return j(function*(){const r=yield*md;let t;const o=[];return{run:g=>xa(w=>j(function*(){const x=yield*vm,D=yield*n.setup({worker:r(i),scope:x});t=D,yield*Mi(x,fe(()=>{t=void 0}));const q=(yield*Ks()).pipe(Kg(wm(Em))),A=yield*vb(),z=Uu(q);if(yield*n.listen({port:D,scope:x,emit(N){Sb(A,z(g(N)))},deferred:A.deferred}),o.length>0){for(const[N,P]of o)D.postMessage([0,N],P);o.length=0}return yield*w(Eb(A))}).pipe(Pn)),send:(g,w)=>Ys({try:()=>{t===void 0?o.push([g,w]):t.postMessage([0,g],w)},catch:x=>new Gt({reason:"send",cause:x})})}})}}),Cv=kv,xv=so,Iv=Sv,Tv=gd,Rv=Ev,Dv=qv,Ve=Symbol("WebChannel"),Vs=X("WebChannel.DebugPing",{message:F,payload:Ln(F)}),Wr=X("WebChannel.Ping",{requestId:F}),Vr=X("WebChannel.Pong",{requestId:F}),Av=ce(Wr,Vr),Wc=n=>({send:ce(n.send,Vs,Wr,Vr),listen:ce(n.listen,Vs,Wr,Vr)}),tr=n=>Pt(n,"send")&&Pt(n,"listen")?Wc(n):Wc({send:n,listen:n}),gi=n=>i=>i.pipe(Eu(oi(function*(r){return r._tag==="Right"&&Ie(Vs)(r.right)?(yield*He(`WebChannel:ping [${n}] ${r.right.message}`,r.right.payload),!1):!0}))),ro=({channelName:n,schema:i})=>On(r=>j(function*(){const t=tr(i),o=new BroadcastChannel(n);yield*We(()=>Ys(()=>o.close()).pipe(ja));const l=x=>j(function*(){const D=yield*qu(t.send)(x);o.postMessage(D)}),f=ui(o,"message").pipe(pn(x=>Zs(t.listen)(x.data)),gi(n)),g=yield*Se().pipe(Te(_n(Lt))),w=!1;return{[Ve]:Ve,send:l,listen:f,closedDeferred:g,shutdown:Fe(r,kt("shutdown")),schema:t,supportsTransferables:w}}).pipe(ie(`WebChannel:broadcastChannel(${n})`))),ra=({listenWindow:n,sendWindow:i,targetOrigin:r="*",ids:t,schema:o})=>On(l=>j(function*(){const f=tr(o),g={sendTotal:0,listenTotal:0,targetOrigin:r,ids:t},w=qe({message:f.listen,from:Re(t.other),to:Re(t.own)}).annotations({title:"webmesh.WindowMessageListen"}),x=qe({message:f.send,from:Re(t.own),to:Re(t.other)}).annotations({title:"webmesh.WindowMessageSend"}),D=N=>j(function*(){g.sendTotal++;const[P,b]=yield*Ua(x)({message:N,from:t.own,to:t.other});i.postMessage(P,r,b)}),q=ui(n,"message").pipe(Wt(N=>Ie(xm(w))(N.data)),pn(N=>(g.listenTotal++,Zs(f.listen)(N.data.message))),gi("window")),A=yield*Se().pipe(Te(_n(Lt))),z=!0;return{[Ve]:Ve,send:D,listen:q,closedDeferred:A,shutdown:Fe(l,kt("shutdown")),schema:f,supportsTransferables:z,debugInfo:g}}).pipe(ie("WebChannel:windowChannel"))),$v=({port:n,schema:i,debugId:r})=>On(t=>j(function*(){const o=tr(i),l=r===void 0?"messagePort":`messagePort:${r}`,f=D=>j(function*(){const[q,A]=yield*Ua(o.send)(D);n.postMessage(q,A)}),g=ui(n,"message").pipe(pn(D=>Zs(o.listen)(D.data)),gi(l));n.start();const w=yield*Se().pipe(Te(_n(Lt))),x=!0;return yield*We(()=>Ys(()=>n.close()).pipe(ja)),{[Ve]:Ve,send:f,listen:g,closedDeferred:w,shutdown:Fe(t,kt("shutdown")),schema:o,supportsTransferables:x}}).pipe(ie("WebChannel:messagePortChannel")));Cm("livestore:sameThreadChannels",()=>new Map);const Vc=({port:n,schema:i,debugId:r})=>On(t=>j(function*(){const o=tr(i),l=r===void 0?"messagePort":`messagePort:${r}`,f=new Map,g=X("ChannelRequest",{id:F,payload:ce(o.listen,o.send)}).annotations({title:"webmesh.ChannelRequest"}),w=X("ChannelRequestAck",{reqId:F}).annotations({title:"webmesh.ChannelRequestAck"}),x=ce(g,w).annotations({title:"webmesh.ChannelMessage"}),D={sendTotal:0,sendPending:0,listenTotal:0,id:r},q=P=>j(function*(){D.sendTotal++,D.sendPending++;const b=crypto.randomUUID(),[y,h]=yield*Ua(x)({_tag:"ChannelRequest",id:b,payload:P}),S=yield*Se();f.set(b,S),n.postMessage(y,h),yield*S,f.delete(b),D.sendPending--}),A=ui(n,"message").pipe(pn(P=>Zs(x)(P.data)),Ye(P=>j(function*(){P._tag==="Right"&&(P.right._tag==="ChannelRequestAck"?yield*Me(f.get(P.right.reqId),void 0):P.right._tag==="ChannelRequest"&&(D.listenTotal++,n.postMessage(bu(x)({_tag:"ChannelRequestAck",reqId:P.right.id}))))})),km(P=>P._tag==="Left"?$r(P):P.right._tag==="ChannelRequest"?$r(Xr(P.right.payload)):bt()),P=>P,gi(l));n.start();const z=yield*Se().pipe(Te(_n(Lt))),N=!0;return yield*We(()=>Ys(()=>n.close()).pipe(ja)),{[Ve]:Ve,send:q,listen:A,closedDeferred:z,shutdown:Fe(t,kt("shutdown")),schema:o,supportsTransferables:N,debugInfo:D}}).pipe(ie("WebChannel:messagePortChannelWithAck"))),Gc=(n,i)=>j(function*(){const r=yield*vt().pipe(Te(Ot)),t={current:void 0};if(yield*n.listen.pipe(i!=null&&i.heartbeat?Eu(oi(function*(l){if(l._tag==="Right"&&Ie(Av)(l.right)){if(l.right._tag==="WebChannel.Ping")yield*n.send(Vr.make({requestId:l.right.requestId}));else{const{deferred:f,requestId:g}=t.current??ge("No pending ping");g!==l.right.requestId&&ge("Received pong for unexpected requestId",g,l.right.requestId),yield*Me(f,void 0)}return!1}return!0})):hn,hd(l=>Ha(r,l)),je,we),i!=null&&i.heartbeat){const{interval:l,timeout:f}=i.heartbeat;yield*j(function*(){for(;;){yield*Pa(l);const g=crypto.randomUUID();yield*n.send(Wr.make({requestId:g}));const w=yield*Se();t.current={deferred:w,requestId:g},yield*w.pipe(cs(f),An("TimeoutException",()=>n.shutdown))}}).pipe(ie("WebChannel:heartbeat"),we)}const o=Fn(r,{maxChunkSize:1});return{[Ve]:Ve,send:n.send,listen:o,closedDeferred:n.closedDeferred,shutdown:n.shutdown,schema:n.schema,supportsTransferables:n.supportsTransferables,debugInfo:{innerDebugInfo:n.debugInfo,listenQueueSize:r}}}),yd=n=>i=>{if(Pt(console,"createTask")===!1)return i;const r=j(function*(){const o=yield*Im;return Tm({span:(l,...f)=>{const g=o.span(l,...f),w=n(l);return g.runInTask=x=>w.run(x),g},context:(l,f)=>{const g=wu(Su)(f.currentContext);if(g._tag==="None")return o.context(l,f);const w=g.value;if(w._tag==="ExternalSpan")return o.context(l,f);const x=w;return"runInTask"in x&&typeof x.runInTask=="function"?x.runInTask(()=>o.context(l,f)):o.context(l,f)}})}),t=me(r,ut(Dm),Rm);return ct(i,t)},Pv=Cv()({setup({scope:n,worker:i}){const r="port"in i?i.port:i;return $a(Mi(n,fe(()=>{r.postMessage([1])})),r)},listen({deferred:n,emit:i,port:r,scope:t}){function o(f){i(f.data)}function l(f){Ra(n,new Gt({reason:"unknown",cause:f.error??f.message}))}return r.addEventListener("message",o),r.addEventListener("error",l),"start"in r&&r.start(),Mi(t,fe(()=>{r.removeEventListener("message",o),r.removeEventListener("error",l)}))}}),Lv=ci(xv,Pv),Fv=$m(Iv,Lv),Nv=n=>Am(Fv,Dv(n)),Qc=Nv,zv=me(Hu(Lm(10),4),Zg(ju(Bi(1))),Xg(ey),ty(Pm(Bi(10)))),Uv=(n,i)=>Ca((r,t)=>{t.aborted||navigator.locks.request(i,{signal:t,mode:"exclusive",ifAvailable:!1},o=>(r(un),di(Dn(n)))).catch(o=>{if(!(o.code===20&&o.message==="signal is aborted without reason"))throw o})}),Hv=(n,i)=>Ca((r,t)=>{navigator.locks.request(i,{mode:"exclusive",ifAvailable:!0},o=>{r(Un(o!==null));const l=new Promise(f=>{t.addEventListener("abort",()=>{f()})});return Promise.race([di(Dn(n)),l])})});qe({name:F,args:tt,seqNum:Ne,parentSeqNum:Ne,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyDecoded"});const jv=qe({name:F,args:tt,seqNum:Ne,parentSeqNum:Ne,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyEncoded"}),Ov=qe({name:F,args:tt,seqNum:oc,parentSeqNum:oc,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),Mv=qe({name:F,args:tt}),Bv=n=>ce(...[...n.eventsDefsMap.values()].map(i=>qe({name:Re(i.name),args:i.schema,seqNum:Ne,parentSeqNum:Ne,clientId:F,sessionId:F}))).annotations({title:"EventDef"}),bd=Fm(Bv),Ls=class Ls extends jn("LiveStoreEvent.EncodedWithMeta")({name:F,args:tt,seqNum:Ne,parentSeqNum:Ne,clientId:F,sessionId:F,meta:qe({sessionChangeset:ce(X("sessionChangeset",{data:Nm,debug:tt.pipe(Ln)}),X("no-op",{}),X("unset",{})),syncMetadata:Er(fi),materializerHashLeader:Er(Pe),materializerHashSession:Er(Pe)}).pipe(ku,Ln,Cu({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:bt(),materializerHashLeader:bt(),materializerHashSession:bt()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:bt(),materializerHashLeader:bt(),materializerHashSession:bt()})}))}){constructor(){super(...arguments);T(this,"toJSON",()=>({seqNum:`${qt(this.seqNum)} → ${qt(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args}));T(this,"rebase",(r,t)=>new Ls({...this,...Oa(r,t)}));T(this,"toGlobal",()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global}))}};T(Ls,"fromGlobal",(r,t)=>new Ls({...r,seqNum:{global:r.seqNum,client:ac},parentSeqNum:{global:r.parentSeqNum,client:ac},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:t.syncMetadata,materializerHashLeader:t.materializerHashLeader,materializerHashSession:t.materializerHashSession}}));let lt=Ls;const Jc=(n,i)=>n.seqNum.global===i.seqNum.global&&n.seqNum.client===i.seqNum.client&&n.name===i.name&&n.clientId===i.clientId&&n.sessionId===i.sessionId&&JSON.stringify(n.args)===JSON.stringify(i.args);class vE extends Hn()("IsOfflineError",{}){}class wE extends Hn()("InvalidPushError",{reason:ce(X("Unexpected",{message:F}),X("ServerAhead",{minimumExpectedNum:Pe,providedNum:Pe}))}){}class SE extends Hn()("InvalidPullError",{message:F}){}class Wv extends Hn()("LeaderAheadError",{minimumExpectedNum:Ne,providedNum:Ne}){}class At extends jn("SyncState")({pending:pe(lt),upstreamHead:Ne,localHead:Ne}){constructor(){super(...arguments);T(this,"toJSON",()=>({pending:this.pending.map(r=>r.toJSON()),upstreamHead:qt(this.upstreamHead),localHead:qt(this.localHead)}))}}class vd extends X("upstream-rebase",{rollbackEvents:pe(lt),newEvents:pe(lt)}){}class wd extends X("upstream-advance",{newEvents:pe(lt)}){}class Vv extends X("local-push",{newEvents:pe(lt)}){}class Gv extends ce(vd,wd,Vv){}class Sd extends ce(vd,wd){}class yi extends jn("MergeContext")({payload:Gv,syncState:At}){constructor(){super(...arguments);T(this,"toJSON",()=>({payload:Hm(this.payload).pipe(Ni("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(t=>t.toJSON())})),Ni("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(t=>t.toJSON())})),Ni("upstream-rebase",t=>({_tag:"upstream-rebase",newEvents:t.newEvents.map(o=>o.toJSON()),rollbackEvents:t.rollbackEvents.map(o=>o.toJSON())})),jm),syncState:this.syncState.toJSON()}))}}class ks extends jn("MergeResultAdvance")({_tag:Re("advance"),newSyncState:At,newEvents:pe(lt),confirmedEvents:pe(lt),mergeContext:yi}){constructor(){super(...arguments);T(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(r=>r.toJSON()),confirmedEvents:this.confirmedEvents.map(r=>r.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class ia extends jn("MergeResultRebase")({_tag:Re("rebase"),newSyncState:At,newEvents:pe(lt),rollbackEvents:pe(lt),mergeContext:yi}){constructor(){super(...arguments);T(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(r=>r.toJSON()),rollbackEvents:this.rollbackEvents.map(r=>r.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class Ed extends jn("MergeResultReject")({_tag:Re("reject"),expectedMinimumId:Ne,mergeContext:yi}){constructor(){super(...arguments);T(this,"toJSON",()=>({_tag:this._tag,expectedMinimumId:qt(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()}))}}class qd extends jn("MergeResultUnexpectedError")({_tag:Re("unexpected-error"),cause:te}){}class EE extends ce(ks,ia,Ed,qd){}const aa=n=>{if(Vt)debugger;return qd.make({_tag:"unexpected-error",cause:new te({cause:n})})},Yc=({syncState:n,payload:i,isClientEvent:r,isEqualEvent:t,ignoreClientEvents:o=!1})=>{var f,g,w;kd(n),Qv(i);const l=yi.make({payload:i,syncState:n});switch(i._tag){case"upstream-rebase":{const x=[...i.rollbackEvents,...n.pending],D=((f=i.newEvents.at(-1))==null?void 0:f.seqNum)??n.upstreamHead,q=Kc({events:n.pending,baseEventSequenceNumber:D,isClientEvent:r});return vn(ia.make({_tag:"rebase",newSyncState:new At({pending:q,upstreamHead:D,localHead:((g=q.at(-1))==null?void 0:g.seqNum)??D}),newEvents:[...i.newEvents,...q],rollbackEvents:x,mergeContext:l}))}case"upstream-advance":{if(i.newEvents.length===0)return vn(ks.make({_tag:"advance",newSyncState:new At({pending:n.pending,upstreamHead:n.upstreamHead,localHead:n.localHead}),newEvents:[],confirmedEvents:[],mergeContext:l}));for(let q=1;q<i.newEvents.length;q++)if(qr(i.newEvents[q-1].seqNum,i.newEvents[q].seqNum))return aa(`Events must be sorted in ascending order by event number. Received: [${i.newEvents.map(A=>qt(A.seqNum)).join(", ")}]`);if(qr(n.upstreamHead,i.newEvents[0].seqNum)||Ba(n.upstreamHead,i.newEvents[0].seqNum))return aa(`Incoming events must be greater than upstream head. Expected greater than: ${qt(n.upstreamHead)}. Received: [${i.newEvents.map(q=>qt(q.seqNum)).join(", ")}]`);const x=i.newEvents.at(-1).seqNum,D=oa({existingEvents:n.pending,incomingEvents:i.newEvents,isEqualEvent:t,isClientEvent:r,ignoreClientEvents:o});if(D===-1){const q=new Set(n.pending.map(b=>`${b.seqNum.global},${b.seqNum.client}`)),A=i.newEvents.filter(b=>!q.has(`${b.seqNum.global},${b.seqNum.client}`));let z=0;const[N,P]=zm(n.pending,(b,y)=>{if(o&&r(b))return z++,!1;const h=i.newEvents.at(y-z);return h?t(b,h)===!1:!0});return vn(ks.make({_tag:"advance",newSyncState:new At({pending:P,upstreamHead:x,localHead:((w=P.at(-1))==null?void 0:w.seqNum)??Um(n.localHead,x)}),newEvents:A,confirmedEvents:N,mergeContext:l}))}else{const q=n.pending.slice(D),A=Kc({events:q,baseEventSequenceNumber:x,isClientEvent:r}),z=oa({existingEvents:i.newEvents,incomingEvents:n.pending,isEqualEvent:t,isClientEvent:r,ignoreClientEvents:o});return vn(ia.make({_tag:"rebase",newSyncState:new At({pending:A,upstreamHead:x,localHead:A.at(-1).seqNum}),newEvents:[...i.newEvents.slice(z),...A],rollbackEvents:q,mergeContext:l}))}}case"local-push":{if(i.newEvents.length===0)return vn(ks.make({_tag:"advance",newSyncState:n,newEvents:[],confirmedEvents:[],mergeContext:l}));const x=i.newEvents.at(0);if(qr(x.seqNum,n.localHead)===!1){const q=Oa(n.localHead,!0).seqNum;return vn(Ed.make({_tag:"reject",expectedMinimumId:q,mergeContext:l}))}else return vn(ks.make({_tag:"advance",newSyncState:new At({pending:[...n.pending,...i.newEvents],upstreamHead:n.upstreamHead,localHead:i.newEvents.at(-1).seqNum}),newEvents:i.newEvents,confirmedEvents:[],mergeContext:l}))}default:Ma(i)}},oa=({existingEvents:n,incomingEvents:i,isEqualEvent:r,isClientEvent:t,ignoreClientEvents:o})=>{if(o){const l=n.filter(w=>!t(w)),f=oa({existingEvents:l,incomingEvents:i,isEqualEvent:r,isClientEvent:t,ignoreClientEvents:!1});if(f===-1)return-1;const g=n[f].seqNum;return n.findIndex(w=>Ba(w.seqNum,g))}return n.findIndex((l,f)=>{const g=i[f];return g&&!r(l,g)})},Kc=({events:n,baseEventSequenceNumber:i,isClientEvent:r})=>{let t=i;return n.map(o=>{const l=r(o),f=o.rebase(t,l);return t=f.seqNum,f})},Qv=n=>{for(let i=1;i<n.newEvents.length;i++)if(Hr(n.newEvents[i-1].seqNum,n.newEvents[i].seqNum))return aa(`Events must be ordered in monotonically ascending order by eventNum. Received: [${n.newEvents.map(r=>qt(r.seqNum)).join(", ")}]`)},kd=n=>{for(let i=0;i<n.pending.length;i++){const r=n.pending[i],t=n.pending[i+1];if(t===void 0)break;Hr(r.seqNum,t.seqNum)&&ge(`Events must be ordered in monotonically ascending order by eventNum. Received: [${n.pending.map(l=>qt(l.seqNum)).join(", ")}]`,{event:r,nextEvent:t}),t.seqNum.global>r.seqNum.global?t.seqNum.client!==0&&ge(`New global events must point to clientId 0 in the parentSeqNum. Received: (${qt(t.seqNum)})`,n.pending,{event:r,nextEvent:t}):Ba(t.parentSeqNum,r.seqNum)===!1&&ge("Events must be linked in a continuous chain via the parentSeqNum",n.pending,{event:r,nextEvent:t})}},vn=n=>(n._tag==="unexpected-error"||n._tag==="reject"||(kd(n.newSyncState),qr(n.newSyncState.upstreamHead,n.newSyncState.localHead)&&ge("Local head must be greater than or equal to upstream head",{localHead:n.newSyncState.localHead,upstreamHead:n.newSyncState.upstreamHead}),Hr(n.newSyncState.localHead,n.mergeContext.syncState.localHead)===!1&&ge("New local head must be greater than or equal to the previous local head",{localHead:n.newSyncState.localHead,previousLocalHead:n.mergeContext.syncState.localHead}),Hr(n.newSyncState.upstreamHead,n.mergeContext.syncState.upstreamHead)===!1&&ge("New upstream head must be greater than or equal to the previous upstream head",{upstreamHead:n.newSyncState.upstreamHead,previousUpstreamHead:n.mergeContext.syncState.upstreamHead})),n),Jv=({schema:n,clientSession:i,runtime:r,materializeEvent:t,rollback:o,refreshTables:l,span:f,params:g,confirmUnsavedChanges:w})=>{const x=bd(n),D={current:new At({localHead:i.leaderThread.initialState.leaderHead,upstreamHead:i.leaderThread.initialState.leaderHead,pending:[]})},q=vt().pipe(gt),A=h=>Wi(n,h.name).eventDef.options.clientOnly,z=rv().pipe(gt),N=(h,{otelContext:S})=>{let _=D.current.localHead;const E=h.map(({name:$,args:H})=>{const C=Wi(n,$),U=Oa(_,C.eventDef.options.clientOnly);return _=U.seqNum,new lt(Mm(x)({name:$,args:H,...U,clientId:i.clientId,sessionId:i.sessionId}))}),I=Yc({syncState:D.current,payload:{_tag:"local-push",newEvents:E},isClientEvent:A,isEqualEvent:Jc});if(I._tag==="unexpected-error")return ge("Unexpected error in client-session-sync-processor",I.cause);if(f.addEvent("local-push",{batchSize:E.length,mergeResult:vs?JSON.stringify(I):void 0}),I._tag!=="advance")return ge(`Expected advance, got ${I._tag}`);D.current=I.newSyncState,q.offer(I.newSyncState).pipe(gt);const R=new Set;for(const $ of I.newEvents){const H=Hs(x)($),{writeTables:C,sessionChangeset:U,materializerHash:J}=t(H,{otelContext:S,withChangeset:!0,materializerHashLeader:bt()});for(const re of C)R.add(re);$.meta.sessionChangeset=U,$.meta.materializerHashSession=J}return Lc(z,E).pipe(gt),{writeTables:R}},P={rebaseCount:0,advanceCount:0,rejectCount:0},b=Rt.setSpan(jt.active(),f),y=j(function*(){if(w&&typeof window<"u"&&typeof window.addEventListener=="function"){const E=I=>{D.current.pending.length>0&&I.preventDefault()};yield*Te(fe(()=>window.addEventListener("beforeunload",E)),()=>fe(()=>window.removeEventListener("beforeunload",E)))}const h=yield*ad(),S=j(function*(){const E=yield*iv(z,1,g.leaderPushBatchSize);yield*i.leaderThread.events.push(E).pipe(An("LeaderAheadError",()=>(P.rejectCount++,Fc(z))))}).pipe(js,St,ue);yield*Br(h,S);const _=()=>{var E;return((E=i.sqliteDb.select(Rs`SELECT mergeCounter FROM ${Om} WHERE id = 0`)[0])==null?void 0:E.mergeCounter)??0};yield*xu(()=>i.leaderThread.events.pull({cursor:{mergeCounter:_(),eventNum:D.current.localHead}})).pipe(Ye(({payload:E,mergeCounter:I})=>j(function*(){i.devtools.enabled&&(yield*i.devtools.pullLatch.await);const R=Yc({syncState:D.current,payload:E,isClientEvent:A,isEqualEvent:Jc});if(R._tag==="unexpected-error")return yield*zr(R.cause);if(R._tag==="reject")return ge("Unexpected reject in client-session-sync-processor",R);if(D.current=R.newSyncState,q.offer(R.newSyncState).pipe(gt),R._tag==="rebase"){f.addEvent("merge:pull:rebase",{payloadTag:E._tag,payload:vs?JSON.stringify(E):void 0,newEventsCount:R.newEvents.length,rollbackCount:R.rollbackEvents.length,res:vs?JSON.stringify(R):void 0,leaderMergeCounter:I}),P.rebaseCount++,yield*pb(h),yield*Fc(z),yield*Br(h,S),Vt&&He("merge:pull:rebase: rollback",R.rollbackEvents.length,...R.rollbackEvents.slice(0,10).map(H=>H.toJSON()),{leaderMergeCounter:I}).pipe(ct(r),gt);for(let H=R.rollbackEvents.length-1;H>=0;H--){const C=R.rollbackEvents[H];C.meta.sessionChangeset._tag!=="no-op"&&C.meta.sessionChangeset._tag!=="unset"&&(o(C.meta.sessionChangeset.data),C.meta.sessionChangeset={_tag:"unset"})}yield*Lc(z,R.newSyncState.pending)}else f.addEvent("merge:pull:advance",{payloadTag:E._tag,payload:vs?JSON.stringify(E):void 0,newEventsCount:R.newEvents.length,res:vs?JSON.stringify(R):void 0,leaderMergeCounter:I}),P.advanceCount++;if(R.newEvents.length===0)return;const $=new Set;for(const H of R.newEvents){const C=Hs(x)(H),{writeTables:U,sessionChangeset:J,materializerHash:re}=t(C,{otelContext:b,withChangeset:!0,materializerHashLeader:H.meta.materializerHashLeader});for(const M of U)$.add(M);H.meta.sessionChangeset=J,H.meta.materializerHashSession=re}l($)}).pipe(ue,Ia(R=>i.shutdown(R)))),je,js,St,ie("client-session-sync-processor:pull"),ue,we)});return{push:N,boot:y,syncState:mi({get:j(function*(){const h=D.current;return D===void 0?ge("Not initialized"):h}),changes:Fn(q)}),debug:{print:()=>j(function*(){console.log("debugInfo",P),console.log("syncState",D.current);const h=yield*ov(z);console.log("pushQueueSize",h);const S=yield*av(z);console.log("pushQueueItems",S.map(_=>_.toJSON()))}).pipe(ct(r),gt),debugInfo:()=>P}}},Yv="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let it=(n=21)=>{let i="",r=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)i+=Yv[r[n]&63];return i};const Cd=X("RequestSessions",{}),xd=X("SessionInfo",{storeId:F,clientId:F,sessionId:F,schemaAlias:F,isLeader:Nn}),Id=ce(Cd,xd),Td=({webChannel:n,sessionInfo:i})=>j(function*(){yield*n.send(i),yield*n.listen.pipe(dn(),Wt(Ie(Cd)),Ye(()=>n.send(i)),je)}),Kv=qe({queryStr:F,bindValues:Os(Ru),durationMs:Pe,rowsCount:Os(Pe),queriedTables:Tu(F),startTimePerfNow:Pe}),Zv=n=>Vm([n],{decode:i=>(r,t,o)=>{if(r instanceof kn){const l=Jm(pe(i))([...r],t);return cc(l,f=>kn.make(r.sizeLimit,f))}return lc(new uc(o,r))},encode:i=>(r,t,o)=>{if(r instanceof kn){const l=Qm(pe(i))([...r],t);return cc(l,f=>kn.make(r.sizeLimit,f))}return lc(new uc(o,r))}},{description:`BoundArray<${Gm(n)}>`,pretty:()=>i=>`BoundArray(${i.length})`,arbitrary:()=>i=>i.anything(),equivalence:()=>(i,r)=>i===r}),Zc=n=>Bm(qe({size:Pe,items:pe(n)}),Zv(Iu(n)),{encode:i=>({size:i.sizeLimit,items:[...i]}),decode:i=>kn.make(i.size,i.items)}),io=qe({slowQueries:Zc(Kv),queryFrameDuration:Pe,queryFrameCount:Pe,events:Zc(Wm(F,tt))});ku(io);const Qe="0.3.1",Xc=4,Xv=qe({isConnected:Nn,timestampMs:Pe,latchClosed:Nn}),$s=F,ao=F,Rd=F,Ir=Re(Qe),bi=(n,i)=>X(n,{liveStoreVersion:Ir,...i}).annotations({identifier:n}),ew=(n,i)=>bi(n,{clientId:ao,...i}),tw=(n,i)=>bi(n,{clientId:ao,sessionId:Rd,...i}),Ae=(n,i)=>bi(n,{clientId:ao,sessionId:Rd,requestId:$s,...i}),ke=(n,i)=>ew(n,{requestId:$s,...i}),oo=(n,i)=>{const r=X(`${n}.Response.Success`,{requestId:$s,liveStoreVersion:Ir,...i.success}).annotations({identifier:`${n}.Response.Success`}),t=i.error?X(`${n}.Response.Error`,{requestId:$s,liveStoreVersion:Ir,...i.error}).annotations({identifier:`${n}.Response.Error`}):Du;return{Request:X(`${n}.Request`,{requestId:$s,liveStoreVersion:Ir,...i.payload}).annotations({identifier:`${n}.Request`}),Response:ce(r,t),Success:r,Error:t}};class nw extends Ae("LSD.ClientSession.DebugInfoReq",{}){}class Dd extends Ae("LSD.ClientSession.DebugInfoRes",{debugInfo:io}){}class sw extends Ae("LSD.ClientSession.DebugInfoHistorySubscribe",{subscriptionId:F}){}class Ad extends Ae("LSD.ClientSession.DebugInfoHistoryRes",{debugInfoHistory:pe(io),subscriptionId:F}){}class rw extends Ae("LSD.ClientSession.DebugInfoHistoryUnsubscribe",{subscriptionId:F}){}class iw extends Ae("LSD.ClientSession.DebugInfoResetReq",{}){}class $d extends Ae("LSD.ClientSession.DebugInfoResetRes",{}){}class aw extends Ae("LSD.ClientSession.DebugInfoRerunQueryReq",{queryStr:F,bindValues:Os(Ru),queriedTables:Tu(F)}){}class Pd extends Ae("LSD.ClientSession.DebugInfoRerunQueryRes",{}){}let ow=class extends Ae("LSD.ClientSession.SyncHeadSubscribe",{subscriptionId:F}){},cw=class extends Ae("LSD.ClientSession.SyncHeadUnsubscribe",{subscriptionId:F}){},Ld=class extends Ae("LSD.ClientSession.SyncHeadRes",{local:Ne,upstream:Ne,subscriptionId:F}){};class lw extends Ae("LSD.ClientSession.ReactivityGraphSubscribe",{includeResults:Nn,subscriptionId:F}){}class uw extends Ae("LSD.ClientSession.ReactivityGraphUnsubscribe",{subscriptionId:F}){}class Fd extends Ae("LSD.ClientSession.ReactivityGraphRes",{reactivityGraph:tt,subscriptionId:F}){}class dw extends Ae("LSD.ClientSession.LiveQueriesSubscribe",{subscriptionId:F}){}class fw extends Ae("LSD.ClientSession.LiveQueriesUnsubscribe",{subscriptionId:F}){}class hw extends qe({_tag:Re("computed","db","graphql","signal"),id:Pe,label:F,hash:F,runs:Pe,executionTimes:pe(Pe),lastestResult:tt,activeSubscriptions:pe(qe({frames:pe(qe({name:F,filePath:F}))}))}){}class Nd extends Ae("LSD.ClientSession.LiveQueriesRes",{liveQueries:pe(hw),subscriptionId:F}){}let _w=class extends Ae("LSD.ClientSession.Ping",{}){},zd=class extends Ae("LSD.ClientSession.Pong",{}){},co=class extends tw("LSD.ClientSession.Disconnect",{}){};const pw=ce(nw,sw,rw,iw,aw,lw,uw,dw,fw,co,_w,ow,cw).annotations({identifier:"LSD.ClientSession.MessageToApp"}),mw=ce(Dd,Ad,$d,Pd,Fd,Nd,co,zd,Ld).annotations({identifier:"LSD.ClientSession.MessageFromApp"});class RE extends ke("LSD.Leader.ResetAllDataReq",{mode:Re("all-data","only-app-db")}){}class gw extends ke("LSD.Leader.DatabaseFileInfoReq",{}){}class el extends qe({fileSize:Pe,persistenceInfo:qe({fileName:F},{key:F,value:tt})}){}class yw extends ke("LSD.Leader.DatabaseFileInfoRes",{state:el,eventlog:el}){}class bw extends ke("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:F}){}class vw extends ke("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:F}){}class ww extends ke("LSD.Leader.NetworkStatusRes",{networkStatus:Xv,subscriptionId:F}){}class Sw extends ke("LSD.Leader.SyncingInfoReq",{}){}class Ew extends qe({enabled:Nn,metadata:Au({key:F,value:tt})}){}class qw extends ke("LSD.Leader.SyncingInfoRes",{syncingInfo:Ew}){}class kw extends ke("LSD.Leader.SyncHistorySubscribe",{subscriptionId:F}){}class Cw extends ke("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:F}){}class xw extends ke("LSD.Leader.SyncHistoryRes",{eventEncoded:Ov,metadata:Er(fi),subscriptionId:F}){}class Iw extends ke("LSD.Leader.SyncHeadSubscribe",{subscriptionId:F}){}class Tw extends ke("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:F}){}class Rw extends ke("LSD.Leader.SyncHeadRes",{local:Ne,upstream:Ne,subscriptionId:F}){}class Dw extends ke("LSD.Leader.SnapshotReq",{}){}class Aw extends ke("LSD.Leader.SnapshotRes",{snapshot:ns}){}const Ud=oo("LSD.Leader.LoadDatabaseFile",{payload:{data:ns},success:{},error:{cause:ce(X("unsupported-file",{}),X("unsupported-database",{}),X("unexpected-error",{cause:Nr}))}});class $w extends bi("LSD.Leader.SyncPull",{payload:Sd}){}class Pw extends ke("LSD.Leader.CommitEventReq",{eventEncoded:Mv}){}class Lw extends ke("LSD.Leader.CommitEventRes",{}){}class Fw extends ke("LSD.Leader.EventlogReq",{}){}class Nw extends ke("LSD.Leader.EventlogRes",{eventlog:ns}){}class zw extends ke("LSD.Leader.Ping",{}){}class Uw extends ke("LSD.Leader.Pong",{}){}class Hd extends ke("LSD.Leader.Disconnect",{}){}const lo=oo("LSD.Leader.SetSyncLatch",{payload:{closeLatch:Nn},success:{}}),uo=oo("LSD.Leader.ResetAllData",{payload:{mode:Re("all-data","only-app-db")},success:{}}),Hw=ce(Dw,Ud.Request,Fw,uo.Request,bw,vw,Hd,Pw,zw,gw,kw,Cw,Sw,Iw,Tw,lo.Request).annotations({identifier:"LSD.Leader.MessageToApp"});ce(Aw,Ud.Response,Nw,Hd,$w,ww,Lw,Uw,yw,xw,qw,Rw,uo.Success,lo.Success).annotations({identifier:"LSD.Leader.MessageFromApp"});const jw=ce(X("node",{url:F}),X("web",{}),X("browser-extension",{}));jw.pipe(Ym("_tag"),Iu);const Ow={client:{session:({storeId:n,clientId:i,sessionId:r})=>`client-session-${n}-${i}-${r}`,leader:({storeId:n,clientId:i})=>`client-leader-${n}-${i}`}},jd={sessionInfo:()=>"session-info",devtoolsClientSession:({storeId:n,clientId:i,sessionId:r})=>`devtools-channel(client-session-${n}-${i}-${r})`,devtoolsClientLeader:({storeId:n,clientId:i,sessionId:r})=>`devtools-channel(client-leader-${n}-${i}-${r})`},Mw={devtoolsClientSession:(n,{storeId:i,clientId:r,sessionId:t})=>n===jd.devtoolsClientSession({storeId:i,clientId:r,sessionId:t}),devtoolsClientLeader:(n,{storeId:i,clientId:r})=>n.startsWith(`devtools-channel(client-leader-${i}-${r}`)},Bw=n=>n.makeBroadcastChannel({channelName:jd.sessionInfo(),schema:Id}),nr=F.pipe(Ln,Cu({constructor:()=>it(10),decoding:()=>it(10)})),Mn={id:nr,target:F,source:F,channelName:F,hops:pe(F)},Od=Km.pipe(Ln);class Tr extends X("DirectChannelRequest",{...Mn,remainingHops:pe(F).pipe(Ln),channelVersion:Pe,reqId:Os(F),sourceId:F}){}class Md extends X("DirectChannelResponseSuccess",{...Mn,reqId:F,port:hi,remainingHops:pe(F),channelVersion:Pe}){}class fo extends X("DirectChannelResponseNoTransferables",{...Mn,reqId:F,remainingHops:pe(F)}){}class Bd extends X("ProxyChannelRequest",{...Mn,remainingHops:Od,channelIdCandidate:F}){}class Wd extends X("ProxyChannelResponseSuccess",{...Mn,reqId:F,remainingHops:pe(F),combinedChannelId:F,channelIdCandidate:F}){}class Vd extends X("ProxyChannelPayload",{...Mn,remainingHops:Od,payload:tt,combinedChannelId:F}){}class Gd extends X("ProxyChannelPayloadAck",{...Mn,reqId:F,remainingHops:pe(F),combinedChannelId:F}){}class ca extends X("NetworkEdgeAdded",{id:nr,source:F,target:F}){}class la extends X("NetworkTopologyRequest",{id:nr,hops:pe(F),source:F,target:Re("-")}){}class ua extends X("NetworkTopologyResponse",{id:nr,reqId:F,remainingHops:pe(F),nodeName:F,edges:pe(F),source:F,target:Re("-")}){}const Rr=X("BroadcastChannelPacket",{id:nr,channelName:F,payload:tt,hops:pe(F),source:F,target:Re("-")});class da extends ce(Tr,Md,fo){}class Qd extends ce(Bd,Wd,Vd,Gd){}class ho extends ce(da,Qd,ca,la,ua,Rr){}class br extends X("DirectChannelPing",{}){}class vr extends X("DirectChannelPong",{}){}class Ww extends Hn()("EdgeAlreadyExistsError",{target:F}){}const Ps=n=>({packetId:n.id,"span.label":n.id+(Pt(n,"reqId")&&n.reqId!==void 0?` for ${n.reqId}`:""),...n._tag!=="DirectChannelResponseSuccess"&&n._tag!=="ProxyChannelPayload"?{packet:n}:{}});qe({channelName:F,source:F,mode:ce(Re("proxy"),Re("direct"))});const Vw=Se,Gw=({nodeName:n,incomingPacketsQueue:i,target:r,checkTransferableEdges:t,channelName:o,schema:l,sendPacket:f,channelVersion:g,scope:w,sourceId:x})=>j(function*(){const D=yield*Vw(),q=yield*ai.pipe(Zm(()=>Un(void 0))),A={send:ce(l.send,br,vr),listen:ce(l.listen,br,vr)},z={current:{_tag:"Initial"}},N=({packet:h,respondToSender:S})=>j(function*(){const _=z.current;if(q==null||q.addEvent(`process:${h._tag}`,{channelState:_._tag,packetId:h.id,packetReqId:h.reqId,packetChannelVersion:Pt("channelVersion")(h)?h.channelVersion:void 0}),_._tag==="Initial")return ge();if(h._tag==="DirectChannelResponseNoTransferables")return yield*za(D,h),"close";if(h.channelVersion>g)return q==null||q.addEvent(`incoming packet has higher version (${h.channelVersion}), closing channel`),yield*Fe(w,kt("higher-version-expected")),"close";if(h.channelVersion<g){const E=Tr.make({source:n,sourceId:x,target:r,channelName:o,channelVersion:g,hops:[],remainingHops:h.hops,reqId:void 0});q==null||q.addEvent(`incoming packet has lower version (${h.channelVersion}), sending request to reconnect (${E.id})`),yield*f(E);return}if(_._tag==="Established"&&h._tag==="DirectChannelRequest")return h.sourceId===_.otherSourceId?void 0:(q==null||q.addEvent("force-new-channel"),yield*Fe(w,kt("force-new-channel")),"close");switch(h._tag){case"DirectChannelRequest":{if(_._tag!=="RequestSent")return;if(h.reqId!==_.reqPacketId){const I=Tr.make({source:n,sourceId:x,target:r,channelName:o,channelVersion:g,hops:[],remainingHops:h.hops,reqId:h.id});q==null||q.addEvent(`Re-sending new request (${I.id}) for incoming request (${h.id})`),yield*f(I)}if(n>r){q==null||q.addEvent("winner side: creating direct channel and sending response");const I=new MessageChannel,R=yield*Vc({port:I.port1,schema:A,debugId:g}).pipe(Us(Gc));yield*S(Md.make({reqId:h.id,target:r,source:n,channelName:h.channelName,hops:[],remainingHops:h.hops.slice(0,-1),port:I.port2,channelVersion:g})),z.current={_tag:"winner:ResponseSent",channel:R,otherSourceId:h.sourceId},yield*R.listen.pipe(dn(),Wt(Ie(br)),Lr(1),je),yield*R.send(vr.make({})),q==null||q.addEvent("winner side: established"),z.current={_tag:"Established",otherSourceId:h.sourceId},yield*Me(D,R)}else q==null||q.addEvent("loser side: waiting for response"),z.current={_tag:"loser:WaitingForResponse",otherSourceId:h.sourceId};break}case"DirectChannelResponseSuccess":{if(_._tag!=="loser:WaitingForResponse")return ge(`Expected to find direct channel response from ${r}, but was in ${_._tag} state`);const E=yield*Vc({port:h.port,schema:A,debugId:g}).pipe(Us(Gc)),I=yield*E.listen.pipe(dn(),Wt(Ie(vr)),Lr(1),je,Va);yield*E.send(br.make({})).pipe(cs(10),li({times:2})),yield*I,q==null||q.addEvent("loser side: established"),z.current={_tag:"Established",otherSourceId:_.otherSourceId},yield*Me(D,E);return}default:return Ma(h)}}).pipe(ie(`handleMessagePacket:${h._tag}:${h.source}→${h.target}`,{attributes:Ps(h)}));yield*j(function*(){for(;;){const h=yield*$u(i);if((yield*N(h))==="close")return}}).pipe(St,ue,we);const P=z.current;return P._tag!=="Initial"?ge(`Expected channel to be in Initial state, but was in ${P._tag} state`):(yield*j(function*(){const h=Tr.make({source:n,sourceId:x,target:r,channelName:o,channelVersion:g,hops:[],reqId:void 0});z.current={_tag:"RequestSent",reqPacketId:h.id};const S=t(h);if(S!==void 0)return yield*rt(`No transferable edges found for ${h.source}→${h.target}`),yield*zr(S);yield*f(h),q==null||q.addEvent(`initial edge request sent (${h.id})`)}),yield*D)}).pipe(Wa(`makeDirectChannel:${g}`)),Qw=({schema:n,newEdgeAvailablePubSub:i,channelName:r,checkTransferableEdges:t,nodeName:o,incomingPacketsQueue:l,target:f,sendPacket:g})=>On(w=>j(function*(){const x=it(),D=yield*vt(),q=yield*cb(),A=yield*Se(),z={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*j(function*(){const S=yield*Se();for(;;){z.connectCounter++;const R=z.connectCounter;yield*rt(`Connecting#${R}`);const $=yield*ri();yield*We(J=>Fe($,J));const H=yield*Pu(i).pipe(Ye(J=>rt(`new-conn:${J}`)),Lr(1),je,$a("new-edge"),Va),C=Gw({nodeName:o,sourceId:x,incomingPacketsQueue:l,target:f,checkTransferableEdges:t,channelName:r,schema:n,channelVersion:R,sendPacket:g,scope:$}).pipe(ii($),Ds($),Xm(bt())),U=yield*eg(C,H.pipe(tg));if(U==="new-edge")yield*Fe($,qa("new-edge"));else{const J=yield*U.pipe(Fr);if(J._tag==="Failure")yield*Fe($,J),ng(J.cause)&&Ie(fo)(J.cause.error)&&(yield*H.pipe(Fr));else{const re=J.value;yield*Me(S,{channel:re,makeDirectChannelScope:$,channelVersion:R});break}}}const{channel:_,makeDirectChannelScope:E,channelVersion:I}=yield*S;yield*rt(`Connected#${I}`),z.isConnected=!0,z.innerChannelRef.current=_,yield*Me(A,void 0),yield*_.listen.pipe(dn(),hd(R=>Ha(D,R)),je,ue,Ds(E)),yield*j(function*(){for(;;){const[R,$]=yield*ab(q);yield*_.send(R),yield*Me($,void 0),yield*ob(q)}}).pipe(Ds(E)),yield*_.closedDeferred,yield*Fe(E,kt("channel-closed")),yield*rt(`Disconnected#${I}`),z.isConnected=!1,z.innerChannelRef.current=void 0}).pipe(Pn,js,ue,we);const N=yield*Lu.pipe(st),P=S=>j(function*(){const _=yield*Se();z.pendingSends++,z.totalSends++,yield*ib(q,[S,_]),yield*_,z.pendingSends--}).pipe(Pn,Es(N)),b=Fn(D,{maxChunkSize:1}).pipe(pn(Xr)),y=yield*Se().pipe(Te(_n(Lt)));return{webChannel:{[Ve]:Ve,send:P,listen:b,closedDeferred:y,supportsTransferables:!0,schema:n,debugInfo:z,shutdown:Fe(w,kt("shutdown"))},initialEdgeDeferred:A}})),Jw=({queue:n,nodeName:i,newEdgeAvailablePubSub:r,sendPacket:t,target:o,channelName:l,schema:f})=>On(g=>j(function*(){const w={current:{_tag:"Initial"}},x={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},D=it(5);yield*Vi({channelIdCandidate:D});const q=yield*Lu.pipe(st),A=yield*dd(!1),z=j(function*(){return yield*Nc(A,U=>U!==!1)}),N=C=>j(function*(){yield*rt(`Connected (${C})`).pipe(Es(q)),w.current={_tag:"Established",listenSchema:f.listen,listenQueue:S,ackMap:_,combinedChannelId:C},yield*xr(A,w.current),x.isConnected=!0}),P=Ur(()=>t(Bd.make({channelName:l,hops:[],source:i,target:o,channelIdCandidate:D}))),b=C=>[D,C].sort().join("_"),y=yield*vt().pipe(Te(Ot)),h=({packet:C,respondToSender:U})=>j(function*(){const re=`target:${C.source}, channelName:${C.channelName}`,M=w.current;switch(C._tag){case"ProxyChannelRequest":{const be=b(C.channelIdCandidate);M._tag==="Established"?M.combinedChannelId===be||(yield*wt(`[${i}] Received ProxyChannelRequest with different channel ID (${be}) while established with ${M.combinedChannelId}. Re-establishing.`),yield*xr(A,!1),w.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*rt("Reconnecting (received conflicting ProxyChannelRequest)").pipe(Es(q)),x.isConnected=!1,x.connectCounter++,yield*P):M._tag==="Initial"&&(yield*xr(A,!1),w.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*rt("Connecting (received ProxyChannelRequest)").pipe(Es(q)),x.isConnected=!1,x.connectCounter++),yield*U(Wd.make({reqId:C.id,remainingHops:C.hops,hops:[],target:o,source:i,channelName:l,combinedChannelId:be,channelIdCandidate:D}));return}case"ProxyChannelResponseSuccess":{if(M._tag!=="Pending"){if(M._tag==="Established"&&M.combinedChannelId!==C.combinedChannelId)return ge(`ProxyChannel[${re}]: Expected proxy channel to have the same combinedChannelId as the packet:
${M.combinedChannelId} (channel) === ${C.combinedChannelId} (packet)`);if(M._tag==="Established")return;yield*wt(`[${i}] Ignoring ResponseSuccess ${C.id} received in unexpected state ${M._tag}`);return}const be=b(C.channelIdCandidate);if(be!==C.combinedChannelId)return yield*dc(`ProxyChannel[${re}]: Expected proxy channel to have the same combinedChannelId as the packet:
${be} (channel) === ${C.combinedChannelId} (packet)`);yield*N(C.combinedChannelId);const Ce=w.current;if(Ce._tag==="Established"){const dt=yield*sg(y);for(const Le of dt){if(Ce.combinedChannelId!==Le.combinedChannelId){yield*wt(`[${i}] Discarding buffered payload ${Le.id}: Combined channel ID mismatch during drain. Expected ${Ce.combinedChannelId}, got ${Le.combinedChannelId}`);continue}const Kt=yield*Gi(Ce.listenSchema)(Le.payload);yield*Ce.listenQueue.pipe(Mt(Kt))}}else yield*zs(`[${i}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${Ce._tag}`);return}case"ProxyChannelPayload":{if(M._tag==="Established"&&M.combinedChannelId!==C.combinedChannelId)return yield*dc(`ProxyChannel[${re}]: Expected proxy channel to have the same combinedChannelId as the packet:
${M.combinedChannelId} (channel) === ${C.combinedChannelId} (packet)`);if(yield*U(Gd.make({reqId:C.id,remainingHops:C.hops,hops:[],target:o,source:i,channelName:l,combinedChannelId:M._tag==="Established"?M.combinedChannelId:C.combinedChannelId})),M._tag==="Established"){const be=yield*Gi(M.listenSchema)(C.payload);yield*M.listenQueue.pipe(Mt(be))}else yield*Mt(y,C);return}case"ProxyChannelPayloadAck":{if(M._tag!=="Established"){yield*rt(`Not yet connected to ${o}. dropping message`),yield*wt(`[${i}] Received Ack but not established (State: ${M._tag}). Dropping Ack for ${C.reqId}`);return}const be=M.ackMap.get(C.reqId)??ge(`[ProxyChannel[${re}]] Expected ack for ${C.reqId}`);yield*Me(be,void 0),M.ackMap.delete(C.reqId);return}default:return Ma(C)}}).pipe(ie(`handleProxyPacket:${C._tag}:${C.source}->${C.target}`,{attributes:Ps(C)}));yield*Fn(n).pipe(Ye(h),je,ue,we);const S=yield*vt();yield*rt("Connecting");const _=new Map;{if(w.current._tag!=="Initial")return ge("Expected proxy channel to be Initial");w.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*P;const C=yield*Pu(r).pipe(Ye(()=>P),je,we),{combinedChannelId:U}=yield*z;yield*os(C),yield*N(U)}const E=C=>j(function*(){const U=yield*rg(f.send)(C),J=yield*ad(),re=yield*Se();x.pendingSends++,x.totalSends++;const M=j(function*(){const{combinedChannelId:Ce}=yield*Nc(A,Le=>Le!==!1);yield*j(function*(){const Le=yield*Se(),Kt=Vd.make({channelName:l,payload:U,hops:[],source:i,target:o,combinedChannelId:Ce});_.set(Kt.id,Le),yield*t(Kt),yield*Le,yield*Me(re,void 0),x.pendingSends--}).pipe(cs(100),li(Hu(10)),st)}).pipe($t(zs)),be=yield*A.changes.pipe(Wt(Ce=>Ce===!1),Ye(()=>Br(J,M)),je,Va);yield*Br(J,M),yield*re,yield*os(be)}).pipe(Pn,ie("sendAckWithRetry:ProxyChannelPayload"),Es(q)),I=Fn(S).pipe(pn(Xr)),R=yield*Se().pipe(Te(_n(Lt))),$=yield*Ks();return{[Ve]:Ve,send:E,listen:I,closedDeferred:R,supportsTransferables:!1,schema:f,shutdown:Fe(g,Lt),debugInfo:x,debug:{ping:(C="ping")=>E(Vs.make({message:C})).pipe(ct($),ue,Ft)}}}).pipe(Wa("makeProxyChannel"))),Yr=class Yr{constructor({timeout:i}){T(this,"values",new Map);T(this,"timeoutHandle");T(this,"timeoutMs");T(this,"onShutdown",()=>clearTimeout(this.timeoutHandle));this.timeoutMs=cu(i)}add(i){this.values.set(i,Date.now()),this.scheduleCleanup()}has(i){return this.values.has(i)}delete(i){this.values.delete(i)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const i=Date.now();for(const[r,t]of this.values.entries())i-t>=this.timeoutMs&&this.values.delete(r)}};T(Yr,"make",i=>j(function*(){const r=new Yr({timeout:i});return yield*We(()=>fe(()=>r.onShutdown())),r}));let fa=Yr;const Yw=n=>j(function*(){const i=new Map,r=yield*fa.make(ig(1)),t=yield*fu().pipe(Te(ag)),o=new Map,l=yield*vt().pipe(Te(Ot)),f=new Map,g=new Map,w=_=>{var E;if(_._tag==="DirectChannelRequest"&&(i.size===0||((E=i.get(_.target))==null?void 0:E.channel.supportsTransferables)===!1)||![...i.values()].some(I=>I.channel.supportsTransferables===!0))return fo.make({reqId:_.id,channelName:_.channelName,source:_.target,target:_.source,remainingHops:_.hops,hops:[]})},x=_=>j(function*(){var E,I;if(Ie(ca)(_)){yield*rt("NetworkEdgeAdded",{packet:_,nodeName:n}),yield*Aa(t,_.target);const R=Array.from(i).filter(([$])=>$!==_.source).map(([$,H])=>H.channel);yield*qn(R,$=>$.send(_),{concurrency:"unbounded"});return}if(Ie(Rr)(_)){const R=Array.from(i).filter(([C])=>!_.hops.includes(C)).map(([C,U])=>U.channel),$={..._,hops:[..._.hops,n]};if(yield*qn(R,C=>C.send($),{concurrency:"unbounded"}),_.source===n)return;const H=g.get(_.channelName);H!==void 0&&(yield*Mt(H,_));return}if(Ie(la)(_)){if(_.source!==n){const H=_.hops.at(-1)??ge(`${n}: Expected hops for packet`,_),C=i.get(H).channel,U=ua.make({reqId:_.id,source:_.source,target:_.target,remainingHops:_.hops.slice(0,-1),nodeName:n,edges:Array.from(i.keys())});yield*C.send(U)}const R=Array.from(i).filter(([H])=>!_.hops.includes(H)).map(([H,C])=>C.channel),$={..._,hops:[..._.hops,n]};yield*qn(R,H=>H.send($),{concurrency:"unbounded"});return}if(Ie(ua)(_)){if(_.source===n)f.get(_.reqId).set(_.nodeName,new Set(_.edges));else{const $=_.remainingHops.at(-1)??ge(`${n}: Expected remaining hops for packet`,_);yield*(((E=i.get($))==null?void 0:E.channel)??ge(`${n}: Expected edge channel (${$}) for packet`,_,"Available edges:",Array.from(i.keys()))).send({..._,remainingHops:_.remainingHops.slice(0,-1)})}return}if(i.has(_.target)){const R=i.get(_.target).channel,$=_.source===n?[]:[..._.hops,n];yield*Vi({hasDirectEdge:!0}),yield*R.send({..._,hops:$})}else if(_.remainingHops!==void 0){const R=_.remainingHops.at(-1)??ge(`${n}: Expected remaining hops for packet`,_),$=(I=i.get(R))==null?void 0:I.channel;if($===void 0){yield*wt(`${n}: Expected to find hop target ${R} in edges. Dropping packet.`,_);return}yield*$.send({..._,remainingHops:_.remainingHops.slice(0,-1),hops:[..._.hops,n]})}else{const R=_.source===n?[]:[..._.hops,n],$=Array.from(i).filter(([C])=>C!==_.source).map(([C,U])=>({name:C,channel:U.channel}));R.length===0&&$.length===0&&Vt&&(yield*wt(n,"no route found to",_.target,_._tag,"TODO handle better"));const H={..._,hops:R};yield*Vi({edgesToForwardTo:$.map(({name:C})=>C)}),yield*qn($,({channel:C})=>C.send(H),{concurrency:"unbounded"})}}).pipe(ie(`sendPacket:${_._tag}:${_.source}→${_.target}`,{attributes:Ps(_)}),st),D=({target:_,edgeChannel:E,replaceIfExists:I=!1})=>j(function*(){if(i.has(_))if(I)yield*q(_).pipe(st);else return yield*new Ww({target:_});const R=yield*E.listen.pipe(dn(),Ye(H=>j(function*(){const C=yield*Gi(ho)(H);if(!r.has(C.id))switch(r.add(C.id),C._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*x(C);break}default:if(C.target===n){const U=`target:${C.source}, channelName:${C.channelName}`;if(!o.has(U)){const M=yield*vt().pipe(Te(Ot));o.set(U,{queue:M,debugInfo:void 0})}const J=o.get(U).queue,re=M=>E.send(M).pipe(ie(`respondToSender:${M._tag}:${M.source}→${M.target}`,{attributes:Ps(M)}),st);Ie(Qd)(C)?yield*Mt(J,{packet:C,respondToSender:re}):Ie(da)(C)&&(yield*Mt(J,{packet:C,respondToSender:re})),(C._tag==="ProxyChannelRequest"||C._tag==="DirectChannelRequest")&&(yield*Mt(l,{channelName:C.channelName,source:C.source,mode:C._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(Ie(da)(C)){const U=w(C);if(U!==void 0)return yield*rt(`No transferable edges found for ${C.source}→${C.target}`),yield*E.send(U).pipe(ie(`sendNoTransferableResponse:${C.source}→${C.target}`,{attributes:Ps(U)}))}yield*x(C)}}})),je,St,st,ue,we);i.set(_,{channel:E,listenFiber:R});const $=ca.make({source:n,target:_});yield*x($).pipe(st)}).pipe(ln({"addEdge:target":_,nodeName:n}),ie(`addEdge:${n}→${_}`,{attributes:{supportsTransferables:E.supportsTransferables}})),q=_=>j(function*(){i.has(_)||(yield*new Ta(`No edge found for ${_}`)),yield*os(i.get(_).listenFiber),i.delete(_)}),A=({target:_,channelName:E})=>fe(()=>o.has(`target:${_}, channelName:${E}`)),z=({target:_,channelName:E,schema:I,mode:R,timeout:$=Bi(1),closeExisting:H=!1})=>j(function*(){var re;const C=tr(I),U=`target:${_}, channelName:${E}`;if(o.has(U)){const M=(re=o.get(U).debugInfo)==null?void 0:re.channel;M&&(H?(yield*M.shutdown,o.delete(U)):ge(`Channel ${U} already exists`,M))}if(o.has(U)===!1){const M=yield*vt().pipe(Te(Ot));o.set(U,{queue:M,debugInfo:void 0})}const J=o.get(U).queue;if(yield*We(()=>fe(()=>o.delete(U))),R==="direct"){const M=yield*vt().pipe(Te(Ot));yield*cg(J,1,10).pipe(Et(dt=>Ha(M,dt)),js,St,ue,we);const{webChannel:be,initialEdgeDeferred:Ce}=yield*Qw({nodeName:n,incomingPacketsQueue:M,newEdgeAvailablePubSub:t,target:_,channelName:E,schema:C,sendPacket:x,checkTransferableEdges:w});return o.set(U,{queue:J,debugInfo:{channel:be,target:_}}),yield*Ce,be}else{const M=yield*Jw({nodeName:n,newEdgeAvailablePubSub:t,target:_,channelName:E,schema:C,queue:J,sendPacket:x});return o.set(U,{queue:J,debugInfo:{channel:M,target:_}}),M}}).pipe(Wa(`makeChannel:${n}→${_}(${E})`,{attributes:{target:_,channelName:E,mode:R,timeout:$}}),ln({nodeName:n,target:_,channelName:E}));let N=!1;const P=xu(()=>{if(N)return ge("listenForChannel already started");N=!0;const _=I=>`${I.channelName}:${I.source}:${I.mode}`,E=new Set;return Fn(l).pipe(Wt(I=>{const R=_(I);return E.has(R)?!1:(E.add(R),!0)}))}),b=({channelName:_,schema:E})=>On(I=>j(function*(){if(g.has(_))return ge(`Broadcast channel ${_} already exists`,g.get(_));const R={},$=yield*vt().pipe(Te(Ot));g.set(_,$);const H=J=>j(function*(){const re=yield*qu(E)(J),M=Rr.make({channelName:_,payload:re,source:n,target:"-",hops:[]});yield*x(M)}),C=Fn($).pipe(Wt(Ie(Rr)),pn(J=>Zs(E)(J.payload))),U=yield*Se().pipe(Te(_n(Lt)));return{[Ve]:Ve,send:H,listen:C,closedDeferred:U,supportsTransferables:!1,schema:{listen:E,send:E},shutdown:Fe(I,Lt),debugInfo:R}})),y=fe(()=>new Set(i.keys())),h=yield*Ks();return{nodeName:n,addEdge:D,removeEdge:q,hasChannel:A,makeChannel:z,listenForChannel:P,makeBroadcastChannel:b,edgeKeys:y,debug:{print:()=>{var _,E,I,R;console.log("Webmesh debug info for node:",n),console.log("Edges:",i.size);for(const[$,H]of i)console.log(`  ${$}: supportsTransferables=${H.channel.supportsTransferables}`);console.log("Channels:",o.size);for(const[$,H]of o)console.log(hr($,2),`
`,Object.entries({target:(_=H.debugInfo)==null?void 0:_.target,supportsTransferables:(E=H.debugInfo)==null?void 0:E.channel.supportsTransferables,...(I=H.debugInfo)==null?void 0:I.channel.debugInfo}).map(([C,U])=>hr(`${C}=${U}`,4)).join(`
`),"    ",(R=H.debugInfo)==null?void 0:R.channel,`
`,hr(`Queue: ${H.queue.unsafeSize().pipe(og)}`,4),H.queue);console.log("Broadcast channels:",g.size);for(const[$,H]of g)console.log(hr($,2))},ping:_=>{j(function*(){const E=I=>Vs.make({message:`ping from ${n} via ${I}`,payload:_});for(const[I,R]of i)yield*He(`sending ping via edge ${I}`),yield*R.channel.send(E(`edge ${I}`));for(const[I,R]of o){if(R.debugInfo===void 0){yield*He(`channel ${I} has no debug info`);continue}yield*He(`sending ping via channel ${I}`),yield*R.debugInfo.channel.send(E(`channel ${I}`))}}).pipe(ct(h),ue,Ft)},requestTopology:(_=1e3)=>j(function*(){const E=la.make({source:n,target:"-",hops:[]}),I=new Map;I.set(n,new Set(i.keys())),f.set(E.id,I),yield*x(E),yield*He(`Waiting ${_}ms for topology response`),yield*Pa(_),yield*He(`Topology response (from ${n}):`);for(const[R,$]of I)yield*He(`  node '${R}' has edge to: ${Array.from($.values()).join(", ")}`)}).pipe(ct(h),ue,di)}}}).pipe(ie(`makeMeshNode:${n}`),ln({"makeMeshNode.nodeName":n})),Kw=({storeId:n,clientId:i,sessionId:r,isLeader:t,devtoolsEnabled:o,connectDevtoolsToStore:l,lockStatus:f,leaderThread:g,schema:w,sqliteDb:x,shutdown:D,connectWebmeshNode:q,webmeshMode:A,registerBeforeUnload:z,debugInstanceId:N})=>j(function*(){const P=o?{enabled:!0,pullLatch:yield*fc(!0),pushLatch:yield*fc(!0)}:{enabled:!1};return o&&(yield*j(function*(){const b=yield*Yw(Ow.client.session({storeId:n,clientId:i,sessionId:r}));globalThis.__debugWebmeshNode=b;const y=w.devtools.alias,h=xd.make({storeId:n,clientId:i,sessionId:r,schemaAlias:y,isLeader:t});yield*q({webmeshNode:b,sessionInfo:h});const S=yield*Bw(b);yield*Td({webChannel:S,sessionInfo:h}).pipe(ue,we),yield*b.listenForChannel.pipe(Wt(_=>Mw.devtoolsClientSession(_.channelName,{storeId:n,clientId:i,sessionId:r})&&_.mode===A),Ye(lg(function*({channelName:_,source:E}){const I=yield*b.makeChannel({target:E,channelName:_,schema:{listen:pw,send:mw},mode:A}),R=I.send(co.make({clientId:i,liveStoreVersion:Qe,sessionId:r})).pipe(st);yield*We(()=>R),yield*Te(fe(()=>z(()=>R.pipe(Ft))),$=>fe(()=>$())),yield*l(I)},ue,we)),je)}).pipe(ie("@livestore/common:make-client-session:devtools"),ue,we)),{sqliteDb:x,leaderThread:g,devtools:P,lockStatus:f,clientId:i,sessionId:r,shutdown:D,debugInstanceId:N}}),Jd=n=>(...i)=>{const[r,t,o]=i;if(Ga(r)){const{query:l,bindValues:f}=r.asSql();return n(l,f,t)}else return n(r,t,o)},Yd=n=>(...i)=>{const[r,t]=i;if(Ga(r)){const{query:o,bindValues:l}=r.asSql(),f=Fu(r),g=n(o,l);return Hs(f)(g)}else return n(r,t)},B=0,Zw=1,Gs=10,_o=12,sr=14,sn=21,zi=25,Xw=27,ha=100,eS=101,vi=522,Kd=778,tl=2,Gr=4,Qr=8,Zd=64,Xd=256,ef=2048,tf=16384,nf=524288,tS=2048,nl=1,sl=2,rl=3,il=4,al=5,nS=512;class sf{constructor(i,r){T(this,"name");T(this,"mxPathname",64);T(this,"_module");this.name=i,this._module=r}close(){}isReady(){return!0}hasAsyncMethod(i){return!1}xOpen(i,r,t,o,l){return sr}xDelete(i,r,t){return B}xAccess(i,r,t,o){return B}xFullPathname(i,r,t,o){return B}xGetLastError(i,r,t){return B}xClose(i){return B}xRead(i,r,t,o,l){return B}xWrite(i,r,t,o,l){return B}xTruncate(i,r,t){return B}xSync(i,r){return B}xFileSize(i,r){return B}xLock(i,r){return B}xUnlock(i,r){return B}xCheckReservedLock(i,r){return B}xFileControl(i,r,t){return _o}xSectorSize(i){return nS}xDeviceCharacteristics(i){return 0}}const sS=Object.getPrototypeOf(async function(){}).constructor;var at,Cs,_a,rf,Ml;let rS=(Ml=class extends sf{constructor(r,t){super(r,t);Ze(this,at)}hasAsyncMethod(r){const t=`j${r.slice(1)}`;return this[t]instanceof sS}getFilename(r){throw new Error("unimplemented")}jOpen(r,t,o,l){return sr}jDelete(r,t){return B}jAccess(r,t,o){return B}jFullPathname(r,t){const{read:o,written:l}=new TextEncoder().encodeInto(r,t);return o<r.length||l>=t.length?Gs:(t[l]=0,B)}jGetLastError(r){return B}jClose(r){return B}jRead(r,t,o){return t.fill(0),vi}jWrite(r,t,o){return Kd}jTruncate(r,t){return B}jSync(r,t){return B}jFileSize(r,t){return B}jLock(r,t){return B}jUnlock(r,t){return B}jCheckReservedLock(r,t){return t.setInt32(0,0,!0),B}jFileControl(r,t,o){return _o}jSectorSize(r){return super.xSectorSize(r)}jDeviceCharacteristics(r){return 0}xOpen(r,t,o,l,f){var x;const g=le(this,at,rf).call(this,t,l),w=le(this,at,Cs).call(this,"Int32",f);return(x=this.log)==null||x.call(this,"jOpen",g,o,"0x"+l.toString(16)),this.jOpen(g,o,l,w)}xDelete(r,t,o){var f;const l=this._module.UTF8ToString(t);return(f=this.log)==null||f.call(this,"jDelete",l,o),this.jDelete(l,o)}xAccess(r,t,o,l){var w;const f=this._module.UTF8ToString(t),g=le(this,at,Cs).call(this,"Int32",l);return(w=this.log)==null||w.call(this,"jAccess",f,o),this.jAccess(f,o,g)}xFullPathname(r,t,o,l){var w;const f=this._module.UTF8ToString(t),g=this._module.HEAPU8.subarray(l,l+o);return(w=this.log)==null||w.call(this,"jFullPathname",f,o),this.jFullPathname(f,g)}xGetLastError(r,t,o){var f;const l=this._module.HEAPU8.subarray(o,o+t);return(f=this.log)==null||f.call(this,"jGetLastError",t),this.jGetLastError(l)}xClose(r){var t;return(t=this.log)==null||t.call(this,"jClose",r),this.jClose(r)}xRead(r,t,o,l,f){var x;const g=le(this,at,_a).call(this,t,o),w=Ui(l,f);return(x=this.log)==null||x.call(this,"jRead",r,o,w),this.jRead(r,g,w)}xWrite(r,t,o,l,f){var x;const g=le(this,at,_a).call(this,t,o),w=Ui(l,f);return(x=this.log)==null||x.call(this,"jWrite",r,g,w),this.jWrite(r,g,w)}xTruncate(r,t,o){var f;const l=Ui(t,o);return(f=this.log)==null||f.call(this,"jTruncate",r,l),this.jTruncate(r,l)}xSync(r,t){var o;return(o=this.log)==null||o.call(this,"jSync",r,t),this.jSync(r,t)}xFileSize(r,t){var l;const o=le(this,at,Cs).call(this,"BigInt64",t);return(l=this.log)==null||l.call(this,"jFileSize",r),this.jFileSize(r,o)}xLock(r,t){var o;return(o=this.log)==null||o.call(this,"jLock",r,t),this.jLock(r,t)}xUnlock(r,t){var o;return(o=this.log)==null||o.call(this,"jUnlock",r,t),this.jUnlock(r,t)}xCheckReservedLock(r,t){var l;const o=le(this,at,Cs).call(this,"Int32",t);return(l=this.log)==null||l.call(this,"jCheckReservedLock",r),this.jCheckReservedLock(r,o)}xFileControl(r,t,o){var f;const l=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+o);return(f=this.log)==null||f.call(this,"jFileControl",r,t,l),this.jFileControl(r,t,l)}xSectorSize(r){var t;return(t=this.log)==null||t.call(this,"jSectorSize",r),this.jSectorSize(r)}xDeviceCharacteristics(r){var t;return(t=this.log)==null||t.call(this,"jDeviceCharacteristics",r),this.jDeviceCharacteristics(r)}},at=new WeakSet,Cs=function(r,t){const o=r==="Int32"?4:8,l=`get${r}`,f=`set${r}`,g=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+t,o);let w=g();return new Proxy(w,{get(x,D){if(w.buffer.byteLength===0&&(w=g()),D===l)return function(A,z){if(!z)throw new Error("must be little endian");return w[D](A,z)};if(D===f)return function(A,z,N){if(!N)throw new Error("must be little endian");return w[D](A,z,N)};if(typeof D=="string"&&D.match(/^(get)|(set)/))throw new Error("invalid type");const q=w[D];return typeof q=="function"?q.bind(w):q}})},_a=function(r,t){let o=this._module.HEAPU8.subarray(r,r+t);return new Proxy(o,{get:(l,f,g)=>{o.buffer.byteLength===0&&(o=this._module.HEAPU8.subarray(r,r+t));const w=o[f];return typeof w=="function"?w.bind(o):w}})},rf=function(r,t){if(t&Zd){let o=r,l=1;const f=[];for(;l;){const g=this._module.HEAPU8[o++];if(g)f.push(g);else switch(this._module.HEAPU8[o]||(l=null),l){case 1:f.push(63),l=2;break;case 2:f.push(61),l=3;break;case 3:f.push(38),l=2;break}}return new TextDecoder().decode(new Uint8Array(f))}return r?this._module.UTF8ToString(r):null},Ml);function Ui(n,i){return i*4294967296+n+(n<0?2**32:0)}class po extends rS{constructor(r,t){super(r,t);T(this,"mapNameToFile",new Map);T(this,"mapIdToFile",new Map)}static async create(r,t){const o=new po(r,t);return await o.isReady(),o}close(){for(const r of this.mapIdToFile.keys())this.jClose(r)}jOpen(r,t,o,l){const g=new URL(r||Math.random().toString(36).slice(2),"file://").pathname;let w=this.mapNameToFile.get(g);if(!w)if(o&Gr)w={pathname:g,flags:o,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(g,w);else return sr;return this.mapIdToFile.set(t,w),l.setInt32(0,o,!0),B}jClose(r){const t=this.mapIdToFile.get(r);return this.mapIdToFile.delete(r),t.flags&Qr&&this.mapNameToFile.delete(t.pathname),B}jRead(r,t,o){const l=this.mapIdToFile.get(r),f=Math.min(o,l.size),w=Math.min(o+t.byteLength,l.size)-f;return w&&t.set(new Uint8Array(l.data,f,w)),w<t.byteLength?(t.fill(0,w),vi):B}jWrite(r,t,o){const l=this.mapIdToFile.get(r);if(o+t.byteLength>l.data.byteLength){const f=Math.max(o+t.byteLength,2*l.data.byteLength),g=new ArrayBuffer(f);new Uint8Array(g).set(new Uint8Array(l.data,0,l.size)),l.data=g}return new Uint8Array(l.data,o,t.byteLength).set(t),l.size=Math.max(l.size,o+t.byteLength),B}jTruncate(r,t){const o=this.mapIdToFile.get(r);return o.size=Math.min(o.size,t),B}jFileSize(r,t){const o=this.mapIdToFile.get(r);return t.setBigInt64(0,BigInt(o.size),!0),B}jDelete(r,t){const l=new URL(r,"file://").pathname;return this.mapNameToFile.delete(l),B}jAccess(r,t,o){const f=new URL(r,"file://").pathname,g=this.mapNameToFile.get(f);return o.setInt32(0,g?1:0,!0),B}}let ol;const af=n=>{if(n.vfs_registered.has("memory-vfs")===!1){const t=new po("memory-vfs",n.module);n.vfs_register(t,!1),ol=t}return{dbPointer:n.open_v2Sync(":memory:",void 0,"memory-vfs"),vfs:ol}},cl=({sqlite3:n,metadata:i})=>{const r=[],{dbPointer:t}=i;let o=!1;const l={_tag:"SqliteDb",metadata:i,prepare:f=>{try{const g=n.statements(t,f.trim(),{unscoped:!0});let w=!1;const x={execute:(D,q)=>{for(const A of g){D!==void 0&&Object.keys(D).length>0&&n.bind_collection(A,D);try{n.step(A)}finally{q!=null&&q.onRowsChanged&&q.onRowsChanged(n.changes(t)),n.reset(A)}}},select:D=>{if(g.length!==1)throw new qs({query:{bindValues:D,sql:f},code:-1,cause:"Expected only one statement when using `select`"});const q=g[0];D!==void 0&&Object.keys(D).length>0&&n.bind_collection(q,D);const A=[];try{let z;try{z=n.column_names(q)}catch{}for(;n.step(q)===ha;)if(z!==void 0){const N={};for(let P=0;P<z.length;P++)N[z[P]]=n.column(q,P);A.push(N)}}catch(z){throw new qs({query:{bindValues:D,sql:f},code:z.code,cause:z})}finally{n.reset(q)}return A},finalize:()=>{if(!w){w=!0;for(const D of g)n.finalize(D)}},sql:f};return r.push(x),x}catch(g){throw new qs({query:{sql:f,bindValues:{}},code:g.code,cause:g})}},export:()=>n.serialize(t,"main"),execute:Jd((f,g,w)=>{const x=l.prepare(f);x.execute(g,w),x.finalize()}),select:Yd((f,g)=>{const w=l.prepare(f),x=w.select(g);return w.finalize(),x}),destroy:()=>{l.close(),i.deleteDb()},close:()=>{if(!o){for(const f of r)f.finalize();n.close(t),o=!0}},import:f=>{if(f instanceof Uint8Array){const x=af(n);n.deserialize(x.dbPointer,"main",f,f.length,f.length,3),n.backup(t,"main",x.dbPointer,"main"),n.close(x.dbPointer)}else n.backup(t,"main",f.metadata.dbPointer,"main");i.configureDb(l)},session:()=>{const f=n.session_create(t,"main");return n.session_attach(f,null),{changeset:()=>n.session_changeset(f).changeset??void 0,finish:()=>{n.session_delete(f)}}},makeChangeset:f=>({invert:()=>{const w=n.changeset_invert(f);return l.makeChangeset(w)},apply:()=>{try{n.changeset_apply(t,f),f=void 0}catch(w){throw new qs({code:w.code??-1,cause:w,note:"Failed calling makeChangeset.apply"})}}})};return i.configureDb(l),l},iS=Object.getPrototypeOf(async()=>{}).constructor;var ot,xs,pa,of;class aS extends sf{constructor(r,t){super(r,t);Ze(this,ot)}hasAsyncMethod(r){const t=`j${r.slice(1)}`;return this[t]instanceof iS}getFilename(r){throw new Error("unimplemented")}jOpen(r,t,o,l){return sr}jDelete(r,t){return B}jAccess(r,t,o){return B}jFullPathname(r,t){const{read:o,written:l}=new TextEncoder().encodeInto(r,t);return o<r.length||l>=t.length?Gs:(t[l]=0,B)}jGetLastError(r){return B}jClose(r){return B}jRead(r,t,o){return t.fill(0),vi}jWrite(r,t,o){return Kd}jTruncate(r,t){return B}jSync(r,t){return B}jFileSize(r,t){return B}jLock(r,t){return B}jUnlock(r,t){return B}jCheckReservedLock(r,t){return t.setInt32(0,0,!0),B}jFileControl(r,t,o){return _o}jSectorSize(r){return super.xSectorSize(r)}jDeviceCharacteristics(r){return 0}xOpen(r,t,o,l,f){var x;const g=le(this,ot,of).call(this,t,l),w=le(this,ot,xs).call(this,"Int32",f);return(x=this.log)==null||x.call(this,"jOpen",g,o,"0x"+l.toString(16)),this.jOpen(g,o,l,w)}xDelete(r,t,o){var f;const l=this._module.UTF8ToString(t);return(f=this.log)==null||f.call(this,"jDelete",l,o),this.jDelete(l,o)}xAccess(r,t,o,l){var w;const f=this._module.UTF8ToString(t),g=le(this,ot,xs).call(this,"Int32",l);return(w=this.log)==null||w.call(this,"jAccess",f,o),this.jAccess(f,o,g)}xFullPathname(r,t,o,l){var w;const f=this._module.UTF8ToString(t),g=this._module.HEAPU8.subarray(l,l+o);return(w=this.log)==null||w.call(this,"jFullPathname",f,o),this.jFullPathname(f,g)}xGetLastError(r,t,o){var f;const l=this._module.HEAPU8.subarray(o,o+t);return(f=this.log)==null||f.call(this,"jGetLastError",t),this.jGetLastError(l)}xClose(r){var t;return(t=this.log)==null||t.call(this,"jClose",r),this.jClose(r)}xRead(r,t,o,l,f){var x;const g=le(this,ot,pa).call(this,t,o),w=Hi(l,f);return(x=this.log)==null||x.call(this,"jRead",r,o,w),this.jRead(r,g,w)}xWrite(r,t,o,l,f){var x;const g=le(this,ot,pa).call(this,t,o),w=Hi(l,f);return(x=this.log)==null||x.call(this,"jWrite",r,g,w),this.jWrite(r,g,w)}xTruncate(r,t,o){var f;const l=Hi(t,o);return(f=this.log)==null||f.call(this,"jTruncate",r,l),this.jTruncate(r,l)}xSync(r,t){var o;return(o=this.log)==null||o.call(this,"jSync",r,t),this.jSync(r,t)}xFileSize(r,t){var l;const o=le(this,ot,xs).call(this,"BigInt64",t);return(l=this.log)==null||l.call(this,"jFileSize",r),this.jFileSize(r,o)}xLock(r,t){var o;return(o=this.log)==null||o.call(this,"jLock",r,t),this.jLock(r,t)}xUnlock(r,t){var o;return(o=this.log)==null||o.call(this,"jUnlock",r,t),this.jUnlock(r,t)}xCheckReservedLock(r,t){var l;const o=le(this,ot,xs).call(this,"Int32",t);return(l=this.log)==null||l.call(this,"jCheckReservedLock",r),this.jCheckReservedLock(r,o)}xFileControl(r,t,o){var f;const l=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+o);return(f=this.log)==null||f.call(this,"jFileControl",r,t,l),this.jFileControl(r,t,l)}xSectorSize(r){var t;return(t=this.log)==null||t.call(this,"jSectorSize",r),this.jSectorSize(r)}xDeviceCharacteristics(r){var t;return(t=this.log)==null||t.call(this,"jDeviceCharacteristics",r),this.jDeviceCharacteristics(r)}}ot=new WeakSet,xs=function(r,t){const o=r==="Int32"?4:8,l=`get${r}`,f=`set${r}`,g=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+t,o);let w=g();return new Proxy(w,{get(x,D){if(w.buffer.byteLength===0&&(w=g()),D===l)return function(A,z){if(!z)throw new Error("must be little endian");return w[D](A,z)};if(D===f)return function(A,z,N){if(!N)throw new Error("must be little endian");return w[D](A,z,N)};if(typeof D=="string"&&/^(get)|(set)/.test(D))throw new Error("invalid type");const q=w[D];return typeof q=="function"?q.bind(w):q}})},pa=function(r,t){let o=this._module.HEAPU8.subarray(r,r+t);return new Proxy(o,{get:(l,f,g)=>{o.buffer.byteLength===0&&(o=this._module.HEAPU8.subarray(r,r+t));const w=o[f];return typeof w=="function"?w.bind(o):w}})},of=function(r,t){if(t&Zd){let o=r,l=1;const f=[];for(;l;){const g=this._module.HEAPU8[o++];if(g)f.push(g);else switch(this._module.HEAPU8[o]||(l=null),l){case 1:{f.push(63),l=2;break}case 2:{f.push(61),l=3;break}case 3:{f.push(38),l=2;break}}}return new TextDecoder().decode(new Uint8Array(f))}return r?this._module.UTF8ToString(r):null};function Hi(n,i){return i*4294967296+n+(n<0?2**32:0)}const cf=4096,mo=512,oS=4,cS=8,ma=mo+oS,ll=mo,ul=ma,wn=cf,lS=Xd|ef|tf|nf,uS=6;var Qs,on,_t,Xe,Dt,pt,ye,lf,uf,df,Zn,ya,Xn,ba;const go=class go extends aS{constructor(r,t,o){super(r,o);Ze(this,ye);T(this,"log",null);Ze(this,Qs);Ze(this,on);Ze(this,_t,new Map);Ze(this,Xe,new Map);Ze(this,Dt,new Set);Ze(this,pt,new Map);Di(this,Qs,t)}static async create(r,t,o){const l=new go(r,t,o);return await l.isReady(),l}getOpfsFileName(r){const t=le(this,ye,Xn).call(this,r),o=Y(this,Xe).get(t);return Y(this,_t).get(o)}resetAccessHandle(r){const t=le(this,ye,Xn).call(this,r);Y(this,Xe).get(t).truncate(wn)}jOpen(r,t,o,l){try{const f=r?le(this,ye,Xn).call(this,r):Math.random().toString(36);let g=Y(this,Xe).get(f);if(!g&&o&Gr)if(this.getSize()<this.getCapacity())[g]=Y(this,Dt).keys(),le(this,ye,Zn).call(this,g,f,o);else throw new Error("cannot create file");if(!g)throw new Error("file not found");const w={path:f,flags:o,accessHandle:g};return Y(this,pt).set(t,w),l.setInt32(0,o,!0),B}catch(f){return console.error(f.message),sr}}jClose(r){const t=Y(this,pt).get(r);return t&&(t.accessHandle.flush(),Y(this,pt).delete(r),t.flags&Qr&&le(this,ye,ba).call(this,t.path)),B}jRead(r,t,o){const f=Y(this,pt).get(r).accessHandle.read(t.subarray(),{at:wn+o});return f<t.byteLength?(t.fill(0,f,t.byteLength),vi):B}jWrite(r,t,o){return Y(this,pt).get(r).accessHandle.write(t.subarray(),{at:wn+o})===t.byteLength?B:Gs}jTruncate(r,t){return Y(this,pt).get(r).accessHandle.truncate(wn+t),B}jSync(r,t){return Y(this,pt).get(r).accessHandle.flush(),B}jFileSize(r,t){const l=Y(this,pt).get(r).accessHandle.getSize()-wn;return t.setBigInt64(0,BigInt(l),!0),B}jSectorSize(r){return cf}jDeviceCharacteristics(r){return tS}jAccess(r,t,o){const l=le(this,ye,Xn).call(this,r);return o.setInt32(0,Y(this,Xe).has(l)?1:0,!0),B}jDelete(r,t){const o=le(this,ye,Xn).call(this,r);return le(this,ye,ba).call(this,o),B}async close(){le(this,ye,uf).call(this)}async isReady(){if(!Y(this,on)){let r=await navigator.storage.getDirectory();for(const t of Y(this,Qs).split("/"))t&&(r=await r.getDirectoryHandle(t,{create:!0}));Di(this,on,r),await le(this,ye,lf).call(this),this.getCapacity()===0&&await this.addCapacity(uS)}return!0}getSize(){return Y(this,Xe).size}getCapacity(){return Y(this,_t).size}async addCapacity(r){for(let t=0;t<r;++t){const o=Math.random().toString(36).replace("0.",""),f=await(await Y(this,on).getFileHandle(o,{create:!0})).createSyncAccessHandle();Y(this,_t).set(f,o),le(this,ye,Zn).call(this,f,"",0)}return r}async removeCapacity(r){let t=0;for(const o of Array.from(Y(this,Dt))){if(t==r||this.getSize()===this.getCapacity())return t;const l=Y(this,_t).get(o);o.close(),await Y(this,on).removeEntry(l),Y(this,_t).delete(o),Y(this,Dt).delete(o),++t}return t}};Qs=new WeakMap,on=new WeakMap,_t=new WeakMap,Xe=new WeakMap,Dt=new WeakMap,pt=new WeakMap,ye=new WeakSet,lf=async function(){const r=[];for await(const[t,o]of Y(this,on))o.kind==="file"&&r.push([t,o]);await Promise.all(r.map(async([t,o])=>{const l=await o.createSyncAccessHandle();Y(this,_t).set(l,t);const f=le(this,ye,df).call(this,l);f?Y(this,Xe).set(f,l):Y(this,Dt).add(l)}))},uf=function(){for(const r of Y(this,_t).keys())r.close();Y(this,_t).clear(),Y(this,Xe).clear(),Y(this,Dt).clear()},df=function(r){const t=new Uint8Array(ma);r.read(t,{at:0});const l=new DataView(t.buffer,t.byteOffset).getUint32(ll);if(t[0]&&(l&Qr||(l&lS)===0))return console.warn(`Remove file with unexpected flags ${l.toString(16)}`),le(this,ye,Zn).call(this,r,"",0),"";const f=new Uint32Array(cS/4);r.read(f,{at:ul});const g=le(this,ye,ya).call(this,t);if(f.every((w,x)=>w===g[x])){const w=t.indexOf(0);return w===0&&r.truncate(wn),new TextDecoder().decode(t.subarray(0,w))}else return console.warn("Disassociating file with bad digest."),le(this,ye,Zn).call(this,r,"",0),""},Zn=function(r,t,o){const l=new Uint8Array(ma);if(new TextEncoder().encodeInto(t,l).written>=mo)throw new Error("path too long");new DataView(l.buffer,l.byteOffset).setUint32(ll,o);const w=le(this,ye,ya).call(this,l);r.write(l,{at:0}),r.write(w,{at:ul}),r.flush(),t?(Y(this,Xe).set(t,r),Y(this,Dt).delete(r)):(r.truncate(wn),Y(this,Dt).add(r))},ya=function(r){if(!r[0])return new Uint32Array([4274806656,2899230775]);let t=3735928559,o=1103547991;for(const l of r)t=Math.imul(t^l,2654435761),o=Math.imul(o^l,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),o=Math.imul(o^o>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),new Uint32Array([t>>>0,o>>>0])},Xn=function(r){return(typeof r=="string"?new URL(r,"file://localhost/"):r).pathname},ba=function(r){const t=Y(this,Xe).get(r);t&&(Y(this,Xe).delete(r),le(this,ye,Zn).call(this,t,"",0))};let ga=go;const dS=hu(1).pipe(gt),dl=new Map,fS=({sqlite3:n,directory:i,fileName:r})=>j(function*(){const t=i.replaceAll(/["*/:<>?\\|]/g,"_"),l=`opfs${t.length===0?"":`-${t}`}`;if(n.vfs_registered.has(l)===!1){const w=yield*$n(()=>ga.create(l,i,n.module));n.vfs_register(w,!1),dl.set(l,w)}const f=n.open_v2Sync(r,void 0,l),g=dl.get(l);return{dbPointer:f,vfs:g}}).pipe(dS.withPermits(1)),hS=4096,ff=512,_S=4,pS=8,hf=ff+_S,mS=ff,fl=hf,gS=hS,yS=Xd|ef|tf|nf,bS=new TextDecoder,vS=async n=>{const i=new Uint8Array(await n.slice(0,hf).arrayBuffer()),t=new DataView(i.buffer,i.byteOffset).getUint32(mS);if(i[0]&&(t&Qr||(t&yS)===0))return console.warn(`Remove file with unexpected flags ${t.toString(16)}`),"";const o=new Uint32Array(await n.slice(fl,fl+pS).arrayBuffer()),l=wS(i);if(o.every((f,g)=>f===l[g])){const f=i.indexOf(0);return bS.decode(i.subarray(0,f))}else return console.warn("Disassociating file with bad digest."),""},wS=n=>{if(!n[0])return new Uint32Array([4274806656,2899230775]);let i=3735928559,r=1103547991;for(const t of n)i=Math.imul(i^t,2654435761),r=Math.imul(r^t,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),new Uint32Array([i>>>0,r>>>0])},SS=({sqlite3:n})=>i=>j(function*(){if(i._tag==="in-memory"){const{dbPointer:f,vfs:g}=af(n);return cl({sqlite3:n,metadata:{_tag:"in-memory",vfs:g,dbPointer:f,deleteDb:()=>{},configureDb:i.configureDb??(()=>{}),persistenceInfo:{fileName:":memory:"}}})}const r=60;let t=i.fileName;i.fileName.length>r&&(yield*wt(`dbFilename too long: '${i.fileName}'. Max ${r} chars, got ${i.fileName.length}. Hashing...`),t=`hash-${ug(i.fileName)}.db`);const{dbPointer:o,vfs:l}=yield*fS({sqlite3:n,directory:i.opfsDirectory,fileName:t});return cl({sqlite3:n,metadata:{_tag:"opfs",vfs:l,dbPointer:o,deleteDb:()=>l.resetAccessHandle(i.fileName),configureDb:i.configureDb??(()=>{}),persistenceInfo:{fileName:t,opfsDirectory:i.opfsDirectory,opfsFileName:l.getOpfsFileName(t)}}})}),hl=0x7fffffffffffffffn,_l=-0x8000000000000000n;class nt extends Error{constructor(i,r){super(i),this.code=r}}const Yn=!1;function ES(n){const i={};n.retryOps=[];const r=n._getSqliteFree(),t=n._malloc(8),o=[t,t+4];function l(b){if(typeof b!="string")return 0;const y=new TextEncoder().encode(b),h=n._sqlite3_malloc(y.byteLength+1);return n.HEAPU8.set(y,h),n.HEAPU8[h+y.byteLength]=0,h}function f(b,y){return BigInt(y)<<32n|BigInt(b)&0xffffffffn}const g=function(){const b=BigInt(Number.MAX_SAFE_INTEGER)>>32n,y=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(h,S){return S>b||S<y?f(h,S):S*4294967296+(h&2147483647)-(h&2147483648)}}(),w=new Set;function x(b){if(!w.has(b))throw new nt("not a database",sn)}const D=new Map;function q(b){if(!D.has(b))throw new nt("not a statement",sn)}i.bind_collection=function(b,y){q(b);const h=Array.isArray(y),S=i.bind_parameter_count(b);for(let _=1;_<=S;++_){const E=h?_-1:i.bind_parameter_name(b,_),I=y[E];I!==void 0&&i.bind(b,_,I)}return B},i.bind=function(b,y,h){switch(q(b),typeof h){case"number":return h===(h|0)?i.bind_int(b,y,h):i.bind_double(b,y,h);case"string":return i.bind_text(b,y,h);default:return h instanceof Uint8Array||Array.isArray(h)?i.bind_blob(b,y,h):h===null?i.bind_null(b,y):typeof h=="bigint"?i.bind_int64(b,y,h):h===void 0?Xw:(console.warn("unknown binding converted to null",h),i.bind_null(b,y))}},i.bind_blob=function(){const b="sqlite3_bind_blob",y=n.cwrap(b,...W("nnnnn:n"));return function(h,S,_){q(h);const E=_.byteLength??_.length,I=n._sqlite3_malloc(E);n.HEAPU8.subarray(I).set(_);const R=y(h,S,I,E,r);return N(b,R,D.get(h))}}(),i.bind_parameter_count=function(){const y=n.cwrap("sqlite3_bind_parameter_count",...W("n:n"));return function(h){return q(h),y(h)}}(),i.bind_double=function(){const b="sqlite3_bind_double",y=n.cwrap(b,...W("nnn:n"));return function(h,S,_){q(h);const E=y(h,S,_);return N(b,E,D.get(h))}}(),i.bind_int=function(){const b="sqlite3_bind_int",y=n.cwrap(b,...W("nnn:n"));return function(h,S,_){if(q(h),_>2147483647||_<-2147483648)return zi;const E=y(h,S,_);return N(b,E,D.get(h))}}(),i.bind_int64=function(){const b="sqlite3_bind_int64",y=n.cwrap(b,...W("nnnn:n"));return function(h,S,_){if(q(h),_>hl||_<_l)return zi;const E=_&0xffffffffn,I=_>>32n,R=y(h,S,Number(E),Number(I));return N(b,R,D.get(h))}}(),i.bind_null=function(){const b="sqlite3_bind_null",y=n.cwrap(b,...W("nn:n"));return function(h,S){q(h);const _=y(h,S);return N(b,_,D.get(h))}}(),i.bind_parameter_name=function(){const y=n.cwrap("sqlite3_bind_parameter_name",...W("n:s"));return function(h,S){return q(h),y(h,S)}}(),i.bind_text=function(){const b="sqlite3_bind_text",y=n.cwrap(b,...W("nnnnn:n"));return function(h,S,_){q(h);const E=l(_),I=y(h,S,E,-1,r);return N(b,I,D.get(h))}}(),i.changes=function(){const y=n.cwrap("sqlite3_changes",...W("n:n"));return function(h){return x(h),y(h)}}(),i.deserialize=function(){const y=n.cwrap("sqlite3_deserialize",...W("nnnnnn:n"));return function(h,S,_,E,I,R){x(h);const $=n._sqlite3_malloc(E);return n.HEAPU8.subarray($).set(_),y(h,S,$,E,I,R)}}();const A=1;i.serialize=function(){const y=n.cwrap("sqlite3_serialize",...W("nsnn:n"));return function(h,S){x(h);const _=o[0];let E=y(h,S,_,0);if(E===0){E=y(h,S,_,A);const I=n.getValue(_,"*"),R=n.HEAPU8.subarray(E,E+I);return new Uint8Array(R.slice())}else{const I=n.getValue(_,"*"),R=n.HEAPU8.subarray(E,E+I);return new Uint8Array(R)}}}(),i.backup=function(){const b=n.cwrap("sqlite3_backup_init",...W("nsns:n")),y=n.cwrap("sqlite3_backup_step",...W("nn:n")),h=n.cwrap("sqlite3_backup_finish",...W("n:n"));return function(S,_,E,I){x(S),x(E);const R=b(S,_,E,I);if(R===0){const $=n.ccall("sqlite3_errmsg","string",["number"],[S]);throw new nt(`backup failed: ${$}`,Zw)}return y(R,-1),h(R)}}(),i.clear_bindings=function(){const b="sqlite3_clear_bindings",y=n.cwrap(b,...W("n:n"));return function(h){q(h);const S=y(h);return N(b,S,D.get(h))}}(),i.close=function(){const b="sqlite3_close",y=n.cwrap(b,...W("n:n"),{async:Yn});return function(h){x(h);const S=y(h);return w.delete(h),N(b,S,h)}}(),i.column=function(b,y){q(b);const h=i.column_type(b,y);switch(h){case il:return i.column_blob(b,y);case sl:return i.column_double(b,y);case nl:const S=i.column_int(b,y),_=n.getTempRet0();return g(S,_);case al:return null;case rl:return i.column_text(b,y);default:throw new nt("unknown type",h)}},i.column_blob=function(){const y=n.cwrap("sqlite3_column_blob",...W("nn:n"));return function(h,S){q(h);const _=i.column_bytes(h,S),E=y(h,S);if(E===0)return null;const I=n.HEAPU8.subarray(E,E+_);return new Uint8Array(I)}}(),i.column_bytes=function(){const y=n.cwrap("sqlite3_column_bytes",...W("nn:n"));return function(h,S){return q(h),y(h,S)}}(),i.column_count=function(){const y=n.cwrap("sqlite3_column_count",...W("n:n"));return function(h){return q(h),y(h)}}(),i.column_double=function(){const y=n.cwrap("sqlite3_column_double",...W("nn:n"));return function(h,S){return q(h),y(h,S)}}(),i.column_int=function(){const y=n.cwrap("sqlite3_column_int64",...W("nn:n"));return function(h,S){return q(h),y(h,S)}}(),i.column_int64=function(){const y=n.cwrap("sqlite3_column_int64",...W("nn:n"));return function(h,S){q(h);const _=y(h,S),E=n.getTempRet0();return f(_,E)}}(),i.column_name=function(){const y=n.cwrap("sqlite3_column_name",...W("nn:s"));return function(h,S){return q(h),y(h,S)}}(),i.column_names=function(b){const y=[],h=i.column_count(b);for(let S=0;S<h;++S)y.push(i.column_name(b,S));return y},i.column_text=function(){const y=n.cwrap("sqlite3_column_text",...W("nn:s"));return function(h,S){return q(h),y(h,S)}}(),i.column_type=function(){const y=n.cwrap("sqlite3_column_type",...W("nn:n"));return function(h,S){return q(h),y(h,S)}}(),i.create_function=function(b,y,h,S,_,E,I,R){x(b);function $(C){return(U,J,re)=>C(U,n.HEAP32.subarray(re/4,re/4+J))}const H=n.create_function(b,y,h,S,_,E&&$(E),I&&$(I),R);return N("sqlite3_create_function",H,b)},i.data_count=function(){const y=n.cwrap("sqlite3_data_count",...W("n:n"));return function(h){return q(h),y(h)}}(),i.exec=function(b,y,h){const S=i.statements(b,y,{unscoped:!0});for(const _ of S){let E;for(;i.step(_)===ha;)if(h){E=E??i.column_names(_);const I=i.row(_);h(I,E),h(I,E)}}for(const _ of S)i.finalize(_);return B},i.finalize=function(){const y=n.cwrap("sqlite3_finalize",...W("n:n"),{async:Yn});return function(h){const S=y(h);return D.delete(h),S}}(),i.get_autocommit=function(){const y=n.cwrap("sqlite3_get_autocommit",...W("n:n"));return function(h){return y(h)}}(),i.libversion=function(){const y=n.cwrap("sqlite3_libversion",...W(":s"));return function(){return y()}}(),i.libversion_number=function(){const y=n.cwrap("sqlite3_libversion_number",...W(":n"));return function(){return y()}}(),i.limit=function(){const y=n.cwrap("sqlite3_limit",...W("nnn:n"));return function(h,S,_){return y(h,S,_)}}(),i.open_v2=function(){const b="sqlite3_open_v2",y=n.cwrap(b,...W("snnn:n"),{async:Yn});return async function(h,S,_){S=S||Gr|tl,_=l(_);try{const E=await P(()=>y(h,o[0],S,_)),I=n.getValue(o[0],"*");return w.add(I),n.ccall("RegisterExtensionFunctions","void",["number"],[I]),N(b,E,I),I}finally{n._sqlite3_free(_)}}}(),i.open_v2Sync=function(){const b="sqlite3_open_v2",y=n.cwrap(b,...W("snnn:n"),{async:Yn});return function(h,S,_){S=S||Gr|tl,_=l(_);try{const E=y(h,o[0],S,_),I=n.getValue(o[0],"*");return w.add(I),n.ccall("RegisterExtensionFunctions","void",["number"],[I]),N(b,E,I),I}finally{n._sqlite3_free(_)}}}(),i.progress_handler=function(b,y,h,S){x(b),n.progress_handler(b,y,h,S)},i.reset=function(){const b="sqlite3_reset",y=n.cwrap(b,...W("n:n"),{async:Yn});return function(h){q(h);const S=y(h);return N(b,S,D.get(h))}}(),i.result=function(b,y){switch(typeof y){case"number":y===(y|0)?i.result_int(b,y):i.result_double(b,y);break;case"string":i.result_text(b,y);break;default:if(y instanceof Uint8Array||Array.isArray(y))i.result_blob(b,y);else if(y===null)i.result_null(b);else{if(typeof y=="bigint")return i.result_int64(b,y);console.warn("unknown result converted to null",y),i.result_null(b)}break}},i.result_blob=function(){const y=n.cwrap("sqlite3_result_blob",...W("nnnn:n"));return function(h,S){const _=S.byteLength??S.length,E=n._sqlite3_malloc(_);n.HEAPU8.subarray(E).set(S),y(h,E,_,r)}}(),i.result_double=function(){const y=n.cwrap("sqlite3_result_double",...W("nn:n"));return function(h,S){y(h,S)}}(),i.result_int=function(){const y=n.cwrap("sqlite3_result_int",...W("nn:n"));return function(h,S){y(h,S)}}(),i.result_int64=function(){const y=n.cwrap("sqlite3_result_int64",...W("nnn:n"));return function(h,S){if(S>hl||S<_l)return zi;const _=S&0xffffffffn,E=S>>32n;y(h,Number(_),Number(E))}}(),i.result_null=function(){const y=n.cwrap("sqlite3_result_null",...W("n:n"));return function(h){y(h)}}(),i.result_text=function(){const y=n.cwrap("sqlite3_result_text",...W("nnnn:n"));return function(h,S){const _=l(S);y(h,_,-1,r)}}(),i.row=function(b){const y=[],h=i.data_count(b);for(let S=0;S<h;++S){const _=i.column(b,S);y.push((_==null?void 0:_.buffer)===n.HEAPU8.buffer?_.slice():_)}return y},i.set_authorizer=function(b,y,h){x(b);function S(I,R,$,H,C,U){return[I,R,n.UTF8ToString($),n.UTF8ToString(H),n.UTF8ToString(C),n.UTF8ToString(U)]}function _(I){return(R,$,H,C,U,J)=>I(...S(R,$,H,C,U,J))}const E=n.set_authorizer(b,_(y),h);return N("sqlite3_set_authorizer",E,b)},i.sql=function(){const y=n.cwrap("sqlite3_sql",...W("n:s"));return function(h){return q(h),y(h)}}(),i.statements=function(b,y,h={}){const S=n.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!1}),_=[],E=new TextEncoder().encode(y),I=E.byteLength-E.byteLength%4+12,R=n._sqlite3_malloc(I),$=R+E.byteLength+1;n.HEAPU8.set(E,R),n.HEAPU8[$-1]=0;const H=R+I-8,C=R+I-4;let U;function J(){U&&!h.unscoped&&i.finalize(U),U=0}n.setValue(C,R,"*");do{J();const re=n.getValue(C,"*"),M=S(b,re,$-C,h.flags||0,H,C);M!==B&&N("sqlite3_prepare_v3",M,b),U=n.getValue(H,"*"),U&&(D.set(U,b),_.push(U))}while(U);return _},i.step=function(){const b="sqlite3_step",y=n.cwrap(b,...W("n:n"),{async:Yn});return function(h){q(h);const S=y(h);return N(b,S,D.get(h),[ha,eS])}}(),i.commit_hook=function(b,y){x(b),n.commit_hook(b,y)},i.update_hook=function(b,y){x(b);function h(_,E,I,R,$){return[_,n.UTF8ToString(E),n.UTF8ToString(I),f(R,$)]}function S(_){return(E,I,R,$,H)=>_(...h(E,I,R,$,H))}n.update_hook(b,S(y))},i.session_create=function(){const b="sqlite3session_create",y=n.cwrap(b,...W("nsn:n"));return function(h,S){x(h);const _=n._malloc(4),E=y(h,S,_);return E!==B&&N(b,E,h),n.getValue(_,"i32")}}(),i.session_attach=function(){const b="sqlite3session_attach",y=n.cwrap(b,...W("ns:n"));return function(h,S){if(typeof h!="number")throw new nt("Invalid session object",sn);const _=y(h,S);return N(b,_)}}(),i.session_enable=function(){const y=n.cwrap("sqlite3session_enable",...W("nn:n"));return function(h,S){const _=S?1:0;if(typeof h!="number")throw new nt("Invalid session object",sn);if(y(h,_)!==_)throw new nt("Failed to enable session",sn)}}(),i.session_changeset=function(){const b="sqlite3session_changeset",y=n.cwrap(b,...W("nnn:n"));return function(h){if(typeof h!="number")throw new nt("Invalid session object",sn);const S=n._malloc(4),_=n._malloc(4);try{const E=y(h,S,_);if(E===B){const I=n.getValue(S,"i32"),R=n.getValue(_,"i32");if(R===0)return{result:E,size:0,changeset:null};const $=new Uint8Array(n.HEAPU8.subarray(R,R+I));return n._sqlite3_free(R),{result:E,size:I,changeset:$}}return N(b,E)}finally{n._free(S),n._free(_)}}}(),i.session_delete=function(){const y=n.cwrap("sqlite3session_delete",...W("n:v"));return function(h){if(typeof h!="number")throw new nt("Invalid session object",sn);return y(h)}}(),i.changeset_start=function(){const b="sqlite3changeset_start",y=n.cwrap(b,...W("nnn:n"));return function(h){const S=n._sqlite3_malloc(h.length);n.HEAPU8.subarray(S).set(h);const _=n._malloc(4);try{const E=y(_,h.length,S);return E!==B&&N(b,E),n.getValue(_,"i32")}finally{n._sqlite3_free(S),n._free(_)}}}(),i.changeset_finalize=function(){const y=n.cwrap("sqlite3changeset_finalize",...W("n:n"));return function(h){return y(h)}}(),i.changeset_invert=function(){const b="sqlite3changeset_invert",y=n.cwrap(b,...W("nn:nn"));return function(h){const S=n._sqlite3_malloc(h.length);n.HEAPU8.subarray(S).set(h);const _=n._malloc(4),E=n._malloc(4),I=y(h.length,S,_,E);I!==B&&N(b,I);const R=n.getValue(_,"i32"),$=n.getValue(E,"i32"),H=new Uint8Array(n.HEAPU8.buffer,$,R).slice();return n._sqlite3_free(S),n._sqlite3_free($),H}}(),i.session_changeset_inverted=function(){const b="sqlite3session_changeset",y=n.cwrap(b,...W("nnn:n")),h="sqlite3changeset_invert",S=n.cwrap(h,...W("nn:nn"));return function(_){if(typeof _!="number")throw new nt("Invalid session object",sn);const E=n._malloc(4),I=n._malloc(4),R=n._malloc(4),$=n._malloc(4);try{const H=y(_,E,I);if(H!==B)return N(b,H);const C=n.getValue(E,"i32"),U=n.getValue(I,"i32"),J=S(C,U,R,$);if(J!==B)return N(h,J);const re=n.getValue(R,"i32"),M=n.getValue($,"i32"),be=new Uint8Array(n.HEAPU8.buffer,M,re);return n._sqlite3_free(U),n._sqlite3_free(M),{result:H,size:C,changeset:new Uint8Array(be)}}finally{n._free(E),n._free(I),n._free(R),n._free($)}}}(),i.changeset_apply=function(){const b="sqlite3changeset_apply",y=n.cwrap(b,...W("nnnnnn:n"));return function(h,S,_){const E=n._sqlite3_malloc(S.length);n.HEAPU8.subarray(E).set(S);const I=1,R=()=>I,$=y(h,S.length,E,null,R,null);return n._sqlite3_free(E),$!==B&&N(b,$),$}}(),i.value=function(b){const y=i.value_type(b);switch(y){case il:return i.value_blob(b);case sl:return i.value_double(b);case nl:const h=i.value_int(b),S=n.getTempRet0();return g(h,S);case al:return null;case rl:return i.value_text(b);default:throw new nt("unknown type",y)}},i.value_blob=function(){const y=n.cwrap("sqlite3_value_blob",...W("n:n"));return function(h){const S=i.value_bytes(h),_=y(h);return n.HEAPU8.subarray(_,_+S)}}(),i.value_bytes=function(){const y=n.cwrap("sqlite3_value_bytes",...W("n:n"));return function(h){return y(h)}}(),i.value_double=function(){const y=n.cwrap("sqlite3_value_double",...W("n:n"));return function(h){return y(h)}}(),i.value_int=function(){const y=n.cwrap("sqlite3_value_int64",...W("n:n"));return function(h){return y(h)}}(),i.value_int64=function(){const y=n.cwrap("sqlite3_value_int64",...W("n:n"));return function(h){const S=y(h),_=n.getTempRet0();return f(S,_)}}(),i.value_text=function(){const y=n.cwrap("sqlite3_value_text",...W("n:s"));return function(h){return y(h)}}(),i.value_type=function(){const y=n.cwrap("sqlite3_value_type",...W("n:n"));return function(h){return y(h)}}();const z=new Set;i.vfs_register=function(b,y){if(z.has(b.name))return;const h=n.vfs_register(b,y),S=N("sqlite3_vfs_register",h);return z.add(b.name),S},i.vfs_registered=z;function N(b,y,h=null,S=[B]){if(S.includes(y))return y;const _=h?n.ccall("sqlite3_errmsg","string",["number"],[h]):b;throw new nt(_,y)}async function P(b){let y;do n.retryOps.length&&(await Promise.all(n.retryOps),n.retryOps=[]),y=await b();while(y&&n.retryOps.length);return y}return i}function W(n){const i=[],r=n.match(/([ns@]*):([nsv@])/);switch(r[2]){case"n":i.push("number");break;case"s":i.push("string");break;case"v":i.push(null);break}const t=[];for(let o of r[1])switch(o){case"n":t.push("number");break;case"s":t.push("string");break}return i.push(t),i}var qS=(()=>{var n=import.meta.url;return function(i={}){var r,t=i,o,l,f=new Promise((e,s)=>{o=e,l=s}),g=typeof window=="object",w=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var x=Object.assign({},t),D="./this.program",q=(e,s)=>{throw s},A="";function z(e){return t.locateFile?t.locateFile(e,A):A+e}var N,P;(g||w)&&(w?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),n&&(A=n),A.startsWith("blob:")?A="":A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1),w&&(P=e=>{var s=new XMLHttpRequest;return s.open("GET",e,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),N=e=>fetch(e,{credentials:"same-origin"}).then(s=>s.ok?s.arrayBuffer():Promise.reject(new Error(s.status+" : "+s.url))));var b=t.print||console.log.bind(console),y=t.printErr||console.error.bind(console);Object.assign(t,x),x=null,t.arguments&&t.arguments,t.thisProgram&&(D=t.thisProgram);var h=t.wasmBinary,S,_=!1,E,I,R,$,H,C,U,J,re;function M(){var e=S.buffer;t.HEAP8=I=new Int8Array(e),t.HEAP16=$=new Int16Array(e),t.HEAPU8=R=new Uint8Array(e),t.HEAPU16=H=new Uint16Array(e),t.HEAP32=C=new Int32Array(e),t.HEAPU32=U=new Uint32Array(e),t.HEAPF32=J=new Float32Array(e),t.HEAPF64=re=new Float64Array(e)}var be=[],Ce=[],dt=[],Le=[];function Kt(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)ne(t.preRun.shift());or(be)}function yo(){!t.noFSInit&&!u.initialized&&u.init(),u.ignorePermissions=!1,or(Ce)}function rr(){or(dt)}function ir(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Nt(t.postRun.shift());or(Le)}function ne(e){be.unshift(e)}function $e(e){Ce.unshift(e)}function Nt(e){Le.unshift(e)}var mn=0,ps=null;function pE(e){return e}function Ei(e){var s;mn++,(s=t.monitorRunDependencies)==null||s.call(t,mn)}function ar(e){var a;if(mn--,(a=t.monitorRunDependencies)==null||a.call(t,mn),mn==0&&ps){var s=ps;ps=null,s()}}function Zt(e){var a;(a=t.onAbort)==null||a.call(t,e),e="Aborted("+e+")",y(e),_=!0,e+=". Build with -sASSERTIONS for more info.";var s=new WebAssembly.RuntimeError(e);throw l(s),s}var vf="data:application/octet-stream;base64,",bo=e=>e.startsWith(vf);function wf(){if(t.locateFile){var e="wa-sqlite.wasm";return bo(e)?e:z(e)}return new URL("/assets/wa-sqlite-CWx0VZcQ.wasm",import.meta.url).href}var qi;function vo(e){if(e==qi&&h)return new Uint8Array(h);if(P)return P(e);throw"both async and sync fetching of the wasm failed"}function Sf(e){return h?Promise.resolve().then(()=>vo(e)):N(e).then(s=>new Uint8Array(s),()=>vo(e))}function wo(e,s,a){return Sf(e).then(c=>WebAssembly.instantiate(c,s)).then(a,c=>{y(`failed to asynchronously prepare wasm: ${c}`),Zt(c)})}function Ef(e,s,a,c){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!bo(s)&&typeof fetch=="function"?fetch(s,{credentials:"same-origin"}).then(d=>{var m=WebAssembly.instantiateStreaming(d,a);return m.then(c,function(v){return y(`wasm streaming compile failed: ${v}`),y("falling back to ArrayBuffer instantiation"),wo(s,a,c)})}):wo(s,a,c)}function qf(){return{a:k_}}function kf(){function e(c,d){return p=c.exports,S=p.la,M(),Gn=p.of,$e(p.ma),ar(),p}Ei();function s(c){e(c.instance)}var a=qf();if(t.instantiateWasm)try{return t.instantiateWasm(a,e)}catch(c){y(`Module.instantiateWasm callback failed with error: ${c}`),l(c)}return qi??(qi=wf()),Ef(h,qi,a,s).catch(l),{}}var Q,ve;class So{constructor(s){T(this,"name","ExitStatus");this.message=`Program terminated with exit(${s})`,this.status=s}}var or=e=>{for(;e.length>0;)e.shift()(t)};function Eo(e,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return I[e];case"i8":return I[e];case"i16":return $[e>>1];case"i32":return C[e>>2];case"i64":Zt("to do getValue(i64) use WASM_BIGINT");case"float":return J[e>>2];case"double":return re[e>>3];case"*":return U[e>>2];default:Zt(`invalid type for getValue: ${s}`)}}t.noExitRuntime;function Bn(e,s,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":I[e]=s;break;case"i8":I[e]=s;break;case"i16":$[e>>1]=s;break;case"i32":C[e>>2]=s;break;case"i64":Zt("to do setValue(i64) use WASM_BIGINT");case"float":J[e>>2]=s;break;case"double":re[e>>3]=s;break;case"*":U[e>>2]=s;break;default:Zt(`invalid type for setValue: ${a}`)}}var Cf=e=>Uo(e),xf=()=>jo(),qo=typeof TextDecoder<"u"?new TextDecoder:void 0,Wn=(e,s=0,a=NaN)=>{for(var c=s+a,d=s;e[d]&&!(d>=c);)++d;if(d-s>16&&e.buffer&&qo)return qo.decode(e.subarray(s,d));for(var m="";s<d;){var v=e[s++];if(!(v&128)){m+=String.fromCharCode(v);continue}var k=e[s++]&63;if((v&224)==192){m+=String.fromCharCode((v&31)<<6|k);continue}var L=e[s++]&63;if((v&240)==224?v=(v&15)<<12|k<<6|L:v=(v&7)<<18|k<<12|L<<6|e[s++]&63,v<65536)m+=String.fromCharCode(v);else{var O=v-65536;m+=String.fromCharCode(55296|O>>10,56320|O&1023)}}return m},gn=(e,s)=>e?Wn(R,e,s):"",If=(e,s,a,c)=>Zt(`Assertion failed: ${gn(e)}, at: `+[s?gn(s):"unknown filename",a,c?gn(c):"unknown function"]),he={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(e).slice(1)},normalizeArray:(e,s)=>{for(var a=0,c=e.length-1;c>=0;c--){var d=e[c];d==="."?e.splice(c,1):d===".."?(e.splice(c,1),a++):a&&(e.splice(c,1),a--)}if(s)for(;a;a--)e.unshift("..");return e},normalize:e=>{var s=he.isAbs(e),a=e.substr(-1)==="/";return e=he.normalizeArray(e.split("/").filter(c=>!!c),!s).join("/"),!e&&!s&&(e="."),e&&a&&(e+="/"),(s?"/":"")+e},dirname:e=>{var s=he.splitPath(e),a=s[0],c=s[1];return!a&&!c?".":(c&&(c=c.substr(0,c.length-1)),a+c)},basename:e=>{if(e==="/")return"/";e=he.normalize(e),e=e.replace(/\/$/,"");var s=e.lastIndexOf("/");return s===-1?e:e.substr(s+1)},join:(...e)=>he.normalize(e.join("/")),join2:(e,s)=>he.normalize(e+"/"+s)},Tf=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);Zt("initRandomDevice")},ko=e=>(ko=Tf())(e),Xt={resolve:(...e)=>{for(var s="",a=!1,c=e.length-1;c>=-1&&!a;c--){var d=c>=0?e[c]:u.cwd();if(typeof d!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!d)return"";s=d+"/"+s,a=he.isAbs(d)}return s=he.normalizeArray(s.split("/").filter(m=>!!m),!a).join("/"),(a?"/":"")+s||"."},relative:(e,s)=>{e=Xt.resolve(e).substr(1),s=Xt.resolve(s).substr(1);function a(O){for(var Z=0;Z<O.length&&O[Z]==="";Z++);for(var ee=O.length-1;ee>=0&&O[ee]==="";ee--);return Z>ee?[]:O.slice(Z,ee-Z+1)}for(var c=a(e.split("/")),d=a(s.split("/")),m=Math.min(c.length,d.length),v=m,k=0;k<m;k++)if(c[k]!==d[k]){v=k;break}for(var L=[],k=v;k<c.length;k++)L.push("..");return L=L.concat(d.slice(v)),L.join("/")}},ki=[],Vn=e=>{for(var s=0,a=0;a<e.length;++a){var c=e.charCodeAt(a);c<=127?s++:c<=2047?s+=2:c>=55296&&c<=57343?(s+=4,++a):s+=3}return s},Ci=(e,s,a,c)=>{if(!(c>0))return 0;for(var d=a,m=a+c-1,v=0;v<e.length;++v){var k=e.charCodeAt(v);if(k>=55296&&k<=57343){var L=e.charCodeAt(++v);k=65536+((k&1023)<<10)|L&1023}if(k<=127){if(a>=m)break;s[a++]=k}else if(k<=2047){if(a+1>=m)break;s[a++]=192|k>>6,s[a++]=128|k&63}else if(k<=65535){if(a+2>=m)break;s[a++]=224|k>>12,s[a++]=128|k>>6&63,s[a++]=128|k&63}else{if(a+3>=m)break;s[a++]=240|k>>18,s[a++]=128|k>>12&63,s[a++]=128|k>>6&63,s[a++]=128|k&63}}return s[a]=0,a-d};function xi(e,s,a){var c=a>0?a:Vn(e)+1,d=new Array(c),m=Ci(e,d,0,d.length);return s&&(d.length=m),d}var Rf=()=>{if(!ki.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;ki=xi(e,!0)}return ki.shift()},yn={ttys:[],init(){},shutdown(){},register(e,s){yn.ttys[e]={input:[],output:[],ops:s},u.registerDevice(e,yn.stream_ops)},stream_ops:{open(e){var s=yn.ttys[e.node.rdev];if(!s)throw new u.ErrnoError(43);e.tty=s,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,s,a,c,d){if(!e.tty||!e.tty.ops.get_char)throw new u.ErrnoError(60);for(var m=0,v=0;v<c;v++){var k;try{k=e.tty.ops.get_char(e.tty)}catch{throw new u.ErrnoError(29)}if(k===void 0&&m===0)throw new u.ErrnoError(6);if(k==null)break;m++,s[a+v]=k}return m&&(e.node.timestamp=Date.now()),m},write(e,s,a,c,d){if(!e.tty||!e.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var m=0;m<c;m++)e.tty.ops.put_char(e.tty,s[a+m])}catch{throw new u.ErrnoError(29)}return c&&(e.node.timestamp=Date.now()),m}},default_tty_ops:{get_char(e){return Rf()},put_char(e,s){s===null||s===10?(b(Wn(e.output)),e.output=[]):s!=0&&e.output.push(s)},fsync(e){e.output&&e.output.length>0&&(b(Wn(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,s,a){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,s){s===null||s===10?(y(Wn(e.output)),e.output=[]):s!=0&&e.output.push(s)},fsync(e){e.output&&e.output.length>0&&(y(Wn(e.output)),e.output=[])}}},Df=(e,s)=>{R.fill(0,e,e+s)},Co=(e,s)=>Math.ceil(e/s)*s,xo=e=>{e=Co(e,65536);var s=No(65536,e);return s&&Df(s,e),s},K={ops_table:null,mount(e){return K.createNode(null,"/",16895,0)},createNode(e,s,a,c){if(u.isBlkdev(a)||u.isFIFO(a))throw new u.ErrnoError(63);K.ops_table||(K.ops_table={dir:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,lookup:K.node_ops.lookup,mknod:K.node_ops.mknod,rename:K.node_ops.rename,unlink:K.node_ops.unlink,rmdir:K.node_ops.rmdir,readdir:K.node_ops.readdir,symlink:K.node_ops.symlink},stream:{llseek:K.stream_ops.llseek}},file:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:{llseek:K.stream_ops.llseek,read:K.stream_ops.read,write:K.stream_ops.write,allocate:K.stream_ops.allocate,mmap:K.stream_ops.mmap,msync:K.stream_ops.msync}},link:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,readlink:K.node_ops.readlink},stream:{}},chrdev:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:u.chrdev_stream_ops}});var d=u.createNode(e,s,a,c);return u.isDir(d.mode)?(d.node_ops=K.ops_table.dir.node,d.stream_ops=K.ops_table.dir.stream,d.contents={}):u.isFile(d.mode)?(d.node_ops=K.ops_table.file.node,d.stream_ops=K.ops_table.file.stream,d.usedBytes=0,d.contents=null):u.isLink(d.mode)?(d.node_ops=K.ops_table.link.node,d.stream_ops=K.ops_table.link.stream):u.isChrdev(d.mode)&&(d.node_ops=K.ops_table.chrdev.node,d.stream_ops=K.ops_table.chrdev.stream),d.timestamp=Date.now(),e&&(e.contents[s]=d,e.timestamp=d.timestamp),d},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,s){var a=e.contents?e.contents.length:0;if(!(a>=s)){var c=1024*1024;s=Math.max(s,a*(a<c?2:1.125)>>>0),a!=0&&(s=Math.max(s,256));var d=e.contents;e.contents=new Uint8Array(s),e.usedBytes>0&&e.contents.set(d.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,s){if(e.usedBytes!=s)if(s==0)e.contents=null,e.usedBytes=0;else{var a=e.contents;e.contents=new Uint8Array(s),a&&e.contents.set(a.subarray(0,Math.min(s,e.usedBytes))),e.usedBytes=s}},node_ops:{getattr(e){var s={};return s.dev=u.isChrdev(e.mode)?e.id:1,s.ino=e.id,s.mode=e.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=e.rdev,u.isDir(e.mode)?s.size=4096:u.isFile(e.mode)?s.size=e.usedBytes:u.isLink(e.mode)?s.size=e.link.length:s.size=0,s.atime=new Date(e.timestamp),s.mtime=new Date(e.timestamp),s.ctime=new Date(e.timestamp),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr(e,s){s.mode!==void 0&&(e.mode=s.mode),s.timestamp!==void 0&&(e.timestamp=s.timestamp),s.size!==void 0&&K.resizeFileStorage(e,s.size)},lookup(e,s){throw K.doesNotExistError},mknod(e,s,a,c){return K.createNode(e,s,a,c)},rename(e,s,a){if(u.isDir(e.mode)){var c;try{c=u.lookupNode(s,a)}catch{}if(c)for(var d in c.contents)throw new u.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=a,s.contents[a]=e,s.timestamp=e.parent.timestamp},unlink(e,s){delete e.contents[s],e.timestamp=Date.now()},rmdir(e,s){var a=u.lookupNode(e,s);for(var c in a.contents)throw new u.ErrnoError(55);delete e.contents[s],e.timestamp=Date.now()},readdir(e){var s=[".",".."];for(var a of Object.keys(e.contents))s.push(a);return s},symlink(e,s,a){var c=K.createNode(e,s,41471,0);return c.link=a,c},readlink(e){if(!u.isLink(e.mode))throw new u.ErrnoError(28);return e.link}},stream_ops:{read(e,s,a,c,d){var m=e.node.contents;if(d>=e.node.usedBytes)return 0;var v=Math.min(e.node.usedBytes-d,c);if(v>8&&m.subarray)s.set(m.subarray(d,d+v),a);else for(var k=0;k<v;k++)s[a+k]=m[d+k];return v},write(e,s,a,c,d,m){if(s.buffer===I.buffer&&(m=!1),!c)return 0;var v=e.node;if(v.timestamp=Date.now(),s.subarray&&(!v.contents||v.contents.subarray)){if(m)return v.contents=s.subarray(a,a+c),v.usedBytes=c,c;if(v.usedBytes===0&&d===0)return v.contents=s.slice(a,a+c),v.usedBytes=c,c;if(d+c<=v.usedBytes)return v.contents.set(s.subarray(a,a+c),d),c}if(K.expandFileStorage(v,d+c),v.contents.subarray&&s.subarray)v.contents.set(s.subarray(a,a+c),d);else for(var k=0;k<c;k++)v.contents[d+k]=s[a+k];return v.usedBytes=Math.max(v.usedBytes,d+c),c},llseek(e,s,a){var c=s;if(a===1?c+=e.position:a===2&&u.isFile(e.node.mode)&&(c+=e.node.usedBytes),c<0)throw new u.ErrnoError(28);return c},allocate(e,s,a){K.expandFileStorage(e.node,s+a),e.node.usedBytes=Math.max(e.node.usedBytes,s+a)},mmap(e,s,a,c,d){if(!u.isFile(e.node.mode))throw new u.ErrnoError(43);var m,v,k=e.node.contents;if(!(d&2)&&k&&k.buffer===I.buffer)v=!1,m=k.byteOffset;else{if(v=!0,m=xo(s),!m)throw new u.ErrnoError(48);k&&((a>0||a+s<k.length)&&(k.subarray?k=k.subarray(a,a+s):k=Array.prototype.slice.call(k,a,a+s)),I.set(k,m))}return{ptr:m,allocated:v}},msync(e,s,a,c,d){return K.stream_ops.write(e,s,0,c,a,!1),0}}},Af=(e,s,a,c)=>{var d=`al ${e}`;N(e).then(m=>{s(new Uint8Array(m)),d&&ar()},m=>{if(a)a();else throw`Loading data file "${e}" failed.`}),d&&Ei()},$f=(e,s,a,c,d,m)=>{u.createDataFile(e,s,a,c,d,m)},Pf=t.preloadPlugins||[],Lf=(e,s,a,c)=>{typeof Browser<"u"&&Browser.init();var d=!1;return Pf.forEach(m=>{d||m.canHandle(s)&&(m.handle(e,s,a,c),d=!0)}),d},Ff=(e,s,a,c,d,m,v,k,L,O)=>{var Z=s?Xt.resolve(he.join2(e,s)):e;function ee(oe){function V(G){O==null||O(),k||$f(e,s,G,c,d,L),m==null||m(),ar()}Lf(oe,Z,V,()=>{v==null||v(),ar()})||V(oe)}Ei(),typeof a=="string"?Af(a,ee,v):ee(a)},Nf=e=>{var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=s[e];if(typeof a>"u")throw new Error(`Unknown file open mode: ${e}`);return a},Ii=(e,s)=>{var a=0;return e&&(a|=365),s&&(a|=146),a},u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){T(this,"name","ErrnoError");this.errno=e}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){T(this,"shared",{})}get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{constructor(e,s,a,c){T(this,"node_ops",{});T(this,"stream_ops",{});T(this,"readMode",365);T(this,"writeMode",146);T(this,"mounted",null);e||(e=this),this.parent=e,this.mount=e.mount,this.id=u.nextInode++,this.name=s,this.mode=a,this.rdev=c}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return u.isDir(this.mode)}get isDevice(){return u.isChrdev(this.mode)}},lookupPath(e,s={}){if(e=Xt.resolve(e),!e)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(s=Object.assign(a,s),s.recurse_count>8)throw new u.ErrnoError(32);for(var c=e.split("/").filter(ee=>!!ee),d=u.root,m="/",v=0;v<c.length;v++){var k=v===c.length-1;if(k&&s.parent)break;if(d=u.lookupNode(d,c[v]),m=he.join2(m,c[v]),u.isMountpoint(d)&&(!k||k&&s.follow_mount)&&(d=d.mounted.root),!k||s.follow)for(var L=0;u.isLink(d.mode);){var O=u.readlink(m);m=Xt.resolve(he.dirname(m),O);var Z=u.lookupPath(m,{recurse_count:s.recurse_count+1});if(d=Z.node,L++>40)throw new u.ErrnoError(32)}}return{path:m,node:d}},getPath(e){for(var s;;){if(u.isRoot(e)){var a=e.mount.mountpoint;return s?a[a.length-1]!=="/"?`${a}/${s}`:a+s:a}s=s?`${e.name}/${s}`:e.name,e=e.parent}},hashName(e,s){for(var a=0,c=0;c<s.length;c++)a=(a<<5)-a+s.charCodeAt(c)|0;return(e+a>>>0)%u.nameTable.length},hashAddNode(e){var s=u.hashName(e.parent.id,e.name);e.name_next=u.nameTable[s],u.nameTable[s]=e},hashRemoveNode(e){var s=u.hashName(e.parent.id,e.name);if(u.nameTable[s]===e)u.nameTable[s]=e.name_next;else for(var a=u.nameTable[s];a;){if(a.name_next===e){a.name_next=e.name_next;break}a=a.name_next}},lookupNode(e,s){var a=u.mayLookup(e);if(a)throw new u.ErrnoError(a);for(var c=u.hashName(e.id,s),d=u.nameTable[c];d;d=d.name_next){var m=d.name;if(d.parent.id===e.id&&m===s)return d}return u.lookup(e,s)},createNode(e,s,a,c){var d=new u.FSNode(e,s,a,c);return u.hashAddNode(d),d},destroyNode(e){u.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var s=["r","w","rw"][e&3];return e&512&&(s+="w"),s},nodePermissions(e,s){return u.ignorePermissions?0:s.includes("r")&&!(e.mode&292)||s.includes("w")&&!(e.mode&146)||s.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!u.isDir(e.mode))return 54;var s=u.nodePermissions(e,"x");return s||(e.node_ops.lookup?0:2)},mayCreate(e,s){var a;try{return a=u.lookupNode(e,s),20}catch{}return u.nodePermissions(e,"wx")},mayDelete(e,s,a){var c;try{c=u.lookupNode(e,s)}catch(m){return m.errno}var d=u.nodePermissions(e,"wx");if(d)return d;if(a){if(!u.isDir(c.mode))return 54;if(u.isRoot(c)||u.getPath(c)===u.cwd())return 10}else if(u.isDir(c.mode))return 31;return 0},mayOpen(e,s){return e?u.isLink(e.mode)?32:u.isDir(e.mode)&&(u.flagsToPermissionString(s)!=="r"||s&512)?31:u.nodePermissions(e,u.flagsToPermissionString(s)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=u.MAX_OPEN_FDS;e++)if(!u.streams[e])return e;throw new u.ErrnoError(33)},getStreamChecked(e){var s=u.getStream(e);if(!s)throw new u.ErrnoError(8);return s},getStream:e=>u.streams[e],createStream(e,s=-1){return e=Object.assign(new u.FSStream,e),s==-1&&(s=u.nextfd()),e.fd=s,u.streams[s]=e,e},closeStream(e){u.streams[e]=null},dupStream(e,s=-1){var c,d;var a=u.createStream(e,s);return(d=(c=a.stream_ops)==null?void 0:c.dup)==null||d.call(c,a),a},chrdev_stream_ops:{open(e){var a,c;var s=u.getDevice(e.node.rdev);e.stream_ops=s.stream_ops,(c=(a=e.stream_ops).open)==null||c.call(a,e)},llseek(){throw new u.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,s)=>e<<8|s,registerDevice(e,s){u.devices[e]={stream_ops:s}},getDevice:e=>u.devices[e],getMounts(e){for(var s=[],a=[e];a.length;){var c=a.pop();s.push(c),a.push(...c.mounts)}return s},syncfs(e,s){typeof e=="function"&&(s=e,e=!1),u.syncFSRequests++,u.syncFSRequests>1&&y(`warning: ${u.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=u.getMounts(u.root.mount),c=0;function d(v){return u.syncFSRequests--,s(v)}function m(v){if(v)return m.errored?void 0:(m.errored=!0,d(v));++c>=a.length&&d(null)}a.forEach(v=>{if(!v.type.syncfs)return m(null);v.type.syncfs(v,e,m)})},mount(e,s,a){var c=a==="/",d=!a,m;if(c&&u.root)throw new u.ErrnoError(10);if(!c&&!d){var v=u.lookupPath(a,{follow_mount:!1});if(a=v.path,m=v.node,u.isMountpoint(m))throw new u.ErrnoError(10);if(!u.isDir(m.mode))throw new u.ErrnoError(54)}var k={type:e,opts:s,mountpoint:a,mounts:[]},L=e.mount(k);return L.mount=k,k.root=L,c?u.root=L:m&&(m.mounted=k,m.mount&&m.mount.mounts.push(k)),L},unmount(e){var s=u.lookupPath(e,{follow_mount:!1});if(!u.isMountpoint(s.node))throw new u.ErrnoError(28);var a=s.node,c=a.mounted,d=u.getMounts(c);Object.keys(u.nameTable).forEach(v=>{for(var k=u.nameTable[v];k;){var L=k.name_next;d.includes(k.mount)&&u.destroyNode(k),k=L}}),a.mounted=null;var m=a.mount.mounts.indexOf(c);a.mount.mounts.splice(m,1)},lookup(e,s){return e.node_ops.lookup(e,s)},mknod(e,s,a){var c=u.lookupPath(e,{parent:!0}),d=c.node,m=he.basename(e);if(!m||m==="."||m==="..")throw new u.ErrnoError(28);var v=u.mayCreate(d,m);if(v)throw new u.ErrnoError(v);if(!d.node_ops.mknod)throw new u.ErrnoError(63);return d.node_ops.mknod(d,m,s,a)},statfs(e){var s={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:u.nextInode,ffree:u.nextInode-1,fsid:42,flags:2,namelen:255},a=u.lookupPath(e,{follow:!0}).node;return a!=null&&a.node_ops.statfs&&Object.assign(s,a.node_ops.statfs(a.mount.opts.root)),s},create(e,s=438){return s&=4095,s|=32768,u.mknod(e,s,0)},mkdir(e,s=511){return s&=1023,s|=16384,u.mknod(e,s,0)},mkdirTree(e,s){for(var a=e.split("/"),c="",d=0;d<a.length;++d)if(a[d]){c+="/"+a[d];try{u.mkdir(c,s)}catch(m){if(m.errno!=20)throw m}}},mkdev(e,s,a){return typeof a>"u"&&(a=s,s=438),s|=8192,u.mknod(e,s,a)},symlink(e,s){if(!Xt.resolve(e))throw new u.ErrnoError(44);var a=u.lookupPath(s,{parent:!0}),c=a.node;if(!c)throw new u.ErrnoError(44);var d=he.basename(s),m=u.mayCreate(c,d);if(m)throw new u.ErrnoError(m);if(!c.node_ops.symlink)throw new u.ErrnoError(63);return c.node_ops.symlink(c,d,e)},rename(e,s){var a=he.dirname(e),c=he.dirname(s),d=he.basename(e),m=he.basename(s),v,k,L;if(v=u.lookupPath(e,{parent:!0}),k=v.node,v=u.lookupPath(s,{parent:!0}),L=v.node,!k||!L)throw new u.ErrnoError(44);if(k.mount!==L.mount)throw new u.ErrnoError(75);var O=u.lookupNode(k,d),Z=Xt.relative(e,c);if(Z.charAt(0)!==".")throw new u.ErrnoError(28);if(Z=Xt.relative(s,a),Z.charAt(0)!==".")throw new u.ErrnoError(55);var ee;try{ee=u.lookupNode(L,m)}catch{}if(O!==ee){var oe=u.isDir(O.mode),V=u.mayDelete(k,d,oe);if(V)throw new u.ErrnoError(V);if(V=ee?u.mayDelete(L,m,oe):u.mayCreate(L,m),V)throw new u.ErrnoError(V);if(!k.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(O)||ee&&u.isMountpoint(ee))throw new u.ErrnoError(10);if(L!==k&&(V=u.nodePermissions(k,"w"),V))throw new u.ErrnoError(V);u.hashRemoveNode(O);try{k.node_ops.rename(O,L,m),O.parent=L}catch(G){throw G}finally{u.hashAddNode(O)}}},rmdir(e){var s=u.lookupPath(e,{parent:!0}),a=s.node,c=he.basename(e),d=u.lookupNode(a,c),m=u.mayDelete(a,c,!0);if(m)throw new u.ErrnoError(m);if(!a.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(d))throw new u.ErrnoError(10);a.node_ops.rmdir(a,c),u.destroyNode(d)},readdir(e){var s=u.lookupPath(e,{follow:!0}),a=s.node;if(!a.node_ops.readdir)throw new u.ErrnoError(54);return a.node_ops.readdir(a)},unlink(e){var s=u.lookupPath(e,{parent:!0}),a=s.node;if(!a)throw new u.ErrnoError(44);var c=he.basename(e),d=u.lookupNode(a,c),m=u.mayDelete(a,c,!1);if(m)throw new u.ErrnoError(m);if(!a.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(d))throw new u.ErrnoError(10);a.node_ops.unlink(a,c),u.destroyNode(d)},readlink(e){var s=u.lookupPath(e),a=s.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.readlink)throw new u.ErrnoError(28);return a.node_ops.readlink(a)},stat(e,s){var a=u.lookupPath(e,{follow:!s}),c=a.node;if(!c)throw new u.ErrnoError(44);if(!c.node_ops.getattr)throw new u.ErrnoError(63);return c.node_ops.getattr(c)},lstat(e){return u.stat(e,!0)},chmod(e,s,a){var c;if(typeof e=="string"){var d=u.lookupPath(e,{follow:!a});c=d.node}else c=e;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{mode:s&4095|c.mode&-4096,timestamp:Date.now()})},lchmod(e,s){u.chmod(e,s,!0)},fchmod(e,s){var a=u.getStreamChecked(e);u.chmod(a.node,s)},chown(e,s,a,c){var d;if(typeof e=="string"){var m=u.lookupPath(e,{follow:!c});d=m.node}else d=e;if(!d.node_ops.setattr)throw new u.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown(e,s,a){u.chown(e,s,a,!0)},fchown(e,s,a){var c=u.getStreamChecked(e);u.chown(c.node,s,a)},truncate(e,s){if(s<0)throw new u.ErrnoError(28);var a;if(typeof e=="string"){var c=u.lookupPath(e,{follow:!0});a=c.node}else a=e;if(!a.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(a.mode))throw new u.ErrnoError(31);if(!u.isFile(a.mode))throw new u.ErrnoError(28);var d=u.nodePermissions(a,"w");if(d)throw new u.ErrnoError(d);a.node_ops.setattr(a,{size:s,timestamp:Date.now()})},ftruncate(e,s){var a=u.getStreamChecked(e);if((a.flags&2097155)===0)throw new u.ErrnoError(28);u.truncate(a.node,s)},utime(e,s,a){var c=u.lookupPath(e,{follow:!0}),d=c.node;d.node_ops.setattr(d,{timestamp:Math.max(s,a)})},open(e,s,a=438){if(e==="")throw new u.ErrnoError(44);s=typeof s=="string"?Nf(s):s,s&64?a=a&4095|32768:a=0;var c;if(typeof e=="object")c=e;else{e=he.normalize(e);try{var d=u.lookupPath(e,{follow:!(s&131072)});c=d.node}catch{}}var m=!1;if(s&64)if(c){if(s&128)throw new u.ErrnoError(20)}else c=u.mknod(e,a,0),m=!0;if(!c)throw new u.ErrnoError(44);if(u.isChrdev(c.mode)&&(s&=-513),s&65536&&!u.isDir(c.mode))throw new u.ErrnoError(54);if(!m){var v=u.mayOpen(c,s);if(v)throw new u.ErrnoError(v)}s&512&&!m&&u.truncate(c,0),s&=-131713;var k=u.createStream({node:c,path:u.getPath(c),flags:s,seekable:!0,position:0,stream_ops:c.stream_ops,ungotten:[],error:!1});return k.stream_ops.open&&k.stream_ops.open(k),t.logReadFiles&&!(s&1)&&(e in u.readFiles||(u.readFiles[e]=1)),k},close(e){if(u.isClosed(e))throw new u.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(s){throw s}finally{u.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,s,a){if(u.isClosed(e))throw new u.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new u.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new u.ErrnoError(28);return e.position=e.stream_ops.llseek(e,s,a),e.ungotten=[],e.position},read(e,s,a,c,d){if(c<0||d<0)throw new u.ErrnoError(28);if(u.isClosed(e))throw new u.ErrnoError(8);if((e.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(e.node.mode))throw new u.ErrnoError(31);if(!e.stream_ops.read)throw new u.ErrnoError(28);var m=typeof d<"u";if(!m)d=e.position;else if(!e.seekable)throw new u.ErrnoError(70);var v=e.stream_ops.read(e,s,a,c,d);return m||(e.position+=v),v},write(e,s,a,c,d,m){if(c<0||d<0)throw new u.ErrnoError(28);if(u.isClosed(e))throw new u.ErrnoError(8);if((e.flags&2097155)===0)throw new u.ErrnoError(8);if(u.isDir(e.node.mode))throw new u.ErrnoError(31);if(!e.stream_ops.write)throw new u.ErrnoError(28);e.seekable&&e.flags&1024&&u.llseek(e,0,2);var v=typeof d<"u";if(!v)d=e.position;else if(!e.seekable)throw new u.ErrnoError(70);var k=e.stream_ops.write(e,s,a,c,d,m);return v||(e.position+=k),k},allocate(e,s,a){if(u.isClosed(e))throw new u.ErrnoError(8);if(s<0||a<=0)throw new u.ErrnoError(28);if((e.flags&2097155)===0)throw new u.ErrnoError(8);if(!u.isFile(e.node.mode)&&!u.isDir(e.node.mode))throw new u.ErrnoError(43);if(!e.stream_ops.allocate)throw new u.ErrnoError(138);e.stream_ops.allocate(e,s,a)},mmap(e,s,a,c,d){if((c&2)!==0&&(d&2)===0&&(e.flags&2097155)!==2)throw new u.ErrnoError(2);if((e.flags&2097155)===1)throw new u.ErrnoError(2);if(!e.stream_ops.mmap)throw new u.ErrnoError(43);if(!s)throw new u.ErrnoError(28);return e.stream_ops.mmap(e,s,a,c,d)},msync(e,s,a,c,d){return e.stream_ops.msync?e.stream_ops.msync(e,s,a,c,d):0},ioctl(e,s,a){if(!e.stream_ops.ioctl)throw new u.ErrnoError(59);return e.stream_ops.ioctl(e,s,a)},readFile(e,s={}){if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error(`Invalid encoding type "${s.encoding}"`);var a,c=u.open(e,s.flags),d=u.stat(e),m=d.size,v=new Uint8Array(m);return u.read(c,v,0,m,0),s.encoding==="utf8"?a=Wn(v):s.encoding==="binary"&&(a=v),u.close(c),a},writeFile(e,s,a={}){a.flags=a.flags||577;var c=u.open(e,a.flags,a.mode);if(typeof s=="string"){var d=new Uint8Array(Vn(s)+1),m=Ci(s,d,0,d.length);u.write(c,d,0,m,void 0,a.canOwn)}else if(ArrayBuffer.isView(s))u.write(c,s,0,s.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");u.close(c)},cwd:()=>u.currentPath,chdir(e){var s=u.lookupPath(e,{follow:!0});if(s.node===null)throw new u.ErrnoError(44);if(!u.isDir(s.node.mode))throw new u.ErrnoError(54);var a=u.nodePermissions(s.node,"x");if(a)throw new u.ErrnoError(a);u.currentPath=s.path},createDefaultDirectories(){u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices(){u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(c,d,m,v,k)=>v,llseek:()=>0}),u.mkdev("/dev/null",u.makedev(1,3)),yn.register(u.makedev(5,0),yn.default_tty_ops),yn.register(u.makedev(6,0),yn.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var e=new Uint8Array(1024),s=0,a=()=>(s===0&&(s=ko(e).byteLength),e[--s]);u.createDevice("/dev","random",a),u.createDevice("/dev","urandom",a),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories(){u.mkdir("/proc");var e=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount(){var s=u.createNode(e,"fd",16895,73);return s.node_ops={lookup(a,c){var d=+c,m=u.getStreamChecked(d),v={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>m.path}};return v.parent=v,v}},s}},{},"/proc/self/fd")},createStandardStreams(e,s,a){e?u.createDevice("/dev","stdin",e):u.symlink("/dev/tty","/dev/stdin"),s?u.createDevice("/dev","stdout",null,s):u.symlink("/dev/tty","/dev/stdout"),a?u.createDevice("/dev","stderr",null,a):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},staticInit(){u.nameTable=new Array(4096),u.mount(K,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:K}},init(e,s,a){u.initialized=!0,e??(e=t.stdin),s??(s=t.stdout),a??(a=t.stderr),u.createStandardStreams(e,s,a)},quit(){u.initialized=!1;for(var e=0;e<u.streams.length;e++){var s=u.streams[e];s&&u.close(s)}},findObject(e,s){var a=u.analyzePath(e,s);return a.exists?a.object:null},analyzePath(e,s){try{var a=u.lookupPath(e,{follow:!s});e=a.path}catch{}var c={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=u.lookupPath(e,{parent:!0});c.parentExists=!0,c.parentPath=a.path,c.parentObject=a.node,c.name=he.basename(e),a=u.lookupPath(e,{follow:!s}),c.exists=!0,c.path=a.path,c.object=a.node,c.name=a.node.name,c.isRoot=a.path==="/"}catch(d){c.error=d.errno}return c},createPath(e,s,a,c){e=typeof e=="string"?e:u.getPath(e);for(var d=s.split("/").reverse();d.length;){var m=d.pop();if(m){var v=he.join2(e,m);try{u.mkdir(v)}catch{}e=v}}return v},createFile(e,s,a,c,d){var m=he.join2(typeof e=="string"?e:u.getPath(e),s),v=Ii(c,d);return u.create(m,v)},createDataFile(e,s,a,c,d,m){var v=s;e&&(e=typeof e=="string"?e:u.getPath(e),v=s?he.join2(e,s):e);var k=Ii(c,d),L=u.create(v,k);if(a){if(typeof a=="string"){for(var O=new Array(a.length),Z=0,ee=a.length;Z<ee;++Z)O[Z]=a.charCodeAt(Z);a=O}u.chmod(L,k|146);var oe=u.open(L,577);u.write(oe,a,0,a.length,0,m),u.close(oe),u.chmod(L,k)}},createDevice(e,s,a,c){var k;var d=he.join2(typeof e=="string"?e:u.getPath(e),s),m=Ii(!!a,!!c);(k=u.createDevice).major??(k.major=64);var v=u.makedev(u.createDevice.major++,0);return u.registerDevice(v,{open(L){L.seekable=!1},close(L){var O;(O=c==null?void 0:c.buffer)!=null&&O.length&&c(10)},read(L,O,Z,ee,oe){for(var V=0,G=0;G<ee;G++){var _e;try{_e=a()}catch{throw new u.ErrnoError(29)}if(_e===void 0&&V===0)throw new u.ErrnoError(6);if(_e==null)break;V++,O[Z+G]=_e}return V&&(L.node.timestamp=Date.now()),V},write(L,O,Z,ee,oe){for(var V=0;V<ee;V++)try{c(O[Z+V])}catch{throw new u.ErrnoError(29)}return ee&&(L.node.timestamp=Date.now()),V}}),u.mkdev(d,m,v)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{e.contents=P(e.url),e.usedBytes=e.contents.length}catch{throw new u.ErrnoError(29)}},createLazyFile(e,s,a,c,d){class m{constructor(){T(this,"lengthKnown",!1);T(this,"chunks",[])}get(V){if(!(V>this.length-1||V<0)){var G=V%this.chunkSize,_e=V/this.chunkSize|0;return this.getter(_e)[G]}}setDataGetter(V){this.getter=V}cacheLength(){var V=new XMLHttpRequest;if(V.open("HEAD",a,!1),V.send(null),!(V.status>=200&&V.status<300||V.status===304))throw new Error("Couldn't load "+a+". Status: "+V.status);var G=Number(V.getResponseHeader("Content-length")),_e,Je=(_e=V.getResponseHeader("Accept-Ranges"))&&_e==="bytes",Ke=(_e=V.getResponseHeader("Content-Encoding"))&&_e==="gzip",ft=1024*1024;Je||(ft=G);var ht=(Ct,Jn)=>{if(Ct>Jn)throw new Error("invalid range ("+Ct+", "+Jn+") or no bytes requested!");if(Jn>G-1)throw new Error("only "+G+" bytes available! programmer error!");var ze=new XMLHttpRequest;if(ze.open("GET",a,!1),G!==ft&&ze.setRequestHeader("Range","bytes="+Ct+"-"+Jn),ze.responseType="arraybuffer",ze.overrideMimeType&&ze.overrideMimeType("text/plain; charset=x-user-defined"),ze.send(null),!(ze.status>=200&&ze.status<300||ze.status===304))throw new Error("Couldn't load "+a+". Status: "+ze.status);return ze.response!==void 0?new Uint8Array(ze.response||[]):xi(ze.responseText||"",!0)},ys=this;ys.setDataGetter(Ct=>{var Jn=Ct*ft,ze=(Ct+1)*ft-1;if(ze=Math.min(ze,G-1),typeof ys.chunks[Ct]>"u"&&(ys.chunks[Ct]=ht(Jn,ze)),typeof ys.chunks[Ct]>"u")throw new Error("doXHR failed!");return ys.chunks[Ct]}),(Ke||!G)&&(ft=G=1,G=this.getter(0).length,ft=G,b("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=G,this._chunkSize=ft,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!w)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var v=new m,k={isDevice:!1,contents:v}}else var k={isDevice:!1,url:a};var L=u.createFile(e,s,k,c,d);k.contents?L.contents=k.contents:k.url&&(L.contents=null,L.url=k.url),Object.defineProperties(L,{usedBytes:{get:function(){return this.contents.length}}});var O={},Z=Object.keys(L.stream_ops);Z.forEach(oe=>{var V=L.stream_ops[oe];O[oe]=(...G)=>(u.forceLoadFile(L),V(...G))});function ee(oe,V,G,_e,Je){var Ke=oe.node.contents;if(Je>=Ke.length)return 0;var ft=Math.min(Ke.length-Je,_e);if(Ke.slice)for(var ht=0;ht<ft;ht++)V[G+ht]=Ke[Je+ht];else for(var ht=0;ht<ft;ht++)V[G+ht]=Ke.get(Je+ht);return ft}return O.read=(oe,V,G,_e,Je)=>(u.forceLoadFile(L),ee(oe,V,G,_e,Je)),O.mmap=(oe,V,G,_e,Je)=>{u.forceLoadFile(L);var Ke=xo(V);if(!Ke)throw new u.ErrnoError(48);return ee(oe,I,Ke,V,G),{ptr:Ke,allocated:!0}},L.stream_ops=O,L}},se={DEFAULT_POLLMASK:5,calculateAt(e,s,a){if(he.isAbs(s))return s;var c;if(e===-100)c=u.cwd();else{var d=se.getStreamFromFD(e);c=d.path}if(s.length==0){if(!a)throw new u.ErrnoError(44);return c}return he.join2(c,s)},doStat(e,s,a){var c=e(s);C[a>>2]=c.dev,C[a+4>>2]=c.mode,U[a+8>>2]=c.nlink,C[a+12>>2]=c.uid,C[a+16>>2]=c.gid,C[a+20>>2]=c.rdev,ve=[c.size>>>0,(Q=c.size,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[a+24>>2]=ve[0],C[a+28>>2]=ve[1],C[a+32>>2]=4096,C[a+36>>2]=c.blocks;var d=c.atime.getTime(),m=c.mtime.getTime(),v=c.ctime.getTime();return ve=[Math.floor(d/1e3)>>>0,(Q=Math.floor(d/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[a+40>>2]=ve[0],C[a+44>>2]=ve[1],U[a+48>>2]=d%1e3*1e3*1e3,ve=[Math.floor(m/1e3)>>>0,(Q=Math.floor(m/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[a+56>>2]=ve[0],C[a+60>>2]=ve[1],U[a+64>>2]=m%1e3*1e3*1e3,ve=[Math.floor(v/1e3)>>>0,(Q=Math.floor(v/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[a+72>>2]=ve[0],C[a+76>>2]=ve[1],U[a+80>>2]=v%1e3*1e3*1e3,ve=[c.ino>>>0,(Q=c.ino,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[a+88>>2]=ve[0],C[a+92>>2]=ve[1],0},doMsync(e,s,a,c,d){if(!u.isFile(s.node.mode))throw new u.ErrnoError(43);if(c&2)return 0;var m=R.slice(e,e+a);u.msync(s,m,d,a,c)},getStreamFromFD(e){var s=u.getStreamChecked(e);return s},varargs:void 0,getStr(e){var s=gn(e);return s}};function zf(e,s){try{return e=se.getStr(e),u.chmod(e,s),0}catch(a){if(typeof u>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Uf(e,s,a,c){try{if(s=se.getStr(s),s=se.calculateAt(e,s),a&-8)return-28;var d=u.lookupPath(s,{follow:!0}),m=d.node;if(!m)return-44;var v="";return a&4&&(v+="r"),a&2&&(v+="w"),a&1&&(v+="x"),v&&u.nodePermissions(m,v)?-2:0}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return-k.errno}}function Hf(e,s){try{return u.fchmod(e,s),0}catch(a){if(typeof u>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function jf(e,s,a){try{return u.fchown(e,s,a),0}catch(c){if(typeof u>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var cr=()=>{var e=C[+se.varargs>>2];return se.varargs+=4,e},Of=cr;function Mf(e,s,a){se.varargs=a;try{var c=se.getStreamFromFD(e);switch(s){case 0:{var d=cr();if(d<0)return-28;for(;u.streams[d];)d++;var m;return m=u.dupStream(c,d),m.fd}case 1:case 2:return 0;case 3:return c.flags;case 4:{var d=cr();return c.flags|=d,0}case 12:{var d=Of(),v=0;return $[d+v>>1]=2,0}case 13:case 14:return 0}return-28}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return-k.errno}}function Bf(e,s){try{var a=se.getStreamFromFD(e);return se.doStat(u.stat,a.path,s)}catch(c){if(typeof u>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var ms=(e,s)=>s+2097152>>>0<4194305-!!e?(e>>>0)+s*4294967296:NaN;function Wf(e,s,a){var c=ms(s,a);try{return isNaN(c)?61:(u.ftruncate(e,c),0)}catch(d){if(typeof u>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var en=(e,s,a)=>Ci(e,R,s,a);function Vf(e,s){try{if(s===0)return-28;var a=u.cwd(),c=Vn(a)+1;return s<c?-68:(en(a,e,s),c)}catch(d){if(typeof u>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function Gf(e,s){try{return e=se.getStr(e),se.doStat(u.lstat,e,s)}catch(a){if(typeof u>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Qf(e,s,a){try{return s=se.getStr(s),s=se.calculateAt(e,s),s=he.normalize(s),s[s.length-1]==="/"&&(s=s.substr(0,s.length-1)),u.mkdir(s,a,0),0}catch(c){if(typeof u>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Jf(e,s,a,c){try{s=se.getStr(s);var d=c&256,m=c&4096;return c=c&-6401,s=se.calculateAt(e,s,m),se.doStat(d?u.lstat:u.stat,s,a)}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function Yf(e,s,a,c){se.varargs=c;try{s=se.getStr(s),s=se.calculateAt(e,s);var d=c?cr():0;return u.open(s,a,d).fd}catch(m){if(typeof u>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}function Kf(e,s,a,c){try{if(s=se.getStr(s),s=se.calculateAt(e,s),c<=0)return-28;var d=u.readlink(s),m=Math.min(c,Vn(d)),v=I[a+m];return en(d,a,c+1),I[a+m]=v,m}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return-k.errno}}function Zf(e){try{return e=se.getStr(e),u.rmdir(e),0}catch(s){if(typeof u>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function Xf(e,s){try{return e=se.getStr(e),se.doStat(u.stat,e,s)}catch(a){if(typeof u>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function eh(e,s,a){try{return s=se.getStr(s),s=se.calculateAt(e,s),a===0?u.unlink(s):a===512?u.rmdir(s):Zt("Invalid flags passed to unlinkat"),0}catch(c){if(typeof u>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var Io=e=>U[e>>2]+C[e+4>>2]*4294967296;function th(e,s,a,c){try{s=se.getStr(s),s=se.calculateAt(e,s,!0);var d=Date.now(),m,v;if(!a)m=d,v=d;else{var k=Io(a),L=C[a+8>>2];L==1073741823?m=d:L==1073741822?m=-1:m=k*1e3+L/(1e3*1e3),a+=16,k=Io(a),L=C[a+8>>2],L==1073741823?v=d:L==1073741822?v=-1:v=k*1e3+L/(1e3*1e3)}return(v!=-1||m!=-1)&&u.utime(s,m,v),0}catch(O){if(typeof u>"u"||O.name!=="ErrnoError")throw O;return-O.errno}}var nh=e=>e%4===0&&(e%100!==0||e%400===0),sh=[0,31,60,91,121,152,182,213,244,274,305,335],rh=[0,31,59,90,120,151,181,212,243,273,304,334],ih=e=>{var s=nh(e.getFullYear()),a=s?sh:rh,c=a[e.getMonth()]+e.getDate()-1;return c};function ah(e,s,a){var c=ms(e,s),d=new Date(c*1e3);C[a>>2]=d.getSeconds(),C[a+4>>2]=d.getMinutes(),C[a+8>>2]=d.getHours(),C[a+12>>2]=d.getDate(),C[a+16>>2]=d.getMonth(),C[a+20>>2]=d.getFullYear()-1900,C[a+24>>2]=d.getDay();var m=ih(d)|0;C[a+28>>2]=m,C[a+36>>2]=-(d.getTimezoneOffset()*60);var v=new Date(d.getFullYear(),0,1),k=new Date(d.getFullYear(),6,1).getTimezoneOffset(),L=v.getTimezoneOffset(),O=(k!=L&&d.getTimezoneOffset()==Math.min(L,k))|0;C[a+32>>2]=O}function oh(e,s,a,c,d,m,v,k){var L=ms(d,m);try{if(isNaN(L))return 61;var O=se.getStreamFromFD(c),Z=u.mmap(O,e,L,s,a),ee=Z.ptr;return C[v>>2]=Z.allocated,U[k>>2]=ee,0}catch(oe){if(typeof u>"u"||oe.name!=="ErrnoError")throw oe;return-oe.errno}}function ch(e,s,a,c,d,m,v){var k=ms(m,v);try{var L=se.getStreamFromFD(d);a&2&&se.doMsync(e,L,s,c,k)}catch(O){if(typeof u>"u"||O.name!=="ErrnoError")throw O;return-O.errno}}var lh=(e,s,a,c)=>{var d=new Date().getFullYear(),m=new Date(d,0,1),v=new Date(d,6,1),k=m.getTimezoneOffset(),L=v.getTimezoneOffset(),O=Math.max(k,L);U[e>>2]=O*60,C[s>>2]=+(k!=L);var Z=V=>{var G=V>=0?"-":"+",_e=Math.abs(V),Je=String(Math.floor(_e/60)).padStart(2,"0"),Ke=String(_e%60).padStart(2,"0");return`UTC${G}${Je}${Ke}`},ee=Z(k),oe=Z(L);L<k?(en(ee,a,17),en(oe,c,17)):(en(ee,c,17),en(oe,a,17))},uh=()=>Date.now(),dh=()=>performance.now(),fh=()=>2147483648,hh=e=>{var s=S.buffer,a=(e-s.byteLength+65535)/65536|0;try{return S.grow(a),M(),1}catch{}},_h=e=>{var s=R.length;e>>>=0;var a=fh();if(e>a)return!1;for(var c=1;c<=4;c*=2){var d=s*(1+.2/c);d=Math.min(d,e+100663296);var m=Math.min(a,Co(Math.max(e,d),65536)),v=hh(m);if(v)return!0}return!1},Ti={},ph=()=>D||"./this.program",gs=()=>{if(!gs.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:ph()};for(var a in Ti)Ti[a]===void 0?delete s[a]:s[a]=Ti[a];var c=[];for(var a in s)c.push(`${a}=${s[a]}`);gs.strings=c}return gs.strings},mh=(e,s)=>{for(var a=0;a<e.length;++a)I[s++]=e.charCodeAt(a);I[s]=0},gh=(e,s)=>{var a=0;return gs().forEach((c,d)=>{var m=s+a;U[e+d*4>>2]=m,mh(c,m),a+=c.length+1}),0},yh=(e,s)=>{var a=gs();U[e>>2]=a.length;var c=0;return a.forEach(d=>c+=d.length+1),U[s>>2]=c,0};function bh(e){try{var s=se.getStreamFromFD(e);return u.close(s),0}catch(a){if(typeof u>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function vh(e,s){try{var a=0,c=0,d=0,m=se.getStreamFromFD(e),v=m.tty?2:u.isDir(m.mode)?3:u.isLink(m.mode)?7:4;return I[s]=v,$[s+2>>1]=d,ve=[a>>>0,(Q=a,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[s+8>>2]=ve[0],C[s+12>>2]=ve[1],ve=[c>>>0,(Q=c,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[s+16>>2]=ve[0],C[s+20>>2]=ve[1],0}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return k.errno}}var wh=(e,s,a,c)=>{for(var d=0,m=0;m<a;m++){var v=U[s>>2],k=U[s+4>>2];s+=8;var L=u.read(e,I,v,k,c);if(L<0)return-1;if(d+=L,L<k)break}return d};function Sh(e,s,a,c){try{var d=se.getStreamFromFD(e),m=wh(d,s,a);return U[c>>2]=m,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}function Eh(e,s,a,c,d){var m=ms(s,a);try{if(isNaN(m))return 61;var v=se.getStreamFromFD(e);return u.llseek(v,m,c),ve=[v.position>>>0,(Q=v.position,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],C[d>>2]=ve[0],C[d+4>>2]=ve[1],v.getdents&&m===0&&c===0&&(v.getdents=null),0}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return k.errno}}function qh(e){var a;try{var s=se.getStreamFromFD(e);return(a=s.stream_ops)!=null&&a.fsync?s.stream_ops.fsync(s):0}catch(c){if(typeof u>"u"||c.name!=="ErrnoError")throw c;return c.errno}}var kh=(e,s,a,c)=>{for(var d=0,m=0;m<a;m++){var v=U[s>>2],k=U[s+4>>2];s+=8;var L=u.write(e,I,v,k,c);if(L<0)return-1;if(d+=L,L<k)break}return d};function Ch(e,s,a,c){try{var d=se.getStreamFromFD(e),m=kh(d,s,a);return U[c>>2]=m,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var ae=function(){const e=typeof Asyncify=="object"?Asyncify.handleAsync.bind(Asyncify):null;t.handleAsync=e;const s=new Map;t.setCallback=(a,c)=>s.set(a,c),t.getCallback=a=>s.get(a),t.deleteCallback=a=>s.delete(a),ae=function(a,c,...d){const m=s.get(c);let v=null;const k=typeof m=="function"?m:m[v=gn(d.shift())];if(a){if(e)return e(()=>k.apply(m,d));throw new Error("Synchronous WebAssembly cannot call async function")}const L=k.apply(m,d);if(typeof(L==null?void 0:L.then)=="function")throw console.error("unexpected Promise",k),new Error(`${v} unexpectedly returned a Promise`);return L}};function xh(...e){return ae(!1,...e)}function Ih(...e){return ae(!0,...e)}function Th(...e){return ae(!1,...e)}function Rh(...e){return ae(!0,...e)}function Dh(...e){return ae(!1,...e)}function Ah(...e){return ae(!0,...e)}function $h(...e){return ae(!1,...e)}function Ph(...e){return ae(!0,...e)}function Lh(...e){return ae(!1,...e)}function Fh(...e){return ae(!0,...e)}function Nh(...e){return ae(!1,...e)}function zh(...e){return ae(!0,...e)}function Uh(...e){return ae(!1,...e)}function Hh(...e){return ae(!0,...e)}function jh(...e){return ae(!1,...e)}function Oh(...e){return ae(!0,...e)}function Mh(...e){return ae(!1,...e)}function Bh(...e){return ae(!0,...e)}function Wh(...e){return ae(!1,...e)}function Vh(...e){return ae(!0,...e)}function Gh(...e){return ae(!1,...e)}function Qh(...e){return ae(!0,...e)}function Jh(...e){return ae(!1,...e)}function Yh(...e){return ae(!0,...e)}function Kh(...e){return ae(!1,...e)}function Zh(...e){return ae(!0,...e)}function Xh(...e){return ae(!1,...e)}function e_(...e){return ae(!0,...e)}function t_(...e){return ae(!1,...e)}function n_(...e){return ae(!0,...e)}function s_(...e){return ae(!1,...e)}function r_(...e){return ae(!0,...e)}var i_=e=>{E=e,q(e,new So(e))},a_=(e,s)=>{E=e,i_(e)},o_=e=>{if(e instanceof So||e=="unwind")return E;q(1,e)},To=(e,s)=>{e<128?s.push(e):s.push(e%128|128,e>>7)},c_=e=>{for(var s={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},a={parameters:[],results:e[0]=="v"?[]:[s[e[0]]]},c=1;c<e.length;++c)a.parameters.push(s[e[c]]);return a},l_=(e,s)=>{var a=e.slice(0,1),c=e.slice(1),d={i:127,p:127,j:126,f:125,d:124,e:111};s.push(96),To(c.length,s);for(var m=0;m<c.length;++m)s.push(d[c[m]]);a=="v"?s.push(0):s.push(1,d[a])},u_=(e,s)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(c_(s),e);var a=[1];l_(s,a);var c=[0,97,115,109,1,0,0,0,1];To(a.length,c),c.push(...a),c.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var d=new WebAssembly.Module(new Uint8Array(c)),m=new WebAssembly.Instance(d,{e:{f:e}}),v=m.exports.f;return v},Gn,d_=e=>Gn.get(e),f_=(e,s)=>{if(Qn)for(var a=e;a<e+s;a++){var c=d_(a);c&&Qn.set(c,a)}},Qn,h_=e=>(Qn||(Qn=new WeakMap,f_(0,Gn.length)),Qn.get(e)||0),Ro=[],__=()=>{if(Ro.length)return Ro.pop();try{Gn.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return Gn.length-1},Do=(e,s)=>Gn.set(e,s),p_=(e,s)=>{var a=h_(e);if(a)return a;var c=__();try{Do(c,e)}catch(m){if(!(m instanceof TypeError))throw m;var d=u_(e,s);Do(c,d)}return Qn.set(e,c),c},Ao=e=>{var s=t["_"+e];return s},$o=(e,s)=>{I.set(e,s)},Po=e=>Ho(e),m_=e=>{var s=Vn(e)+1,a=Po(s);return en(e,a,s),a},tn=(e,s,a,c,d)=>{var m={string:G=>{var _e=0;return G!=null&&G!==0&&(_e=m_(G)),_e},array:G=>{var _e=Po(G.length);return $o(G,_e),_e}};function v(G){return s==="string"?gn(G):s==="boolean"?!!G:G}var k=Ao(e),L=[],O=0;if(c)for(var Z=0;Z<c.length;Z++){var ee=m[a[Z]];ee?(O===0&&(O=xf()),L[Z]=ee(c[Z])):L[Z]=c[Z]}var oe=k(...L);function V(G){return O!==0&&Cf(O),v(G)}return oe=V(oe),oe},g_=(e,s,a,c)=>{var d=!a||a.every(v=>v==="number"||v==="boolean"),m=s!=="string";return m&&d&&!c?Ao(e):(...v)=>tn(e,s,a,v)},y_=e=>zo(),b_=(e,s,a)=>{if(a??(a=2147483647),a<2)return 0;a-=2;for(var c=s,d=a<e.length*2?a/2:e.length,m=0;m<d;++m){var v=e.charCodeAt(m);$[s>>1]=v,s+=2}return $[s>>1]=0,s-c},v_=(e,s,a)=>{if(a??(a=2147483647),a<4)return 0;for(var c=s,d=c+a-4,m=0;m<e.length;++m){var v=e.charCodeAt(m);if(v>=55296&&v<=57343){var k=e.charCodeAt(++m);v=65536+((v&1023)<<10)|k&1023}if(C[s>>2]=v,s+=4,s+4>d)break}return C[s>>2]=0,s-c},w_=e=>{for(var s="";;){var a=R[e++];if(!a)return s;s+=String.fromCharCode(a)}},Lo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,S_=(e,s)=>{for(var a=e,c=a>>1,d=c+s/2;!(c>=d)&&H[c];)++c;if(a=c<<1,a-e>32&&Lo)return Lo.decode(R.subarray(e,a));for(var m="",v=0;!(v>=s/2);++v){var k=$[e+v*2>>1];if(k==0)break;m+=String.fromCharCode(k)}return m},E_=(e,s)=>{for(var a=0,c="";!(a>=s/4);){var d=C[e+a*4>>2];if(d==0)break;if(++a,d>=65536){var m=d-65536;c+=String.fromCharCode(55296|m>>10,56320|m&1023)}else c+=String.fromCharCode(d)}return c};function q_(e){for(var s=[],a=0;a<e.length;a++){var c=e[a];c>255&&(c&=255),s.push(String.fromCharCode(c))}return s.join("")}u.createPreloadedFile=Ff,u.staticInit(),K.doesNotExistError=new u.ErrnoError(44),K.doesNotExistError.stack="<generic error, no stack>",ae();var k_={a:If,Y:zf,$:Uf,Z:Hf,X:jf,b:Mf,W:Bf,y:Wf,Q:Vf,U:Gf,N:Qf,S:Jf,L:Yf,J:Kf,I:Zf,V:Xf,G:eh,F:th,w:ah,u:oh,v:ch,M:lh,n:uh,m:dh,D:_h,O:gh,P:yh,o:bh,E:vh,K:Sh,x:Eh,R:qh,H:Ch,s:xh,t:Ih,ga:Th,ka:Rh,i:Dh,j:Ah,c:$h,d:Ph,ca:Lh,da:Fh,ea:Nh,fa:zh,g:Uh,h:Hh,z:jh,A:Oh,e:Mh,f:Bh,aa:Wh,ba:Vh,B:Gh,C:Qh,p:Jh,q:Yh,ha:Kh,ia:Zh,ja:Xh,r:e_,k:t_,l:n_,T:s_,_:r_},p=kf();t._sqlite3_status64=(e,s,a,c)=>(t._sqlite3_status64=p.na)(e,s,a,c),t._sqlite3_status=(e,s,a,c)=>(t._sqlite3_status=p.oa)(e,s,a,c),t._sqlite3_db_status=(e,s,a,c,d)=>(t._sqlite3_db_status=p.pa)(e,s,a,c,d),t._sqlite3_msize=e=>(t._sqlite3_msize=p.qa)(e),t._sqlite3_vfs_find=e=>(t._sqlite3_vfs_find=p.ra)(e),t._sqlite3_vfs_register=(e,s)=>(t._sqlite3_vfs_register=p.sa)(e,s),t._sqlite3_vfs_unregister=e=>(t._sqlite3_vfs_unregister=p.ta)(e),t._sqlite3_release_memory=e=>(t._sqlite3_release_memory=p.ua)(e),t._sqlite3_soft_heap_limit64=(e,s)=>(t._sqlite3_soft_heap_limit64=p.va)(e,s),t._sqlite3_memory_used=()=>(t._sqlite3_memory_used=p.wa)(),t._sqlite3_hard_heap_limit64=(e,s)=>(t._sqlite3_hard_heap_limit64=p.xa)(e,s),t._sqlite3_memory_highwater=e=>(t._sqlite3_memory_highwater=p.ya)(e),t._sqlite3_malloc=e=>(t._sqlite3_malloc=p.za)(e),t._sqlite3_malloc64=(e,s)=>(t._sqlite3_malloc64=p.Aa)(e,s),t._sqlite3_free=e=>(t._sqlite3_free=p.Ba)(e),t._sqlite3_realloc=(e,s)=>(t._sqlite3_realloc=p.Ca)(e,s),t._sqlite3_realloc64=(e,s,a)=>(t._sqlite3_realloc64=p.Da)(e,s,a),t._sqlite3_str_vappendf=(e,s,a)=>(t._sqlite3_str_vappendf=p.Ea)(e,s,a),t._sqlite3_str_append=(e,s,a)=>(t._sqlite3_str_append=p.Fa)(e,s,a),t._sqlite3_str_appendchar=(e,s,a)=>(t._sqlite3_str_appendchar=p.Ga)(e,s,a),t._sqlite3_str_appendall=(e,s)=>(t._sqlite3_str_appendall=p.Ha)(e,s),t._sqlite3_str_appendf=(e,s,a)=>(t._sqlite3_str_appendf=p.Ia)(e,s,a),t._sqlite3_str_finish=e=>(t._sqlite3_str_finish=p.Ja)(e),t._sqlite3_str_errcode=e=>(t._sqlite3_str_errcode=p.Ka)(e),t._sqlite3_str_length=e=>(t._sqlite3_str_length=p.La)(e),t._sqlite3_str_value=e=>(t._sqlite3_str_value=p.Ma)(e),t._sqlite3_str_reset=e=>(t._sqlite3_str_reset=p.Na)(e),t._sqlite3_str_new=e=>(t._sqlite3_str_new=p.Oa)(e),t._sqlite3_vmprintf=(e,s)=>(t._sqlite3_vmprintf=p.Pa)(e,s),t._sqlite3_mprintf=(e,s)=>(t._sqlite3_mprintf=p.Qa)(e,s),t._sqlite3_vsnprintf=(e,s,a,c)=>(t._sqlite3_vsnprintf=p.Ra)(e,s,a,c),t._sqlite3_snprintf=(e,s,a,c)=>(t._sqlite3_snprintf=p.Sa)(e,s,a,c),t._sqlite3_log=(e,s,a)=>(t._sqlite3_log=p.Ta)(e,s,a),t._sqlite3_randomness=(e,s)=>(t._sqlite3_randomness=p.Ua)(e,s),t._sqlite3_stricmp=(e,s)=>(t._sqlite3_stricmp=p.Va)(e,s),t._sqlite3_strnicmp=(e,s,a)=>(t._sqlite3_strnicmp=p.Wa)(e,s,a),t._sqlite3_os_init=()=>(t._sqlite3_os_init=p.Xa)(),t._sqlite3_os_end=()=>(t._sqlite3_os_end=p.Ya)(),t._sqlite3_serialize=(e,s,a,c)=>(t._sqlite3_serialize=p.Za)(e,s,a,c),t._sqlite3_prepare_v2=(e,s,a,c,d)=>(t._sqlite3_prepare_v2=p._a)(e,s,a,c,d),t._sqlite3_step=e=>(t._sqlite3_step=p.$a)(e),t._sqlite3_column_int64=(e,s)=>(t._sqlite3_column_int64=p.ab)(e,s),t._sqlite3_reset=e=>(t._sqlite3_reset=p.bb)(e),t._sqlite3_exec=(e,s,a,c,d)=>(t._sqlite3_exec=p.cb)(e,s,a,c,d),t._sqlite3_column_int=(e,s)=>(t._sqlite3_column_int=p.db)(e,s),t._sqlite3_finalize=e=>(t._sqlite3_finalize=p.eb)(e),t._sqlite3_deserialize=(e,s,a,c,d,m,v,k)=>(t._sqlite3_deserialize=p.fb)(e,s,a,c,d,m,v,k),t._sqlite3_database_file_object=e=>(t._sqlite3_database_file_object=p.gb)(e),t._sqlite3_backup_init=(e,s,a,c)=>(t._sqlite3_backup_init=p.hb)(e,s,a,c),t._sqlite3_backup_step=(e,s)=>(t._sqlite3_backup_step=p.ib)(e,s),t._sqlite3_backup_finish=e=>(t._sqlite3_backup_finish=p.jb)(e),t._sqlite3_backup_remaining=e=>(t._sqlite3_backup_remaining=p.kb)(e),t._sqlite3_backup_pagecount=e=>(t._sqlite3_backup_pagecount=p.lb)(e),t._sqlite3_clear_bindings=e=>(t._sqlite3_clear_bindings=p.mb)(e),t._sqlite3_value_blob=e=>(t._sqlite3_value_blob=p.nb)(e),t._sqlite3_value_text=e=>(t._sqlite3_value_text=p.ob)(e),t._sqlite3_value_bytes=e=>(t._sqlite3_value_bytes=p.pb)(e),t._sqlite3_value_bytes16=e=>(t._sqlite3_value_bytes16=p.qb)(e),t._sqlite3_value_double=e=>(t._sqlite3_value_double=p.rb)(e),t._sqlite3_value_int=e=>(t._sqlite3_value_int=p.sb)(e),t._sqlite3_value_int64=e=>(t._sqlite3_value_int64=p.tb)(e),t._sqlite3_value_subtype=e=>(t._sqlite3_value_subtype=p.ub)(e),t._sqlite3_value_pointer=(e,s)=>(t._sqlite3_value_pointer=p.vb)(e,s),t._sqlite3_value_text16=e=>(t._sqlite3_value_text16=p.wb)(e),t._sqlite3_value_text16be=e=>(t._sqlite3_value_text16be=p.xb)(e),t._sqlite3_value_text16le=e=>(t._sqlite3_value_text16le=p.yb)(e),t._sqlite3_value_type=e=>(t._sqlite3_value_type=p.zb)(e),t._sqlite3_value_encoding=e=>(t._sqlite3_value_encoding=p.Ab)(e),t._sqlite3_value_nochange=e=>(t._sqlite3_value_nochange=p.Bb)(e),t._sqlite3_value_frombind=e=>(t._sqlite3_value_frombind=p.Cb)(e),t._sqlite3_value_dup=e=>(t._sqlite3_value_dup=p.Db)(e),t._sqlite3_value_free=e=>(t._sqlite3_value_free=p.Eb)(e),t._sqlite3_result_blob=(e,s,a,c)=>(t._sqlite3_result_blob=p.Fb)(e,s,a,c),t._sqlite3_result_blob64=(e,s,a,c,d)=>(t._sqlite3_result_blob64=p.Gb)(e,s,a,c,d),t._sqlite3_result_double=(e,s)=>(t._sqlite3_result_double=p.Hb)(e,s),t._sqlite3_result_error=(e,s,a)=>(t._sqlite3_result_error=p.Ib)(e,s,a),t._sqlite3_result_error16=(e,s,a)=>(t._sqlite3_result_error16=p.Jb)(e,s,a),t._sqlite3_result_int=(e,s)=>(t._sqlite3_result_int=p.Kb)(e,s),t._sqlite3_result_int64=(e,s,a)=>(t._sqlite3_result_int64=p.Lb)(e,s,a),t._sqlite3_result_null=e=>(t._sqlite3_result_null=p.Mb)(e),t._sqlite3_result_pointer=(e,s,a,c)=>(t._sqlite3_result_pointer=p.Nb)(e,s,a,c),t._sqlite3_result_subtype=(e,s)=>(t._sqlite3_result_subtype=p.Ob)(e,s),t._sqlite3_result_text=(e,s,a,c)=>(t._sqlite3_result_text=p.Pb)(e,s,a,c),t._sqlite3_result_text64=(e,s,a,c,d,m)=>(t._sqlite3_result_text64=p.Qb)(e,s,a,c,d,m),t._sqlite3_result_text16=(e,s,a,c)=>(t._sqlite3_result_text16=p.Rb)(e,s,a,c),t._sqlite3_result_text16be=(e,s,a,c)=>(t._sqlite3_result_text16be=p.Sb)(e,s,a,c),t._sqlite3_result_text16le=(e,s,a,c)=>(t._sqlite3_result_text16le=p.Tb)(e,s,a,c),t._sqlite3_result_value=(e,s)=>(t._sqlite3_result_value=p.Ub)(e,s),t._sqlite3_result_error_toobig=e=>(t._sqlite3_result_error_toobig=p.Vb)(e),t._sqlite3_result_zeroblob=(e,s)=>(t._sqlite3_result_zeroblob=p.Wb)(e,s),t._sqlite3_result_zeroblob64=(e,s,a)=>(t._sqlite3_result_zeroblob64=p.Xb)(e,s,a),t._sqlite3_result_error_code=(e,s)=>(t._sqlite3_result_error_code=p.Yb)(e,s),t._sqlite3_result_error_nomem=e=>(t._sqlite3_result_error_nomem=p.Zb)(e),t._sqlite3_user_data=e=>(t._sqlite3_user_data=p._b)(e),t._sqlite3_context_db_handle=e=>(t._sqlite3_context_db_handle=p.$b)(e),t._sqlite3_vtab_nochange=e=>(t._sqlite3_vtab_nochange=p.ac)(e),t._sqlite3_vtab_in_first=(e,s)=>(t._sqlite3_vtab_in_first=p.bc)(e,s),t._sqlite3_vtab_in_next=(e,s)=>(t._sqlite3_vtab_in_next=p.cc)(e,s),t._sqlite3_aggregate_context=(e,s)=>(t._sqlite3_aggregate_context=p.dc)(e,s),t._sqlite3_get_auxdata=(e,s)=>(t._sqlite3_get_auxdata=p.ec)(e,s),t._sqlite3_set_auxdata=(e,s,a,c)=>(t._sqlite3_set_auxdata=p.fc)(e,s,a,c),t._sqlite3_column_count=e=>(t._sqlite3_column_count=p.gc)(e),t._sqlite3_data_count=e=>(t._sqlite3_data_count=p.hc)(e),t._sqlite3_column_blob=(e,s)=>(t._sqlite3_column_blob=p.ic)(e,s),t._sqlite3_column_bytes=(e,s)=>(t._sqlite3_column_bytes=p.jc)(e,s),t._sqlite3_column_bytes16=(e,s)=>(t._sqlite3_column_bytes16=p.kc)(e,s),t._sqlite3_column_double=(e,s)=>(t._sqlite3_column_double=p.lc)(e,s),t._sqlite3_column_text=(e,s)=>(t._sqlite3_column_text=p.mc)(e,s),t._sqlite3_column_value=(e,s)=>(t._sqlite3_column_value=p.nc)(e,s),t._sqlite3_column_text16=(e,s)=>(t._sqlite3_column_text16=p.oc)(e,s),t._sqlite3_column_type=(e,s)=>(t._sqlite3_column_type=p.pc)(e,s),t._sqlite3_column_name=(e,s)=>(t._sqlite3_column_name=p.qc)(e,s),t._sqlite3_column_name16=(e,s)=>(t._sqlite3_column_name16=p.rc)(e,s),t._sqlite3_bind_blob=(e,s,a,c,d)=>(t._sqlite3_bind_blob=p.sc)(e,s,a,c,d),t._sqlite3_bind_blob64=(e,s,a,c,d,m)=>(t._sqlite3_bind_blob64=p.tc)(e,s,a,c,d,m),t._sqlite3_bind_double=(e,s,a)=>(t._sqlite3_bind_double=p.uc)(e,s,a),t._sqlite3_bind_int=(e,s,a)=>(t._sqlite3_bind_int=p.vc)(e,s,a),t._sqlite3_bind_int64=(e,s,a,c)=>(t._sqlite3_bind_int64=p.wc)(e,s,a,c),t._sqlite3_bind_null=(e,s)=>(t._sqlite3_bind_null=p.xc)(e,s),t._sqlite3_bind_pointer=(e,s,a,c,d)=>(t._sqlite3_bind_pointer=p.yc)(e,s,a,c,d),t._sqlite3_bind_text=(e,s,a,c,d)=>(t._sqlite3_bind_text=p.zc)(e,s,a,c,d),t._sqlite3_bind_text64=(e,s,a,c,d,m,v)=>(t._sqlite3_bind_text64=p.Ac)(e,s,a,c,d,m,v),t._sqlite3_bind_text16=(e,s,a,c,d)=>(t._sqlite3_bind_text16=p.Bc)(e,s,a,c,d),t._sqlite3_bind_value=(e,s,a)=>(t._sqlite3_bind_value=p.Cc)(e,s,a),t._sqlite3_bind_zeroblob=(e,s,a)=>(t._sqlite3_bind_zeroblob=p.Dc)(e,s,a),t._sqlite3_bind_zeroblob64=(e,s,a,c)=>(t._sqlite3_bind_zeroblob64=p.Ec)(e,s,a,c),t._sqlite3_bind_parameter_count=e=>(t._sqlite3_bind_parameter_count=p.Fc)(e),t._sqlite3_bind_parameter_name=(e,s)=>(t._sqlite3_bind_parameter_name=p.Gc)(e,s),t._sqlite3_bind_parameter_index=(e,s)=>(t._sqlite3_bind_parameter_index=p.Hc)(e,s),t._sqlite3_db_handle=e=>(t._sqlite3_db_handle=p.Ic)(e),t._sqlite3_stmt_readonly=e=>(t._sqlite3_stmt_readonly=p.Jc)(e),t._sqlite3_stmt_isexplain=e=>(t._sqlite3_stmt_isexplain=p.Kc)(e),t._sqlite3_stmt_explain=(e,s)=>(t._sqlite3_stmt_explain=p.Lc)(e,s),t._sqlite3_stmt_busy=e=>(t._sqlite3_stmt_busy=p.Mc)(e),t._sqlite3_next_stmt=(e,s)=>(t._sqlite3_next_stmt=p.Nc)(e,s),t._sqlite3_stmt_status=(e,s,a)=>(t._sqlite3_stmt_status=p.Oc)(e,s,a),t._sqlite3_sql=e=>(t._sqlite3_sql=p.Pc)(e),t._sqlite3_expanded_sql=e=>(t._sqlite3_expanded_sql=p.Qc)(e),t._sqlite3_value_numeric_type=e=>(t._sqlite3_value_numeric_type=p.Rc)(e),t._sqlite3_blob_open=(e,s,a,c,d,m,v,k)=>(t._sqlite3_blob_open=p.Sc)(e,s,a,c,d,m,v,k),t._sqlite3_blob_close=e=>(t._sqlite3_blob_close=p.Tc)(e),t._sqlite3_blob_read=(e,s,a,c)=>(t._sqlite3_blob_read=p.Uc)(e,s,a,c),t._sqlite3_blob_write=(e,s,a,c)=>(t._sqlite3_blob_write=p.Vc)(e,s,a,c),t._sqlite3_blob_bytes=e=>(t._sqlite3_blob_bytes=p.Wc)(e),t._sqlite3_blob_reopen=(e,s,a)=>(t._sqlite3_blob_reopen=p.Xc)(e,s,a),t._sqlite3_set_authorizer=(e,s,a)=>(t._sqlite3_set_authorizer=p.Yc)(e,s,a),t._sqlite3_strglob=(e,s)=>(t._sqlite3_strglob=p.Zc)(e,s),t._sqlite3_strlike=(e,s,a)=>(t._sqlite3_strlike=p._c)(e,s,a),t._sqlite3_errmsg=e=>(t._sqlite3_errmsg=p.$c)(e),t._sqlite3_auto_extension=e=>(t._sqlite3_auto_extension=p.ad)(e),t._sqlite3_cancel_auto_extension=e=>(t._sqlite3_cancel_auto_extension=p.bd)(e),t._sqlite3_reset_auto_extension=()=>(t._sqlite3_reset_auto_extension=p.cd)(),t._sqlite3_prepare=(e,s,a,c,d)=>(t._sqlite3_prepare=p.dd)(e,s,a,c,d),t._sqlite3_prepare_v3=(e,s,a,c,d,m)=>(t._sqlite3_prepare_v3=p.ed)(e,s,a,c,d,m),t._sqlite3_prepare16=(e,s,a,c,d)=>(t._sqlite3_prepare16=p.fd)(e,s,a,c,d),t._sqlite3_prepare16_v2=(e,s,a,c,d)=>(t._sqlite3_prepare16_v2=p.gd)(e,s,a,c,d),t._sqlite3_prepare16_v3=(e,s,a,c,d,m)=>(t._sqlite3_prepare16_v3=p.hd)(e,s,a,c,d,m),t._sqlite3_get_table=(e,s,a,c,d,m)=>(t._sqlite3_get_table=p.id)(e,s,a,c,d,m),t._sqlite3_free_table=e=>(t._sqlite3_free_table=p.jd)(e),t._sqlite3_create_module=(e,s,a,c)=>(t._sqlite3_create_module=p.kd)(e,s,a,c),t._sqlite3_create_module_v2=(e,s,a,c,d)=>(t._sqlite3_create_module_v2=p.ld)(e,s,a,c,d),t._sqlite3_drop_modules=(e,s)=>(t._sqlite3_drop_modules=p.md)(e,s),t._sqlite3_declare_vtab=(e,s)=>(t._sqlite3_declare_vtab=p.nd)(e,s),t._sqlite3_vtab_on_conflict=e=>(t._sqlite3_vtab_on_conflict=p.od)(e),t._sqlite3_vtab_config=(e,s,a)=>(t._sqlite3_vtab_config=p.pd)(e,s,a),t._sqlite3_vtab_collation=(e,s)=>(t._sqlite3_vtab_collation=p.qd)(e,s),t._sqlite3_vtab_in=(e,s,a)=>(t._sqlite3_vtab_in=p.rd)(e,s,a),t._sqlite3_vtab_rhs_value=(e,s,a)=>(t._sqlite3_vtab_rhs_value=p.sd)(e,s,a),t._sqlite3_vtab_distinct=e=>(t._sqlite3_vtab_distinct=p.td)(e),t._sqlite3_keyword_name=(e,s,a)=>(t._sqlite3_keyword_name=p.ud)(e,s,a),t._sqlite3_keyword_count=()=>(t._sqlite3_keyword_count=p.vd)(),t._sqlite3_keyword_check=(e,s)=>(t._sqlite3_keyword_check=p.wd)(e,s),t._sqlite3_complete=e=>(t._sqlite3_complete=p.xd)(e),t._sqlite3_complete16=e=>(t._sqlite3_complete16=p.yd)(e),t._sqlite3_libversion=()=>(t._sqlite3_libversion=p.zd)(),t._sqlite3_libversion_number=()=>(t._sqlite3_libversion_number=p.Ad)(),t._sqlite3_threadsafe=()=>(t._sqlite3_threadsafe=p.Bd)(),t._sqlite3_initialize=()=>(t._sqlite3_initialize=p.Cd)(),t._sqlite3_shutdown=()=>(t._sqlite3_shutdown=p.Dd)(),t._sqlite3_config=(e,s)=>(t._sqlite3_config=p.Ed)(e,s),t._sqlite3_db_mutex=e=>(t._sqlite3_db_mutex=p.Fd)(e),t._sqlite3_db_release_memory=e=>(t._sqlite3_db_release_memory=p.Gd)(e),t._sqlite3_db_cacheflush=e=>(t._sqlite3_db_cacheflush=p.Hd)(e),t._sqlite3_db_config=(e,s,a)=>(t._sqlite3_db_config=p.Id)(e,s,a),t._sqlite3_last_insert_rowid=e=>(t._sqlite3_last_insert_rowid=p.Jd)(e),t._sqlite3_set_last_insert_rowid=(e,s,a)=>(t._sqlite3_set_last_insert_rowid=p.Kd)(e,s,a),t._sqlite3_changes64=e=>(t._sqlite3_changes64=p.Ld)(e),t._sqlite3_changes=e=>(t._sqlite3_changes=p.Md)(e),t._sqlite3_total_changes64=e=>(t._sqlite3_total_changes64=p.Nd)(e),t._sqlite3_total_changes=e=>(t._sqlite3_total_changes=p.Od)(e),t._sqlite3_txn_state=(e,s)=>(t._sqlite3_txn_state=p.Pd)(e,s),t._sqlite3_close=e=>(t._sqlite3_close=p.Qd)(e),t._sqlite3_close_v2=e=>(t._sqlite3_close_v2=p.Rd)(e),t._sqlite3_busy_handler=(e,s,a)=>(t._sqlite3_busy_handler=p.Sd)(e,s,a),t._sqlite3_progress_handler=(e,s,a,c)=>(t._sqlite3_progress_handler=p.Td)(e,s,a,c),t._sqlite3_busy_timeout=(e,s)=>(t._sqlite3_busy_timeout=p.Ud)(e,s),t._sqlite3_interrupt=e=>(t._sqlite3_interrupt=p.Vd)(e),t._sqlite3_is_interrupted=e=>(t._sqlite3_is_interrupted=p.Wd)(e),t._sqlite3_create_function=(e,s,a,c,d,m,v,k)=>(t._sqlite3_create_function=p.Xd)(e,s,a,c,d,m,v,k),t._sqlite3_create_function_v2=(e,s,a,c,d,m,v,k,L)=>(t._sqlite3_create_function_v2=p.Yd)(e,s,a,c,d,m,v,k,L),t._sqlite3_create_window_function=(e,s,a,c,d,m,v,k,L,O)=>(t._sqlite3_create_window_function=p.Zd)(e,s,a,c,d,m,v,k,L,O),t._sqlite3_create_function16=(e,s,a,c,d,m,v,k)=>(t._sqlite3_create_function16=p._d)(e,s,a,c,d,m,v,k),t._sqlite3_overload_function=(e,s,a)=>(t._sqlite3_overload_function=p.$d)(e,s,a),t._sqlite3_trace_v2=(e,s,a,c)=>(t._sqlite3_trace_v2=p.ae)(e,s,a,c),t._sqlite3_commit_hook=(e,s,a)=>(t._sqlite3_commit_hook=p.be)(e,s,a),t._sqlite3_update_hook=(e,s,a)=>(t._sqlite3_update_hook=p.ce)(e,s,a),t._sqlite3_rollback_hook=(e,s,a)=>(t._sqlite3_rollback_hook=p.de)(e,s,a),t._sqlite3_autovacuum_pages=(e,s,a,c)=>(t._sqlite3_autovacuum_pages=p.ee)(e,s,a,c),t._sqlite3_wal_autocheckpoint=(e,s)=>(t._sqlite3_wal_autocheckpoint=p.fe)(e,s),t._sqlite3_wal_hook=(e,s,a)=>(t._sqlite3_wal_hook=p.ge)(e,s,a),t._sqlite3_wal_checkpoint_v2=(e,s,a,c,d)=>(t._sqlite3_wal_checkpoint_v2=p.he)(e,s,a,c,d),t._sqlite3_wal_checkpoint=(e,s)=>(t._sqlite3_wal_checkpoint=p.ie)(e,s),t._sqlite3_error_offset=e=>(t._sqlite3_error_offset=p.je)(e),t._sqlite3_errmsg16=e=>(t._sqlite3_errmsg16=p.ke)(e),t._sqlite3_errcode=e=>(t._sqlite3_errcode=p.le)(e),t._sqlite3_extended_errcode=e=>(t._sqlite3_extended_errcode=p.me)(e),t._sqlite3_system_errno=e=>(t._sqlite3_system_errno=p.ne)(e),t._sqlite3_errstr=e=>(t._sqlite3_errstr=p.oe)(e),t._sqlite3_limit=(e,s,a)=>(t._sqlite3_limit=p.pe)(e,s,a),t._sqlite3_open=(e,s)=>(t._sqlite3_open=p.qe)(e,s),t._sqlite3_open_v2=(e,s,a,c)=>(t._sqlite3_open_v2=p.re)(e,s,a,c),t._sqlite3_open16=(e,s)=>(t._sqlite3_open16=p.se)(e,s),t._sqlite3_create_collation=(e,s,a,c,d)=>(t._sqlite3_create_collation=p.te)(e,s,a,c,d),t._sqlite3_create_collation_v2=(e,s,a,c,d,m)=>(t._sqlite3_create_collation_v2=p.ue)(e,s,a,c,d,m),t._sqlite3_create_collation16=(e,s,a,c,d)=>(t._sqlite3_create_collation16=p.ve)(e,s,a,c,d),t._sqlite3_collation_needed=(e,s,a)=>(t._sqlite3_collation_needed=p.we)(e,s,a),t._sqlite3_collation_needed16=(e,s,a)=>(t._sqlite3_collation_needed16=p.xe)(e,s,a),t._sqlite3_get_clientdata=(e,s)=>(t._sqlite3_get_clientdata=p.ye)(e,s),t._sqlite3_set_clientdata=(e,s,a,c)=>(t._sqlite3_set_clientdata=p.ze)(e,s,a,c),t._sqlite3_get_autocommit=e=>(t._sqlite3_get_autocommit=p.Ae)(e),t._sqlite3_table_column_metadata=(e,s,a,c,d,m,v,k,L)=>(t._sqlite3_table_column_metadata=p.Be)(e,s,a,c,d,m,v,k,L),t._sqlite3_sleep=e=>(t._sqlite3_sleep=p.Ce)(e),t._sqlite3_extended_result_codes=(e,s)=>(t._sqlite3_extended_result_codes=p.De)(e,s),t._sqlite3_file_control=(e,s,a,c)=>(t._sqlite3_file_control=p.Ee)(e,s,a,c),t._sqlite3_test_control=(e,s)=>(t._sqlite3_test_control=p.Fe)(e,s),t._sqlite3_create_filename=(e,s,a,c,d)=>(t._sqlite3_create_filename=p.Ge)(e,s,a,c,d),t._sqlite3_free_filename=e=>(t._sqlite3_free_filename=p.He)(e),t._sqlite3_uri_parameter=(e,s)=>(t._sqlite3_uri_parameter=p.Ie)(e,s),t._sqlite3_uri_key=(e,s)=>(t._sqlite3_uri_key=p.Je)(e,s),t._sqlite3_uri_boolean=(e,s,a)=>(t._sqlite3_uri_boolean=p.Ke)(e,s,a),t._sqlite3_uri_int64=(e,s,a,c)=>(t._sqlite3_uri_int64=p.Le)(e,s,a,c),t._sqlite3_filename_database=e=>(t._sqlite3_filename_database=p.Me)(e),t._sqlite3_filename_journal=e=>(t._sqlite3_filename_journal=p.Ne)(e),t._sqlite3_filename_wal=e=>(t._sqlite3_filename_wal=p.Oe)(e),t._sqlite3_db_name=(e,s)=>(t._sqlite3_db_name=p.Pe)(e,s),t._sqlite3_db_filename=(e,s)=>(t._sqlite3_db_filename=p.Qe)(e,s),t._sqlite3_db_readonly=(e,s)=>(t._sqlite3_db_readonly=p.Re)(e,s),t._sqlite3_compileoption_used=e=>(t._sqlite3_compileoption_used=p.Se)(e),t._sqlite3_compileoption_get=e=>(t._sqlite3_compileoption_get=p.Te)(e),t._sqlite3session_create=(e,s,a)=>(t._sqlite3session_create=p.Ue)(e,s,a),t._sqlite3session_delete=e=>(t._sqlite3session_delete=p.Ve)(e),t._sqlite3session_attach=(e,s)=>(t._sqlite3session_attach=p.We)(e,s),t._sqlite3session_changeset=(e,s,a)=>(t._sqlite3session_changeset=p.Xe)(e,s,a),t._sqlite3session_enable=(e,s)=>(t._sqlite3session_enable=p.Ye)(e,s),t._sqlite3changeset_start=(e,s,a)=>(t._sqlite3changeset_start=p.Ze)(e,s,a),t._sqlite3changeset_finalize=e=>(t._sqlite3changeset_finalize=p._e)(e),t._sqlite3changeset_invert=(e,s,a,c)=>(t._sqlite3changeset_invert=p.$e)(e,s,a,c),t._sqlite3changeset_apply=(e,s,a,c,d,m)=>(t._sqlite3changeset_apply=p.af)(e,s,a,c,d,m),t._sqlite3_sourceid=()=>(t._sqlite3_sourceid=p.bf)(),t._malloc=e=>(t._malloc=p.cf)(e),t._free=e=>(t._free=p.df)(e),t._RegisterExtensionFunctions=e=>(t._RegisterExtensionFunctions=p.ef)(e),t._getSqliteFree=()=>(t._getSqliteFree=p.ff)();var Fo=t._main=(e,s)=>(Fo=t._main=p.gf)(e,s);t._libauthorizer_set_authorizer=(e,s,a)=>(t._libauthorizer_set_authorizer=p.hf)(e,s,a),t._libfunction_create_function=(e,s,a,c,d,m,v,k)=>(t._libfunction_create_function=p.jf)(e,s,a,c,d,m,v,k),t._libhook_commit_hook=(e,s,a)=>(t._libhook_commit_hook=p.kf)(e,s,a),t._libhook_update_hook=(e,s,a)=>(t._libhook_update_hook=p.lf)(e,s,a),t._libprogress_progress_handler=(e,s,a,c)=>(t._libprogress_progress_handler=p.mf)(e,s,a,c),t._libvfs_vfs_register=(e,s,a,c,d,m)=>(t._libvfs_vfs_register=p.nf)(e,s,a,c,d,m);var No=(e,s)=>(No=p.pf)(e,s),zo=()=>(zo=p.qf)(),Uo=e=>(Uo=p.rf)(e),Ho=e=>(Ho=p.sf)(e),jo=()=>(jo=p.tf)();t._sqlite3_version=5472,t.getTempRet0=y_,t.ccall=tn,t.cwrap=g_,t.addFunction=p_,t.setValue=Bn,t.getValue=Eo,t.UTF8ToString=gn,t.stringToUTF8=en,t.lengthBytesUTF8=Vn,t.intArrayFromString=xi,t.intArrayToString=q_,t.AsciiToString=w_,t.UTF16ToString=S_,t.stringToUTF16=b_,t.UTF32ToString=E_,t.stringToUTF32=v_,t.writeArrayToMemory=$o;var lr;ps=function e(){lr||Oo(),lr||(ps=e)};function C_(){var e=Fo,s=0,a=0;try{var c=e(s,a);return a_(c,!0),c}catch(d){return o_(d)}}function Oo(){if(mn>0||(Kt(),mn>0))return;function e(){var s;lr||(lr=!0,t.calledRun=!0,!_&&(yo(),rr(),o(t),(s=t.onRuntimeInitialized)==null||s.call(t),Mo&&C_(),ir()))}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();var Mo=!0;return t.noInitialRun&&(Mo=!1),Oo(),function(){const e=Object.getPrototypeOf(async function(){}).constructor;let s=0;t.set_authorizer=function(a,c,d){s&&(t.deleteCallback(s),t._sqlite3_free(s),s=0),s=t._sqlite3_malloc(4),Bn(s,c instanceof e?1:0,"i32");const m=tn("libauthorizer_set_authorizer","number",["number","number","number"],[a,c?1:0,s]);return!m&&c&&t.setCallback(s,(v,k,L,O,Z,ee)=>c(d,k,L,O,Z,ee)),m}}(),function(){const e=Object.getPrototypeOf(async function(){}).constructor,s=["xFunc","xStep","xFinal"],a=new Map;t.create_function=function(c,d,m,v,k,L,O,Z){const ee=t._sqlite3_malloc(4),oe={xFunc:L,xStep:O,xFinal:Z};Bn(ee,s.reduce((G,_e,Je)=>oe[_e]instanceof e?G|1<<Je:G,0),"i32");const V=tn("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[c,d,m,v,ee,L?1:0,O?1:0,Z?1:0]);if(!V){if(a.has(d)){const G=a.get(d);t.deleteCallback(G)}a.set(d,ee),t.setCallback(ee,{xFunc:L,xStep:O,xFinal:Z})}return V}}(),function(){const e=Object.getPrototypeOf(async function(){}).constructor;let s=0;t.update_hook=function(a,c){s&&(t.deleteCallback(s),t._sqlite3_free(s),s=0),s=t._sqlite3_malloc(4),Bn(s,c instanceof e?1:0,"i32"),tn("libhook_update_hook","void",["number","number","number"],[a,c?1:0,s]),c&&t.setCallback(s,(d,m,v,k,L,O)=>c(m,v,k,L,O))}}(),function(){const e=Object.getPrototypeOf(async function(){}).constructor;let s=0;t.commit_hook=function(a,c){s&&(t.deleteCallback(s),t._sqlite3_free(s),s=0),s=t._sqlite3_malloc(4),Bn(s,c instanceof e?1:0,"i32"),tn("libhook_commit_hook","void",["number","number","number"],[a,c?1:0,s]),c&&t.setCallback(s,d=>c())}}(),function(){const e=Object.getPrototypeOf(async function(){}).constructor;let s=0;t.progress_handler=function(a,c,d,m){s&&(t.deleteCallback(s),t._sqlite3_free(s),s=0),s=t._sqlite3_malloc(4),Bn(s,d instanceof e?1:0,"i32"),tn("libprogress_progress_handler","number",["number","number","number","number"],[a,c,d?1:0,s]),d&&t.setCallback(s,v=>d(m))}}(),function(){const e=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],s=new Map;t.vfs_register=function(a,c){let d=0,m=0;e.forEach((k,L)=>{a[k]&&(d|=1<<L,a.hasAsyncMethod(k)&&(m|=1<<L))});const v=t._sqlite3_malloc(4);try{const k=tn("libvfs_vfs_register","number",["string","number","number","number","number","number"],[a.name,a.mxPathname,d,m,c?1:0,v]);if(!k){if(s.has(a.name)){const O=s.get(a.name);t.deleteCallback(O)}const L=Eo(v,"*");s.set(a.name,L),t.setCallback(L,a)}return k}finally{t._sqlite3_free(v)}}}(),r=f,r}})();const kS=async()=>{const n=await qS(),i=ES(n);return i.module=n,i},wi=typeof navigator>"u"||navigator.storage===void 0?new Proxy({},{get:()=>Promise.reject(new Error("Can't get OPFS root handle in this environment as navigator.storage is undefined"))}):navigator.storage.getDirectory(),_f=async n=>{const i=await wi;if(n===void 0)return i;let r=i;const t=n==null?void 0:n.split("/").filter(Boolean);for(;t.length>0;)r=await r.getDirectoryHandle(t.shift());return r},pf=async(n=wi,i=Number.POSITIVE_INFINITY,r="")=>{if(i<0)return;const t=await n,o=t.values();for await(const l of o){const f=l.kind==="directory",g=l.kind==="file"?await l.getFile().then(w=>pv(w.size)):void 0;if(console.log(`${r}${f?"📁":"📄"} ${l.name} ${g?`(${g})`:""}`),f){const w=await t.getDirectoryHandle(l.name);await pf(w,i-1,`${r}  `)}}},CS=async n=>{if(n.kind==="directory")for await(const i of n.keys())await n.removeEntry(i,{recursive:!0})},xS=Object.freeze(Object.defineProperty({__proto__:null,deleteAll:CS,getDirHandle:_f,printTree:pf,rootHandlePromise:wi},Symbol.toStringTag,{value:"Module"}));class AE extends Hn()("PersistedSqliteError",{cause:Nr}){}const IS=({storageOptions:n,storeId:i,schema:r})=>$n(async()=>{const t=mf(n.directory,i),o=await _f(t).catch(()=>{});if(o===void 0)return;const l=async q=>{const A=await q.getFile(),z=await vS(A);return z?{fileName:z,file:A}:void 0},g=await(async q=>{const A=[];for await(const z of q)z.kind==="file"&&A.push(z);return A})(o.values()),w=await Promise.all(g.map(l)),x="/"+DS(r),D=w.find(q=>(q==null?void 0:q.fileName)===x);if(D!==void 0){const q=await D.file.slice(gS).arrayBuffer();return q.byteLength===0?void 0:new Uint8Array(q)}}).pipe(no({duration:1e3,label:"@livestore/adapter-web:readPersistedAppDbFromClientSession"}),_d("@livestore/adapter-web:readPersistedAppDbFromClientSession"),ie("@livestore/adapter-web:readPersistedAppDbFromClientSession")),TS=({storageOptions:n,storeId:i})=>j(function*(){const r=mf(n.directory,i);yield*RS(r)}).pipe(li({schedule:zv}),ie("@livestore/adapter-web:resetPersistedDataFromClientSession")),RS=n=>$n(async()=>{const i=await wi,r=n.split("/").filter(t=>t.length);try{let t=i;for(let o=0;o<r.length-1;o++)t=await t.getDirectoryHandle(r[o]);await t.removeEntry(r.at(-1),{recursive:!0})}catch(t){if(t instanceof DOMException&&t.name==="NotFoundError")return;throw t}}).pipe(te.mapToUnexpectedError,ie("@livestore/adapter-web:worker:opfsDeleteFile",{attributes:{absFilePath:n}})),mf=(n,i)=>{if(n===void 0||n===""||n==="/")return`livestore-${i}@${Xc}`;if(n.includes("/"))throw new Error(`@livestore/adapter-web:worker:sanitizeOpfsDir: Nested directories are not yet supported ('${n}')`);return`${n}@${Xc}`},DS=n=>`state${n.state.sqlite.migrations.strategy==="manual"?"fixed":n.state.sqlite.hash.toString()}.db`;class AS extends ce(jr,te){}const $S=n=>ro({channelName:`livestore.shutdown.${n}`,schema:AS});class gf extends X("DedicatedWorkerDisconnectBroadcast",{}){}const PS=n=>ro({channelName:`livestore.worker-disconnect.${n}`,schema:gf});class Si extends Ge()("DevtoolsWebCommon.CreateConnection",{payload:{from:F,port:hi},success:qe({}),failure:Du}){}class $E extends ce(Si){}const LS=qe({type:Re("opfs"),directory:Ln(F)}),yf=ce(LS);Au({key:F,value:fi});var va;(function(n){class i extends Ge()("InitialMessage",{payload:{port:hi,storeId:F,clientId:F},success:Cn,failure:te}){}n.InitialMessage=i;class r extends ce(i){}n.Request=r})(va||(va={}));var xe;(function(n){class i extends Ge()("InitialMessage",{payload:{storageOptions:yf,devtoolsEnabled:Nn,storeId:F,clientId:F,debugInstanceId:F,syncPayload:Os(fi)},success:Cn,failure:te}){}n.InitialMessage=i;class r extends Ge()("BootStatusStream",{payload:{},success:dg,failure:te}){}n.BootStatusStream=r;class t extends Ge()("PushToLeader",{payload:{batch:pe(jv)},success:Cn,failure:ce(te,Wv)}){}n.PushToLeader=t;class o extends Ge()("PullStream",{payload:{cursor:fg},success:qe({payload:Sd,mergeCounter:Pe}),failure:te}){}n.PullStream=o;class l extends Ge()("Export",{payload:{},success:ns,failure:te}){}n.Export=l;class f extends Ge()("ExportEventlog",{payload:{},success:ns,failure:te}){}n.ExportEventlog=f;class g extends Ge()("GetRecreateSnapshot",{payload:{},success:qe({snapshot:ns,migrationsReport:hg}),failure:te}){}n.GetRecreateSnapshot=g;class w extends Ge()("GetLeaderHead",{payload:{},success:Ne,failure:te}){}n.GetLeaderHead=w;class x extends Ge()("GetLeaderSyncState",{payload:{},success:At,failure:te}){}n.GetLeaderSyncState=x;class D extends Ge()("Shutdown",{payload:{},success:Cn,failure:te}){}n.Shutdown=D;class q extends Ge()("ExtraDevtoolsMessage",{payload:{message:Hw},success:Cn,failure:te}){}n.ExtraDevtoolsMessage=q,n.Request=ce(i,r,t,o,l,f,g,w,x,D,q,Si)})(xe||(xe={}));var Jr;(function(n){class i extends X("FromClientSession",{initialMessage:xe.InitialMessage}){}n.InitialMessagePayloadFromClientSession=i;class r extends Ge()("InitialMessage",{payload:{payload:ce(i,X("FromWebBridge",{})),liveStoreVersion:Re(Qe)},success:Cn,failure:te}){}n.InitialMessage=r;class t extends Ge()("UpdateMessagePort",{payload:{port:hi},success:Cn,failure:te}){}n.UpdateMessagePort=t;class o extends ce(r,t,xe.BootStatusStream,xe.PushToLeader,xe.PullStream,xe.Export,xe.GetRecreateSnapshot,xe.ExportEventlog,xe.GetLeaderHead,xe.GetLeaderSyncState,xe.Shutdown,xe.ExtraDevtoolsMessage,Si){}n.Request=o})(Jr||(Jr={}));const FS=ro({channelName:"session-info",schema:Id}),pl={sharedWorker:({storeId:n})=>`shared-worker-${n}`,browserExtension:{contentscriptMain:n=>`contentscript-main-${n}`,contentscriptIframe:n=>`contentscript-iframe-${n}`}},wa=X("ClientSessionContentscriptMainReq",{storeId:F,clientId:F,sessionId:F}),ml=X("ClientSessionContentscriptMainRes",{tabId:Pe}),NS={contentscriptMain:Ur(()=>ra({listenWindow:window,sendWindow:window,schema:{listen:wa,send:ml},ids:{own:"contentscript-main-static",other:"client-session-static"}})),clientSession:Ur(()=>ra({listenWindow:window,sendWindow:window,schema:{listen:ml,send:wa},ids:{own:"client-session-static",other:"contentscript-main-static"}}))},zS=({node:n,target:i,worker:r})=>j(function*(){const t=new MessageChannel,o=yield*Se();Vt&&(yield*gv(`@livestore/devtools-web-common: closing message channel ${n.nodeName} → ${i}`)),yield*r.execute(Si.make({from:n.nodeName,port:t.port1})).pipe(Ye(()=>Me(o,!0)),je,ue,we),yield*o;const l=yield*$v({port:t.port2,schema:ho});yield*n.addEdge({target:i,edgeChannel:l,replaceIfExists:!0}),Vt&&(yield*He(`@livestore/devtools-web-common: initiated connection: ${n.nodeName} → ${i}`))}).pipe(te.mapToUnexpectedError),US=({schema:n,storeId:i,clientId:r,sessionId:t})=>j(function*(){if(fn()){const o=globalThis.LIVESTORE_DEVTOOLS_PATH??"/_livestore",l=`${location.origin}${o}`,f=yield*$n(()=>fetch(l));if(f.ok&&(yield*$n(()=>f.text())).includes('<meta name="livestore-devtools" content="true" />')){const w=`${l}/web/${i}/${r}/${t}/${n.devtools.alias}`;yield*La(`[@livestore/adapter-web] Devtools ready on ${w}`)}}}).pipe(ie("@livestore/adapter-web:client-session:devtools:logDevtoolsUrl")),HS=oi(function*({webmeshNode:n,sessionInfo:i,sharedWorker:r,devtoolsEnabled:t,schema:o}){if(t){const{clientId:l,sessionId:f,storeId:g}=i;yield*US({clientId:l,sessionId:f,schema:o,storeId:g}),yield*Td({webChannel:yield*FS,sessionInfo:i}).pipe(ue,we),yield*j(function*(){const w=yield*NS.clientSession;yield*w.send(wa.make({clientId:l,sessionId:f,storeId:g}));const{tabId:x}=yield*w.listen.pipe(dn(),_g,pg),D=pl.browserExtension.contentscriptMain(x),q=yield*ra({listenWindow:window,sendWindow:window,schema:ho,ids:{own:n.nodeName,other:D}});yield*n.addEdge({target:D,edgeChannel:q})}).pipe(ie("@livestore/adapter-web:client-session:devtools:browser-extension"),ue,we),yield*zS({node:n,target:pl.sharedWorker({storeId:g}),worker:r})}}),jS=kS();fn()&&(globalThis.__debugLiveStoreUtils={opfs:xS,runSync:n=>gt(n),runFork:n=>Ft(n)});const OS=n=>i=>j(function*(){var rr,ir;const{schema:r,storeId:t,devtoolsEnabled:o,debugInstanceId:l,bootStatusQueue:f,shutdown:g,syncPayload:w}=i;yield*MS,yield*Mt(f,{stage:"loading"});const x=yield*$n(()=>jS),D=`livestore-tab-lock-${t}`,q=yield*Ss(yf)(n.storage),A=yield*$S(t);n.resetPersistence===!0&&(yield*A.send(jr.make({reason:"adapter-reset"})),yield*TS({storageOptions:q,storeId:t}));const z=((rr=n.experimental)==null?void 0:rr.disableFastPath)===!0?void 0:yield*IS({storageOptions:q,storeId:t,schema:r}),N=n.clientId??gl(`clientId:${t}`,"local"),P=n.sessionId??gl(`sessionId:${t}`,"session"),b=yield*PS(t);yield*A.listen.pipe(dn(),Ye(ne=>g(Fs(ne))),je,St,ue,we);const y=hc(n.sharedWorker,{name:`livestore-shared-worker-${t}`}),h=yield*Rv({size:1,concurrency:100,initialMessage:()=>new Jr.InitialMessage({liveStoreVersion:Qe,payload:{_tag:"FromClientSession",initialMessage:new xe.InitialMessage({storageOptions:q,storeId:t,clientId:N,devtoolsEnabled:o,debugInstanceId:l,syncPayload:w})}})}).pipe(ct(Qc(()=>y)),ue,te.mapToUnexpectedError,$t(g),ie("@livestore/adapter-web:client-session:setupSharedWorker"),we),S=yield*Se();let _=yield*Hv(S,D);const E=yield*dd(_?"has-lock":"no-lock"),I=yield*Se();_===!1&&(yield*Me(I,void 0));const R=j(function*(){yield*He(`[@livestore/adapter-web:client-session] ✅ Got lock '${D}' (clientId: ${N}, sessionId: ${P}).`),yield*We(()=>He(`[@livestore/adapter-web:client-session] Releasing lock for '${D}'`)),yield*xr(E,"has-lock");const ne=new MessageChannel,$e=hc(n.worker,{name:`livestore-worker-${t}-${P}`});yield*Tv({initialMessage:()=>new va.InitialMessage({port:ne.port1,storeId:t,clientId:N})}).pipe(ct(Qc(()=>$e)),te.mapToUnexpectedError,$t(g),ie("@livestore/adapter-web:client-session:setupDedicatedWorker"),ue,we),yield*b.send(gf.make({})),yield*(yield*es(h)).executeEffect(new Jr.UpdateMessagePort({port:ne.port2})).pipe(te.mapToUnexpectedError,$t(g)),yield*Me(I,void 0),yield*gu}).pipe(ie("@livestore/adapter-web:client-session:lock"));_===!1?(yield*He(`[@livestore/adapter-web:client-session] ⏳ Waiting for lock '${D}' (sessionId: ${P})`),yield*Uv(S,D).pipe(Us(()=>(_=!0,R)),St,ue,we)):yield*R.pipe(St,ue,we);const $=ne=>es(h).pipe(Et(()=>I),Bt($e=>$e.executeEffect(ne)),no({label:`@livestore/adapter-web:client-session:runInWorker:${ne._tag}`,duration:2e3}),ie(`@livestore/adapter-web:client-session:runInWorker:${ne._tag}`),Na($e=>Ie(te)($e)?$e:_c($e)||Ie(Gt)($e)?new te({cause:$e}):$e),Eg($e=>new te({cause:$e}))),H=ne=>j(function*(){return(yield*es(h)).execute(ne).pipe(vg(Nt=>Ie(te)(Nt)?Nt:_c(Nt)||Ie(Gt)(Nt)?new te({cause:Nt}):Nt),wg(`@livestore/adapter-web:client-session:runInWorkerStream:${ne._tag}`))}).pipe(Sg),C=yield*H(new xe.BootStatusStream).pipe(Ye(ne=>Mt(f,ne)),je,$t(ne=>ni(ne)?un:g(ne)),St,ue,we);yield*mg(f).pipe(Us(os(C)),ue,we);const U=z===void 0?yield*$(new xe.GetRecreateSnapshot).pipe(ut(({snapshot:ne,migrationsReport:$e})=>({_tag:"from-leader-worker",snapshot:ne,migrationsReport:$e}))):{_tag:"fast-path",snapshot:z},J=U._tag==="from-leader-worker"?U.migrationsReport:{migrations:[]},M=yield*SS({sqlite3:x})({_tag:"in-memory"});M.import(U.snapshot),(((ir=M.select("select count(*) as count from sqlite_master")[0])==null?void 0:ir.count)??0)===0&&(yield*te.make({cause:"Encountered empty or corrupted database",payload:{snapshotByteLength:U.snapshot.byteLength,storageOptions:n.storage}}));const Ce=M.select(`select seqNumGlobal, seqNumClient from ${gg} order by seqNumGlobal desc, seqNumClient desc limit 1`)[0],dt=Ce?yg({global:Ce.seqNumGlobal,client:Ce.seqNumClient}):bg;yield*We(ne=>j(function*(){ti(ne)&&kg(ne)===!1&&Ie(jr)(pc(ne.cause))===!1&&Ie(kr)(pc(ne.cause))===!1?yield*zs("[@livestore/adapter-web:client-session] client-session shutdown",ne.cause):yield*He("[@livestore/adapter-web:client-session] client-session shutdown",_,ne),_&&(yield*Me(S,void 0))}).pipe(ue,st));const Le={export:$(new xe.Export).pipe(cs(1e4),te.mapToUnexpectedError,ie("@livestore/adapter-web:client-session:export")),events:{pull:({cursor:ne})=>H(new xe.PullStream({cursor:ne})).pipe(qg),push:ne=>$(new xe.PushToLeader({batch:ne})).pipe(ie("@livestore/adapter-web:client-session:pushToLeader",{attributes:{batchSize:ne.length}}))},initialState:{leaderHead:dt,migrationsReport:J},getEventlogData:$(new xe.ExportEventlog).pipe(cs(1e4),te.mapToUnexpectedError,ie("@livestore/adapter-web:client-session:getEventlogData")),getSyncState:$(new xe.GetLeaderSyncState).pipe(te.mapToUnexpectedError,ie("@livestore/adapter-web:client-session:getLeaderSyncState")),sendDevtoolsMessage:ne=>$(new xe.ExtraDevtoolsMessage({message:ne})).pipe(te.mapToUnexpectedError,ie("@livestore/adapter-web:client-session:devtoolsMessageForLeader"))},Kt=yield*es(h);return yield*Kw({...i,sqliteDb:M,lockStatus:E,clientId:N,sessionId:P,isLeader:!0,leaderThread:Le,webmeshMode:"direct",connectWebmeshNode:({sessionInfo:ne,webmeshNode:$e})=>HS({webmeshNode:$e,sessionInfo:ne,sharedWorker:Kt,devtoolsEnabled:o,schema:r}),registerBeforeUnload:ne=>typeof window<"u"&&typeof window.addEventListener=="function"?(window.addEventListener("beforeunload",ne),()=>window.removeEventListener("beforeunload",ne)):()=>{}})}).pipe(te.mapToUnexpectedError),gl=(n,i)=>{const r=()=>it(5),t=typeof window>"u"?void 0:i==="session"?sessionStorage:i==="local"?localStorage:ge(`[@livestore/adapter-web] Invalid storage type: ${i}`);if(t===void 0)return r();const o=`livestore:${n}`,l=t.getItem(o);if(l)return l;const f=r();return t.setItem(o,f),f},MS=j(function*(){const n=(i,r)=>j(function*(){i&&(yield*te.make({cause:`[@livestore/adapter-web] Browser not supported. The LiveStore web adapter needs '${r}' to work properly`}))});yield*du([n(typeof navigator>"u","navigator"),n(navigator.locks===void 0,"navigator.locks"),n(navigator.storage===void 0,"navigator.storage"),n(crypto.randomUUID===void 0,"crypto.randomUUID"),n(typeof window>"u","window"),n(typeof sessionStorage>"u","sessionStorage")])});function BS(n){return new SharedWorker("/assets/make-shared-worker-DtZDLhce.js",{type:"module",name:n==null?void 0:n.name})}const WS=["begin","rollback","commit","savepoint","release"],yl=200;var xn,as,Kr;class VS{constructor(){Ze(this,xn,new Qi(yl));Ze(this,as,new Map);T(this,"getKey",(i,r)=>r==null?i:Array.isArray(r)?i+`
`+r.join(`
`):i+`
`+Object.values(r).join(`
`));T(this,"get",i=>Y(this,xn).get(i));T(this,"set",(i,r,t)=>{Y(this,xn).set(r,t);for(const o of i){let l=Y(this,as).get(o);l==null&&(l=new Cg(yl),l.onEvict=Y(this,Kr),Y(this,as).set(o,l)),l.add(r)}});Ze(this,Kr,i=>{Y(this,xn).delete(i)});T(this,"ignoreQuery",i=>WS.some(r=>i.startsWith(r)));T(this,"invalidate",i=>{for(const r of i){const t=Y(this,as).get(r);if(t!=null)for(const o of t)Y(this,xn).delete(o)}})}}xn=new WeakMap,as=new WeakMap,Kr=new WeakMap;const bf=()=>({slowQueries:new kn(200),queryFrameDuration:0,queryFrameCount:0,events:new kn(1e3)});class GS{constructor({db:i,otel:r}){T(this,"_tag","SqliteDb");T(this,"cachedStmts",new Qi(200));T(this,"tablesUsedCache",new Qi(200));T(this,"resultCache",new VS);T(this,"db");T(this,"otelTracer");T(this,"otelRootSpanContext");T(this,"tablesUsedStmt");T(this,"debugInfo",bf());T(this,"metadata");T(this,"execute",Jd((i,r)=>this.cachedExecute(i,r)));T(this,"select",Yd((i,r)=>this.cachedSelect(i,r)));this.db=i,this.otelTracer=r.tracer,this.otelRootSpanContext=r.rootSpanContext,this.tablesUsedStmt=i.prepare("SELECT tbl_name FROM tables_used(?) AS u JOIN sqlite_master ON sqlite_master.name = u.name WHERE u.schema = 'main';"),this.cachedStmts.onEvict=(t,o)=>o.finalize(),QS(this)}prepare(i){return this.db.prepare(i)}import(i){return this.db.import(i)}close(){this.db.close()}destroy(){this.db.destroy()}session(){return this.db.session()}makeChangeset(i){return this.db.makeChangeset(i)}txn(i){this.execute(Rs`begin transaction;`);let r=!1,t;try{t=i()}catch(o){throw r=!0,this.execute(Rs`rollback;`),o}return r||this.execute(Rs`commit;`),t}withChangeset(i){const r=this.db.session(),t=i(),o=r.changeset();return r.finish(),{result:t,changeset:o?{_tag:"sessionChangeset",data:o,debug:null}:{_tag:"no-op"}}}rollback(i){this.db.makeChangeset(i).invert().apply()}getTablesUsed(i){const r=JS(i);if(r!==void 0)return new Set([r]);const t=this.tablesUsedCache.get(i);if(t)return t;const o=this.tablesUsedStmt,l=new Set;try{const f=o.select([i]);for(const g of f)l.add(g.tbl_name)}catch(f){return console.error("Error getting tables used",f,"for query",i),new Set}return this.tablesUsedCache.set(i,l),l}cachedExecute(i,r,t){return this.otelTracer.startActiveSpan("livestore.in-memory-db:execute",{attributes:{"sql.query":i}},(t==null?void 0:t.otelContext)??this.otelRootSpanContext,o=>{try{let l=this.cachedStmts.get(i);l===void 0&&(l=this.db.prepare(i),this.cachedStmts.set(i,l)),l.execute(r),(t==null?void 0:t.hasNoEffects)!==!0&&!this.resultCache.ignoreQuery(i)&&this.resultCache.invalidate((t==null?void 0:t.writeTables)??this.getTablesUsed(i)),o.end();const f=Ji(o);return this.debugInfo.queryFrameDuration+=f,this.debugInfo.queryFrameCount++,f>5&&fn()&&this.debugInfo.slowQueries.push({queryStr:i,bindValues:r,durationMs:f,rowsCount:void 0,queriedTables:new Set,startTimePerfNow:mc(o)}),{durationMs:f}}catch(l){if(o.recordException(l),o.end(),Vt)debugger;throw new qs({cause:l,query:{bindValues:r??{},sql:i}})}})}cachedSelect(i,r,t){const{queriedTables:o,skipCache:l=!1,otelContext:f}=t??{};return this.otelTracer.startActiveSpan("sql-in-memory-select",{},f??this.otelRootSpanContext,g=>{try{g.setAttribute("sql.query",i);const w=this.resultCache.getKey(i,r),x=this.resultCache.get(w);if(l===!1&&x!==void 0)return g.setAttribute("sql.rowsCount",x.length),g.setAttribute("sql.cached",!0),g.end(),x;let D=this.cachedStmts.get(i);D===void 0&&(D=this.db.prepare(i),this.cachedStmts.set(i,D));const q=D.select(r);g.setAttribute("sql.rowsCount",q.length),g.setAttribute("sql.cached",!1);const A=o??this.getTablesUsed(i);this.resultCache.set(A,w,q),g.end();const z=Ji(g);return this.debugInfo.queryFrameDuration+=z,this.debugInfo.queryFrameCount++,z>5&&fn()&&this.debugInfo.slowQueries.push({queryStr:i,bindValues:r,durationMs:z,rowsCount:q.length,queriedTables:A,startTimePerfNow:mc(g)}),q}finally{g.end()}})}export(){for(const i of this.cachedStmts.keys())this.cachedStmts.delete(i);return this.db.export()}}const QS=n=>{n.execute(Rs`
      PRAGMA page_size=32768;
      PRAGMA cache_size=10000;
      PRAGMA synchronous='OFF';
      PRAGMA temp_store='MEMORY';
      PRAGMA foreign_keys='ON'; -- we want foreign key constraints to be enforced
    `)},JS=n=>{const[i,r]=n.trim().match(/^delete\s+from\s+(\w+)$/i)??[];return r};class YS{constructor(){T(this,"map");T(this,"add",i=>{const r=this.map.get(i)??0;this.map.set(i,r+1)});T(this,"remove",i=>{const r=this.map.get(i)??0;r===1?this.map.delete(i):this.map.set(i,r-1)});T(this,"has",i=>this.map.has(i));this.map=new Map}get size(){return this.map.size}*[Symbol.iterator](){for(const i of this.map.keys())yield i}}const Sa=(n,i,r="application/octet-stream")=>{const t=n instanceof Blob?n:new Blob([n],{type:r}),o=window.URL.createObjectURL(t);KS(o,i),setTimeout(()=>window.URL.revokeObjectURL(o),1e3)},KS=(n,i)=>{const r=document.createElement("a");r.href=n,r.download=i,document.body.append(r),r.style.display="none",r.click(),r.remove()},ZS=()=>{fn()&&(globalThis.__debugLiveStoreUtils={downloadBlob:Sa,runSync:n=>gt(n),runFork:n=>Ft(n)})};fn()&&ZS();class XS extends xg{constructor({clientSession:r,schema:t,otelOptions:o,context:l,batchUpdates:f,storeId:g,effectContext:w,params:x,confirmUnsavedChanges:D,__runningInDevtools:q}){super();T(this,"storeId");T(this,"reactivityGraph");T(this,"sqliteDbWrapper");T(this,"clientSession");T(this,"schema");T(this,"context");T(this,"otel");T(this,"tableRefs");T(this,"effectContext");T(this,"activeQueries");T(this,"__eventSchema");T(this,"syncProcessor");T(this,"boot");T(this,"subscribe",(r,t)=>this.otel.tracer.startActiveSpan("LiveStore.subscribe",{attributes:{label:t==null?void 0:t.label,queryLabel:r.label}},(t==null?void 0:t.otelContext)??this.otel.queriesSpanContext,o=>{var q;const l=Rt.setSpan(jt.active(),o),f=r._tag==="def"||r._tag==="signal-def"?r.make(this.reactivityGraph.context):{value:r,deref:()=>{}},g=f.value,w=`subscribe:${t==null?void 0:t.label}`,x=this.reactivityGraph.makeEffect((A,z,N)=>t.onUpdate(A(g.results$,l,N)),{label:w});return t!=null&&t.stackInfo&&g.activeSubscriptions.add(t.stackInfo),(q=t==null?void 0:t.onSubscribe)==null||q.call(t,g),this.activeQueries.add(g),(t==null?void 0:t.skipInitialRun)!==!0&&!g.isDestroyed&&x.doEffect(l,{_tag:"subscribe.initial",label:`subscribe-initial-run:${t==null?void 0:t.label}`}),()=>{var A;try{this.reactivityGraph.destroyNode(x),this.activeQueries.remove(g),t!=null&&t.stackInfo&&g.activeSubscriptions.delete(t.stackInfo),f.deref(),(A=t==null?void 0:t.onUnsubsubscribe)==null||A.call(t)}finally{o.end()}}}));T(this,"subscribeStream",(r,t)=>Rg(o=>j(this,function*(){const l=yield*ai.pipe(An("NoSuchElementException",()=>Un(void 0))),f=l?Rt.setSpan(jt.active(),l):jt.active();yield*Te(fe(()=>this.subscribe(r,{onUpdate:g=>o.single(g),otelContext:f,label:t==null?void 0:t.label})),g=>fe(()=>g()))})));T(this,"query",(r,t)=>{if(typeof r=="object"&&"query"in r&&"bindValues"in r)return this.sqliteDbWrapper.cachedSelect(r.query,Dg(r.bindValues,r.query),{otelContext:t==null?void 0:t.otelContext});if(Ga(r)){const o=r[gc];o._tag==="RowQuery"&&Ag({table:o.tableDef,id:o.id,explicitDefaultValues:o.explicitDefaultValues,otelContext:t==null?void 0:t.otelContext})(this.reactivityGraph.context);const l=r.asSql(),f=Fu(r),g=this.sqliteDbWrapper.cachedSelect(l.query,l.bindValues,{otelContext:t==null?void 0:t.otelContext,queriedTables:new Set([r[gc].tableDef.sqliteDef.name])});return Hs(f)(g)}else if(r._tag==="def"){const o=r.make(this.reactivityGraph.context),l=this.query(o.value,t);return o.deref(),l}else return r._tag==="signal-def"?r.make(this.reactivityGraph.context).value.get():r.run({otelContext:t==null?void 0:t.otelContext,debugRefreshReason:t==null?void 0:t.debugRefreshReason})});T(this,"setSignal",(r,t)=>{const o=r.make(this.reactivityGraph.context),l=typeof t=="function"?t(o.value.get()):t;o.value.set(l),o.rc>1&&o.deref()});T(this,"commit",(r,...t)=>{const{events:o,options:l}=this.getCommitArgs(r,t);for(const x of o)$g(x.args,this.clientSession.sessionId);if(o.length===0)return;const f=(l==null?void 0:l.skipRefresh)??!1;Rt.getSpan(this.otel.commitsSpanContext).addEvent("commit");let w;return this.otel.tracer.startActiveSpan("LiveStore:commit",{attributes:{"livestore.eventsCount":o.length,"livestore.eventTags":o.map(x=>x.name),"livestore.commitLabel":l==null?void 0:l.label},links:l==null?void 0:l.spanLinks},(l==null?void 0:l.otelContext)??this.otel.commitsSpanContext,x=>{const D=Rt.setSpan(jt.active(),x);try{const{writeTables:q}=(()=>{try{const N=()=>this.syncProcessor.push(o,{otelContext:D});return o.length>1?this.sqliteDbWrapper.txn(N):N()}catch(N){throw console.error(N),x.setStatus({code:yc.ERROR,message:N.toString()}),N}finally{x.end()}})(),A=[];for(const N of q){const P=this.tableRefs[N];bc(P!==void 0,`No table ref found for ${N}`),A.push([P,null])}const z={_tag:"commit",events:o,writeTables:Array.from(q)};this.reactivityGraph.setRefs(A,{debugRefreshReason:z,otelContext:D,skipRefresh:f})}catch(q){throw console.error(q),x.setStatus({code:yc.ERROR,message:q.toString()}),q}finally{x.end(),w=Ji(x)}return{durationMs:w}})});T(this,"events",r=>vc("store.events() is not yet implemented but planned soon"));T(this,"eventsStream",r=>vc("store.eventsStream() is not yet implemented but planned soon"));T(this,"manualRefresh",r=>{const{label:t}=r??{};this.otel.tracer.startActiveSpan("LiveStore:manualRefresh",{attributes:{"livestore.manualRefreshLabel":t}},this.otel.commitsSpanContext,o=>{const l=Rt.setSpan(jt.active(),o);this.reactivityGraph.runDeferredEffects({otelContext:l}),o.end()})});T(this,"shutdown",async r=>{await this.clientSession.shutdown(r??Fs(jr.make({reason:"manual"}))).pipe(this.runEffectFork,es,di)});T(this,"_dev",{downloadDb:(r="local")=>{j(this,function*(){const t=r==="local"?this.sqliteDbWrapper.export():yield*this.clientSession.leaderThread.export;Sa(t,`livestore-${Date.now()}.db`)}).pipe(this.runEffectFork)},downloadEventlogDb:()=>{j(this,function*(){const r=yield*this.clientSession.leaderThread.getEventlogData;Sa(r,`livestore-eventlog-${Date.now()}.db`)}).pipe(this.runEffectFork)},hardReset:(r="all-data")=>{j(this,function*(){const t=this.clientSession.clientId;yield*this.clientSession.leaderThread.sendDevtoolsMessage(uo.Request.make({liveStoreVersion:Qe,mode:r,requestId:it(),clientId:t}))}).pipe(this.runEffectFork)},overrideNetworkStatus:r=>{const t=this.clientSession.clientId;this.clientSession.leaderThread.sendDevtoolsMessage(lo.Request.make({clientId:t,closeLatch:r==="offline",liveStoreVersion:Qe,requestId:it()})).pipe(this.runEffectFork)},syncStates:()=>{j(this,function*(){const r=yield*this.syncProcessor.syncState;console.log("Session sync state:",r.toJSON());const t=yield*this.clientSession.leaderThread.getSyncState;console.log("Leader sync state:",t.toJSON())}).pipe(this.runEffectFork)},version:Qe,otel:{rootSpanContext:()=>{var r;return(r=Rt.getSpan(this.otel.rootSpanContext))==null?void 0:r.spanContext()}}});T(this,"toJSON",()=>({_tag:"livestore.Store",reactivityGraph:this.reactivityGraph.getSnapshot({includeResults:!0})}));T(this,"runEffectFork",r=>r.pipe(Ds(this.effectContext.lifetimeScope),ue,Uu(this.effectContext.runtime)));T(this,"getCommitArgs",(r,t)=>{let o,l;return typeof r=="function"?o=r(f=>o.push(f)):(r==null?void 0:r.label)!==void 0||(r==null?void 0:r.skipRefresh)!==void 0||(r==null?void 0:r.otelContext)!==void 0||(r==null?void 0:r.spanLinks)!==void 0?(l=r,o=t):r===void 0?o=[]:o=[r,...t],{events:o,options:l}});this.storeId=g,this.sqliteDbWrapper=new GS({otel:o,db:r.sqliteDb}),this.clientSession=r,this.schema=t,this.context=l,this.effectContext=w;const A=Ig(),z=o.tracer.startSpan("LiveStore:sync",{},o.rootSpanContext);this.syncProcessor=Jv({schema:t,clientSession:r,runtime:w.runtime,materializeEvent:(_,{otelContext:E,withChangeset:I,materializerHashLeader:R})=>{const{eventDef:$,materializer:H}=Wi(t,_.name),C=Pg({eventDef:$,materializer:H,dbState:this.sqliteDbWrapper,event:{decoded:_,encoded:void 0}}),U=fn()?$r(Lg(C)):bt();R._tag==="Some"&&U._tag==="Some"&&R.value!==U.value&&this.shutdown(Fs(te.make({cause:`Materializer hash mismatch detected for event "${_.name}".`,note:"Please make sure your event materializer is a pure function without side effects."})));const J=new Set,re=()=>{for(const{statementSql:be,bindValues:Ce,writeTables:dt=this.sqliteDbWrapper.getTablesUsed(be)}of C){try{this.sqliteDbWrapper.cachedExecute(be,Ce,{otelContext:E,writeTables:dt})}catch(Le){throw te.make({cause:Le,note:`Error executing materializer for event "${_.name}".
Statement: ${be}
Bind values: ${JSON.stringify(Ce)}`})}for(const Le of dt)J.add(Le)}};let M={_tag:"unset"};return I===!0?M=this.sqliteDbWrapper.withChangeset(re).changeset:re(),{writeTables:J,sessionChangeset:M,materializerHash:U}},rollback:_=>{this.sqliteDbWrapper.rollback(_)},refreshTables:_=>{const E=[];for(const I of _){const R=this.tableRefs[I];bc(R!==void 0,`No table ref found for ${I}`),E.push([R,null])}A.setRefs(E)},span:z,params:{leaderPushBatchSize:x.leaderPushBatchSize},confirmUnsavedChanges:D}),this.__eventSchema=bd(t),this.tableRefs={},this.activeQueries=new YS;const N=o.tracer.startSpan("LiveStore:commits",{},o.rootSpanContext),P=Rt.setSpan(jt.active(),N),b=o.tracer.startSpan("LiveStore:queries",{},o.rootSpanContext),y=Rt.setSpan(jt.active(),b);this.reactivityGraph=A,this.reactivityGraph.context={store:this,defRcMap:new Map,reactivityGraph:new WeakRef(A),otelTracer:o.tracer,rootOtelContext:y,effectsWrapper:f},this.otel={tracer:o.tracer,rootSpanContext:o.rootSpanContext,commitsSpanContext:P,queriesSpanContext:y};const h=new Set(q?this.schema.state.sqlite.tables.keys():Array.from(this.schema.state.sqlite.tables.keys()).filter(_=>!Tg(_))),S=new Map(Array.from(this.reactivityGraph.atoms.values()).filter(_=>{var E;return _._tag==="ref"&&((E=_.label)==null?void 0:E.startsWith("tableRef:"))===!0}).map(_=>[_.label.slice(9),_]));for(const _ of h)this.tableRefs[_]=S.get(_)??this.reactivityGraph.makeRef(null,{equal:()=>!1,label:`tableRef:${_}`,meta:{liveStoreRefType:"table"}});this.boot=j(this,function*(){yield*We(()=>fe(()=>{for(const _ of Object.values(this.tableRefs))for(const E of _.super)this.reactivityGraph.removeEdge(E,_);z.end(),N.end(),b.end()})),yield*this.syncProcessor.boot})}get sessionId(){return this.clientSession.sessionId}get clientId(){return this.clientSession.clientId}}const bl=globalThis.requestAnimationFrame===void 0?n=>setTimeout(n,1e3):globalThis.requestAnimationFrame,eE=globalThis.cancelAnimationFrame===void 0?n=>clearTimeout(n):globalThis.cancelAnimationFrame,tE=({storeDevtoolsChannel:n,store:i})=>j(function*(){const r=new Map,t=new Map,o=new Map,l=new Map,{clientId:f,sessionId:g}=i.clientSession;yield*We(()=>fe(()=>{for(const q of r.values())q();for(const q of t.values())q();for(const q of o.values())q();for(const q of l.values())q()}));const w=new Set,x=q=>n.send(q).pipe(ue,Ft),D=q=>{var N,P,b,y;if(q.clientId!==f||q.sessionId!==g||q._tag==="LSD.ClientSession.Disconnect")return;const A=q.requestId;if(w.has(A))return;w.add(A);const z=globalThis.requestIdleCallback??(h=>h());switch(q._tag){case"LSD.ClientSession.ReactivityGraphSubscribe":{const h=q.includeResults,{subscriptionId:S}=q,_=()=>z(()=>x(Fd.make({reactivityGraph:i.reactivityGraph.getSnapshot({includeResults:h}),requestId:it(10),clientId:f,sessionId:g,liveStoreVersion:Qe,subscriptionId:S})),{timeout:500});_();const E=wc(_,20);r.set(S,i.reactivityGraph.subscribeToRefresh(E));break}case"LSD.ClientSession.DebugInfoReq":{x(Dd.make({debugInfo:i.sqliteDbWrapper.debugInfo,requestId:A,clientId:f,sessionId:g,liveStoreVersion:Qe}));break}case"LSD.ClientSession.DebugInfoHistorySubscribe":{const{subscriptionId:h}=q,S=[];let _=!1,E;const I=()=>{S.push(i.sqliteDbWrapper.debugInfo),i.sqliteDbWrapper.debugInfo=bf(),S.length>10&&(x(Ad.make({debugInfoHistory:S,requestId:it(10),clientId:f,sessionId:g,liveStoreVersion:Qe,subscriptionId:h})),S.length=0),_===!1&&(E=bl(I))};E=bl(I);const R=()=>{_=!0,E!==void 0&&(eE(E),E=void 0)};o.set(h,R);break}case"LSD.ClientSession.DebugInfoHistoryUnsubscribe":{const{subscriptionId:h}=q;(N=o.get(h))==null||N(),o.delete(h);break}case"LSD.ClientSession.DebugInfoResetReq":{i.sqliteDbWrapper.debugInfo.slowQueries.clear(),x($d.make({requestId:A,clientId:f,sessionId:g,liveStoreVersion:Qe}));break}case"LSD.ClientSession.DebugInfoRerunQueryReq":{const{queryStr:h,bindValues:S,queriedTables:_}=q;i.sqliteDbWrapper.cachedSelect(h,S,{queriedTables:_,skipCache:!0}),x(Pd.make({requestId:A,clientId:f,sessionId:g,liveStoreVersion:Qe}));break}case"LSD.ClientSession.ReactivityGraphUnsubscribe":{const{subscriptionId:h}=q;(P=r.get(h))==null||P(),r.delete(h);break}case"LSD.ClientSession.LiveQueriesSubscribe":{const{subscriptionId:h}=q,S=()=>z(()=>x(Nd.make({liveQueries:[...i.activeQueries].map(E=>({_tag:E._tag,id:E.id,label:E.label,hash:E.def.hash,runs:E.runs,executionTimes:E.executionTimes.map(I=>Number(I.toString().slice(0,5))),lastestResult:E.results$.previousResult===Fg?"SYMBOL_NOT_REFRESHED_YET":E.results$.previousResult,activeSubscriptions:Array.from(E.activeSubscriptions)})),requestId:it(10),liveStoreVersion:Qe,clientId:f,sessionId:g,subscriptionId:h})),{timeout:500});S();const _=wc(S,20);t.set(h,i.reactivityGraph.subscribeToRefresh(_));break}case"LSD.ClientSession.LiveQueriesUnsubscribe":{const{subscriptionId:h}=q;(b=t.get(h))==null||b(),t.delete(h);break}case"LSD.ClientSession.SyncHeadSubscribe":{const{subscriptionId:h}=q,S=_=>x(Ld.make({local:_.localHead,upstream:_.upstreamHead,requestId:it(10),clientId:f,sessionId:g,liveStoreVersion:Qe,subscriptionId:h}));S(i.syncProcessor.syncState.pipe(gt)),l.set(h,i.syncProcessor.syncState.changes.pipe(Ye(_=>S(_)),je,St,ue,Nu));break}case"LSD.ClientSession.SyncHeadUnsubscribe":{const{subscriptionId:h}=q;(y=l.get(h))==null||y(),l.delete(h);break}case"LSD.ClientSession.Ping":{x(zd.make({requestId:A,clientId:f,sessionId:g,liveStoreVersion:Qe}));break}default:console.warn("[LSD.ClientSession] Unknown message",q)}};yield*n.listen.pipe(dn(),sv(q=>D(q)),je,ie("LSD.devtools.onMessage"))}).pipe(te.mapToUnexpectedError,ie("LSD.devtools.connectStoreToDevtools")),nE={leaderPushBatchSize:100},Zr=class Zr extends zu("@livestore/livestore/effect/LiveStoreContextRunning")(){};T(Zr,"fromDeferred",j(function*(){const r=yield*yield*sE;return ci(Zr,r)}).pipe(Ug));let Ea=Zr;class sE extends zu("@livestore/livestore/effect/DeferredStoreContext")(){}const rE=({schema:n,adapter:i,storeId:r,context:t={},boot:o,batchUpdates:l,disableDevtools:f,onBootStatus:g,shutdownDeferred:w,params:x,debug:D,confirmUnsavedChanges:q=!0,syncPayload:A})=>j(function*(){const z=yield*ri();yield*iE(r),yield*We(P=>Fe(z,P));const N=(D==null?void 0:D.instanceId)??it(10);return yield*j(function*(){const P=yield*ai.pipe(st),b=Rt.setSpan(jt.active(),P),y=yield*Ng,h=yield*vt().pipe(Te(Ot));yield*$u(h).pipe(yv(H=>g==null?void 0:g(H)),Et(H=>H.stage==="done"?Ot(h):un),js,ue,we);const S=yield*Se(),_=H=>j(function*(){const C=yield*S;yield*tE({storeDevtoolsChannel:H,store:C})}),E=yield*Ks(),I=H=>j(function*(){yield*Fe(z,In(H)).pipe(no({label:"@livestore/livestore:shutdown",duration:500}),cs(1e3),An("TimeoutException",()=>zs("@livestore/livestore:shutdown: Timed out after 1 second"))),w&&(yield*Ts(w,H)),yield*He("LiveStore shutdown complete")}).pipe(ie("@livestore/livestore:shutdown"),ct(E),ue,Ft,es),R=yield*i({schema:n,storeId:r,devtoolsEnabled:vl(f),bootStatusQueue:h,shutdown:I,connectDevtoolsToStore:_,debugInstanceId:N,syncPayload:A}).pipe(_d("livestore:makeAdapter"),ie("createStore:makeAdapter"));Vt&&R.leaderThread.initialState.migrationsReport.migrations.length>0&&(yield*He("[@livestore/livestore:createStore] migrationsReport",...R.leaderThread.initialState.migrationsReport.migrations.map(H=>H.hashes.actual===void 0?`Table '${H.tableName}' doesn't exist yet. Creating table...`:`Schema hash mismatch for table '${H.tableName}' (DB: ${H.hashes.actual}, expected: ${H.hashes.expected}), migrating table...`)));const $=new XS({clientSession:R,schema:n,context:t,otelOptions:{tracer:y,rootSpanContext:b},effectContext:{lifetimeScope:z,runtime:E},__runningInDevtools:vl(f)===!1,confirmUnsavedChanges:q,batchUpdates:H=>H(),storeId:r,params:{leaderPushBatchSize:(x==null?void 0:x.leaderPushBatchSize)??nE.leaderPushBatchSize}});return yield*$.boot,o!==void 0&&(yield*mv(()=>o($,{migrationsReport:R.leaderThread.initialState.migrationsReport,parentSpan:P})).pipe(te.mapToUnexpectedError,ct(ci(Ea,{stage:"running",store:$})),ie("createStore:boot"))),yield*zg(),l!==void 0&&($.reactivityGraph.context.effectsWrapper=l),yield*Me(S,$),$}).pipe(ie("createStore",{attributes:{debugInstanceId:N,storeId:r}}),ln({debugInstanceId:N,storeId:r}),Vt?yd(P=>console.createTask(P)):hn,ii(z))}),iE=n=>j(function*(){if(!/^[a-zA-Z0-9_-]+$/.test(n))return yield*te.make({cause:`Invalid storeId: ${n}. Only alphanumeric characters, underscores, and hyphens are allowed.`,payload:{storeId:n}})}),vl=n=>n===!0||n===!1?!n:fn()===!0,aE=Se(),oE=n=>to?de.jsx(de.Fragment,{}):de.jsx(de.Fragment,{children:Ie(te)(n)?n.toString():Vg(n)}),cE=n=>{const i=n._tag==="LiveStore.StoreInterrupted"?`interrupted due to: ${n.reason}`:n.reason==="devtools-import"?"devtools import":n.reason==="devtools-reset"?"devtools reset":n.reason==="adapter-reset"?"adapter reset":n.reason==="manual"?"manual shutdown":"unknown reason";return to?de.jsx(de.Fragment,{}):de.jsxs(de.Fragment,{children:["LiveStore Shutdown due to ",i]})},lE=n=>to?de.jsx(de.Fragment,{}):de.jsxs(de.Fragment,{children:["LiveStore is loading (",n.stage,")..."]}),uE=({renderLoading:n=lE,renderError:i=oE,renderShutdown:r=cE,otelOptions:t,children:o,schema:l,storeId:f="default",boot:g,adapter:w,batchUpdates:x,disableDevtools:D,signal:q,confirmUnsavedChanges:A=!0,syncPayload:z,debug:N})=>{const P=dE({storeId:f,schema:l,otelOptions:t,boot:g,adapter:w,batchUpdates:x,disableDevtools:D,signal:q,confirmUnsavedChanges:A,syncPayload:z,debug:N});return P.stage==="error"?i(P.error):P.stage==="shutdown"?r(P.cause):P.stage!=="running"?n(P):(globalThis.__debugLiveStore??(globalThis.__debugLiveStore={}),Object.keys(globalThis.__debugLiveStore).length===0&&(globalThis.__debugLiveStore._=P.store),globalThis.__debugLiveStore[(N==null?void 0:N.instanceId)??f]=P.store,de.jsx(Hg.Provider,{value:P,children:o}))},dE=({schema:n,storeId:i,otelOptions:r,boot:t,adapter:o,batchUpdates:l,disableDevtools:f,signal:g,context:w,params:x,confirmUnsavedChanges:D,syncPayload:q,debug:A})=>{const[z,N]=ur.useState(0),P=ur.useRef({value:{stage:"loading"},componentScope:void 0,shutdownDeferred:void 0,previousShutdownDeferred:void 0,counter:0}),b=A==null?void 0:A.instanceId,y=ur.useRef({schema:n,otelOptions:r,boot:t,adapter:o,batchUpdates:l,disableDevtools:f,signal:g,context:w,params:x,confirmUnsavedChanges:D,syncPayload:q,debugInstanceId:b}),h=(_,E,I)=>j(function*(){yield*Fe(_,qa(I)),yield*za(E,I)}).pipe($t(R=>He("[@livestore/livestore/react] interupting",R)),Ft),S={schema:y.current.schema!==n,otelOptions:y.current.otelOptions!==r,boot:y.current.boot!==t,adapter:y.current.adapter!==o,batchUpdates:y.current.batchUpdates!==l,disableDevtools:y.current.disableDevtools!==f,signal:y.current.signal!==g,context:y.current.context!==w,params:y.current.params!==x,confirmUnsavedChanges:y.current.confirmUnsavedChanges!==D,syncPayload:y.current.syncPayload!==q,debugInstanceId:y.current.debugInstanceId!==b};if(S.schema||S.otelOptions||S.boot||S.adapter||S.batchUpdates||S.disableDevtools||S.signal||S.context||S.params||S.confirmUnsavedChanges||S.syncPayload){if(y.current={schema:n,otelOptions:r,boot:t,adapter:o,batchUpdates:l,disableDevtools:f,signal:g,context:w,params:x,confirmUnsavedChanges:D,syncPayload:q,debugInstanceId:b},P.current.componentScope!==void 0&&P.current.shutdownDeferred!==void 0){const _=Object.keys(S).filter(E=>S[E]);h(P.current.componentScope,P.current.shutdownDeferred,new kr({reason:`re-rendering due to changed input props: ${_.join(", ")}`})),P.current.componentScope=void 0,P.current.shutdownDeferred=void 0}P.current={value:{stage:"loading"},componentScope:void 0,shutdownDeferred:void 0,previousShutdownDeferred:P.current.shutdownDeferred,counter:P.current.counter+1}}return ur.useEffect(()=>{const _=P.current.counter,E=R=>{P.current.counter===_&&(P.current.value=R,N($=>$+1))};g==null||g.addEventListener("abort",()=>{P.current.componentScope!==void 0&&P.current.shutdownDeferred!==void 0&&P.current.counter===_&&(h(P.current.componentScope,P.current.shutdownDeferred,new kr({reason:"Aborted via provided AbortController"})),P.current.componentScope=void 0,P.current.shutdownDeferred=void 0)});const I=j(function*(){P.current.previousShutdownDeferred&&(yield*Dn(P.current.previousShutdownDeferred));const R=yield*ri().pipe(Te(Fe)),$=yield*aE;P.current.componentScope=R,P.current.shutdownDeferred=$,yield*j(function*(){const C=yield*rE({schema:n,storeId:i,boot:t,adapter:o,batchUpdates:l,disableDevtools:f,shutdownDeferred:$,context:w,params:x,confirmUnsavedChanges:D,syncPayload:q,onBootStatus:U=>{P.current.value.stage==="running"||P.current.value.stage==="error"||E(U)},debug:{instanceId:b}}).pipe($t(U=>Ts($,U)));E({stage:"running",store:C})}).pipe(ii(R),Ds(R));const H=C=>fe(()=>E({stage:"shutdown",cause:C}));yield*Dn($).pipe($t(C=>He("[@livestore/livestore/react] shutdown",jg(C))),An("LiveStore.IntentionalShutdownCause",C=>H(C)),An("LiveStore.StoreInterrupted",C=>H(C)),Og(C=>fe(()=>E({stage:"error",error:C}))),Mg(C=>fe(()=>E({stage:"error",error:C}))),Fr)}).pipe(Pn,ie("@livestore/react:useCreateStore"),Vt?yd(R=>console.createTask(R)):hn,Bg({parentSpanContext:r==null?void 0:r.rootSpanContext,otelTracer:r==null?void 0:r.tracer}),ue,ln({thread:"window"}),ct(uv("window")),$b(Wg),Nu);return()=>{I(),P.current.componentScope!==void 0&&P.current.shutdownDeferred!==void 0&&(h(P.current.componentScope,P.current.shutdownDeferred,new kr({reason:"unmounting component"})),P.current.componentScope=void 0,P.current.shutdownDeferred=void 0)}},[n,r,t,o,l,f,g,i,w,x,D,q,b]),P.current.value};function fE(n){return new Worker("/assets/livestore.worker-No4EdCW3.js",{type:"module",name:n==null?void 0:n.name})}const hE=OS({storage:{type:"opfs"},worker:fE,sharedWorker:BS}),_E=()=>de.jsx(uE,{schema:Gg,storeId:void 0,adapter:hE,renderLoading:n=>de.jsx(de.Fragment,{}),batchUpdates:L_.unstable_batchedUpdates,syncPayload:{authToken:"insecure-token-change-me"},children:de.jsx(Qg,{children:de.jsx(Jg,{children:de.jsx(Yg,{})})})}),PE=T_(function(){return de.jsxs("html",{lang:"en",children:[de.jsxs("head",{children:[de.jsx("meta",{charSet:"utf-8"}),de.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),de.jsx(R_,{}),de.jsx(D_,{})]}),de.jsxs("body",{children:[de.jsx("div",{id:"root",children:de.jsx(_E,{children:de.jsx(A_,{})})}),de.jsx($_,{}),de.jsx(P_,{})]})]})});export{PE as default};
