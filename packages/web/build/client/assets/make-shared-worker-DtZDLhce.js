var yP=Object.defineProperty;var DS=e=>{throw TypeError(e)};var bP=(e,t,n)=>t in e?yP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var a=(e,t,n)=>bP(e,typeof t!="symbol"?t+"":t,n),qS=(e,t,n)=>t.has(e)||DS("Cannot "+n);var US=(e,t,n)=>(qS(e,t,"read from private field"),n?n.call(e):t.get(e)),jS=(e,t,n)=>t.has(e)?DS("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),zS=(e,t,n,r)=>(qS(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);const SP=e=>typeof e=="function",f=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(i){return t(i,n,r,s)}};case 5:return function(n,r,s,o,i){return arguments.length>=5?t(n,r,s,o,i):function(c){return t(c,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},K=e=>e,od=e=>()=>e,BS=od(!0),An=od(!1),Ik=od(void 0),ua=Ik;function d(e,t,n,r,s,o,i,c,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return i(o(s(r(n(t(e))))));case 8:return c(i(o(s(r(n(t(e)))))));case 9:return u(c(i(o(s(r(n(t(e))))))));default:{let l=arguments[0];for(let g=1;g<arguments.length;g++)l=arguments[g](l);return l}}}const Ks=e=>(t,n)=>t===n||e(t,n),_P=f(2,(e,t)=>Ks((n,r)=>e(t(n),t(r)))),wP=e=>Ks((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let $P="3.15.5";const id=()=>$P,nl=`effect/GlobalValue/globalStoreId/${id()}`;let Oc;const ee=(e,t)=>(Oc||(globalThis[nl]??(globalThis[nl]=new Map),Oc=globalThis[nl]),Oc.has(e)||Oc.set(e,t()),Oc.get(e)),Gt=e=>typeof e=="string",Ar=e=>typeof e=="number",no=e=>typeof e=="boolean",cd=e=>typeof e=="bigint",Kl=e=>typeof e=="symbol",eu=SP,EP=e=>e===void 0,kP=e=>!1,ad=e=>typeof e=="object"&&e!==null,hr=e=>ad(e)||eu(e),j=f(2,(e,t)=>hr(e)&&t in e),Om=f(2,(e,t)=>j(e,"_tag")&&e._tag===t),Wo=e=>e==null,vP=e=>e!=null,CP=e=>e instanceof Uint8Array,IP=e=>e instanceof Date,Rm=e=>j(e,Symbol.iterator),TP=e=>ad(e)&&!Array.isArray(e),Tk=e=>j(e,"then")&&eu(e.then),ud=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let Ok=class Rk{constructor(t){a(this,"self");a(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new Rk(this.self)}};const OP=335903614,RP=4150755663,PP=1481765933,FP=1284865837,MP=9007199254740992,xP=134217728;class AP{constructor(t,n,r,s){a(this,"_state");return Wo(n)&&Wo(t)?(n=Math.random()*4294967295>>>0,t=0):Wo(n)&&(n=t,t=0),Wo(s)&&Wo(r)?(s=this._state?this._state[3]:RP,r=this._state?this._state[2]:OP):Wo(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),KS(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*xP+n)/MP}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;NP(this._state,t,n,PP,FP),KS(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,i=t>>>27,c=(-i>>>0&31)>>>0;return(o>>>i|o<<c)>>>0}}function NP(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,i=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,u=(n>>>16)*(s>>>16)+((i>>>16)+(o>>>16))>>>0;i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(u=u+1>>>0),o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(u=u+1>>>0),u=u+Math.imul(n,r)>>>0,u=u+Math.imul(t,s)>>>0,e[0]=u,e[1]=c}function KS(e,t,n,r,s){let o=t+r>>>0;const i=n+s>>>0;i>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=i}const Dg=Symbol.for("effect/Utils/YieldWrap");var Za;class Xi{constructor(t){jS(this,Za);zS(this,Za,t)}[Dg](){return US(this,Za)}}Za=new WeakMap;function LP(e){if(typeof e=="object"&&e!==null&&Dg in e)return e[Dg]();throw new Error(ud("yieldWrapGet"))}const bn=ee("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Pk={effect_internal_function:e=>e()},DP={effect_internal_function:e=>{try{return e()}finally{}}};var N$;const qP=((N$=Pk.effect_internal_function(()=>new Error().stack))==null?void 0:N$.includes("effect_internal_function"))===!0,Pe=qP?Pk.effect_internal_function:DP.effect_internal_function,UP=(function*(){}).constructor,jP=e=>hr(e)&&e.constructor===UP,ig=ee(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),Y=Symbol.for("effect/Hash"),A=e=>{if(bn.enabled===!0)return 0;switch(typeof e){case"number":return Pm(e);case"bigint":return it(e.toString(10));case"boolean":return it(String(e));case"symbol":return it(String(e));case"string":return it(e);case"undefined":return it("undefined");case"function":case"object":return e===null?it("null"):e instanceof Date?A(e.toISOString()):e instanceof URL?A(e.href):zP(e)?e[Y]():ld(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},ld=e=>(ig.has(e)||ig.set(e,Pm(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),ig.get(e)),J=e=>t=>t*53^e,fd=e=>e&3221225471|e>>>1&1073741824,zP=e=>j(e,Y),Pm=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return fd(t)},it=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return fd(t)},BP=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=d(it(t[r]),J(A(e[t[r]])));return fd(n)},Fk=e=>BP(e,Object.keys(e)),tu=e=>{let t=6151;for(let n=0;n<e.length;n++)t=d(t,J(A(e[n])));return fd(t)},$e=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,Y,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,Y,{value(){return t},enumerable:!1}),t},Q=Symbol.for("effect/Equal");function H(){return arguments.length===1?e=>Wl(e,arguments[0]):Wl(arguments[0],arguments[1])}function Wl(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Hl(e)&&Hl(t))return A(e)===A(t)&&e[Q](t)?!0:bn.enabled&&bn.tester?bn.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(bn.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Wl(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Wl(e[o],t[o])))return bn.tester?bn.tester(e,t):!1;return!0}}return bn.tester?bn.tester(e,t):!1}}return bn.enabled&&bn.tester?bn.tester(e,t):!1}const Hl=e=>j(e,Q),Fm=()=>H,fe=Symbol.for("nodejs.util.inspect.custom"),Le=e=>{try{if(j(e,"toJSON")&&eu(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(Le)}catch{return{}}return ro(e)},Oe=e=>JSON.stringify(e,null,2),dd={toJSON(){return Le(this)},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}};let KP=class{[fe](){return this.toJSON()}toString(){return Oe(this.toJSON())}};const wi=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?Mk(e,t):String(e)}catch{return String(e)}},Mk=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(Ws.fiberRefs!==void 0&&xk(o)?o[hd](Ws.fiberRefs):o):o,t);return n=void 0,r},hd=Symbol.for("effect/Inspectable/Redactable"),xk=e=>typeof e=="object"&&e!==null&&hd in e,Ws=ee("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),WP=(e,t)=>{const n=Ws.fiberRefs;Ws.fiberRefs=e;try{return t()}finally{Ws.fiberRefs=n}},ro=e=>xk(e)&&Ws.fiberRefs!==void 0?e[hd](Ws.fiberRefs):e,D=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},Hc="Async",nu="Commit",St="Failure",wl="OnFailure",Jl="OnSuccess",Vl="OnSuccessAndFailure",_t="Success",Ak="Sync",HP="Tag",Zi="UpdateRuntimeFlags",Gl="While",Jc="Iterator",Nk="WithRuntime",$l="Yield",Mm="RevertFlags",JP=Symbol.for("effect/Effect"),qg=Symbol.for("effect/Stream"),VP=Symbol.for("effect/Sink"),GP=Symbol.for("effect/Channel"),so={_R:e=>e,_E:e=>e,_A:e=>e,_V:id()},QP={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},YP={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},ru={[JP]:so,[qg]:so,[VP]:QP,[GP]:YP,[Q](e){return this===e},[Y](){return $e(this,ld(this))},[Symbol.iterator](){return new Ok(new Xi(this))},pipe(){return D(this,arguments)}},xm={[Y](){return $e(this,Fk(this))},[Q](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&H(this[r],e[r])))return!1;return!0}},su={...ru,_op:nu},XP={...su,...xm},ZP=function(){function e(){}return e.prototype=su,e}(),Lk=Symbol.for("effect/Option"),Dk={...ru,[Lk]:{_A:e=>e},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}},eF=Object.assign(Object.create(Dk),{_tag:"Some",_op:"Some",[Q](e){return Am(e)&&Uk(e)&&H(this.value,e.value)},[Y](){return $e(this,J(A(this._tag))(A(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:Le(this.value)}}}),tF=A("None"),nF=Object.assign(Object.create(Dk),{_tag:"None",_op:"None",[Q](e){return Am(e)&&qk(e)},[Y](){return tF},toJSON(){return{_id:"Option",_tag:this._tag}}}),Am=e=>j(e,Lk),qk=e=>e._tag==="None",Uk=e=>e._tag==="Some",Nm=Object.create(nF),Ql=e=>{const t=Object.create(eF);return t.value=e,t},jk=Symbol.for("effect/Either"),zk={...ru,[jk]:{_R:e=>e},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}},rF=Object.assign(Object.create(zk),{_tag:"Right",_op:"Right",[Q](e){return Lm(e)&&Kk(e)&&H(this.right,e.right)},[Y](){return J(A(this._tag))(A(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:Le(this.right)}}}),sF=Object.assign(Object.create(zk),{_tag:"Left",_op:"Left",[Q](e){return Lm(e)&&Bk(e)&&H(this.left,e.left)},[Y](){return J(A(this._tag))(A(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:Le(this.left)}}}),Lm=e=>j(e,jk),Bk=e=>e._tag==="Left",Kk=e=>e._tag==="Right",oF=e=>{const t=Object.create(sF);return t.left=e,t},iF=e=>{const t=Object.create(rF);return t.right=e,t},V=iF,W=oF,Wk=Lm,pt=Bk,nr=Kk,cF=f(2,(e,{onLeft:t,onRight:n})=>pt(e)?W(t(e.left)):V(n(e.right))),Dm=f(2,(e,t)=>pt(e)?W(t(e.left)):V(e.right)),aF=f(2,(e,t)=>nr(e)?V(t(e.right)):W(e.left)),Tt=f(2,(e,{onLeft:t,onRight:n})=>pt(e)?t(e.left):n(e.right)),uF=Tt({onLeft:K,onRight:K}),Hk=f(2,(e,t)=>{if(nr(e))return e.right;throw t(e.left)}),lF=Hk(()=>new Error("getOrThrow called on a Left")),Jk=e=>e.length>0,Vk=e=>(t,n)=>t===n?0:e(t,n),fF=Vk((e,t)=>e<t?-1:1),Gk=f(2,(e,t)=>Vk((n,r)=>e(t(n),t(r)))),dF=e=>f(2,(t,n)=>e(t,n)===1),M=()=>Nm,x=Ql,hF=Am,Ue=qk,_e=Uk,Re=f(2,(e,{onNone:t,onSome:n})=>Ue(e)?t():n(e.value)),je=f(2,(e,t)=>Ue(e)?t():e.value),rs=f(2,(e,t)=>Ue(e)?t():e),gF=f(2,(e,t)=>Ue(e)?x(t()):e),Co=e=>e==null?M():x(e),Fn=je(Ik),pF=e=>(...t)=>{try{return x(e(...t))}catch{return M()}},Hs=f(2,(e,t)=>Ue(e)?M():x(t(e.value))),ec=f(2,(e,t)=>Ue(e)?M():t(e.value)),mF=f(2,(e,t)=>Ue(e)?M():Co(t(e.value))),yF=ec,bF=f(2,(e,t)=>yF(e,n=>t(n)?Ql(n):Nm)),SF=e=>Ks((t,n)=>Ue(t)?Ue(n):Ue(n)?!1:e(t.value,n.value)),_F=e=>f(2,(t,n)=>Ue(t)?!1:e(t.value,n)),wF=Fm(),$F=_F(wF),EF=f(2,(e,t)=>Ue(e)?!1:t(e.value)),WS=e=>(t,n)=>Ue(t)?n:Ue(n)?t:x(e(t.value,n.value)),kF=(...e)=>e,vF=e=>{const n=e[Symbol.iterator]().next();return n.done?M():x(n.value)},Ug=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},CF=f(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(no(s)){if(s)return x(r)}else if(_e(s))return s;n++}return M()}),IF={[Symbol.iterator](){return TF}},TF={next(){return{done:!0,value:void 0}}},OF=()=>IF,RF=f(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){let s=n.next();for(;!s.done;){if(t(s.value,r++))return{done:!1,value:s.value};s=n.next()}return{done:!0,value:void 0}}}}})),PF=f(2,(e,t)=>{const n={...e};for(const r of FF(e))n[r]=t(e[r],r);return n}),FF=e=>Object.keys(e),gd=e=>new Array(e),MF=f(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),pe=e=>Array.isArray(e)?e:Array.from(e),qm=e=>Array.isArray(e)?e:[e],xF=f(2,(e,{onEmpty:t,onNonEmpty:n})=>ze(e)?n(Ht(e),oo(e)):t()),Yl=f(2,(e,t)=>[t,...e]),AF=f(2,(e,t)=>[...e,t]),Um=f(2,(e,t)=>pe(e).concat(pe(t))),NF=Array.isArray,LF=e=>e.length===0,DF=LF,El=Jk,ze=Jk,Qk=(e,t)=>e<0||e>=t.length,qF=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),UF=f(2,(e,t)=>{const n=Math.floor(t);return Qk(n,e)?M():x(e[n])}),Yk=f(2,(e,t)=>{const n=Math.floor(t);if(Qk(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),Vc=UF(0),Ht=Yk(0),jF=e=>ze(e)?x(Xk(e)):M(),Xk=e=>e[e.length-1],oo=e=>e.slice(1),zF=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},BF=f(2,(e,t)=>ev(e,zF(e,t))),KF=f(2,(e,t)=>{const n=pe(e);return n.slice(qF(t,n),n.length)}),WF=CF,HS=e=>Array.from(e).reverse(),la=f(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),JS=f(2,(e,t)=>HF(e,t,kF)),HF=f(3,(e,t,n)=>{const r=pe(e),s=pe(t);if(ze(r)&&ze(s)){const o=[n(Ht(r),Ht(s))],i=Math.min(r.length,s.length);for(let c=1;c<i;c++)o[c]=n(r[c],s[c]);return o}return[]}),JF=e=>f(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),Zk=Fm(),ev=f(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return ze(n)?r>=1?VF(n,r):[[],n]:[n,[]]}),VF=f(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[Uc(e),[]]:[Yl(e.slice(1,n),Ht(e)),e.slice(n)]}),Uc=e=>e.slice(),GF=f(3,(e,t,n)=>{const r=pe(e),s=pe(t);return ze(r)?ze(s)?rv(n)(Um(r,s)):r:s}),kl=f(2,(e,t)=>GF(e,t,Zk)),QF=e=>{const t=JF(e);return f(2,(n,r)=>pe(n).filter(s=>t(r,s)))},YF=QF(Zk),fs=()=>[],Pn=e=>[e],Js=f(2,(e,t)=>e.map(t)),Xl=f(2,(e,t)=>{if(DF(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),XF=Xl(K),tv=f(2,(e,t)=>{const n=pe(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);_e(o)&&r.push(o.value)}return r}),nv=f(2,(e,t)=>{const n=pe(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),jm=f(3,(e,t,n)=>pe(e).reduce((r,s,o)=>n(r,s,o),t)),VS=(e,t)=>{const n=[];let r=e,s;for(;_e(s=t(r));){const[o,i]=s.value;n.push(o),r=i}return n},pd=wP,rv=f(2,(e,t)=>{const n=pe(e);if(ze(n)){const r=[Ht(n)],s=oo(n);for(const o of s)r.every(i=>!t(o,i))&&r.push(o);return r}return[]}),ZF=e=>rv(e,Fm()),tc=f(2,(e,t)=>pe(e).join(t)),sv=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return sv(e,t.from)}},Nn=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),zm=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},eM=e=>{try{return e.toISOString()}catch{return String(e)}},kn=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>kn(n,t)).join(",")}]`;if(IP(e))return eM(e);if(j(e,"toString")&&eu(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Gt(e))return JSON.stringify(e);if(Ar(e)||e==null||no(e)||Kl(e))return String(e);if(cd(e))return String(e)+"n";if(Rm(e))return`${e.constructor.name}(${kn(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${Nn(e).map(s=>`${Gt(s)?JSON.stringify(s):String(s)}:${kn(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},Bm=e=>typeof e=="string"?JSON.stringify(e):String(e),ov=e=>Array.isArray(e),tM=e=>!Array.isArray(e),GS=e=>`[${Bm(e)}]`,iv=e=>ov(e)?e.map(GS).join(""):GS(e),zr=(e,t,n,r)=>{let s=e;return n&&ze(n)&&(s+=`
at path: ${iv(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},cv=(e,t,n)=>zr("Unsupported schema",e,t,n),nM=(e,t)=>cv("Cannot build an Equivalence",t,e),av=(e,t,n)=>zr("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),uv=e=>cv(void 0,void 0,e),rM=e=>zr("Unsupported key schema",void 0,void 0,e),sM=e=>zr("Unsupported literal",`literal value: ${kn(e)}`),QS=e=>zr("Duplicate index signature",`${e} index signature`),oM=zr("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),iM=zr("Invalid element","A required element cannot follow an optional element. ts(1257)"),YS=e=>zr("Duplicate property signature transformation",`Duplicate key ${kn(e)}`),lv=e=>zr("Duplicate property signature",`Duplicate key ${kn(e)}`),cM=Symbol.for("effect/SchemaId/Int"),aM=Symbol.for("effect/SchemaId/Between"),$i=fF,Zl=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),uM=Symbol.for("effect/annotation/Brand"),lM=Symbol.for("effect/annotation/SchemaId"),fv=Symbol.for("effect/annotation/Message"),Km=Symbol.for("effect/annotation/MissingMessage"),Wm=Symbol.for("effect/annotation/Identifier"),gr=Symbol.for("effect/annotation/Title"),oi=Symbol.for("effect/annotation/AutoTitle"),ou=Symbol.for("effect/annotation/Description"),dv=Symbol.for("effect/annotation/Examples"),hv=Symbol.for("effect/annotation/Default"),gv=Symbol.for("effect/annotation/JSONSchema"),pv=Symbol.for("effect/annotation/Arbitrary"),mv=Symbol.for("effect/annotation/Pretty"),Hm=Symbol.for("effect/annotation/Equivalence"),fM=Symbol.for("effect/annotation/Documentation"),yv=Symbol.for("effect/annotation/Concurrency"),bv=Symbol.for("effect/annotation/Batching"),Sv=Symbol.for("effect/annotation/ParseIssueTitle"),_v=Symbol.for("effect/annotation/ParseOptions"),wv=Symbol.for("effect/annotation/DecodingFallback"),ef=Symbol.for("effect/annotation/Surrogate"),dM=Symbol.for("effect/annotation/StableFilter"),Nt=f(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?x(e.annotations[t]):M()),hM=Nt(uM),gM=Nt(fv),pM=Nt(Km),$v=Nt(gr),Ev=Nt(oi),md=Nt(Wm),kv=Nt(ou),mM=Nt(yv),yM=Nt(bv),bM=Nt(Sv),SM=Nt(_v),_M=Nt(wv),Io=Nt(ef),wM=Nt(dM),$M=e=>EF(wM(e),t=>t===!0),yd=Symbol.for("effect/annotation/JSONIdentifier"),EM=Nt(yd),kM=e=>rs(EM(e),()=>md(e));class bd{constructor(t,n,r,s={}){a(this,"typeParameters");a(this,"decodeUnknown");a(this,"encodeUnknown");a(this,"annotations");a(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return je(cr(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:ft(this.annotations)}}}const Kn=e=>t=>t._tag===e;let tf=class{constructor(t,n={}){a(this,"literal");a(this,"annotations");a(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return je(cr(this),()=>kn(this.literal))}toJSON(){return{_tag:this._tag,literal:cd(this.literal)?String(this.literal):this.literal,annotations:ft(this.annotations)}}};const Gc=Kn("Literal"),vM=new tf(null);class CM{constructor(t,n={}){a(this,"symbol");a(this,"annotations");a(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return je(cr(this),()=>kn(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:ft(this.annotations)}}}class IM{constructor(t={}){a(this,"annotations");a(this,"_tag","UndefinedKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const nf=new IM({[gr]:"undefined"});class TM{constructor(t={}){a(this,"annotations");a(this,"_tag","VoidKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const OM=new TM({[gr]:"void"});class RM{constructor(t={}){a(this,"annotations");a(this,"_tag","NeverKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const Sd=new RM({[gr]:"never"}),PM=Kn("NeverKeyword");class FM{constructor(t={}){a(this,"annotations");a(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const vv=new FM({[gr]:"unknown"});class MM{constructor(t={}){a(this,"annotations");a(this,"_tag","AnyKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const Cv=new MM({[gr]:"any"});class xM{constructor(t={}){a(this,"annotations");a(this,"_tag","StringKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const jg=new xM({[gr]:"string",[ou]:"a string"}),rf=Kn("StringKeyword");class AM{constructor(t={}){a(this,"annotations");a(this,"_tag","NumberKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const zg=new AM({[gr]:"number",[ou]:"a number"}),XS=Kn("NumberKeyword");class NM{constructor(t={}){a(this,"annotations");a(this,"_tag","BooleanKeyword");this.annotations=t}toString(){return ws(this)}toJSON(){return{_tag:this._tag,annotations:ft(this.annotations)}}}const Bg=new NM({[gr]:"boolean",[ou]:"a boolean"}),ZS=Kn("BooleanKeyword"),Jm=Kn("SymbolKeyword"),LM=Kn("TemplateLiteral");let _d=class{constructor(t,n={}){a(this,"type");a(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:ft(this.annotations)}}toString(){return String(this.type)}};class To extends _d{constructor(n,r,s={}){super(n,s);a(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:ft(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Iv=e=>e.map(t=>t.type);class wd{constructor(t,n,r,s={}){a(this,"elements");a(this,"rest");a(this,"isReadonly");a(this,"annotations");a(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,i=!1;for(const c of t)if(c.isOptional)o=!0;else if(o){i=!0;break}if(i||o&&n.length>1)throw new Error(iM)}toString(){return je(cr(this),()=>DM(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:ft(this.annotations)}}}const DM=e=>{const t=e.elements.map(String).join(", ");return xF(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const i=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${i}]`:`readonly [...${o}[], ${i}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Ye extends To{constructor(n,r,s,o,i){super(r,s,i);a(this,"name");a(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:ft(this.annotations)}}}const Tv=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Tv(e.from)}return!1};class iu{constructor(t,n,r){a(this,"type");a(this,"isReadonly");a(this,"parameter");if(this.type=n,this.isReadonly=r,Tv(t))this.parameter=t;else throw new Error(oM)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class vn{constructor(t,n,r={}){a(this,"annotations");a(this,"_tag","TypeLiteral");a(this,"propertySignatures");a(this,"indexSignatures");this.annotations=r;const s={};for(let i=0;i<t.length;i++){const c=t[i].name;if(Object.prototype.hasOwnProperty.call(s,c))throw new Error(lv(c));s[c]=null}const o={string:!1,symbol:!1};for(let i=0;i<n.length;i++){const c=io(n[i].parameter);if(rf(c)){if(o.string)throw new Error(QS("string"));o.string=!0}else if(Jm(c)){if(o.symbol)throw new Error(QS("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return je(cr(this),()=>qM(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:ft(this.annotations)}}}const e_=e=>e.map(String).join("; "),qM=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${e_(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${e_(e.indexSignatures)} }`:"{}"},sf=Kn("TypeLiteral"),UM=la(Gk($i,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),jM={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},Ov=e=>Xl(e,t=>cu(t)?Ov(t.types):[t]),zM=e=>{const t=UM(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[Cv];case"UnknownKeyword":return[vv];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const i=typeof o.literal;switch(i){case"string":case"number":case"bigint":case"boolean":{const c=jM[i];!r[c]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};var vr;let zt=(vr=class{constructor(t,n={}){a(this,"types");a(this,"annotations");a(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return je(cr(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:ft(this.annotations)}}},a(vr,"make",(t,n)=>Vm(t)?new vr(t,n):t.length===1?t[0]:Sd),a(vr,"unify",(t,n)=>vr.make(zM(Ov(t)),n)),vr);const BM=(e,t)=>e.map(t),Vm=e=>e.length>1,cu=Kn("Union"),cg=ee(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class Ei{constructor(t,n={}){a(this,"f");a(this,"annotations");a(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=zm(t)}toString(){return cr(this).pipe(rs(()=>ec(pF(this.f)(),t=>cr(t))),je(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=cg.get(t);return n||(cg.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:ft(this.annotations)},cg.set(t,n),n)}}let au=class{constructor(t,n,r={}){a(this,"from");a(this,"filter");a(this,"annotations");a(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return md(this).pipe(je(()=>Re(Lv(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>ii(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:ft(this.annotations)}}};const ii=Kn("Refinement"),ag={};let rr=class{constructor(t,n,r,s={}){a(this,"from");a(this,"to");a(this,"transformation");a(this,"annotations");a(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return je(cr(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:ft(this.annotations)}}};const KM=Kn("Transformation");class Rv{constructor(t,n){a(this,"decode");a(this,"encode");a(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const WM=e=>t=>t._tag===e;class HM{constructor(){a(this,"_tag","ComposeTransformation")}}const Pv=new HM;let JM=class{constructor(t,n,r,s){a(this,"from");a(this,"to");a(this,"decode");a(this,"encode");this.from=t,this.to=n,this.decode=r,this.encode=s}};class of{constructor(t){a(this,"propertySignatureTransformations");a(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(YS(o));n[o]=!0;const i=s.to;if(r[i])throw new Error(YS(i));r[i]=!0}}}const t_=WM("TypeLiteralTransformation"),ki=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=Io(e);return _e(s)&&(r[ef]=ki(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},VM="[\\s\\S]*",GM="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",Fv=(e,t)=>{switch(e._tag){case"Literal":return Zl(String(e.literal));case"StringKeyword":return VM;case"NumberKeyword":return GM;case"TemplateLiteral":return Mv(e);case"Union":return e.types.map(n=>Fv(n)).join("|")}},QM=(e,t,n,r)=>cu(e)?`(${t})`:t,Mv=(e,t,n)=>{let r="";if(e.head!==""){const s=Zl(e.head);r+=s}for(const s of e.spans){const o=Fv(s.type);if(r+=QM(s.type,o),s.literal!==""){const i=Zl(s.literal);r+=i}}return r},xv=e=>new RegExp(`^${Mv(e)}$`),Qc=e=>{const t=Io(e);if(_e(t))return Qc(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return Qc(e.f());case"Refinement":return Qc(e.from)}return Qr(e).map(n=>As(e,n))},vl=e=>{const t=Io(e);if(_e(t))return vl(t.value);switch(e._tag){case"TypeLiteral":return e.indexSignatures.slice();case"Suspend":return vl(e.f());case"Refinement":return vl(e.from)}return[]},Av=(e,t)=>{const n=WF(e.propertySignatures,r=>r.name===t);if(_e(n))return n.value;if(Gt(t)){let r;for(const s of e.indexSignatures){const o=io(s.parameter);switch(o._tag){case"TemplateLiteral":{if(xv(o).test(t))return new Ye(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new Ye(t,s.type,!1,!0))}}if(r)return r}else if(Kl(t))for(const r of e.indexSignatures){const s=io(r.parameter);if(Jm(s))return new Ye(t,r.type,!1,!0)}},As=(e,t)=>{const n=Io(e);if(_e(n))return As(n.value,t);switch(e._tag){case"TypeLiteral":{const r=Av(e,t);if(r)return r;break}case"Union":return new Ye(t,zt.make(e.types.map(r=>As(r,t).type)),!1,!0);case"Suspend":return As(e.f(),t);case"Refinement":return As(e.from,t)}throw new Error(uv(e))},Qr=e=>{const t=Io(e);if(_e(t))return Qr(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>YF(n,Qr(r)),Qr(e.types[0]));case"Suspend":return Qr(e.f());case"Refinement":return Qr(e.from);case"Transformation":return Qr(e.to)}return[]},n_=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new iu(o,t,!0));break;case"Literal":if(Gt(o.literal)||Ar(o.literal))n.push(new Ye(o.literal,t,!1,!0));else throw new Error(sM(o.literal));break;case"Enums":{for(const[i,c]of o.enums)n.push(new Ye(c,t,!1,!0));break}case"UniqueSymbol":n.push(new Ye(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(rM(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Xn=(e,t)=>{const n=Io(e);if(_e(n))return Xn(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const i=Av(e,o);i&&r.push(i)}return new vn(r,[])}case"Union":return new vn(t.map(r=>As(e,r)),[]);case"Suspend":return Xn(e.f(),t);case"Refinement":return Xn(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new rr(Xn(e.from,t),Xn(e.to,t),Pv);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const i=e.transformation.propertySignatureTransformations.find(c=>c.to===o);i?(r.push(i),s.push(i.from)):s.push(o)}return ze(r)?new rr(Xn(e.from,s),Xn(e.to,t),new of(r)):Xn(e.from,s)}}}throw new Error(uv(e))},YM=(e,t)=>{let n=vl(e);return n.length>0?(n.some(r=>rf(io(r.parameter)))&&(n=n.filter(r=>!LM(io(r.parameter)))),new vn([],n)):Xn(e,Qr(e).filter(r=>!t.includes(r)))},XM=e=>zt.make([e,nf]),Yo=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new wd(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=Bt(e.propertySignatures,r=>r.isReadonly===!1?r:new Ye(r.name,r.type,r.isOptional,!1,r.annotations)),n=Bt(e.indexSignatures,r=>r.isReadonly===!1?r:new iu(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new vn(t,n,e.annotations)}case"Union":{const t=Bt(e.types,Yo);return t===e.types?e:zt.make(t,e.annotations)}case"Suspend":return new Ei(()=>Yo(e.f()),e.annotations);case"Refinement":{const t=Yo(e.from);return t===e.from?e:new au(t,e.filter,e.annotations)}case"Transformation":{const t=Yo(e.from),n=Yo(e.to);return t===e.from&&n===e.to?e:new rr(t,n,e.transformation,e.annotations)}}return e},Nv=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},ZM=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},ex=Nv([dv,hv,gv,pv,mv,Hm]),Xe=e=>{switch(e._tag){case"Declaration":{const t=Bt(e.typeParameters,Xe);return t===e.typeParameters?e:new bd(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=Bt(e.elements,s=>{const o=Xe(s.type);return o===s.type?s:new To(o,s.isOptional)}),n=Iv(e.rest),r=Bt(n,Xe);return t===e.elements&&r===n?e:new wd(t,r.map(s=>new _d(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=Bt(e.propertySignatures,r=>{const s=Xe(r.type);return s===r.type?r:new Ye(r.name,s,r.isOptional,r.isReadonly)}),n=Bt(e.indexSignatures,r=>{const s=Xe(r.type);return s===r.type?r:new iu(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new vn(t,n,e.annotations)}case"Union":{const t=Bt(e.types,Xe);return t===e.types?e:zt.make(t,e.annotations)}case"Suspend":return new Ei(()=>Xe(e.f()),e.annotations);case"Refinement":{const t=Xe(e.from);return t===e.from?e:new au(t,e.filter,e.annotations)}case"Transformation":{const t=ex(e);return Xe(t!==void 0?ki(e.to,t):e.to)}}return e},Ho=e=>Re(kM(e),{onNone:()=>{},onSome:t=>({[yd]:t})});function Bt(e,t){let n=!1;const r=gd(e.length);for(let s=0;s<e.length;s++){const o=e[s],i=t(o);i!==o&&(n=!0),r[s]=i}return n?r:e}const Qn=(e,t)=>{switch(e._tag){case"Declaration":{const n=Bt(e.typeParameters,r=>Qn(r));return n===e.typeParameters?e:new bd(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=Bt(e.elements,o=>{const i=Qn(o.type);return i===o.type?o:new To(i,o.isOptional)}),r=Iv(e.rest),s=Bt(r,o=>Qn(o));return n===e.elements&&s===r?e:new wd(n,s.map(o=>new _d(o)),e.isReadonly,Ho(e))}case"TypeLiteral":{const n=Bt(e.propertySignatures,s=>{const o=Qn(s.type);return o===s.type?s:new Ye(s.name,o,s.isOptional,s.isReadonly)}),r=Bt(e.indexSignatures,s=>{const o=Qn(s.type);return o===s.type?s:new iu(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new vn(n,r,Ho(e))}case"Union":{const n=Bt(e.types,r=>Qn(r));return n===e.types?e:zt.make(n,Ho(e))}case"Suspend":return new Ei(()=>Qn(e.f()),Ho(e));case"Refinement":{const n=Qn(e.from),r=Ho(e);return r?ki(n,r):n}case"Transformation":{const n=Ho(e);return Qn(n?ki(e.from,n):e.from)}}return e},Kg=e=>Qn(e),ft=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},io=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return io(e.from)}},ws=e=>je(cr(e),()=>e._tag);function tx(e){return Re(hM(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${kn(n)}>`).join("")})}const Lv=e=>$v(e).pipe(rs(()=>kv(e)),rs(()=>Ev(e)),Hs(t=>t+tx(e))),cr=e=>rs(md(e),()=>Lv(e)),nx=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return Sd;case"Union":{const r=[];let s=!1;for(const o of e.types){const i=t(o);i?(s=!0,PM(i)||r.push(i)):r.push(o)}if(s)return zt.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},r_=Symbol.for("effect/Brand/Refined"),Dv=()=>Object.assign(e=>e,{[r_]:r_,option:e=>x(e),either:e=>V(e),is:e=>!0}),qv=Symbol.for("effect/Context/Tag"),cf=Symbol.for("effect/Context/Reference"),rx="effect/STM",sx=Symbol.for(rx),Gm={...ru,_op:"Tag",[sx]:so,[qv]:{_Service:e=>e,_Identifier:e=>e},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[fe](){return this.toJSON()},of(e){return e},context(e){return zv(this,e)}},ox={...Gm,[cf]:cf},ix=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(Gm);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},cx=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,Gm),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},ax=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,ox),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},Uv=Symbol.for("effect/Context"),ux={[Uv]:{_Services:e=>e},[Q](e){if(jv(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!H(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[Y](){return $e(this,Pm(this.unsafeMap.size))},pipe(){return D(this,arguments)},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(Le)}},[fe](){return this.toJSON()}},co=e=>{const t=Object.create(ux);return t.unsafeMap=e,t},lx=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},jv=e=>j(e,Uv),fx=e=>j(e,qv),dx=e=>j(e,cf),hx=co(new Map),gx=()=>hx,zv=(e,t)=>co(new Map([[e.key,t]])),px=f(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),co(r)}),ug=ee("effect/Context/defaultValueCache",()=>new Map),Qm=e=>{if(ug.has(e.key))return ug.get(e.key);const t=e.defaultValue();return ug.set(e.key,t),t},mx=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):Qm(t),Bv=f(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(cf in t)return Qm(t);throw lx(t)}return e.unsafeMap.get(t.key)}),yx=Bv,bx=f(2,(e,t)=>e.unsafeMap.has(t.key)?Ql(e.unsafeMap.get(t.key)):dx(t)?Ql(Qm(t)):Nm),Sx=f(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return co(n)}),_x=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return co(n)},on=ix,wx=jv,$d=fx,ds=gx,uu=zv,er=px,en=yx,Ed=Bv,Br=bx,Kr=Sx,Kv=_x,Wv=cx,nc=ax,Hv=Symbol.for("effect/Chunk");function $x(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const Jv=[],Ex=e=>Ks((t,n)=>t.length===n.length&&dn(t).every((r,s)=>e(r,ss(n,s)))),kx=Ex(H),vx={[Hv]:{_A:e=>e},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Chunk",values:dn(this).map(Le)}},[fe](){return this.toJSON()},[Q](e){return kd(e)&&kx(this,e)},[Y](){return $e(this,tu(dn(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Jv[Symbol.iterator]();default:return dn(this)[Symbol.iterator]()}},pipe(){return D(this,arguments)}},Qe=e=>{const t=Object.create(vx);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Mn,t.right=Mn;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Mn,t.right=Mn;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Mn,t.right=Mn;break}}return t},kd=e=>j(e,Hv),Mn=Qe({_tag:"IEmpty"}),xe=()=>Mn,lg=(...e)=>Ox(e),ke=e=>Qe({_tag:"ISingleton",a:e}),ao=e=>kd(e)?e:Ze(pe(e)),Wg=(e,t,n)=>{switch(e.backing._tag){case"IArray":{$x(e.backing.array,0,t,n,e.length);break}case"IConcat":{Wg(e.left,t,n),Wg(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=ss(e,r),r+=1,s+=1;break}}},Cx=e=>{switch(e.backing._tag){case"IEmpty":return Jv;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Wg(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Mn,e.right=Mn,e.depth=0,t}}},dn=Cx,Ix=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Qe({_tag:"IArray",array:HS(e.backing.array)});case"IConcat":return Qe({_tag:"IConcat",left:Nr(e.backing.right),right:Nr(e.backing.left)});case"ISlice":return Ze(HS(dn(e)))}},Nr=Ix,Tx=f(2,(e,t)=>t<0||t>=e.length?M():x(ss(e,t))),Ze=e=>e.length===0?xe():e.length===1?ke(e[0]):Qe({_tag:"IArray",array:e}),Ox=e=>Ze(e),ss=f(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?ss(e.left,t):ss(e.right,t-e.left.length);case"ISlice":return ss(e.backing.chunk,t+e.backing.offset)}}),fa=f(2,(e,t)=>Ne(e,ke(t))),Ft=f(2,(e,t)=>Ne(ke(t),e)),vi=f(2,(e,t)=>{if(t<=0)return Mn;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Qe({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Qe({_tag:"IConcat",left:e.left,right:vi(e.right,t-e.left.length)}):vi(e.left,t);default:return Qe({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Cr=f(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Mn;switch(e.backing._tag){case"ISlice":return Qe({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Cr(e.right,t-e.left.length):Qe({_tag:"IConcat",left:Cr(e.left,t),right:e.right});default:return Qe({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Ne=f(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Qe({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Ne(e.right,t);return Qe({_tag:"IConcat",left:e.left,right:r})}else{const r=Ne(e.right.right,t);if(r.depth===e.depth-3){const s=Qe({_tag:"IConcat",left:e.right.left,right:r});return Qe({_tag:"IConcat",left:e.left,right:s})}else{const s=Qe({_tag:"IConcat",left:e.left,right:e.right.left});return Qe({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Ne(e,t.left);return Qe({_tag:"IConcat",left:r,right:t.right})}else{const r=Ne(e,t.left.left);if(r.depth===t.depth-3){const s=Qe({_tag:"IConcat",left:r,right:t.left.right});return Qe({_tag:"IConcat",left:s,right:t.right})}else{const s=Qe({_tag:"IConcat",left:t.left.right,right:t.right});return Qe({_tag:"IConcat",left:r,right:s})}}}),Vv=f(2,(e,t)=>Ze(tv(e,t))),vd=f(2,(e,t)=>Ze(nv(e,t))),Cd=e=>e.length===0,Lr=e=>e.length>0,Id=Tx(0),Td=e=>ss(e,0),sr=Td,Gv=f(2,(e,t)=>e.backing._tag==="ISingleton"?ke(t(e.backing.a,0)):Ze(d(dn(e),Js((n,r)=>t(n,r))))),Qv=f(2,(e,t)=>[vi(e,t),Cr(e,t)]),Rx=f(2,(e,t)=>{let n=0;for(const r of dn(e)){if(t(r))break;n++}return Qv(e,n)}),Ir=e=>Cr(e,1),Px=f(2,(e,t)=>Cr(e,e.length-t)),Fx=jm,Hg=Symbol.for("effect/Duration"),Yv=BigInt(0),s_=BigInt(24),rl=BigInt(60),Jg=BigInt(1e3),o_=BigInt(1e6),i_=BigInt(1e9),Mx=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,pn=e=>{if(Xv(e))return e;if(Ar(e))return da(e);if(cd(e))return fg(e);if(Array.isArray(e)&&e.length===2&&e.every(Ar))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?Zv:e[0]===1/0||e[1]===1/0?Lx:fg(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Gt(e)){const t=Mx.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return fg(BigInt(r));case"micro":case"micros":return Dx(BigInt(r));case"milli":case"millis":return da(o);case"second":case"seconds":return Ym(o);case"minute":case"minutes":return eC(o);case"hour":case"hours":return qx(o);case"day":case"days":return Ux(o);case"week":case"weeks":return jx(o)}}}throw new Error("Invalid DurationInput")},c_={_tag:"Millis",millis:0},xx={_tag:"Infinity"},Ax={[Hg]:Hg,[Y](){return $e(this,Fk(this.value))},[Q](e){return Xv(e)&&Gx(this,e)},toString(){return`Duration(${nC(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:Bx(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},rn=e=>{const t=Object.create(Ax);return Ar(e)?isNaN(e)||e<=0?t.value=c_:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=xx:e<=Yv?t.value=c_:t.value={_tag:"Nanos",nanos:e},t},Xv=e=>j(e,Hg),Nx=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===Yv;case"Infinity":return!1}},Zv=rn(0),Lx=rn(1/0),fg=e=>rn(e),Dx=e=>rn(e*Jg),da=e=>rn(e),Ym=e=>rn(e*1e3),eC=e=>rn(e*6e4),qx=e=>rn(e*36e5),Ux=e=>rn(e*864e5),jx=e=>rn(e*6048e5),Ci=e=>tC(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),zx=e=>{const t=pn(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},Bx=e=>{const t=pn(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/i_),Number(t.value.nanos%i_)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},tC=f(2,(e,t)=>{const n=pn(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Od=f(3,(e,t,n)=>{const r=pn(e),s=pn(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Ci(r),Ci(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),i=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,i)}return n.onMillis(r.value.millis,s.value.millis)}),Kx=(e,t)=>Od(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Wx=f(2,(e,t)=>tC(e,{onMillis:n=>rn(n*t),onNanos:n=>rn(n*BigInt(t))})),Hx=f(2,(e,t)=>Od(e,t,{onMillis:(n,r)=>rn(n+r),onNanos:(n,r)=>rn(n+r)})),Jx=f(2,(e,t)=>Od(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),Vx=f(2,(e,t)=>Od(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Gx=f(2,(e,t)=>Kx(pn(e),pn(t))),Qx=e=>{const t=pn(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=zx(t),r=n/o_,s=r/Jg,o=s/rl,i=o/rl,c=i/s_;return{days:Number(c),hours:Number(i%s_),minutes:Number(o%rl),seconds:Number(s%rl),millis:Number(r%Jg),nanos:Number(n%o_)}},nC=e=>{const t=pn(e);if(t.value._tag==="Infinity")return"Infinity";if(Nx(t))return"0";const n=Qx(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},uo=5,Xm=Math.pow(2,uo),Yx=Xm-1,Xx=Xm/2,Zx=Xm/4;function eA(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Ii(e,t){return t>>>e&Yx}function ei(e){return 1<<e}function rC(e,t){return eA(e&t-1)}const tA=(e,t)=>({value:e,previous:t});function ci(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let i=0;i<o;++i)s[i]=r[i]}return s[t]=n,s}function sC(e,t,n){const r=n.length-1;let s=0,o=0,i=n;if(e)s=o=t;else for(i=new Array(r);s<t;)i[o++]=n[s++];for(++s;s<=r;)i[o++]=n[s++];return e&&(i.length=r),i}function nA(e,t,n,r){const s=r.length;if(e){let u=s;for(;u>=t;)r[u--]=r[u];return r[t]=n,r}let o=0,i=0;const c=new Array(s+1);for(;o<t;)c[i++]=r[o++];for(c[t]=n;o<s;)c[++i]=r[o++];return c}class hs{constructor(){a(this,"_tag","EmptyNode")}modify(t,n,r,s,o,i){const c=r(M());return Ue(c)?new hs:(++i.value,new Vs(t,s,o,c))}}function xn(e){return Om(e,"EmptyNode")}function rA(e){return xn(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function Rd(e,t){return xn(e)?!1:t===e.edit}class Vs{constructor(t,n,r,s){a(this,"edit");a(this,"hash");a(this,"key");a(this,"value");a(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,i){if(H(o,this.key)){const u=r(this.value);return u===this.value?this:Ue(u)?(--i.value,new hs):Rd(this,t)?(this.value=u,this):new Vs(t,s,o,u)}const c=r(M());return Ue(c)?this:(++i.value,oC(t,n,this.hash,this,s,new Vs(t,s,o,c)))}}class Zm{constructor(t,n,r){a(this,"edit");a(this,"hash");a(this,"children");a(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,i){if(s===this.hash){const u=Rd(this,t),l=this.updateCollisionList(u,t,this.hash,this.children,r,o,i);return l===this.children?this:l.length>1?new Zm(t,this.hash,l):l[0]}const c=r(M());return Ue(c)?this:(++i.value,oC(t,n,this.hash,this,s,new Vs(t,s,o,c)))}updateCollisionList(t,n,r,s,o,i,c){const u=s.length;for(let g=0;g<u;++g){const h=s[g];if("key"in h&&H(i,h.key)){const p=h.value,m=o(p);return m===p?s:Ue(m)?(--c.value,sC(t,g,s)):ci(t,g,new Vs(n,r,i,m),s)}}const l=o(M());return Ue(l)?s:(++c.value,ci(t,u,new Vs(n,r,i,l),s))}}class Ti{constructor(t,n,r){a(this,"edit");a(this,"mask");a(this,"children");a(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,i){const c=this.mask,u=this.children,l=Ii(n,s),g=ei(l),h=rC(c,g),p=c&g,m=Rd(this,t);if(!p){const S=new hs().modify(t,n+uo,r,s,o,i);return S?u.length>=Xx?oA(t,l,S,c,u):new Ti(t,c|g,nA(m,h,S,u)):this}const b=u[h],$=b.modify(t,n+uo,r,s,o,i);if(b===$)return this;let _=c,w;if(xn($)){if(_&=~g,!_)return new hs;if(u.length<=2&&rA(u[h^1]))return u[h^1];w=sC(m,h,u)}else w=ci(m,h,$,u);return m?(this.mask=_,this.children=w,this):new Ti(t,_,w)}}class ey{constructor(t,n,r){a(this,"edit");a(this,"size");a(this,"children");a(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,i){let c=this.size;const u=this.children,l=Ii(n,s),g=u[l],h=(g||new hs).modify(t,n+uo,r,s,o,i);if(g===h)return this;const p=Rd(this,t);let m;if(xn(g)&&!xn(h))++c,m=ci(p,l,h,u);else if(!xn(g)&&xn(h)){if(--c,c<=Zx)return sA(t,c,l,u);m=ci(p,l,new hs,u)}else m=ci(p,l,h,u);return p?(this.size=c,this.children=m,this):new ey(t,c,m)}}function sA(e,t,n,r){const s=new Array(t-1);let o=0,i=0;for(let c=0,u=r.length;c<u;++c)if(c!==n){const l=r[c];l&&!xn(l)&&(s[o++]=l,i|=1<<c)}return new Ti(e,i,s)}function oA(e,t,n,r,s){const o=[];let i=r,c=0;for(let u=0;i;++u)i&1&&(o[u]=s[c++]),i>>>=1;return o[t]=n,new ey(e,c+1,o)}function iA(e,t,n,r,s,o){if(n===s)return new Zm(e,n,[o,r]);const i=Ii(t,n),c=Ii(t,s);if(i===c)return u=>new Ti(e,ei(i)|ei(c),[u]);{const u=i<c?[r,o]:[o,r];return new Ti(e,ei(i)|ei(c),u)}}function oC(e,t,n,r,s,o){let i,c=t;for(;;){const u=iA(e,c,n,r,s,o);if(typeof u=="function")i=tA(u,i),c=c+uo;else{let l=u;for(;i!=null;)l=i.value(l),i=i.previous;return l}}}const iC="effect/HashMap",Vg=Symbol.for(iC),cA={[Vg]:Vg,[Symbol.iterator](){return new Pd(this,(e,t)=>[e,t])},[Y](){let e=A(iC);for(const t of this)e^=d(A(t[0]),J(A(t[1])));return $e(this,e)},[Q](e){if(lA(e)){if(e._size!==this._size)return!1;for(const t of this){const n=d(e,ny(t[0],A(t[0])));if(Ue(n))return!1;if(!H(t[1],n.value))return!1}return!0}return!1},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(Le)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},ty=(e,t,n,r)=>{const s=Object.create(cA);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Pd{constructor(t,n){a(this,"map");a(this,"f");a(this,"v");this.map=t,this.f=n,this.v=cC(this.map._root,this.f,void 0)}next(){if(Ue(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=af(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Pd(this.map,this.f)}}const af=e=>e?aC(e[0],e[1],e[2],e[3],e[4]):M(),cC=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return _e(e.value)?x({value:t(e.key,e.value.value),cont:n}):af(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return aC(r.length,r,0,t,n)}default:return af(n)}},aC=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!xn(o))return cC(o,r,[e,t,n,r,s])}return af(s)},aA=ty(!1,0,new hs,0),Fd=()=>aA,uA=e=>{const t=lC(Fd());for(const n of e)ha(t,n[0],n[1]);return pA(t)},lA=e=>j(e,Vg),fA=e=>e&&xn(e._root),dA=f(2,(e,t)=>ny(e,t,A(t))),ny=f(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return H(t,r.key)?r.value:M();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let i=0,c=o.length;i<c;++i){const u=o[i];if("key"in u&&H(t,u.key))return u.value}}return M()}case"IndexedNode":{const o=Ii(s,n),i=ei(o);if(r.mask&i){r=r.children[rC(r.mask,i)],s+=uo;break}return M()}case"ArrayNode":{if(r=r.children[Ii(s,n)],r){s+=uo;break}return M()}default:return M()}}),hA=f(2,(e,t)=>_e(ny(e,t,A(t)))),ha=f(3,(e,t,n)=>ry(e,t,()=>x(n))),gA=f(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:ty(e._editable,e._edit,t,n)),uC=e=>new Pd(e,t=>t),uf=e=>e._size,lC=e=>ty(!0,e._edit+1,e._root,e._size),pA=e=>(e._editable=!1,e),ry=f(3,(e,t,n)=>mA(e,t,A(t),n)),mA=f(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return d(e,gA(o,s.value))}),a_=f(2,(e,t)=>ry(e,t,M)),yA=f(2,(e,t)=>Md(e,Fd(),(n,r,s)=>ha(n,s,t(r,s)))),fC=f(2,(e,t)=>Md(e,void 0,(n,r,s)=>t(r,s))),Md=f(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return _e(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let i=0,c=o.length;i<c;){const u=o[i++];u&&!xn(u)&&(u._tag==="LeafNode"?_e(u.value)&&(t=n(t,u.value.value,u.key)):s.push(u.children))}return t}),dC="effect/HashSet",Gg=Symbol.for(dC),bA={[Gg]:Gg,[Symbol.iterator](){return uC(this._keyMap)},[Y](){return $e(this,J(A(this._keyMap))(A(dC)))},[Q](e){return SA(e)?uf(this._keyMap)===uf(e._keyMap)&&H(this._keyMap,e._keyMap):!1},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(Le)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},xd=e=>{const t=Object.create(bA);return t._keyMap=e,t},SA=e=>j(e,Gg),_A=xd(Fd()),Ad=()=>_A,wA=e=>{const t=sy(Ad());for(const n of e)ga(t,n);return oy(t)},$A=(...e)=>{const t=sy(Ad());for(const n of e)ga(t,n);return oy(t)},EA=f(2,(e,t)=>hA(e._keyMap,t)),kA=e=>uf(e._keyMap),sy=e=>xd(lC(e._keyMap)),oy=e=>(e._keyMap._editable=!1,e),hC=f(2,(e,t)=>{const n=sy(e);return t(n),oy(n)}),ga=f(2,(e,t)=>e._keyMap._editable?(ha(t,!0)(e._keyMap),e):xd(ha(t,!0)(e._keyMap))),gC=f(2,(e,t)=>e._keyMap._editable?(a_(t)(e._keyMap),e):xd(a_(t)(e._keyMap))),vA=f(2,(e,t)=>hC(e,n=>{for(const r of t)gC(n,r)})),CA=f(2,(e,t)=>hC(Ad(),n=>{IA(e,r=>ga(n,r));for(const r of t)ga(n,r)})),IA=f(2,(e,t)=>fC(e._keyMap,(n,r)=>t(r))),TA=f(3,(e,t,n)=>Md(e._keyMap,t,(r,s,o)=>n(r,o))),lo=Ad,OA=wA,Nd=$A,iy=EA,cy=kA,ai=ga,ay=gC,u_=vA,pa=CA,ma=TA,l_=Symbol.for("effect/MutableRef"),RA={[l_]:l_,toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableRef",current:Le(this.current)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},Oo=e=>{const t=Object.create(RA);return t.current=e,t},PA=f(3,(e,t,n)=>H(t,e.current)?(e.current=n,!0):!1),le=e=>e.current,Ro=f(2,(e,t)=>(e.current=t,e)),Ld="effect/FiberId",fo=Symbol.for(Ld),Oi="None",Qg="Runtime",Yg="Composite",FA=it(`${Ld}-${Oi}`);var L$;let MA=class{constructor(){a(this,L$,fo);a(this,"_tag",Oi);a(this,"id",-1);a(this,"startTimeMillis",-1)}[(L$=fo,Y)](){return FA}[Q](t){return ly(t)&&t._tag===Oi}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[fe](){return this.toJSON()}};var D$;class uy{constructor(t,n){a(this,"id");a(this,"startTimeMillis");a(this,D$,fo);a(this,"_tag",Qg);this.id=t,this.startTimeMillis=n}[(D$=fo,Y)](){return $e(this,it(`${Ld}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[Q](t){return ly(t)&&t._tag===Qg&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[fe](){return this.toJSON()}}var q$;let pC=class{constructor(t,n){a(this,"left");a(this,"right");a(this,q$,fo);a(this,"_tag",Yg);a(this,"_hash");this.left=t,this.right=n}[(q$=fo,Y)](){return d(it(`${Ld}-${this._tag}`),J(A(this.left)),J(A(this.right)),$e(this))}[Q](t){return ly(t)&&t._tag===Yg&&H(this.left,t.left)&&H(this.right,t.right)}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:Le(this.left),right:Le(this.right)}}[fe](){return this.toJSON()}};const mC=new MA,xA=(e,t)=>new uy(e,t),AA=(e,t)=>new pC(e,t),ly=e=>j(e,fo),yC=f(2,(e,t)=>e._tag===Oi?t:t._tag===Oi?e:new pC(e,t)),NA=e=>d(e,ma(mC,(t,n)=>yC(n)(t))),lf=e=>{switch(e._tag){case Oi:return lo();case Qg:return Nd(e.id);case Yg:return d(lf(e.left),pa(lf(e.right)))}},f_=ee(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Oo(0)),LA=(e,t)=>new uy(e,t),Dd=e=>Array.from(lf(e)).map(n=>`#${n}`).join(","),DA=()=>{const e=le(f_);return d(f_,Ro(e+1)),new uy(e,Date.now())},Cn=mC,qA=xA,UA=AA,Gs=yC,jA=NA,fy=lf,bC=LA,zA=Dd,SC=DA,qd=Fd,BA=uA,KA=fA,_C=dA,ff=ha,wC=uC,$C=uf,WA=ry,HA=yA,JA=fC,EC=Md,ya=Symbol.for("effect/List"),Xg=e=>pe(e),VA=e=>_P(pd(e),Xg),GA=VA(H),QA={[ya]:ya,_tag:"Cons",toString(){return Oe(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Xg(this).map(Le)}},[fe](){return this.toJSON()},[Q](e){return vC(e)&&this._tag===e._tag&&GA(this,e)},[Y](){return $e(this,tu(Xg(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return D(this,arguments)}},df=(e,t)=>{const n=Object.create(QA);return n.head=e,n.tail=t,n},YA=it("Nil"),XA={[ya]:ya,_tag:"Nil",toString(){return Oe(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[fe](){return this.toJSON()},[Y](){return YA},[Q](e){return vC(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return D(this,arguments)}},kC=Object.create(XA),vC=e=>j(e,ya),Rr=e=>e._tag==="Nil",dy=e=>e._tag==="Cons",ZA=()=>kC,ho=(e,t)=>df(e,t),Ri=ZA,hy=e=>df(e,kC),eN=f(2,(e,t)=>nN(t,e)),tN=f(2,(e,t)=>ho(t,e)),nN=f(2,(e,t)=>{if(Rr(e))return t;if(Rr(t))return e;{const n=df(t.head,e);let r=n,s=t.tail;for(;!Rr(s);){const o=df(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),rN=f(3,(e,t,n)=>{let r=t,s=e;for(;!Rr(s);)r=n(r,s.head),s=s.tail;return r}),sN=e=>{let t=Ri(),n=e;for(;!Rr(n);)t=tN(t,n.head),n=n.tail;return t},Ud=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=xm,e}(),oN=Symbol.for("effect/DifferContextPatch");function d_(e){return e}const lu={...Ud.prototype,[oN]:{_Value:d_,_Patch:d_}},iN=Object.assign(Object.create(lu),{_tag:"Empty"}),cN=Object.create(iN),CC=()=>cN,aN=Object.assign(Object.create(lu),{_tag:"AndThen"}),uN=(e,t)=>{const n=Object.create(aN);return n.first=e,n.second=t,n},lN=Object.assign(Object.create(lu),{_tag:"AddService"}),fN=(e,t)=>{const n=Object.create(lN);return n.key=e,n.service=t,n},dN=Object.assign(Object.create(lu),{_tag:"RemoveService"}),hN=e=>{const t=Object.create(dN);return t.key=e,t},gN=Object.assign(Object.create(lu),{_tag:"UpdateService"}),pN=(e,t)=>{const n=Object.create(gN);return n.key=e,n.update=t,n},mN=(e,t)=>{const n=new Map(e.unsafeMap);let r=CC();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const i=n.get(s);n.delete(s),H(i,o)||(r=Cl(pN(s,()=>o))(r))}else n.delete(s),r=Cl(fN(s,o))(r);for(const[s]of n.entries())r=Cl(hN(s))(r);return r},Cl=f(2,(e,t)=>uN(e,t)),yN=f(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=ke(e);const s=new Map(t.unsafeMap);for(;Lr(r);){const i=sr(r),c=Ir(r);switch(i._tag){case"Empty":{r=c;break}case"AddService":{s.set(i.key,i.service),r=c;break}case"AndThen":{r=Ft(Ft(c,i.second),i.first);break}case"RemoveService":{s.delete(i.key),r=c;break}case"UpdateService":{s.set(i.key,i.update(s.get(i.key))),n=!0,r=c;break}}}if(!n)return co(s);const o=new Map;for(const[i]of t.unsafeMap)s.has(i)&&(o.set(i,s.get(i)),s.delete(i));for(const[i,c]of s)o.set(i,c);return co(o)}),bN=Symbol.for("effect/DifferHashSetPatch");function dg(e){return e}const jd={...Ud.prototype,[bN]:{_Value:dg,_Key:dg,_Patch:dg}},SN=Object.assign(Object.create(jd),{_tag:"Empty"}),_N=Object.create(SN),IC=()=>_N,wN=Object.assign(Object.create(jd),{_tag:"AndThen"}),$N=(e,t)=>{const n=Object.create(wN);return n.first=e,n.second=t,n},EN=Object.assign(Object.create(jd),{_tag:"Add"}),kN=e=>{const t=Object.create(EN);return t.value=e,t},vN=Object.assign(Object.create(jd),{_tag:"Remove"}),CN=e=>{const t=Object.create(vN);return t.value=e,t},IN=(e,t)=>{const[n,r]=ma([e,IC()],([s,o],i)=>iy(i)(s)?[ay(i)(s),o]:[s,Zg(kN(i))(o)])(t);return ma(r,(s,o)=>Zg(CN(o))(s))(n)},Zg=f(2,(e,t)=>$N(e,t)),TN=f(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=ke(e);for(;Lr(r);){const s=sr(r),o=Ir(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=Ft(s.first)(Ft(s.second)(o));break}case"Add":{n=ai(s.value)(n),r=o;break}case"Remove":n=ay(s.value)(n),r=o}}return n}),ON=Symbol.for("effect/DifferReadonlyArrayPatch");function h_(e){return e}const fu={...Ud.prototype,[ON]:{_Value:h_,_Patch:h_}},RN=Object.assign(Object.create(fu),{_tag:"Empty"}),PN=Object.create(RN),TC=()=>PN,FN=Object.assign(Object.create(fu),{_tag:"AndThen"}),MN=(e,t)=>{const n=Object.create(FN);return n.first=e,n.second=t,n},xN=Object.assign(Object.create(fu),{_tag:"Append"}),AN=e=>{const t=Object.create(xN);return t.values=e,t},NN=Object.assign(Object.create(fu),{_tag:"Slice"}),LN=(e,t)=>{const n=Object.create(NN);return n.from=e,n.until=t,n},DN=Object.assign(Object.create(fu),{_tag:"Update"}),qN=(e,t)=>{const n=Object.create(DN);return n.index=e,n.patch=t,n},UN=e=>{let t=0,n=TC();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);H(o,e.differ.empty)||(n=Il(n,qN(t,o))),t=t+1}return t<e.oldValue.length&&(n=Il(n,LN(0,t))),t<e.newValue.length&&(n=Il(n,AN(KF(t)(e.newValue)))),n},Il=f(2,(e,t)=>MN(e,t)),jN=f(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=Pn(e);for(;El(s);){const o=Ht(s),i=oo(s);switch(o._tag){case"Empty":{s=i;break}case"AndThen":{i.unshift(o.first,o.second),s=i;break}case"Append":{for(const c of o.values)r.push(c);s=i;break}case"Slice":{r=r.slice(o.from,o.until),s=i;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=i;break}}}return r}),zN=Symbol.for("effect/Differ"),BN={[zN]:{_P:K,_V:K},pipe(){return D(this,arguments)}},rc=e=>{const t=Object.create(BN);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},KN=()=>rc({empty:CC(),combine:(e,t)=>Cl(t)(e),diff:(e,t)=>mN(e,t),patch:(e,t)=>yN(t)(e)}),WN=()=>rc({empty:IC(),combine:(e,t)=>Zg(t)(e),diff:(e,t)=>IN(e,t),patch:(e,t)=>TN(t)(e)}),HN=e=>rc({empty:TC(),combine:(t,n)=>Il(t,n),diff:(t,n)=>UN({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>jN(t,n,e)}),OC=()=>JN((e,t)=>t),JN=e=>rc({empty:K,combine:(t,n)=>t===K?n:n===K?t:r=>n(t(r)),diff:(t,n)=>H(t,n)?K:od(n),patch:(t,n)=>e(n,t(n))}),ba=255,RC=8,ep=e=>e&ba,tp=e=>e>>RC&ba,du=(e,t)=>(e&ba)+((t&e&ba)<<RC),VN=du(0,0),GN=e=>du(e,e),QN=e=>du(e,0),YN=f(2,(e,t)=>du(ep(e)&~t,tp(e))),XN=f(2,(e,t)=>e|t),ZN=e=>~e>>>0&ba,e2=0,sc=1,t2=2,PC=4,np=16,FC=32,n2=e=>zd(e,FC),r2=f(2,(e,t)=>e|t),Yr=e=>MC(e)&&!o2(e),MC=e=>zd(e,sc),zd=f(2,(e,t)=>(e&t)!==0),xC=(...e)=>e.reduce((t,n)=>t|n,0),s2=xC(e2),g_=e=>zd(e,PC),o2=e=>zd(e,np),os=f(2,(e,t)=>du(e^t,t)),ui=f(2,(e,t)=>e&(ZN(ep(t))|tp(t))|ep(t)&tp(t)),p_=rc({empty:VN,diff:(e,t)=>os(e,t),combine:(e,t)=>XN(t)(e),patch:(e,t)=>ui(t,e)}),i2=GN,AC=QN,m_=YN,NC=(e,t)=>({_tag:"Par",left:e,right:t}),sl=(e,t)=>({_tag:"Seq",left:e,right:t}),c2=e=>{let t=hy(e),n=Ri();for(;;){const[r,s]=rN(t,[LC(),Ri()],([o,i],c)=>{const[u,l]=a2(c);return[h2(o,u),eN(i,l)]});if(n=u2(n,r),Rr(s))return sN(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},a2=e=>{let t=e,n=LC(),r=Ri(),s=Ri();for(;;)switch(t._tag){case"Empty":{if(Rr(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=ho(t.right,r),t=t.left;break}case"Seq":{const o=t.left,i=t.right;switch(o._tag){case"Empty":{t=i;break}case"Par":{const c=o.left,u=o.right;t=NC(sl(c,i),sl(u,i));break}case"Seq":{const c=o.left,u=o.right;t=sl(c,sl(u,i));break}case"Single":{t=o,s=ho(i,s);break}}break}case"Single":{if(n=d2(n,t),Rr(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},u2=(e,t)=>{if(Rr(e))return hy(hg(t));if(g2(t))return e;const n=_2(e.head),r=p2(t);return n.length===1&&r.length===1&&H(n[0],r[0])?ho(S2(e.head,hg(t)),e.tail):ho(hg(t),e)},l2=Symbol.for("effect/RequestBlock/RequestBlockParallel"),f2={_R:e=>e};var U$;U$=l2;class gy{constructor(t){a(this,"map");a(this,U$,f2);this.map=t}}const LC=()=>new gy(qd()),d2=(e,t)=>new gy(WA(e.map,t.dataSource,n=>gF(Hs(n,fa(t.blockedRequest)),()=>ke(t.blockedRequest)))),h2=(e,t)=>new gy(EC(e.map,t.map,(n,r,s)=>ff(n,s,Re(_C(n,s),{onNone:()=>r,onSome:o=>Ne(r,o)})))),g2=e=>KA(e.map),p2=e=>Array.from(wC(e.map)),hg=e=>b2(HA(e.map,t=>ke(t))),m2=Symbol.for("effect/RequestBlock/RequestBlockSequential"),y2={_R:e=>e};var j$;j$=m2;class DC{constructor(t){a(this,"map");a(this,j$,y2);this.map=t}}const b2=e=>new DC(e),S2=(e,t)=>new DC(EC(t.map,e.map,(n,r,s)=>ff(n,s,Re(_C(n,s),{onNone:()=>xe(),onSome:o=>Ne(o,r)})))),_2=e=>Array.from(wC(e.map)),w2=e=>Array.from(e.map),oc="Die",go="Empty",Po="Fail",ic="Interrupt",Pi="Parallel",Fi="Sequential",qC="effect/Cause",UC=Symbol.for(qC),$2={_E:e=>e},cc={[UC]:$2,[Y](){return d(A(qC),J(A(P2(this))),$e(this))},[Q](e){return py(e)&&R2(this,e)},pipe(){return D(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:Le(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:Le(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:Le(this.left),right:Le(this.right)}}},toString(){return $s(this)},[fe](){return this.toJSON()}},Dr=(()=>{const e=Object.create(cc);return e._tag=go,e})(),po=e=>{const t=Object.create(cc);return t._tag=Po,t.error=e,t},Jt=e=>{const t=Object.create(cc);return t._tag=oc,t.defect=e,t},$n=e=>{const t=Object.create(cc);return t._tag=ic,t.fiberId=e,t},qr=(e,t)=>{const n=Object.create(cc);return n._tag=Pi,n.left=e,n.right=t,n},lt=(e,t)=>{const n=Object.create(cc);return n._tag=Fi,n.left=e,n.right=t,n},py=e=>j(e,UC),E2=e=>e._tag===go,k2=e=>e._tag===Po,my=e=>e._tag===oc,yy=e=>e._tag===go?!0:Mi(e,!0,(t,n)=>{switch(n._tag){case go:return x(t);case oc:case Po:case ic:return x(!1);default:return M()}}),by=e=>_e(I2(e)),Bd=e=>Hd(void 0,M2)(e),v2=e=>Nr(Mi(e,xe(),(t,n)=>n._tag===Po?x(d(t,Ft(n.error))):M())),jC=e=>Nr(Mi(e,xe(),(t,n)=>n._tag===oc?x(d(t,Ft(n.defect))):M())),Sy=e=>Mi(e,lo(),(t,n)=>n._tag===ic?x(d(t,ai(n.fiberId))):M()),zC=e=>Kd(e,t=>t._tag===Po?x(t.error):M()),_y=e=>{const t=zC(e);switch(t._tag){case"None":return V(e);case"Some":return W(t.value)}},C2=e=>Wd(e,{onEmpty:x(Dr),onFail:Hs(po),onDie:t=>x(Jt(t)),onInterrupt:t=>x($n(t)),onSequential:WS(lt),onParallel:WS(qr)}),I2=e=>Kd(e,t=>t._tag===ic?x(t.fiberId):M()),y_=e=>Wd(e,{onEmpty:Dr,onFail:()=>Dr,onDie:Jt,onInterrupt:$n,onSequential:lt,onParallel:qr}),T2=e=>Wd(e,{onEmpty:Dr,onFail:Jt,onDie:Jt,onInterrupt:$n,onSequential:lt,onParallel:qr}),BC=f(2,(e,t)=>O2(e,n=>po(t(n)))),O2=f(2,(e,t)=>Wd(e,{onEmpty:Dr,onFail:n=>t(n),onDie:n=>Jt(n),onInterrupt:n=>$n(n),onSequential:(n,r)=>lt(n,r),onParallel:(n,r)=>qr(n,r)})),R2=(e,t)=>{let n=ke(e),r=ke(t);for(;Lr(n)&&Lr(r);){const[s,o]=d(sr(n),Mi([lo(),xe()],([u,l],g)=>{const[h,p]=rp(g);return x([d(u,pa(h)),d(l,Ne(p))])})),[i,c]=d(sr(r),Mi([lo(),xe()],([u,l],g)=>{const[h,p]=rp(g);return x([d(u,pa(h)),d(l,Ne(p))])}));if(!H(s,i))return!1;n=o,r=c}return!0},P2=e=>F2(ke(e),xe()),F2=(e,t)=>{for(;;){const[n,r]=d(e,jm([lo(),xe()],([o,i],c)=>{const[u,l]=rp(c);return[d(o,pa(u)),d(i,Ne(l))]})),s=cy(n)>0?d(t,Ft(n)):t;if(Cd(r))return Nr(s);e=r,t=s}throw new Error(ud("Cause.flattenCauseLoop"))},Kd=f(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Fi:case Pi:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return M()}),rp=e=>{let t=e;const n=[];let r=lo(),s=xe();for(;t!==void 0;)switch(t._tag){case go:{if(n.length===0)return[r,s];t=n.pop();break}case Po:{if(r=ai(r,lg(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case oc:{if(r=ai(r,lg(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case ic:{if(r=ai(r,lg(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Fi:{switch(t.left._tag){case go:{t=t.right;break}case Fi:{t=lt(t.left.left,lt(t.left.right,t.right));break}case Pi:{t=qr(lt(t.left.left,t.right),lt(t.left.right,t.right));break}default:{s=Ft(s,t.right),t=t.left;break}}break}case Pi:{n.push(t.right),t=t.left;break}}throw new Error(ud("Cause.evaluateCauseLoop"))},M2={emptyCase:BS,failCase:An,dieCase:An,interruptCase:BS,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},b_="SequentialCase",S_="ParallelCase",Wd=f(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:i})=>Hd(e,void 0,{emptyCase:()=>n,failCase:(c,u)=>r(u),dieCase:(c,u)=>t(u),interruptCase:(c,u)=>s(u),sequentialCase:(c,u,l)=>i(u,l),parallelCase:(c,u,l)=>o(u,l)})),Mi=f(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const i=n(r,s);switch(r=_e(i)?i.value:r,s._tag){case Fi:{o.push(s.right),s=s.left;break}case Pi:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Hd=f(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const i=r.pop();switch(i._tag){case go:{s.push(V(n.emptyCase(t)));break}case Po:{s.push(V(n.failCase(t,i.error)));break}case oc:{s.push(V(n.dieCase(t,i.defect)));break}case ic:{s.push(V(n.interruptCase(t,i.fiberId)));break}case Fi:{r.push(i.right),r.push(i.left),s.push(W({_tag:b_}));break}case Pi:{r.push(i.right),r.push(i.left),s.push(W({_tag:S_}));break}}}const o=[];for(;s.length>0;){const i=s.pop();switch(i._tag){case"Left":{switch(i.left._tag){case b_:{const c=o.pop(),u=o.pop(),l=n.sequentialCase(t,c,u);o.push(l);break}case S_:{const c=o.pop(),u=o.pop(),l=n.parallelCase(t,c,u);o.push(l);break}}break}case"Right":{o.push(i.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),$s=(e,t)=>Bd(e)?"All fibers interrupted without errors.":HC(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${KC(n.cause,"  ")}
}`}).join(`
`),KC=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${KC(e.cause,`${t}  `)}
${t}}`),r};class hf extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(WC(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new hf(n.cause)}:void 0);a(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(xi in n&&(this.span=n[xi]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=A2(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const WC=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(j(e,"toString")&&eu(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return Mk(e)},x2=/\((.*)\)/g,gf=ee("effect/Tracer/spanToTrace",()=>new WeakMap),A2=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,i=0;for(;o&&o._tag==="Span"&&i<10;){const c=gf.get(o);if(typeof c=="function"){const u=c();if(typeof u=="string"){const l=u.matchAll(x2);let g=!1;for(const[,h]of l)g=!0,r.push(`    at ${o.name} (${h})`);g||r.push(`    at ${o.name} (${u.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=Fn(o.parent),i++}}return r.join(`
`)},xi=Symbol.for("effect/SpanAnnotation"),HC=e=>Hd(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new hf(n)],failCase:(t,n)=>[new hf(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),hu="Pending",Jd="Done",N2="effect/Deferred",JC=Symbol.for(N2),L2={_E:e=>e,_A:e=>e},D2=e=>({_tag:hu,joiners:e}),VC=e=>({_tag:Jd,effect:e});class ac{constructor(t){a(this,"self");a(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new ac(this.self)}}const GC=(e,t)=>{const n=new dt("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},q2=e=>{const t=new dt("RunBlocked");return t.effect_instruction_i0=e,t},mo=Symbol.for("effect/Effect");class U2{constructor(t,n){a(this,"patch");a(this,"op");a(this,"_op",Mm);this.patch=t,this.op=n}}var z$;class dt{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,z$,so);this._op=t}[(z$=mo,Q)](t){return this===t}[Y](){return $e(this,ld(this))}pipe(){return D(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:Le(this.effect_instruction_i0),effect_instruction_i1:Le(this.effect_instruction_i1),effect_instruction_i2:Le(this.effect_instruction_i2)}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new ac(new Xi(this))}}var B$;class QC{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,B$,so);this._op=t,this._tag=t}[(B$=mo,Q)](t){return Zd(t)&&t._op==="Failure"&&H(this.effect_instruction_i0,t.effect_instruction_i0)}[Y](){return d(it(this._tag),J(A(this.effect_instruction_i0)),$e(this))}get cause(){return this.effect_instruction_i0}pipe(){return D(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new ac(new Xi(this))}}var K$;class YC{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,K$,so);this._op=t,this._tag=t}[(K$=mo,Q)](t){return Zd(t)&&t._op==="Success"&&H(this.effect_instruction_i0,t.effect_instruction_i0)}[Y](){return d(it(this._tag),J(A(this.effect_instruction_i0)),$e(this))}get value(){return this.effect_instruction_i0}pipe(){return D(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:Le(this.value)}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new ac(new Xi(this))}}const yn=e=>j(e,mo),oe=e=>{const t=new dt(Nk);return t.effect_instruction_i0=e,t},wy=f(3,(e,t,n)=>Qt(r=>k(e,s=>k(Ln(B(()=>r(t(s)))),o=>B(()=>n(s,o)).pipe(sn({onFailure:i=>{switch(o._tag){case St:return Be(lt(o.effect_instruction_i0,i));case _t:return Be(i)}},onSuccess:()=>o})))))),rt=f(2,(e,t)=>k(e,()=>R(t))),cn=e=>rt(e,void 0),XC=function(){const e=new dt(nu);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(ud("you're not supposed to end up here"))}return e},Sa=(e,t=Cn)=>{const n=new dt(Hc);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,Es(n,s=>yn(r)?r:ne)},es=(e,t=Cn)=>B(()=>Sa(e,t)),Un=(e,t=Cn)=>XC(e,function(){let n,r;function s(u){n?n(u):r===void 0&&(r=u)}const o=new dt(Hc);o.effect_instruction_i0=u=>{n=u,r&&u(r)},o.effect_instruction_i1=t;let i,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,i=Pe(()=>this.effect_instruction_i0(s,c.signal))):i=Pe(()=>this.effect_instruction_i0(s)),i||c?Es(o,u=>(c&&c.abort(),i??ne)):o}),gu=f(2,(e,t)=>{const n=new dt(wl);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),Ai=f(2,(e,t)=>ar(e,{onFailure:t,onSuccess:R})),ZC=f(3,(e,t,n)=>gu(e,r=>{const s=_y(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):Be(r);case"Right":return Be(s.right)}})),__=Symbol.for("effect/OriginalAnnotation"),$y=(e,t)=>_e(t)?new Proxy(e,{has(n,r){return r===xi||r===__||r in n},get(n,r){return r===xi?t.value:r===__?e:n[r]}}):e,_a=e=>hr(e)&&!(xi in e)?oe(t=>Be(Jt($y(e,Ly(t))))):Be(Jt(e)),sp=e=>eI(()=>Jt(new _L(e))),Ni=e=>ar(e,{onFailure:t=>R(W(t)),onSuccess:t=>R(V(t))}),Ln=e=>tI(e,{onFailure:ye,onSuccess:de}),Me=e=>hr(e)&&!(xi in e)?oe(t=>Be(po($y(e,Ly(t))))):Be(po(e)),pu=e=>k(O(e),Me),Be=e=>{const t=new QC(St);return t.effect_instruction_i0=e,t},eI=e=>k(O(e),Be),mu=oe(e=>R(e.id())),Fo=e=>oe(t=>e(t.id())),k=f(2,(e,t)=>{const n=new dt(Jl);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),j2=f(2,(e,t)=>k(e,n=>{const r=typeof t=="function"?t(n):t;return yn(r)?r:Tk(r)?Sa(s=>{r.then(o=>s(R(o)),o=>s(Me(new Xd(o,"An unknown error occurred in Effect.andThen"))))}):R(r)})),z2=e=>{const t=new dt("OnStep");return t.effect_instruction_i0=e,t},uc=e=>k(e,K),tI=f(2,(e,t)=>sn(e,{onFailure:n=>R(t.onFailure(n)),onSuccess:n=>R(t.onSuccess(n))})),sn=f(2,(e,t)=>{const n=new dt(Vl);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),ar=f(2,(e,t)=>sn(e,{onFailure:n=>{if(jC(n).length>0)return Be(T2(n));const s=v2(n);return s.length>0?t.onFailure(Td(s)):Be(n)},onSuccess:t.onSuccess})),Tr=f(2,(e,t)=>B(()=>{const n=pe(e),r=gd(n.length);let s=0;return rt(Iy({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),yo=f(2,(e,t)=>B(()=>{const n=pe(e);let r=0;return Iy({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),st=k(mu,e=>Ey(e)),Ey=e=>Be($n(e)),Li=e=>{const t=new dt(Zi);return t.effect_instruction_i0=i2(sc),t.effect_instruction_i1=()=>e,t},ky=f(2,(e,t)=>Qt(n=>k(Ln(n(e)),r=>gI(t,r)))),G=f(2,(e,t)=>k(e,n=>O(()=>t(n)))),vy=f(2,(e,t)=>ar(e,{onFailure:n=>pu(()=>t.onFailure(n)),onSuccess:n=>O(()=>t.onSuccess(n))})),Vd=f(2,(e,t)=>sn(e,{onFailure:n=>{const r=_y(n);switch(r._tag){case"Left":return pu(()=>t(r.left));case"Right":return Be(r.right)}},onSuccess:R})),B2=f(2,(e,t)=>ur(e,n=>dI(n)?ne:t(n.effect_instruction_i0))),ur=f(2,(e,t)=>Qt(n=>sn(n(e),{onFailure:r=>{const s=ye(r);return sn(t(s),{onFailure:o=>ye(lt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=de(r);return ge(t(s),s)}}))),Es=f(2,(e,t)=>ur(e,eh({onFailure:n=>Bd(n)?cn(t(Sy(n))):ne,onSuccess:()=>ne}))),Cy=e=>K2(e,K),K2=f(2,(e,t)=>ar(e,{onFailure:n=>_a(t(n)),onSuccess:R})),W2=oe((e,t)=>R(t.runtimeFlags)),R=e=>{const t=new YC(_t);return t.effect_instruction_i0=e,t},B=e=>{const t=new dt(nu);return t.commit=e,t},O=e=>{const t=new dt(Ak);return t.effect_instruction_i0=e,t},Ur=f(e=>e.length===3||e.length===2&&!(hr(e[1])&&"onlyEffect"in e[1]),(e,t)=>k(e,n=>{const r=typeof t=="function"?t(n):t;return yn(r)?rt(r,n):Tk(r)?Sa(s=>{r.then(o=>s(R(n)),o=>s(Me(new Xd(o,"An unknown error occurred in Effect.tap"))))}):R(n)})),H2=e=>oe(t=>{const n=t.getFiberRef(ip),r=d(n,je(()=>t.scope()));return e(Mo(ip,x(r)))}),Wr=e=>{const t=new dt(Zi);return t.effect_instruction_i0=AC(sc),t.effect_instruction_i1=()=>e,t},Qt=e=>XC(e,function(){const t=new dt(Zi);return t.effect_instruction_i0=AC(sc),t.effect_instruction_i1=n=>MC(n)?Pe(()=>this.effect_instruction_i0(Li)):Pe(()=>this.effect_instruction_i0(Wr)),t}),ne=R(void 0),nI=e=>{const t=new dt(Zi);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},yu=f(2,(e,t)=>k(t,n=>n?d(e,G(x)):R(M()))),Iy=e=>{const t=new dt(Gl);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},pf=e=>B(()=>{const t=new dt(Jc);return t.effect_instruction_i0=e(),t}),J2=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return pf(()=>e(d))},V2=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return pf(()=>e.apply(this,n))}:function(...n){let r=pf(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),G2=f(2,(e,t)=>{const n=new dt(Zi);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),bu=e=>{const t=new dt($l);return typeof(e==null?void 0:e.priority)<"u"?dL(t,e.priority):t},Gd=f(2,(e,t)=>k(e,n=>G(t,r=>[n,r]))),is=f(2,(e,t)=>k(e,n=>rt(t,n))),ge=f(2,(e,t)=>k(e,()=>t)),rI=f(3,(e,t,n)=>k(e,r=>G(t,s=>n(r,s)))),Q2=es(()=>{const e=setInterval(()=>{},2147483647);return O(()=>clearInterval(e))}),wa=e=>k(mu,t=>d(e,Or(t))),Or=f(2,(e,t)=>k(e.interruptAsFork(t),()=>e.await)),Y2={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return D(this,arguments)}},X2={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return D(this,arguments)}},Z2={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return D(this,arguments)}},eL={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return D(this,arguments)}},sI={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return D(this,arguments)}},oI={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return D(this,arguments)}},tL={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return D(this,arguments)}},nL={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return D(this,arguments)}},rL="effect/FiberRef",sL=Symbol.for(rL),oL={_A:e=>e},Su=e=>oe(t=>de(t.getFiberRef(e))),lc=f(2,(e,t)=>k(Su(e),t)),mf=f(2,(e,t)=>iL(e,()=>[void 0,t])),iL=f(2,(e,t)=>oe(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),R(r)})),Mo=f(3,(e,t,n)=>wy(is(Su(t),mf(t,n)),()=>e,r=>mf(t,r))),Ty=f(3,(e,t,n)=>lc(t,r=>Mo(e,t,n(r)))),kt=(e,t)=>fc(e,{differ:OC(),fork:(t==null?void 0:t.fork)??K,join:t==null?void 0:t.join}),cL=e=>{const t=WN();return fc(e,{differ:t,fork:t.empty})},aL=e=>{const t=HN(OC());return fc(e,{differ:t,fork:t.empty})},iI=e=>{const t=KN();return fc(e,{differ:t,fork:t.empty})},fc=(e,t)=>({...su,[sL]:oL,initial:e,commit(){return Su(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),uL=e=>fc(e,{differ:p_,fork:p_.empty}),Wn=ee(Symbol.for("effect/FiberRef/currentContext"),()=>iI(ds())),xo=ee(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>kt(0)),cI=ee(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>kt(2048)),aI=ee(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>kt(qd())),lL=ee(Symbol.for("effect/FiberRef/currentLogLevel"),()=>kt(sI)),fL=ee(Symbol.for("effect/FiberRef/currentLogSpan"),()=>kt(Ri())),dL=f(2,(e,t)=>Mo(e,xo,t)),hL=ee(Symbol.for("effect/FiberRef/currentConcurrency"),()=>kt("unbounded")),gL=ee(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>kt(!0)),Oy=ee(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>kt(x(oI))),pL=f(2,(e,t)=>Mo(e,Oy,t)),op=ee(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>aL(fs())),ip=ee(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>kt(M(),{fork:()=>M(),join:(e,t)=>e})),ol=ee(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>kt(Dr,{fork:()=>Dr,join:(e,t)=>e})),uI=ee(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>kt(!0)),Qd=ee(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>kt(!0)),mL=ee(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>kt(qd())),yL=ee(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>kt(xe())),w_=Symbol.for("effect/Scope"),$_=Symbol.for("effect/CloseableScope"),lI=(e,t)=>e.addFinalizer(()=>cn(t)),$a=(e,t)=>e.addFinalizer(t),cp=(e,t)=>e.close(t),Yd=(e,t)=>e.fork(t),bL=e=>SL(K)(e),SL=f(2,(e,t)=>{const n=d(e,zC,Hs(t));switch(n._tag){case"None":return d(jC(e),Id,Re({onNone:()=>{const r=pe(Sy(e)).flatMap(s=>pe(fy(s)).map(o=>`#${o}`));return new wL(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:K}));case"Some":return n.value}}),Ry=function(){class e extends globalThis.Error{commit(){return Me(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[fe](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?$s(po(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,XP),e}(),_u=(e,t)=>{class n extends Ry{constructor(){super(...arguments);a(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},E_=Symbol.for("effect/Cause/errors/RuntimeException"),_L=_u({[E_]:E_},"RuntimeException"),ap=Symbol.for("effect/Cause/errors/InterruptedException"),wL=_u({[ap]:ap},"InterruptedException"),$L=e=>j(e,ap),k_=Symbol.for("effect/Cause/errors/IllegalArgument"),EL=_u({[k_]:k_},"IllegalArgumentException"),v_=Symbol.for("effect/Cause/errors/NoSuchElement"),wu=_u({[v_]:v_},"NoSuchElementException"),C_=Symbol.for("effect/Cause/errors/Timeout"),kL=_u({[C_]:C_},"TimeoutException"),vL=e=>new kL(`Operation timed out after '${nC(e)}'`),I_=Symbol.for("effect/Cause/errors/UnknownException"),Xd=function(){class e extends Ry{constructor(r,s){super(s??"An unknown error occurred",{cause:r});a(this,"_tag","UnknownException");a(this,"error");this.error=r}}return Object.assign(e.prototype,{[I_]:I_,name:"UnknownException"}),e}(),Zd=e=>yn(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),fI=e=>e._tag==="Failure",dI=e=>e._tag==="Success",CL=e=>{switch(e._tag){case St:return by(e.effect_instruction_i0);case _t:return!1}},Tl=f(2,(e,t)=>{switch(e._tag){case St:return ye(e.effect_instruction_i0);case _t:return de(t)}}),gg=e=>Tl(e,void 0),li=(e,t)=>OL(e,t!=null&&t.parallel?qr:lt),ti=e=>ye(Jt(e)),Ea=e=>ye(po(e)),ye=e=>{const t=new QC(St);return t.effect_instruction_i0=e,t},Py=e=>ye($n(e)),Ol=f(2,(e,t)=>{switch(e._tag){case St:return ye(e.effect_instruction_i0);case _t:return de(t(e.effect_instruction_i0))}}),IL=f(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case St:return ye(d(e.effect_instruction_i0,BC(t)));case _t:return de(n(e.effect_instruction_i0))}}),eh=f(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case St:return t(e.effect_instruction_i0);case _t:return n(e.effect_instruction_i0)}}),up=f(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case St:return t(e.effect_instruction_i0);case _t:return n(e.effect_instruction_i0)}}),de=e=>{const t=new YC(_t);return t.effect_instruction_i0=e,t},Ot=de(void 0),TL=f(2,(e,t)=>Fy(e,t,{onSuccess:(n,r)=>[n,r],onFailure:lt})),hI=f(2,(e,t)=>Fy(e,t,{onSuccess:(n,r)=>r,onFailure:lt})),Fy=f(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case St:switch(t._tag){case _t:return ye(e.effect_instruction_i0);case St:return ye(n(e.effect_instruction_i0,t.effect_instruction_i0))}case _t:switch(t._tag){case _t:return de(r(e.effect_instruction_i0,t.effect_instruction_i0));case St:return ye(t.effect_instruction_i0)}}}),OL=(e,t)=>{const n=ao(e);return Lr(n)?d(Ir(n),jm(d(sr(n),Ol(ke)),(r,s)=>d(r,Fy(s,{onSuccess:(o,i)=>d(o,Ft(i)),onFailure:t}))),Ol(Nr),Ol(r=>dn(r)),x):M()},dc=e=>({...su,[JC]:L2,state:Oo(D2([])),commit(){return jn(this)},blockingOn:e}),hc=()=>k(mu,e=>RL(e)),RL=e=>O(()=>dc(e)),jn=e=>es(t=>{const n=le(e.state);switch(n._tag){case Jd:return t(n.effect);case hu:return n.joiners.push(t),AL(e,t)}},e.blockingOn),PL=f(2,(e,t)=>ky(t,e)),gc=f(2,(e,t)=>O(()=>{const n=le(e.state);switch(n._tag){case Jd:return!1;case hu:{Ro(e.state,VC(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),gI=f(2,(e,t)=>gc(e,t)),FL=f(2,(e,t)=>gc(e,Me(t))),pI=f(2,(e,t)=>gc(e,Be(t))),ML=e=>k(mu,t=>gc(e,Ey(t))),My=f(2,(e,t)=>gc(e,Ey(t))),xL=e=>O(()=>le(e.state)._tag===Jd),$u=f(2,(e,t)=>gc(e,R(t))),Eu=(e,t)=>{const n=le(e.state);if(n._tag===hu){Ro(e.state,VC(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},AL=(e,t)=>O(()=>{const n=le(e.state);if(n._tag===hu){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),NL=oe(e=>de(e.currentContext)),pc=()=>NL,mc=e=>k(pc(),e),xy=f(2,(e,t)=>Mo(Wn,t)(e)),Ay=f(2,(e,t)=>Ty(Wn,n=>Kr(n,t))(e)),Ny=f(2,(e,t)=>mc(n=>xy(e,t(n)))),Ly=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?x(t):M()},LL={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:Ot},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},DL=e=>Object.assign(Object.create(LL),e),Is=JC,ue=hc,De=jn,qL=PL,ks=gI,mI=FL,Yc=pI,T_=ML,yf=xL,qe=$u,UL=dc,Ns=Eu,jL=Zd,yc=fI,ka=dI,zL=CL,BL=li,va=ti,ku=Ea,bt=ye,KL=Py,WL=Ol,HL=IL,or=eh,Je=de,xt=Ot,O_=TL,Ca=hI,R_=Symbol.for("effect/MutableHashMap"),JL={[R_]:R_,[Symbol.iterator](){return new Dy(this)},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(Le)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}};class Dy{constructor(t){a(this,"self");a(this,"referentialIterator");a(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new VL(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new Dy(this.self)}}class VL{constructor(t){a(this,"backing");a(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const GL=()=>{const e=Object.create(JL);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},Rs=f(2,(e,t)=>{if(Hl(t)===!1)return e.referential.has(t)?x(e.referential.get(t)):M();const n=t[Y](),r=e.buckets.get(n);return r===void 0?M():QL(e,r,t)}),QL=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[Q](t[s][0])){const i=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),x(i)}return M()},Rc=f(2,(e,t)=>_e(Rs(e,t))),Pc=f(3,(e,t,n)=>{if(Hl(t)===!1)return e.referential.set(t,n),e;const r=t[Y](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(YL(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),YL=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[Q](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},P_=Symbol.for("effect/MutableList"),XL={[P_]:P_,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(Le)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},ZL=e=>({value:e,removed:!1,prev:void 0,next:void 0}),eD=()=>{const e=Object.create(XL);return e.head=void 0,e.tail=void 0,e._length=0,e},yI=e=>qy(e)===0,qy=e=>e._length,tD=f(2,(e,t)=>{const n=ZL(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),nD=e=>{const t=e.head;if(t!==void 0)return rD(e,t),t.value},rD=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},F_=Symbol.for("effect/MutableQueue"),et=Symbol.for("effect/mutable/MutableQueue/Empty"),sD={[F_]:F_,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(Le)}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},bI=e=>{const t=Object.create(sD);return t.queue=eD(),t.capacity=e,t},Uy=e=>bI(e),th=()=>bI(void 0),jy=e=>qy(e.queue),Qs=e=>yI(e.queue),oD=e=>e.capacity===void 0?1/0:e.capacity,Di=f(2,(e,t)=>{const n=qy(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(tD(t)(e.queue),!0)}),zy=f(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=xe(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Di(r.value)(e);for(;r!=null&&!r.done;)s=Ft(r.value)(s),r=n.next();return Nr(s)}),Pr=f(2,(e,t)=>yI(e.queue)?t:nD(e.queue)),nh=f(2,(e,t)=>{let n=xe(),r=0;for(;r<t;){const s=Pr(et)(e);if(s===et)break;n=Ft(s)(n),r+=1}return Nr(n)}),iD="effect/Clock",M_=Symbol.for(iD),Ao=on("effect/Clock"),cD=2**31-1,x_={unsafeSchedule(e,t){const n=Ci(t);if(n>cD)return An;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},A_=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))}(),aD=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return A_;const t=A_()-e.bigint();return()=>t+e.bigint()}();var W$;W$=M_;class uD{constructor(){a(this,W$,M_);a(this,"currentTimeMillis",O(()=>this.unsafeCurrentTimeMillis()));a(this,"currentTimeNanos",O(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return aD()}scheduler(){return R(x_)}sleep(t){return Un(n=>{const r=x_.unsafeSchedule(()=>n(ne),t);return cn(O(r))})}}const lD=()=>new uD,SI="And",_I="Or",wI="InvalidData",$I="MissingData",EI="SourceUnavailable",kI="Unsupported",fD="effect/ConfigError",N_=Symbol.for(fD),bc={_tag:"ConfigError",[N_]:N_},vI=(e,t)=>{const n=Object.create(bc);return n._op=SI,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},CI=(e,t)=>{const n=Object.create(bc);return n._op=_I,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},dD=(e,t,n={pathDelim:"."})=>{const r=Object.create(bc);return r._op=wI,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${d(this.path,tc(n.pathDelim))}: "${this.message}")`}}),r},bo=(e,t,n={pathDelim:"."})=>{const r=Object.create(bc);return r._op=$I,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${d(this.path,tc(n.pathDelim))}: "${this.message}")`}}),r},hD=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(bc);return s._op=EI,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${d(this.path,tc(r.pathDelim))}: "${this.message}")`}}),s},gD=(e,t,n={pathDelim:"."})=>{const r=Object.create(bc);return r._op=kI,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${d(this.path,tc(n.pathDelim))}: "${this.message}")`}}),r},Ls=f(2,(e,t)=>{switch(e._op){case SI:return vI(Ls(e.left,t),Ls(e.right,t));case _I:return CI(Ls(e.left,t),Ls(e.right,t));case wI:return dD([...t,...e.path],e.message);case $I:return bo([...t,...e.path],e.message);case EI:return hD([...t,...e.path],e.message,e.cause);case kI:return gD([...t,...e.path],e.message)}}),pD={_tag:"Empty"},pg=f(2,(e,t)=>{let n=hy(t),r=e;for(;dy(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=ho(s.first,ho(s.second,n.tail));break}case"MapName":{r=Js(r,s.f),n=n.tail;break}case"Nested":{r=Yl(r,s.name),n=n.tail;break}case"Unnested":{if(d(Vc(r),$F(s.name)))r=oo(r),n=n.tail;else return W(bo(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return V(r)}),mD="Constant",yD="Fail",bD="Fallback",SD="Described",_D="Lazy",wD="MapOrFail",$D="Nested",ED="Primitive",kD="Sequence",vD="HashMap",CD="ZipWith";var L_={};const bf=(e,t)=>[...e,...t],ID="effect/ConfigProvider",D_=Symbol.for(ID),TD=on("effect/ConfigProvider"),OD="effect/ConfigProviderFlat",q_=Symbol.for(OD),RD=e=>({[D_]:D_,pipe(){return D(this,arguments)},...e}),PD=e=>({[q_]:q_,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),FD=e=>RD({load:t=>k(Sn(e,fs(),t,!1),n=>Re(Vc(n),{onNone:()=>Me(bo(fs(),`Expected a single value having structure: ${t}`)),onSome:R})),flattened:e}),MD=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=u=>d(u,tc(t)),s=u=>u.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof L_=="object"?L_:{};return FD(PD({load:(u,l,g=!0)=>{const h=r(u),p=o(),m=h in p?x(p[h]):M();return d(m,Vd(()=>bo(u,`Expected ${h} to exist in the process context`)),k(b=>DD(b,u,l,n,g)))},enumerateChildren:u=>O(()=>{const l=o(),p=Object.keys(l).map(m=>s(m.toUpperCase())).filter(m=>{for(let b=0;b<u.length;b++){const $=d(u,Yk(b)),_=m[b];if(_===void 0||$!==_)return!1}return!0}).flatMap(m=>m.slice(u.length,u.length+1));return OA(p)}),patch:pD}))},xD=(e,t,n,r)=>{const s=VS(n.length,u=>u>=r.length?M():x([e(u),u+1])),o=VS(r.length,u=>u>=n.length?M():x([t(u),u+1])),i=bf(n,s),c=bf(r,o);return[i,c]},AD=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Sn=(e,t,n,r)=>{const s=n;switch(s._tag){case mD:return R(Pn(s.value));case SD:return B(()=>Sn(e,t,s.config,r));case yD:return Me(bo(t,s.message));case bD:return d(B(()=>Sn(e,t,s.first,r)),Ai(o=>s.condition(o)?d(Sn(e,t,s.second,r),Ai(i=>Me(CI(o,i)))):Me(o)));case _D:return B(()=>Sn(e,t,s.config(),r));case wD:return B(()=>d(Sn(e,t,s.original,r),k(Tr(o=>d(s.mapOrFail(o),Vd(Ls(AD(t,s.original))))))));case $D:return B(()=>Sn(e,bf(t,Pn(s.name)),s.config,r));case ED:return d(pg(t,e.patch),k(o=>d(e.load(o,s,r),k(i=>{if(i.length===0){const c=d(jF(o),je(()=>"<n/a>"));return Me(bo([],`Expected ${s.description} with name ${c}`))}return R(i)}))));case kD:return d(pg(t,e.patch),k(o=>d(e.enumerateChildren(o),k(UD),k(i=>i.length===0?B(()=>G(Sn(e,t,s.config,!0),Pn)):d(Tr(i,c=>Sn(e,AF(t,`[${c}]`),s.config,!0)),G(c=>{const u=XF(c);return u.length===0?Pn(fs()):Pn(u)}))))));case vD:return B(()=>d(pg(t,e.patch),k(o=>d(e.enumerateChildren(o),k(i=>d(i,Tr(c=>Sn(e,bf(o,Pn(c)),s.valueConfig,r)),G(c=>c.length===0?Pn(qd()):d(qD(c),Js(u=>BA(JS(pe(i),u)))))))))));case CD:return B(()=>d(Sn(e,t,s.left,r),Ni,k(o=>d(Sn(e,t,s.right,r),Ni,k(i=>{if(pt(o)&&pt(i))return Me(vI(o.left,i.left));if(pt(o)&&nr(i))return Me(o.left);if(nr(o)&&pt(i))return Me(i.left);if(nr(o)&&nr(i)){const c=d(t,tc(".")),u=ND(t,c),[l,g]=xD(u,u,d(o.right,Js(V)),d(i.right,Js(V)));return d(l,JS(g),Tr(([h,p])=>d(Gd(h,p),G(([m,b])=>s.zip(m,b)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},ND=(e,t)=>n=>W(bo(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),LD=(e,t)=>e.split(new RegExp(`\\s*${Zl(t)}\\s*`)),DD=(e,t,n,r,s)=>s?d(LD(e,r),Tr(o=>n.parse(o.trim())),Vd(Ls(t))):d(n.parse(e),vy({onFailure:Ls(t),onSuccess:Pn})),qD=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),UD=e=>d(Tr(e,zD),vy({onFailure:()=>fs(),onSuccess:la($i)}),Ni,G(uF)),jD=/^(\[(\d+)\])$/,zD=e=>{const t=e.match(jD);if(t!==null){const n=t[2];return d(n!==void 0&&n.length>0?x(n):M(),ec(BD))}return M()},BD=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?M():x(t)},U_=Symbol.for("effect/Console"),rh=on("effect/Console"),KD={[U_]:U_,assert(e,...t){return O(()=>{console.assert(e,...t)})},clear:O(()=>{console.clear()}),count(e){return O(()=>{console.count(e)})},countReset(e){return O(()=>{console.countReset(e)})},debug(...e){return O(()=>{console.debug(...e)})},dir(e,t){return O(()=>{console.dir(e,t)})},dirxml(...e){return O(()=>{console.dirxml(...e)})},error(...e){return O(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?O(()=>console.groupCollapsed(e==null?void 0:e.label)):O(()=>console.group(e==null?void 0:e.label))},groupEnd:O(()=>{console.groupEnd()}),info(...e){return O(()=>{console.info(...e)})},log(...e){return O(()=>{console.log(...e)})},table(e,t){return O(()=>{console.table(e,t)})},time(e){return O(()=>console.time(e))},timeEnd(e){return O(()=>console.timeEnd(e))},timeLog(e,...t){return O(()=>{console.timeLog(e,...t)})},trace(...e){return O(()=>{console.trace(...e)})},warn(...e){return O(()=>{console.warn(...e)})},unsafe:console},WD="effect/Random",j_=Symbol.for(WD),HD=on("effect/Random");var H$;H$=j_;class JD{constructor(t){a(this,"seed");a(this,H$,j_);a(this,"PRNG");this.seed=t,this.PRNG=new AP(t)}get next(){return O(()=>this.PRNG.number())}get nextBoolean(){return G(this.next,t=>t>.5)}get nextInt(){return O(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return G(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return O(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return VD(t,n=>this.nextIntBetween(0,n))}}const VD=(e,t)=>B(()=>d(O(()=>Array.from(e)),k(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return d(r,yo(s=>d(t(s),G(o=>GD(n,s-1,o)))),rt(ao(n)))}))),GD=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},QD=e=>new JD(A(e)),z_=Symbol.for("effect/Tracer"),II=e=>({[z_]:z_,...e}),vu=on("effect/Tracer"),lr=on("effect/ParentSpan"),B_=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class YD{constructor(t,n,r,s,o,i){a(this,"name");a(this,"parent");a(this,"context");a(this,"startTime");a(this,"kind");a(this,"_tag","Span");a(this,"spanId");a(this,"traceId","native");a(this,"sampled",!0);a(this,"status");a(this,"attributes");a(this,"events",[]);a(this,"links");this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=i,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:B_(32),this.spanId=B_(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const XD=II({span:(e,t,n,r,s,o)=>new YD(e,t,n,r,s,o),context:e=>e()}),Fr=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},Sf=nc()("effect/Tracer/DisablePropagation",{defaultValue:An}),ZD=d(ds(),er(Ao,lD()),er(rh,KD),er(HD,QD(Math.random())),er(TD,MD()),er(vu,XD)),fr=ee(Symbol.for("effect/DefaultServices/currentServices"),()=>iI(ZD)),eq=e=>{const t=pn(e);return sh(n=>n.sleep(t))},TI=e=>oe(t=>e(t.currentDefaultServices)),sh=e=>TI(t=>e(t.unsafeMap.get(Ao.key))),tq=sh(e=>e.currentTimeMillis),nq=e=>TI(t=>e(t.unsafeMap.get(vu.key))),OI=eq,rq=tq,sq=sh,oq=Ao;function iq(e){return new gs(e)}function cq(){return iq(new Map)}const K_=Symbol.for("effect/FiberRefs");var J$;J$=K_;class gs{constructor(t){a(this,"locals");a(this,J$,K_);this.locals=t}pipe(){return D(this,arguments)}}const aq=(e,t,n,r=!1)=>{const s=e;let o=t,i=n,c=r,u;for(;u===void 0;)if(ze(o)&&ze(i)){const l=Ht(o)[0],g=oo(o),h=Ht(i)[0],p=Ht(i)[1],m=oo(i);l.startTimeMillis<h.startTimeMillis?(i=m,c=!0):l.startTimeMillis>h.startTimeMillis?o=g:l.id<h.id?(i=m,c=!0):l.id>h.id?o=g:u=[p,c]}else u=[s.initial,!0];return u},uq=f(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const i=s[0][1];if(!s[0][0][Q](t)){if(!r.has(o)){if(H(i,o.initial))return;r.set(o,[[t,o.join(o.initial,i)]]);return}const c=r.get(o),[u,l]=aq(o,c,s);if(l){const g=o.diff(u,i),h=c[0][1],p=o.join(h,o.patch(g)(h));if(!H(h,p)){let m;const b=c[0][0];b[Q](t)?m=[[b,p],...c.slice(1)]:m=[[t,p],...c],r.set(o,m)}}}}),new gs(r)}),lq=f(2,(e,t)=>{const n=new Map;return RI(e,n,t),new gs(n)}),RI=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],i=s.patch(s.fork)(o);H(o,i)?t.set(s,r):t.set(s,[[n,i],...r])})},PI=f(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new gs(n)}),FI=f(2,(e,t)=>e.locals.has(t)?x(Ht(e.locals.get(t))[1]):M()),Ia=f(2,(e,t)=>d(FI(e,t),je(()=>t.initial))),lp=f(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new gs(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return fp(s,t,n,r),new gs(s)}),fp=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(ze(s)){const[i,c]=Ht(s);if(i[Q](t)){if(H(c,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},fq=f(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new gs(new Map(t));const r=new Map(e.locals);return n!==void 0&&RI(e,r,n),t.forEach(([s,o])=>{o.length===1?fp(r,o[0][0],s,o[0][1]):o.forEach(([i,c])=>{fp(r,i,s,c)})}),new gs(r)}),W_=FI,oh=Ia,dq=fq,hq=cq,gq=Y2,pq=X2,MI=Z2,xI=eL,mq=sI,By=oI,yq=tL,bq=nL,Sq=d($i,Gk(e=>e.ordinal)),_q=dF(Sq),wq=e=>{switch(e){case"All":return gq;case"Debug":return By;case"Error":return MI;case"Fatal":return pq;case"Info":return mq;case"Trace":return yq;case"None":return bq;case"Warning":return xI}},AI=e=>e.replace(/[\s="]/g,"_"),Ky=e=>t=>`${AI(t.label)}=${e-t.startTime}ms`,$q=ru,Eq=ZP;let Hr=class extends Eq{};const qi=Symbol.for("effect/Readable"),Wy=Symbol.for("effect/Ref"),Hy={_A:e=>e};var V$,G$,Q$;class kq extends(Q$=Hr,G$=Wy,V$=qi,Q$){constructor(n){super();a(this,"ref");a(this,G$,Hy);a(this,V$,qi);a(this,"get");this.ref=n,this.get=O(()=>le(this.ref))}commit(){return this.get}modify(n){return O(()=>{const r=le(this.ref),[s,o]=n(r);return r!==o&&Ro(o)(this.ref),s})}}const NI=e=>new kq(Oo(e)),_f=e=>O(()=>NI(e)),cs=e=>e.get,Ta=f(2,(e,t)=>e.modify(()=>[void 0,t])),vq=f(2,(e,t)=>e.modify(n=>[n,t])),LI=f(2,(e,t)=>e.modify(t)),dp=f(2,(e,t)=>e.modify(n=>[void 0,t(n)])),Cq=Wy,No=_f,as=cs,Iq=vq,Fc=LI,Cu=Ta,Tq=dp,DI=lr,Oq=II,Rq=nq,qI="Empty",UI="Add",jI="Remove",zI="Update",BI="AndThen",Pq={_tag:qI},Jy=(e,t)=>{const n=new Map(e.locals);let r=Pq;for(const[s,o]of t.locals.entries()){const i=Ht(o)[1],c=n.get(s);if(c!==void 0){const u=Ht(c)[1];H(u,i)||(r=mg({_tag:zI,fiberRef:s,patch:s.diff(u,i)})(r))}else r=mg({_tag:UI,fiberRef:s,value:i})(r);n.delete(s)}for(const[s]of n.entries())r=mg({_tag:jI,fiberRef:s})(r);return r},mg=f(2,(e,t)=>({_tag:BI,first:e,second:t})),KI=f(3,(e,t,n)=>{let r=n,s=Pn(e);for(;ze(s);){const o=Ht(s),i=oo(s);switch(o._tag){case qI:{s=i;break}case UI:{r=lp(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=i;break}case jI:{r=PI(r,o.fiberRef),s=i;break}case zI:{const c=Ia(r,o.fiberRef);r=lp(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(c)}),s=i;break}case BI:{s=Yl(o.first)(Yl(o.second)(i));break}}}return r}),WI="effect/MetricLabel",hp=Symbol.for(WI);var Y$;class Fq{constructor(t,n){a(this,"key");a(this,"value");a(this,Y$,hp);a(this,"_hash");this.key=t,this.value=n,this._hash=it(WI+this.key+this.value)}[(Y$=hp,Y)](){return this._hash}[Q](t){return xq(t)&&this.key===t.key&&this.value===t.value}pipe(){return D(this,arguments)}}const Mq=(e,t)=>new Fq(e,t),xq=e=>j(e,hp),Aq=f(e=>yn(e[0]),function(){const e=arguments;return Ty(e[0],aI,typeof e[1]=="string"?ff(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>ff(n,r,s),t))}),Nq=e=>G(e,x),HI=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),B(()=>{try{return R(Pe(t))}catch(r){return Me(n?Pe(()=>n(r)):new Xd(r,"An unknown error occurred in Effect.try"))}})},Lq=f(2,(e,t)=>gu(e,n=>{const r=Kd(n,s=>my(s)?x(s):M());switch(r._tag){case"None":return Be(n);case"Some":return t(r.value.defect)}})),Dq=f(2,(e,t)=>sn(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return Be(n);case"Some":return r.value}},onSuccess:R})),qq=f(e=>yn(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=Om(t[0]):r=s=>{const o=j(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let i=0;i<t.length-1;i++)if(t[i]===o)return!0;return!1},ZC(e,r,n)}),Uq=sq,jq=Uq(R),JI=f(2,(e,t)=>ge(OI(t),e)),zq=e=>ZI(e,GI,Jy),Bq=e=>ZI(e,Gd(GI,W2),([t,n],[r,s])=>[Jy(t,r),os(n,s)]),VI=f(2,(e,t)=>ar(e,{onFailure:n=>R(t.onFailure(n)),onSuccess:n=>R(t.onSuccess(n))})),Vy=e=>{const t=k(k(e,()=>bu()),()=>t);return t},GI=oe(e=>R(e.getFiberRefs())),QI=e=>VI(e,{onFailure:ua,onSuccess:ua}),Kq=e=>sn(e,{onFailure:t=>YI(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>ne}),ih=e=>(...t)=>{const n=Co(e);let r;for(let s=0,o=t.length;s<o;s++){const i=t[s];py(i)&&(r!==void 0?r=lt(r,i):r=i,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=Dr),oe(s=>(s.log(t,r,n),ne))},Wq=ih(),YI=ih(By),Hq=ih(xI),Jq=ih(MI),H_=f(2,(e,t)=>sn(e,{onFailure:n=>eI(()=>t(n)),onSuccess:R})),Vq=e=>d(hc(),k(t=>d(Bq(e),ky(t),Qq,G(n=>ge(n,d(jn(t),k(([r,s])=>rt(Gd(XI(r[0]),nI(r[1])),s)))))))),Gq=e=>G(e,t=>!t),Qq=e=>G(No(!0),t=>cn(yu(e,Iq(t,!1)))),XI=e=>rU((t,n)=>d(e,KI(t,n))),Yq=e=>e.length>=1?Un((t,n)=>{try{e(n).then(r=>t(de(r)),r=>t(ti(r)))}catch(r){t(ti(r))}}):Un(t=>{try{e().then(n=>t(de(n)),n=>t(ti(n)))}catch(n){t(ti(n))}}),Oa=f(3,(e,t,n)=>mc(r=>xy(e,er(r,t,n)))),Gy=OI,Ra=R(M()),ZI=f(3,(e,t,n)=>k(t,r=>k(e,s=>G(t,o=>[n(r,o),s])))),Xq=f(2,(e,t)=>sn(e,{onFailure:n=>ge(t(n),Be(n)),onSuccess:R})),Zq=Rq,eU=Zq(R),tU=e=>{let t,n;typeof e=="function"?t=e:(t=e.try,n=e.catch);const r=s=>n?pu(()=>n(s)):Me(new Xd(s,"An unknown error occurred in Effect.tryPromise"));return t.length>=1?Un((s,o)=>{try{t(o).then(i=>s(de(i)),i=>s(r(i)))}catch(i){s(r(i))}}):Un(s=>{try{t().then(o=>s(de(o)),o=>s(r(o)))}catch(o){s(r(o))}})},nU=f(2,(e,t)=>k(e,n=>HI({try:()=>t.try(n),catch:t.catch}))),rU=e=>oe(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),ne)),sU=f(2,(e,t)=>B(()=>t()?G(e,x):R(M()))),oU=e=>new Proxy({},{get(t,n,r){return(...s)=>k(e,o=>o[n](...s))}}),iU=e=>G(pc(),Br(e)),cU=function(){const e=arguments;return QI(k(e0,t=>O(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},e0=k(pc(),e=>{const t=e.unsafeMap.get(lr.key);return t!==void 0&&t._tag==="Span"?R(t):Me(new wu)}),t0=BigInt(0),n0=ec(e=>en(e.context,Sf)?e._tag==="Span"?n0(e.parent):M():x(e)),Qy=(e,t,n)=>{const r=!e.getFiberRef(uI)||n.context&&en(n.context,Sf),s=e.getFiberRef(Wn),o=n.parent?x(n.parent):n.root?M():n0(Br(s,lr));let i;if(r)i=DL({name:t,parent:o,context:er(n.context??ds(),Sf,!0)});else{const c=e.getFiberRef(fr),u=en(c,vu),l=en(c,oq),g=e.getFiberRef(Qd),h=e.getFiberRefs(),p=W_(h,mL),m=W_(h,yL),b=m._tag==="Some"?n.links!==void 0?[...dn(m.value),...n.links??[]]:dn(m.value):n.links??fs();i=u.span(t,o,n.context??ds(),b,g?l.unsafeCurrentTimeNanos():t0,n.kind??"internal"),p._tag==="Some"&&JA(p.value,($,_)=>i.attribute(_,$)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([$,_])=>i.attribute($,_))}return typeof n.captureStackTrace=="function"&&gf.set(i,n.captureStackTrace),i},aU=(e,t)=>(t=Fr(t),oe(n=>R(Qy(n,e,t)))),wf=(e,t,n,r)=>O(()=>{e.status._tag!=="Ended"&&(fI(t)&&gf.has(e)&&e.attribute("code.stacktrace",gf.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():t0,t))}),gp=(e,...t)=>{const n=Fr(t.length===1?void 0:t[0]),r=t[t.length-1];return oe(s=>{const o=Qy(s,e,n),i=s.getFiberRef(Qd),c=en(s.getFiberRef(fr),Ao);return ur(r(o),u=>wf(o,u,c,i))})},pp=f(2,(e,t)=>Oa(e,lr,t)),uU=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Fr(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return gp(t,n,s=>pp(r,s))}return r=>gp(t,n,s=>pp(r,s))},r0="Sequential",s0="Parallel",lU="ParallelN",Iu={_tag:r0},fU={_tag:s0},dU=e=>({_tag:lU,parallelism:e}),hU=e=>e._tag===r0,gU=e=>e._tag===s0,Pa=Iu,mp=fU,yp=dU,Fa=Jy,Ma=KI,ch="effect/FiberStatus",So=Symbol.for(ch),$f="Done",J_="Running",V_="Suspended",pU=it(`${ch}-${$f}`);var X$;let mU=class{constructor(){a(this,X$,So);a(this,"_tag",$f)}[(X$=So,Y)](){return pU}[Q](t){return Yy(t)&&t._tag===$f}};var Z$;class yU{constructor(t){a(this,"runtimeFlags");a(this,Z$,So);a(this,"_tag",J_);this.runtimeFlags=t}[(Z$=So,Y)](){return d(A(ch),J(A(this._tag)),J(A(this.runtimeFlags)),$e(this))}[Q](t){return Yy(t)&&t._tag===J_&&this.runtimeFlags===t.runtimeFlags}}var eE;class bU{constructor(t,n){a(this,"runtimeFlags");a(this,"blockingOn");a(this,eE,So);a(this,"_tag",V_);this.runtimeFlags=t,this.blockingOn=n}[(eE=So,Y)](){return d(A(ch),J(A(this._tag)),J(A(this.runtimeFlags)),J(A(this.blockingOn)),$e(this))}[Q](t){return Yy(t)&&t._tag===V_&&this.runtimeFlags===t.runtimeFlags&&H(this.blockingOn,t.blockingOn)}}const SU=new mU,_U=e=>new yU(e),wU=(e,t)=>new bU(e,t),Yy=e=>j(e,So),$U=e=>e._tag===$f,EU=SU,o0=_U,kU=wU,vU=$U,CU=Symbol.for("effect/Micro"),Ef=Symbol.for("effect/Micro/MicroExit"),G_=Symbol.for("effect/Micro/MicroCause"),IU={_E:K};var tE;class i0 extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let i,c,u;if(r instanceof globalThis.Error){i=`(${o}) ${r.name}`,c=r.message;const l=c.split(`
`).length;u=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,l+3).join(`
`)}`:`${i}: ${c}`}else i=o,c=wi(r,0),u=`${i}: ${c}`;s.length>0&&(u+=`
    ${s.join(`
    `)}`);super(c);a(this,"_tag");a(this,"traces");a(this,tE);this._tag=n,this.traces=s,this[G_]=IU,this.name=i,this.stack=u}pipe(){return D(this,arguments)}toString(){return this.stack}[(tE=G_,fe)](){return this.stack}}class TU extends i0{constructor(n,r=[]){super("Die",n,r);a(this,"defect");this.defect=n}}const OU=(e,t=[])=>new TU(e,t);class RU extends i0{constructor(t=[]){super("Interrupt","interrupted",t)}}const PU=(e=[])=>new RU(e),FU=e=>e._tag==="Interrupt",Q_=Symbol.for("effect/Micro/MicroFiber"),MU={_A:K,_E:K};var nE;nE=Q_;class xU{constructor(t,n=!0){a(this,"context");a(this,"interruptible");a(this,nE);a(this,"_stack",[]);a(this,"_observers",[]);a(this,"_exit");a(this,"_children");a(this,"currentOpCount",0);a(this,"_interrupted",!1);a(this,"_yielded");this.context=t,this.interruptible=n,this[Q_]=MU}getRef(t){return mx(this.context,t)}addObserver(t){return this._exit?(t(this._exit),ua):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(nb))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===il)return;const r=Y_.interruptChildren&&Y_.interruptChildren(this);if(r!==void 0)return this.evaluate(vf(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(rb).shouldYield(this)){n=!0;const s=r;r=vf(qU,()=>s)}if(r=r[bp](this),r===il){const s=this._yielded;return Ef in s?(this._yielded=void 0,s):il}}}catch(s){return j(r,bp)?Sp(s):Sp(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[kf]&&n[kf](this);if(r)return{[t]:r};if(n[t])return n}}yieldWith(t){return this._yielded=t,il}children(){return this._children??(this._children=new Set)}}const Y_=ee("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),c0=Symbol.for("effect/Micro/identifier"),mt=Symbol.for("effect/Micro/args"),bp=Symbol.for("effect/Micro/evaluate"),Ui=Symbol.for("effect/Micro/successCont"),fi=Symbol.for("effect/Micro/failureCont"),kf=Symbol.for("effect/Micro/ensureCont"),il=Symbol.for("effect/Micro/Yield"),AU={_A:K,_E:K,_R:K},NU={...$q,_op:"Micro",[CU]:AU,pipe(){return D(this,arguments)},[Symbol.iterator](){return new Ok(new Xi(this))},toJSON(){return{_id:"Micro",op:this[c0],...mt in this?{args:this[mt]}:void 0}},toString(){return Oe(this)},[fe](){return Oe(this)}};function LU(e){return Sp("Micro.evaluate: Not implemented")}const ah=e=>({...NU,[c0]:e.op,[bp]:e.eval??LU,[Ui]:e.contA,[fi]:e.contE,[kf]:e.ensure}),Xy=e=>{const t=ah(e);return function(){const n=Object.create(t);return n[mt]=e.single===!1?arguments:arguments[0],n}},a0=e=>{const t={...ah(e),[Ef]:Ef,_tag:e.op,get[e.prop](){return this[mt]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[mt]}},[Q](n){return zU(n)&&n._tag===e.op&&H(this[mt],n[mt])},[Y](){return $e(this,J(it(e.op))(A(this[mt])))}};return function(n){const r=Object.create(t);return r[mt]=n,r[Ui]=void 0,r[fi]=void 0,r[kf]=void 0,r}},Zy=a0({op:"Success",prop:"value",eval(e){const t=e.getCont(Ui);return t?t[Ui](this[mt],e):e.yieldWith(this)}}),u0=a0({op:"Failure",prop:"cause",eval(e){let t=e.getCont(fi);for(;FU(this[mt])&&t&&e.interruptible;)t=e.getCont(fi);return t?t[fi](this[mt],e):e.yieldWith(this)}}),DU=Xy({op:"Yield",eval(e){let t=!1;return e.getRef(rb).scheduleTask(()=>{t||e.evaluate(BU)},this[mt]??0),e.yieldWith(()=>{t=!0})}}),qU=DU(0),UU=Zy(void 0),eb=Xy({op:"WithMicroFiber",eval(e){return this[mt](e)}}),vf=f(2,(e,t)=>{const n=Object.create(jU);return n[mt]=e,n[Ui]=t,n}),jU=ah({op:"OnSuccess",eval(e){return e._stack.push(this),this[mt]}}),zU=e=>j(e,Ef),l0=Zy,tb=u0,nb=tb(PU()),Sp=e=>tb(OU(e)),BU=l0(void 0),KU="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class f0{constructor(){a(this,"tasks",[]);a(this,"running",!1);a(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,KU(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(JU)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const WU=f(2,(e,t)=>eb(n=>{const r=n.context;return n.context=t(r),QU(e,()=>(n.context=r,UU))})),HU=f(2,(e,t)=>WU(e,Kr(t)));class JU extends nc()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class rb extends nc()("effect/Micro/currentScheduler",{defaultValue:()=>new f0}){}const VU=f(2,(e,t)=>{const n=Object.create(GU);return n[mt]=e,n[Ui]=t.onSuccess,n[fi]=t.onFailure,n}),GU=ah({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[mt]}}),QU=f(2,(e,t)=>XU(n=>VU(n(e),{onFailure:r=>vf(t(tb(r)),()=>u0(r)),onSuccess:r=>vf(t(l0(r)),()=>Zy(r))}))),d0=Xy({op:"SetInterruptible",ensure(e){if(e.interruptible=this[mt],e._interrupted&&e.interruptible)return()=>nb}}),YU=e=>eb(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(d0(!1)),t._interrupted?nb:e)),XU=e=>eb(t=>t.interruptible?(t.interruptible=!1,t._stack.push(d0(!0)),e(YU)):e(K)),ZU=(e,t)=>{const n=new xU(rb.context(new f0));return n.evaluate(e),n};class h0{constructor(){a(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class ej{constructor(t){a(this,"maxNextTickBeforeTimer");a(this,"running",!1);a(this,"tasks",new h0);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(cI)?t.getFiberRef(xo):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const g0=ee(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new ej(2048));class p0{constructor(){a(this,"tasks",new h0);a(this,"deferred",!1)}scheduleTask(t,n){this.deferred?g0.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(cI)?t.getFiberRef(xo):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const uh=ee(Symbol.for("effect/FiberRef/currentScheduler"),()=>kt(g0)),m0=ee(Symbol.for("effect/FiberRef/currentRequestMap"),()=>kt(new Map)),X_=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return lc(hL,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},sb="InterruptSignal",ob="Stateful",ib="Resume",cb="YieldNow",yg=e=>({_tag:sb,cause:e}),Rl=e=>({_tag:ob,onFiber:e}),Jo=e=>({_tag:ib,effect:e}),tj=()=>({_tag:cb}),nj="effect/FiberScope",Cf=Symbol.for(nj);var rE;rE=Cf;class rj{constructor(){a(this,rE,Cf);a(this,"fiberId",Cn);a(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var sE;sE=Cf;class sj{constructor(t,n){a(this,"fiberId");a(this,"parent");a(this,sE,Cf);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(Rl(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const oj=e=>new sj(e.id(),e),Tu=ee(Symbol.for("effect/FiberScope/Global"),()=>new rj),ij="effect/Fiber",cj=Symbol.for(ij),aj={_E:e=>e,_A:e=>e},uj="effect/Fiber",lj=Symbol.for(uj),y0=e=>e.await,fj=e=>e.inheritAll,dj=f(2,(e,t)=>d(yo(e,b0(t)),ge(d(e,yo(y0))))),b0=f(2,(e,t)=>e.interruptAsFork(t)),ji=e=>is(uc(e.await),e.inheritAll);({...su});const Gr="effect/FiberCurrent",hj=()=>Co(globalThis[Gr]),gj="effect/Logger",pj=Symbol.for(gj),mj={_Message:e=>e,_Output:e=>e},Ou=e=>({[pj]:mj,log:e,pipe(){return D(this,arguments)}}),yj=/^[^\s"=]*$/,bj=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:i,message:c,spans:u})=>{const l=b=>b.match(yj)?b:e(b),g=(b,$)=>`${AI(b)}=${l($)}`,h=(b,$)=>" "+g(b,$);let p=g("timestamp",s.toISOString());p+=h("level",i.label),p+=h("fiber",Dd(o));const m=qm(c);for(let b=0;b<m.length;b++)p+=h("message",wi(m[b],t));E2(r)||(p+=h("cause",$s(r,{renderErrorCause:!0})));for(const b of u)p+=" "+Ky(s.getTime())(b);for(const[b,$]of n)p+=h(b,wi($,t));return p},Sj=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,_j=Ou(bj(Sj)),S0=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return Le(e)}},wj=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},$j=(e,...t)=>e,_n={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},Ej={None:[],All:[],Trace:[_n.gray],Debug:[_n.blue],Info:[_n.green],Warning:[_n.yellow],Error:[_n.red],Fatal:[_n.bgBrightRed,_n.black]},kj={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},vj=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,_0=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,Cj=_0&&process.stdout.isTTY===!0,Ij=_0||"Deno"in globalThis,Tj=e=>{const t=(e==null?void 0:e.mode)??"auto",r=(t==="auto"?Ij?"tty":"browser":t)==="browser",s=typeof(e==null?void 0:e.colors)=="boolean"?e.colors:Cj||r,o=(e==null?void 0:e.formatDate)??vj;return r?Rj({colors:s,formatDate:o}):Oj({colors:s,formatDate:o,stderr:(e==null?void 0:e.stderr)===!0})},Oj=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?wj:$j;return Ou(({annotations:r,cause:s,context:o,date:i,fiberId:c,logLevel:u,message:l,spans:g})=>{const h=oh(o,fr),p=en(h,rh).unsafe,m=e.stderr===!0?p.error:p.log,b=qm(l);let $=n(`[${e.formatDate(i)}]`,_n.white)+` ${n(u.label,...Ej[u._tag])} (${Dd(c)})`;if(dy(g)){const w=i.getTime(),S=Ky(w);for(const P of g)$+=" "+S(P)}$+=":";let _=0;if(b.length>0){const w=S0(b[0]);typeof w=="string"&&($+=" "+n(w,_n.bold,_n.cyan),_++)}if(m($),t||p.group(),yy(s)||m($s(s,{renderErrorCause:!0})),_<b.length)for(;_<b.length;_++)m(ro(b[_]));if($C(r)>0)for(const[w,S]of r)m(n(`${w}:`,_n.bold,_n.white),ro(S));t||p.groupEnd()})},Rj=e=>{const t=e.colors?"%c":"";return Ou(({annotations:n,cause:r,context:s,date:o,fiberId:i,logLevel:c,message:u,spans:l})=>{const g=oh(s,fr),h=en(g,rh).unsafe,p=qm(u);let m=`${t}[${e.formatDate(o)}]`;const b=[];if(e.colors&&b.push("color:gray"),m+=` ${t}${c.label}${t} (${Dd(i)})`,e.colors&&b.push(kj[c._tag],""),dy(l)){const _=o.getTime(),w=Ky(_);for(const S of l)m+=" "+w(S)}m+=":";let $=0;if(p.length>0){const _=S0(p[0]);typeof _=="string"&&(m+=` ${t}${_}`,e.colors&&b.push("color:deepskyblue"),$++)}if(h.groupCollapsed(m,...b),yy(r)||h.error($s(r,{renderErrorCause:!0})),$<p.length)for(;$<p.length;$++)h.log(ro(p[$]));if($C(n)>0)for(const[_,w]of n){const S=ro(w);e.colors?h.log(`%c${_}:`,"color:gray",S):h.log(`${_}:`,S)}h.groupEnd()})},w0="effect/MetricBoundaries",_p=Symbol.for(w0);var oE;class Pj{constructor(t){a(this,"values");a(this,oE,_p);a(this,"_hash");this.values=t,this._hash=d(it(w0),J(tu(this.values)))}[(oE=_p,Y)](){return this._hash}[Q](t){return Fj(t)&&H(this.values,t.values)}pipe(){return D(this,arguments)}}const Fj=e=>j(e,_p),Mj=e=>{const t=d(e,Um(ke(Number.POSITIVE_INFINITY)),ZF);return new Pj(t)},xj=e=>d(MF(e.count-1,t=>e.start*Math.pow(e.factor,t)),Ze,Mj),Aj="effect/MetricKeyType",$0=Symbol.for(Aj),E0="effect/MetricKeyType/Counter",wp=Symbol.for(E0),Nj="effect/MetricKeyType/Frequency",Lj=Symbol.for(Nj),Dj="effect/MetricKeyType/Gauge",qj=Symbol.for(Dj),k0="effect/MetricKeyType/Histogram",$p=Symbol.for(k0),Uj="effect/MetricKeyType/Summary",jj=Symbol.for(Uj),v0={_In:e=>e,_Out:e=>e};var iE,cE;class zj{constructor(t,n){a(this,"incremental");a(this,"bigint");a(this,cE,v0);a(this,iE,wp);a(this,"_hash");this.incremental=t,this.bigint=n,this._hash=it(E0)}[(cE=$0,iE=wp,Y)](){return this._hash}[Q](t){return C0(t)}pipe(){return D(this,arguments)}}var aE,uE;class Bj{constructor(t){a(this,"boundaries");a(this,uE,v0);a(this,aE,$p);a(this,"_hash");this.boundaries=t,this._hash=d(it(k0),J(A(this.boundaries)))}[(uE=$0,aE=$p,Y)](){return this._hash}[Q](t){return I0(t)&&H(this.boundaries,t.boundaries)}pipe(){return D(this,arguments)}}const Kj=e=>new zj((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),Wj=e=>new Bj(e),C0=e=>j(e,wp),Hj=e=>j(e,Lj),Jj=e=>j(e,qj),I0=e=>j(e,$p),Vj=e=>j(e,jj),Gj="effect/MetricKey",T0=Symbol.for(Gj),Qj={_Type:e=>e},Yj=pd(H);var lE;class ab{constructor(t,n,r,s=[]){a(this,"name");a(this,"keyType");a(this,"description");a(this,"tags");a(this,lE,Qj);a(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=d(it(this.name+this.description),J(A(this.keyType)),J(tu(this.tags)))}[(lE=T0,Y)](){return this._hash}[Q](t){return Xj(t)&&this.name===t.name&&H(this.keyType,t.keyType)&&H(this.description,t.description)&&Yj(this.tags,t.tags)}pipe(){return D(this,arguments)}}const Xj=e=>j(e,T0),Zj=(e,t)=>new ab(e,Kj(t),Co(t==null?void 0:t.description)),ez=(e,t,n)=>new ab(e,Wj(t),Co(n)),tz=f(2,(e,t)=>t.length===0?e:new ab(e.name,e.keyType,e.description,kl(e.tags,t))),nz="effect/MetricState",Ru=Symbol.for(nz),O0="effect/MetricState/Counter",Ep=Symbol.for(O0),R0="effect/MetricState/Frequency",kp=Symbol.for(R0),P0="effect/MetricState/Gauge",vp=Symbol.for(P0),F0="effect/MetricState/Histogram",Cp=Symbol.for(F0),M0="effect/MetricState/Summary",Ip=Symbol.for(M0),Pu={_A:e=>e};var fE,dE;class rz{constructor(t){a(this,"count");a(this,dE,Pu);a(this,fE,Ep);this.count=t}[(dE=Ru,fE=Ep,Y)](){return d(A(O0),J(A(this.count)),$e(this))}[Q](t){return gz(t)&&this.count===t.count}pipe(){return D(this,arguments)}}const sz=pd(H);var hE,gE;class oz{constructor(t){a(this,"occurrences");a(this,gE,Pu);a(this,hE,kp);a(this,"_hash");this.occurrences=t}[(gE=Ru,hE=kp,Y)](){return d(it(R0),J(tu(pe(this.occurrences.entries()))),$e(this))}[Q](t){return pz(t)&&sz(pe(this.occurrences.entries()),pe(t.occurrences.entries()))}pipe(){return D(this,arguments)}}var pE,mE;class iz{constructor(t){a(this,"value");a(this,mE,Pu);a(this,pE,vp);this.value=t}[(mE=Ru,pE=vp,Y)](){return d(A(P0),J(A(this.value)),$e(this))}[Q](t){return mz(t)&&this.value===t.value}pipe(){return D(this,arguments)}}var yE,bE;class cz{constructor(t,n,r,s,o){a(this,"buckets");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,bE,Pu);a(this,yE,Cp);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(bE=Ru,yE=Cp,Y)](){return d(A(F0),J(A(this.buckets)),J(A(this.count)),J(A(this.min)),J(A(this.max)),J(A(this.sum)),$e(this))}[Q](t){return yz(t)&&H(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return D(this,arguments)}}var SE,_E;class az{constructor(t,n,r,s,o,i){a(this,"error");a(this,"quantiles");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,_E,Pu);a(this,SE,Ip);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=i}[(_E=Ru,SE=Ip,Y)](){return d(A(M0),J(A(this.error)),J(A(this.quantiles)),J(A(this.count)),J(A(this.min)),J(A(this.max)),J(A(this.sum)),$e(this))}[Q](t){return bz(t)&&this.error===t.error&&H(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return D(this,arguments)}}const uz=e=>new rz(e),lz=e=>new oz(e),fz=e=>new iz(e),dz=e=>new cz(e.buckets,e.count,e.min,e.max,e.sum),hz=e=>new az(e.error,e.quantiles,e.count,e.min,e.max,e.sum),gz=e=>j(e,Ep),pz=e=>j(e,kp),mz=e=>j(e,vp),yz=e=>j(e,Cp),bz=e=>j(e,Ip),Sz="effect/MetricHook",_z=Symbol.for(Sz),wz={_In:e=>e,_Out:e=>e},Fu=e=>({[_z]:wz,pipe(){return D(this,arguments)},...e}),Z_=BigInt(0),$z=e=>{let t=e.keyType.bigint?Z_:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=Z_:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return Fu({get:()=>uz(t),update:r,modify:r})},Ez=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return Fu({get:()=>lz(t),update:n,modify:n})},kz=(e,t)=>{let n=t;return Fu({get:()=>fz(n),update:r=>{n=r},modify:r=>{n=n+r}})},vz=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,i=0,c=Number.MAX_VALUE,u=Number.MIN_VALUE;d(t,la($i),Js((h,p)=>{s[p]=h}));const l=h=>{let p=0,m=n;for(;p!==m;){const b=Math.floor(p+(m-p)/2),$=s[b];h<=$?m=b:p=b,m===p+1&&(h<=s[p]?m=p:p=m)}r[p]=r[p]+1,o=o+1,i=i+h,h<c&&(c=h),h>u&&(u=h)},g=()=>{const h=gd(n);let p=0;for(let m=0;m<n;m++){const b=s[m],$=r[m];p=p+$,h[m]=[b,p]}return h};return Fu({get:()=>dz({buckets:g(),count:o,min:c,max:u,sum:i}),update:l,modify:l})},Cz=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=d(s,la($i)),i=gd(r);let c=0,u=0,l=0,g=0,h=0;const p=b=>{const $=[];let _=0;for(;_!==r-1;){const w=i[_];if(w!=null){const[S,P]=w,y=da(b-S);Vx(y,Zv)&&Jx(y,n)&&$.push(P)}_=_+1}return Iz(t,o,la($,$i))},m=(b,$)=>{if(r>0){c=c+1;const _=c%r;i[_]=[$,b]}g=u===0?b:Math.min(g,b),h=u===0?b:Math.max(h,b),u=u+1,l=l+b};return Fu({get:()=>hz({error:t,quantiles:p(Date.now()),count:u,min:g,max:h,sum:l}),update:([b,$])=>m(b,$),modify:([b,$])=>m(b,$)})},Iz=(e,t,n)=>{const r=n.length;if(!ze(t))return fs();const s=t[0],o=t.slice(1),i=ew(e,r,M(),0,s,n),c=Pn(i);return o.forEach(u=>{c.push(ew(e,r,i.value,i.consumed,u,i.rest))}),Js(c,u=>[u.quantile,u.value])},ew=(e,t,n,r,s,o)=>{let i=e,c=t,u=n,l=r,g=s,h=o,p=e,m=t,b=n,$=r,_=s,w=o;for(;;){if(!ze(h))return{quantile:g,value:M(),consumed:l,rest:[]};if(g===1)return{quantile:g,value:x(Xk(h)),consumed:l+h.length,rest:[]};const S=Ht(h),P=BF(h,T=>T===S),y=g*c,E=i/2*y,C=l+P[0].length,I=Math.abs(C-y);if(C<y-E){p=i,m=c,b=Vc(h),$=C,_=g,w=P[1],i=p,c=m,u=b,l=$,g=_,h=w;continue}if(C>y+E){const T=Ue(u)?x(S):u;return{quantile:g,value:T,consumed:l,rest:h}}switch(u._tag){case"None":{p=i,m=c,b=Vc(h),$=C,_=g,w=P[1],i=p,c=m,u=b,l=$,g=_,h=w;continue}case"Some":{const T=Math.abs(y-u.value);if(I<T){p=i,m=c,b=Vc(h),$=C,_=g,w=P[1],i=p,c=m,u=b,l=$,g=_,h=w;continue}return{quantile:g,value:x(u.value),consumed:l,rest:h}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},Tz="effect/MetricPair",Oz=Symbol.for(Tz),Rz={_Type:e=>e},Pz=(e,t)=>({[Oz]:Rz,metricKey:e,metricState:t,pipe(){return D(this,arguments)}}),Fz="effect/MetricRegistry",tw=Symbol.for(Fz);var wE;wE=tw;class Mz{constructor(){a(this,wE,tw);a(this,"map",GL())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(Pz(n,r.get()));return t}get(t){const n=d(this.map,Rs(t),Fn);if(n==null){if(C0(t.keyType))return this.getCounter(t);if(Jj(t.keyType))return this.getGauge(t);if(Hj(t.keyType))return this.getFrequency(t);if(I0(t.keyType))return this.getHistogram(t);if(Vj(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=d(this.map,Rs(t),Fn);if(n==null){const r=$z(t);d(this.map,Rc(t))||d(this.map,Pc(t,r)),n=r}return n}getFrequency(t){let n=d(this.map,Rs(t),Fn);if(n==null){const r=Ez(t);d(this.map,Rc(t))||d(this.map,Pc(t,r)),n=r}return n}getGauge(t){let n=d(this.map,Rs(t),Fn);if(n==null){const r=kz(t,t.keyType.bigint?BigInt(0):0);d(this.map,Rc(t))||d(this.map,Pc(t,r)),n=r}return n}getHistogram(t){let n=d(this.map,Rs(t),Fn);if(n==null){const r=vz(t);d(this.map,Rc(t))||d(this.map,Pc(t,r)),n=r}return n}getSummary(t){let n=d(this.map,Rs(t),Fn);if(n==null){const r=Cz(t);d(this.map,Rc(t))||d(this.map,Pc(t,r)),n=r}return n}}const xz=()=>new Mz,Az="effect/Metric",Nz=Symbol.for(Az),Lz={_Type:e=>e,_In:e=>e,_Out:e=>e},nw=ee(Symbol.for("effect/Metric/globalMetricRegistry"),()=>xz()),x0=function(e,t,n,r){const s=Object.assign(o=>Ur(o,i=>jz(s,i)),{[Nz]:Lz,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return D(this,arguments)}});return s},lh=(e,t)=>A0(Zj(e,t)),A0=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=nw.get(e)),t;let o=n.get(s);return o!==void 0||(o=nw.get(tz(e,s)),n.set(s,o)),o};return x0(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},Dz=(e,t,n)=>A0(ez(e,t,n)),qz=f(3,(e,t,n)=>Uz(e,[Mq(t,n)])),Uz=f(2,(e,t)=>x0(e.keyType,(n,r)=>e.unsafeUpdate(n,kl(t,r)),n=>e.unsafeValue(kl(t,n)),(n,r)=>e.unsafeModify(n,kl(t,r)))),jz=f(2,(e,t)=>lc(op,n=>O(()=>e.unsafeUpdate(t,n)))),zz="effect/Request",Bz=Symbol.for(zz),Kz={_E:e=>e,_A:e=>e},Wz={...xm,[Bz]:Kz},Hz=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=Wz,e}(),Jz=f(2,(e,t)=>lc(m0,n=>O(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,Eu(r.result,t))}}))),Vz="effect/Supervisor",fh=Symbol.for(Vz),ub={_T:e=>e};var $E;$E=fh;const AS=class AS{constructor(t,n){a(this,"underlying");a(this,"value0");a(this,$E,ub);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new AS(this,d(this.value,G(t)))}zip(t){return new Tf(this,t)}};let If=AS;var EE;EE=fh;const NS=class NS{constructor(t,n){a(this,"left");a(this,"right");a(this,"_tag","Zip");a(this,EE,ub);this.left=t,this.right=n}get value(){return Gd(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new If(this,d(this.value,G(t)))}zip(t){return new NS(this,t)}};let Tf=NS;const N0=e=>j(e,fh)&&Om(e,"Zip");var kE;kE=fh;class Gz{constructor(t){a(this,"effect");a(this,kE,ub);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new If(this,d(this.value,G(t)))}zip(t){return new Tf(this,t)}onRun(t,n){return t()}}const Qz=e=>new Gz(e),dh=ee("effect/Supervisor/none",()=>Qz(ne)),Yz=rc,L0="Empty",D0="AddSupervisor",q0="RemoveSupervisor",U0="AndThen",Xc={_tag:L0},Pl=(e,t)=>({_tag:U0,first:e,second:t}),Xz=(e,t)=>Zz(t,ke(e)),Zz=(e,t)=>{let n=e,r=t;for(;Lr(r);){const s=sr(r);switch(s._tag){case L0:{r=Ir(r);break}case D0:{n=n.zip(s.supervisor),r=Ir(r);break}case q0:{n=Tp(n,s.supervisor),r=Ir(r);break}case U0:{r=Ft(s.first)(Ft(s.second)(Ir(r)));break}}}return n},Tp=(e,t)=>H(e,t)?dh:N0(e)?Tp(e.left,t).zip(Tp(e.right,t)):e,Of=e=>H(e,dh)?lo():N0(e)?d(Of(e.left),pa(Of(e.right))):Nd(e),eB=(e,t)=>{if(H(e,t))return Xc;const n=Of(e),r=Of(t),s=d(r,u_(n),ma(Xc,(i,c)=>Pl(i,{_tag:D0,supervisor:c}))),o=d(n,u_(r),ma(Xc,(i,c)=>Pl(i,{_tag:q0,supervisor:c})));return Pl(s,o)},tB=Yz({empty:Xc,patch:Xz,combine:Pl,diff:eB}),nB=lh("effect_fiber_started",{incremental:!0}),rw=lh("effect_fiber_active"),rB=lh("effect_fiber_successes",{incremental:!0}),sB=lh("effect_fiber_failures",{incremental:!0}),oB=qz(Dz("effect_fiber_lifetimes",xj({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Mc="Continue",iB="Done",sw="Yield",cB={_E:e=>e,_A:e=>e},cl=e=>{throw new Error(`BUG: FiberRuntime - ${wi(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},br=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Sr=ee("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),xc={[Jl]:(e,t,n)=>Pe(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>de(de(n)),[Vl]:(e,t,n)=>Pe(()=>t.effect_instruction_i2(n)),[Mm]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),Yr(e.currentRuntimeFlags)&&e.isInterrupted()?ye(e.getInterruptedCause()):de(n)),[Gl]:(e,t,n)=>(Pe(()=>t.effect_instruction_i2(n)),Pe(()=>t.effect_instruction_i0())?(e.pushStack(t),Pe(()=>t.effect_instruction_i1())):ne),[Jc]:(e,t,n)=>{const r=Pe(()=>t.effect_instruction_i0.next(n));return r.done?de(r.value):(e.pushStack(t),LP(r.value))}},aB={[sb]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),Yr(t)?ye(r.cause):n),[ib]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[ob]:(e,t,n,r)=>(r.onFiber(e,o0(t)),n),[cb]:(e,t,n,r)=>k(bu(),()=>n)},uB=e=>yo(c2(e),t=>Mr(w2(t),([n,r])=>{const s=new Map,o=[];for(const c of r){o.push(dn(c));for(const u of c)s.set(u.request,u)}const i=o.flat();return Mo(RB(n.runAll(o),i,()=>i.forEach(c=>{c.listeners.interrupted=!0})),m0,s)},!1,!1)),lB=id();var vE,CE;class j0 extends Hr{constructor(n,r,s){super();a(this,CE,aj);a(this,vE,cB);a(this,"_fiberRefs");a(this,"_fiberId");a(this,"_queue",new Array);a(this,"_children",null);a(this,"_observers",new Array);a(this,"_running",!1);a(this,"_stack",[]);a(this,"_asyncInterruptor",null);a(this,"_asyncBlockingOn",null);a(this,"_exitValue",null);a(this,"_steps",[]);a(this,"_isYielding",!1);a(this,"currentRuntimeFlags");a(this,"currentOpCount",0);a(this,"currentSupervisor");a(this,"currentScheduler");a(this,"currentTracer");a(this,"currentSpan");a(this,"currentContext");a(this,"currentDefaultServices");a(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,g_(s)){const o=this.getFiberRef(op);nB.unsafeUpdate(1,o),rw.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return ji(this)}id(){return this._fiberId}resume(n){this.tell(Jo(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>vU(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return oj(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(ol)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return B(()=>{const r=dc(this._fiberId);return this.tell(Rl((s,o)=>{Eu(r,O(()=>n(s,o)))})),jn(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Un(n=>{const r=s=>n(R(s));return this.tell(Rl((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),O(()=>this.tell(Rl((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return oe((n,r)=>{const s=n.id(),o=n.getFiberRefs(),i=r.runtimeFlags,c=this.getFiberRefs(),u=uq(o,s,c);n.setFiberRefs(u);const l=n.getFiberRef(aw),g=d(os(i,l),m_(sc),m_(np));return nI(g)})}get poll(){return O(()=>Co(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return O(()=>this.tell(yg($n(n))))}unsafeInterruptAsFork(n){this.tell(yg($n(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(aw,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=PI(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=lp(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(fr),this.currentTracer=this.currentDefaultServices.unsafeMap.get(vu.key),this.currentSupervisor=this.getFiberRef(TB),this.currentScheduler=this.getFiberRef(uh),this.currentContext=this.getFiberRef(Wn),this.currentSpan=this.currentContext.unsafeMap.get(lr.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=Mc;const s=globalThis[Gr];globalThis[Gr]=this;try{for(;r===Mc;)r=this._queue.length===0?iB:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Gr]=s}this._queue.length>0&&!this._running?(this._running=!0,r===sw?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(xo))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=aB[o._tag](this,n,s,o)}return s}isInterrupted(){return!yy(this.getFiberRef(ol))}addInterruptedCause(n){const r=this.getFiberRef(ol);this.setFiberRef(ol,lt(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(yg($n(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Iy({while:()=>!r,body:()=>{const o=n.next();return o.done?O(()=>{r=!0}):cn(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(g_(this.currentRuntimeFlags)){const r=this.getFiberRef(op),s=this.id().startTimeMillis,o=Date.now();switch(oB.unsafeUpdate(o-s,r),rw.unsafeUpdate(-1,r),n._tag){case _t:{rB.unsafeUpdate(1,r);break}case St:{sB.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(Oy);!Bd(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(hh)}log(n,r,s){const o=_e(s)?s.value:this.getFiberRef(lL),i=this.getFiberRef(z0);if(_q(i,o))return;const c=this.getFiberRef(fL),u=this.getFiberRef(aI),l=this.getLoggers(),g=this.getFiberRefs();if(cy(l)>0){const h=en(this.getFiberRef(fr),Ao),p=new Date(h.unsafeCurrentTimeMillis());WP(g,()=>{for(const m of l)m.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:g,spans:c,annotations:u,date:p})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case cb:return sw;case sb:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(ye(n.cause)),this._asyncInterruptor=null),Mc;case ib:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),Mc;case ob:return n.onFiber(this,this._exitValue!==null?EU:kU(this.currentRuntimeFlags,this._asyncBlockingOn)),Mc;default:return cl(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=Yr(this.currentRuntimeFlags)&&this.isInterrupted()?ye(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===br){const i=Sr.currentOp;Sr.currentOp=null,i._op===$l?n2(this.currentRuntimeFlags)?(this.tell(tj()),this.tell(Jo(Ot)),r=null):r=Ot:i._op===Hc&&(r=null)}else{this.currentRuntimeFlags=d(this.currentRuntimeFlags,r2(np));const i=this.interruptAllChildren();i!==null?r=k(i,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(Jo(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Jo(n));else{this._running=!0;const r=globalThis[Gr];globalThis[Gr]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[Gr]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Jo(n))}patchRuntimeFlags(n,r){const s=ui(n,r);return globalThis[Gr]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=i=>{s||(s=!0,this.tell(Jo(i)))};Yr(n)&&(this._asyncInterruptor=o);try{r(o)}catch(i){o(Be(Jt(i)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==wl)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==Jl&&n._op!==Gl&&n._op!==Jc)return n;n=this.popStack()}}[(CE=cj,vE=lj,HP)](n){return O(()=>Ed(this.currentContext,n))}Left(n){return Me(n.left)}None(n){return Me(new wu)}Right(n){return de(n.right)}Some(n){return de(n.value)}Micro(n){return Sa(r=>{let s=r;const o=ZU(HU(n,this.currentContext));return o.addObserver(i=>{if(i._tag==="Success")return s(de(i.value));switch(i.cause._tag){case"Interrupt":return s(ye($n(Cn)));case"Fail":return s(Me(i.cause.error));case"Die":return s(_a(i.cause.defect))}}),Sa(i=>{s=c=>{i(ne)},o.unsafeInterrupt()})})}[Ak](n){const r=Pe(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in xc||cl(s),xc[s._op](this,s,r)):(Sr.currentOp=de(r),br)}[_t](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in xc||cl(s),xc[s._op](this,s,r.effect_instruction_i0)):(Sr.currentOp=r,br)}[St](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case wl:case Vl:return Yr(this.currentRuntimeFlags)&&this.isInterrupted()?ye(y_(r)):Pe(()=>s.effect_instruction_i1(r));case"OnStep":return Yr(this.currentRuntimeFlags)&&this.isInterrupted()?ye(y_(r)):de(ye(r));case Mm:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),Yr(this.currentRuntimeFlags)&&this.isInterrupted()?ye(lt(r,this.getInterruptedCause())):ye(r);default:cl(s)}else return Sr.currentOp=ye(r),br}[Nk](n){return Pe(()=>n.effect_instruction_i0(this,o0(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],i=this._steps[this._steps.length-1];let c=this.popStack();for(;c&&c._op!=="OnStep";)o.push(c),c=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const u=Fa(i.refs,r),l=os(i.flags,s);return de(GC(n.effect_instruction_i0,oe(g=>{for(;o.length>0;)g.pushStack(o.pop());return g.setFiberRefs(Ma(g.id(),g.getFiberRefs())(u)),g.currentRuntimeFlags=ui(l)(g.currentRuntimeFlags),n.effect_instruction_i1})))}return Qt(o=>k(Bi(q2(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return uB(n.effect_instruction_i0)}[Zi](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=ui(s,r);if(Yr(o)&&this.isInterrupted())return ye(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const i=os(o,s);return this.pushStack(new U2(i,n)),Pe(()=>n.effect_instruction_i1(s))}else return Ot}[Jl](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[wl](n){return this.pushStack(n),n.effect_instruction_i0}[Vl](n){return this.pushStack(n),n.effect_instruction_i0}[Hc](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),Sr.currentOp=n,br}[$l](n){return this._isYielding=!1,Sr.currentOp=n,br}[Gl](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):Ot}[Jc](n){return xc[Jc](this,n,void 0)}[nu](n){return Pe(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&t2)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=k(bu({priority:s}),()=>o)}}try{if(r=this.currentTracer.context(()=>lB!==r[mo]._V?sp(`Cannot execute an Effect versioned ${r[mo]._V} with a Runtime of version ${id()}`):this[r._op](r),this),r===br){const s=Sr.currentOp;return s._op===$l||s._op===Hc?br:(Sr.currentOp=null,s._op===_t||s._op===St?s:ye(Jt(s)))}}catch(s){r!==br&&!j(r,"_op")||!(r._op in this)?r=sp(`Not a valid effect: ${wi(r)}`):$L(s)?r=ye(lt(Jt(s),$n(Cn))):r=_a(s)}}}}const z0=ee("effect/FiberRef/currentMinimumLogLevel",()=>kt(wq("Info"))),fB=e=>Ou(t=>{const n=oh(t.context,fr);en(n,rh).unsafe.log(e.log(t))}),B0=ee(Symbol.for("effect/Logger/defaultLogger"),()=>fB(_j)),K0=ee(Symbol.for("effect/Logger/tracerLogger"),()=>Ou(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const i=Br(Ia(n,Wn),lr);if(i._tag==="None"||i.value._tag==="ExternalSpan")return;const c=Ed(Ia(n,fr),Ao),u={};for(const[l,g]of e)u[l]=g;u["effect.fiberId"]=zA(r),u["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(u["effect.cause"]=$s(t,{renderErrorCause:!0})),i.value.event(wi(Array.isArray(o)?o[0]:o),c.unsafeCurrentTimeNanos(),u)})),hh=ee(Symbol.for("effect/FiberRef/currentLoggers"),()=>cL(Nd(B0,K0))),lb=f(e=>yn(e[0]),(e,t)=>Wr(Ur(e,n=>W0(r=>t(n,r))))),W0=e=>oe(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return k(V0,s=>$a(s,o=>oe(i=>{const c=i.getFiberRefs(),u=i.currentRuntimeFlags,l=Fa(c,n),g=os(u,r),h=Fa(n,c);return i.setFiberRefs(Ma(l,i.id(),n)),Ki(G2(e(o),g),O(()=>{i.setFiberRefs(Ma(h,i.id(),i.getFiberRefs()))}))})))}),dB=e=>{if(Array.isArray(e)||Rm(e))return[e,M()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),x(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},hB=(e,t,n)=>{const r=[];for(const s of e)r.push(Ni(s));return k(zi(r,K,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>{const o=M(),i=s.length,c=new Array(i),u=new Array(i);let l=!1;for(let g=0;g<i;g++){const h=s[g];h._tag==="Left"?(c[g]=x(h.left),l=!0):(u[g]=h.right,c[g]=o)}return l?t._tag==="Some"?Me(t.value(c)):Me(c):n!=null&&n.discard?ne:t._tag==="Some"?R(t.value(u)):R(u)})},gB=(e,t,n)=>{const r=[];for(const s of e)r.push(Ni(s));return n!=null&&n.discard?zi(r,K,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}):G(zi(r,K,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},gh=(e,t)=>{const[n,r]=dB(e);return(t==null?void 0:t.mode)==="validate"?hB(n,r,t):(t==null?void 0:t.mode)==="either"?gB(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?G(zi(n,K,t),r.value):zi(n,K,t)},pB=f(2,(e,t)=>Array.from({length:t},()=>e)),mB=f(e=>yn(e[0]),(e,t,n)=>gh(pB(e,t),n)),zi=f(e=>Rm(e[0]),(e,t,n)=>oe(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(gL);return n!=null&&n.discard?X_(n.concurrency,()=>Vo(Pa,n==null?void 0:n.concurrentFinalizers)(o=>s?Mr(e,(i,c)=>o(t(i,c)),!0,!1,1):yo(e,(i,c)=>o(t(i,c)))),()=>Vo(mp,n==null?void 0:n.concurrentFinalizers)(o=>Mr(e,(i,c)=>o(t(i,c)),s,!1)),o=>Vo(yp(o),n==null?void 0:n.concurrentFinalizers)(i=>Mr(e,(c,u)=>i(t(c,u)),s,!1,o))):X_(n==null?void 0:n.concurrency,()=>Vo(Pa,n==null?void 0:n.concurrentFinalizers)(o=>s?Op(e,1,(i,c)=>o(t(i,c)),!0):Tr(e,(i,c)=>o(t(i,c)))),()=>Vo(mp,n==null?void 0:n.concurrentFinalizers)(o=>fb(e,(i,c)=>o(t(i,c)),s)),o=>Vo(yp(o),n==null?void 0:n.concurrentFinalizers)(i=>Op(e,o,(c,u)=>i(t(c,u)),s)))})),fb=(e,t,n)=>B(()=>{const r=pe(e),s=new Array(r.length);return ge(Mr(r,(i,c)=>k(t(i,c),u=>O(()=>s[c]=u)),n,!1),R(s))}),Mr=(e,t,n,r,s)=>Qt(o=>H2(i=>oe(c=>{let u=Array.from(e).reverse(),l=u.length;if(l===0)return ne;let g=0,h=!1;const p=s?Math.min(u.length,s):u.length,m=new Set,b=new Array,$=()=>m.forEach(T=>{T.currentScheduler.scheduleTask(()=>{T.unsafeInterruptAsFork(c.id())},0)}),_=new Array,w=new Array,S=new Array,P=()=>{const T=b.filter(({exit:N})=>N._tag==="Failure").sort((N,v)=>N.index<v.index?-1:N.index===v.index?0:1).map(({exit:N})=>N);return T.length===0&&T.push(Ot),T},y=(T,N=!1)=>{const v=Wr(i(T)),L=bB(v,c,c.currentRuntimeFlags,Tu);return c.currentScheduler.scheduleTask(()=>{N&&L.unsafeInterruptAsFork(c.id()),L.resume(v)},0),L},E=()=>{r||(l-=u.length,u=[]),h=!0,$()},C=n?z2:Ln,I=y(Un(T=>{const N=(L,X)=>{L._op==="Blocked"?S.push(L):(b.push({index:X,exit:L}),L._op==="Failure"&&!h&&E())},v=()=>{if(u.length>0){const L=u.pop();let X=g++;const me=()=>{const We=u.pop();return X=g++,k(bu(),()=>k(C(o(t(We,X))),z))},z=We=>u.length>0&&(N(We,X),u.length>0)?me():R(We),Ae=k(C(o(t(L,X))),z),Ee=y(Ae);_.push(Ee),m.add(Ee),h&&Ee.currentScheduler.scheduleTask(()=>{Ee.unsafeInterruptAsFork(c.id())},0),Ee.addObserver(We=>{let ht;if(We._op==="Failure"?ht=We:ht=We.effect_instruction_i0,w.push(Ee),m.delete(Ee),N(ht,X),b.length===l)T(R(je(li(P(),{parallel:!0}),()=>Ot)));else if(S.length+b.length===l){const Gn=P(),mP=S.map(Tc=>Tc.effect_instruction_i0).reduce(NC);T(R(GC(mP,Mr([je(li(Gn,{parallel:!0}),()=>Ot),...S.map(Tc=>Tc.effect_instruction_i1)],Tc=>Tc,n,!0,s))))}else v()})}};for(let L=0;L<p;L++)v()}));return cn(ur(uc(o(ji(I))),eh({onFailure:T=>{E();const N=S.length+1,v=Math.min(typeof s=="number"?s:S.length,S.length),L=Array.from(S);return Un(X=>{let me=0,z=0;const Ae=(We,ht)=>Gn=>{me++,me===N&&X(de(ye(T))),L.length>0&&ht&&Ee()},Ee=()=>{y(L.pop(),!0).addObserver(Ae(z,!0)),z++};I.addObserver(Ae(z,!1)),z++;for(let We=0;We<v;We++)Ee()})},onSuccess:()=>Tr(w,T=>T.inheritAll)})))}))),Op=(e,t,n,r)=>B(()=>{const s=pe(e),o=new Array(s.length);return ge(Mr(s,(c,u)=>G(n(c,u),l=>o[u]=l),r,!1,t),R(o))}),yB=e=>oe((t,n)=>R(db(e,t,n.runtimeFlags))),Bi=e=>SB(e,Tu),db=(e,t,n,r=null)=>{const s=Rf(e,t,n,r);return s.resume(e),s},bB=(e,t,n,r=null)=>Rf(e,t,n,r),Rf=(e,t,n,r=null)=>{const s=SC(),o=t.getFiberRefs(),i=lq(o,s),c=new j0(s,i,n),u=Ia(i,Wn),l=c.currentSupervisor;return l.onStart(u,e,x(t),c),c.addObserver(h=>l.onEnd(h,c)),(r!==null?r:d(t.getFiberRef(ip),je(()=>t.scope()))).add(n,c),c},SB=(e,t)=>oe((n,r)=>R(db(e,n,r.runtimeFlags,t))),ow=e=>mc(t=>Re(Br(t,Hn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return k(Yd(n,mp),r=>Lo(e,r))}}})),iw=e=>t=>mc(n=>Re(Br(n,Hn),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:k(Yd(r,yp(e)),s=>Lo(t,s))})),Vo=(e,t)=>n=>mc(r=>Re(Br(r,Hn),{onNone:()=>n(K),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?ow:e._tag==="Sequential"?cw:iw(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(ow));case"Sequential":return o(n(cw));case"ParallelN":return o(n(iw(s.strategy.parallelism)))}}else return n(K)}})),ph=e=>k(Hn,e),H0=e=>k(Sc(),t=>ur(e(t),n=>t.close(n))),J0=e=>k(Sc(),t=>vB(e,t)),cw=e=>mc(t=>Re(Br(t,Hn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return k(Yd(n,Pa),r=>Lo(e,r))}}})),_B=f(e=>yn(e[1]),(e,t,n)=>Mu(e,t,(r,s)=>[r,s],n)),wB=f(e=>yn(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?is(e,t):Mu(e,t,(r,s)=>r,n)),$B=f(e=>yn(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?ge(e,t):Mu(e,t,(r,s)=>s,n)),Mu=f(e=>yn(e[1]),(e,t,n,r)=>G(gh([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),Hn=on("effect/Scope"),V0=Hn,EB=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},kB={[w_]:w_,[$_]:$_,pipe(){return D(this,arguments)},fork(e){return O(()=>{const t=G0(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),EB(t,s=>O(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return B(()=>{if(this.state._tag==="Closed")return ne;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?ne:hU(this.strategy)?d(Tr(t,n=>Ln(n(e))),k(n=>d(li(n),Hs(gg),je(()=>Ot)))):gU(this.strategy)?d(fb(t,n=>Ln(n(e)),!1),k(n=>d(li(n,{parallel:!0}),Hs(gg),je(()=>Ot)))):d(Op(t,this.strategy.parallelism,n=>Ln(n(e)),!1),k(n=>d(li(n,{parallel:!0}),Hs(gg),je(()=>Ot))))})},addFinalizer(e){return B(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),ne))}},G0=(e=Iu)=>{const t=Object.create(kB);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},Sc=(e=Iu)=>O(()=>G0(e)),Lo=f(2,(e,t)=>Ny(e,Kr(uu(Hn,t)))),vB=f(2,(e,t)=>d(e,Lo(t),ur(n=>t.close(n)))),CB=e=>fc(e,{differ:tB,fork:Xc}),IB=f(2,(e,t)=>cn(lb(k(Su(e),n=>rt(mf(e,t),n)),n=>mf(e,n)))),hb=f(2,(e,t)=>lc(e,n=>IB(e,t(n)))),aw=uL(s2),TB=CB(dh),Q0=f(3,(e,t,n)=>X0(e,t,{onSelfWin:(r,s)=>k(r.await,o=>{switch(o._tag){case _t:return k(r.inheritAll,()=>n.onSelfDone(o,s));case St:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>k(r.await,o=>{switch(o._tag){case _t:return k(r.inheritAll,()=>n.onOtherDone(o,s));case St:return n.onOtherDone(o,s)}})})),OB=e=>Qt(t=>Fo(n=>k(Bi(t(e)),r=>d(t(ji(r)),Es(()=>d(r,b0(n))))))),Y0=f(2,(e,t)=>Fo(n=>Q0(e,t,{onSelfDone:(r,s)=>up(r,{onFailure:o=>d(ji(s),H_(i=>qr(o,i))),onSuccess:o=>d(s,Or(n),rt(o))}),onOtherDone:(r,s)=>up(r,{onFailure:o=>d(ji(s),H_(i=>qr(i,o))),onSuccess:o=>d(s,Or(n),rt(o))})}))),X0=f(3,(e,t,n)=>oe((r,s)=>{const o=s.runtimeFlags,i=Oo(!0),c=Rf(e,r,o,n.selfScope),u=Rf(t,r,o,n.otherScope);return Un(l=>{c.addObserver(()=>uw(c,u,n.onSelfWin,i,l)),u.addObserver(()=>uw(u,c,n.onOtherWin,i,l)),c.startFork(e),u.startFork(t)},Gs(c.id(),u.id()))})),uw=(e,t,n,r,s)=>{PA(!0,!1)(r)&&s(n(e,t))},Ki=f(2,(e,t)=>Qt(n=>sn(n(e),{onFailure:r=>sn(t,{onFailure:s=>Be(lt(r,s)),onSuccess:()=>Be(r)}),onSuccess:r=>rt(t,r)}))),RB=(e,t,n)=>Fo(r=>k(k(Bi(Li(e)),s=>Un(o=>{const i=t.map(l=>l.listeners.count),c=()=>{i.every(l=>l===0)&&t.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&Zd(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&by(l.result.state.current.effect.cause)))&&(u.forEach(l=>l()),n==null||n(),o(wa(s)))};s.addObserver(l=>{u.forEach(g=>g()),o(l)});const u=t.map((l,g)=>{const h=p=>{i[g]=p,c()};return l.listeners.addObserver(h),()=>l.listeners.removeObserver(h)});return c(),O(()=>{u.forEach(l=>l())})})),()=>B(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return yo(s,o=>Jz(o.request,Py(r)))}))),lw=(e,t)=>(t=Fr(t),Wr(oe(n=>{const r=Ed(n.getFiberRef(Wn),Hn),s=Qy(n,e,t),o=n.getFiberRef(Qd),i=en(n.getFiberRef(fr),Ao);return rt($a(r,c=>wf(s,c,i,o)),s)}))),PB=e=>hb(fr,er(vu,e)),FB=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Fr(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return k(lw(t,Fr(n)),s=>Oa(r,lr,s))}return r=>k(lw(t,Fr(n)),s=>Oa(r,lr,s))},MB=Dr,_c=po,Wi=Jt,mh=$n,xB=qr,AB=lt,NB=py,Z0=k2,LB=my,xa=by,Ys=Bd,DB=Sy,yh=_y,eT=C2,bh=BC,gb=bL,tT=Hd,qB=EL,Sh=wu,nT=$s,UB="effect/ScheduleInterval",Pf=Symbol.for(UB),rT={[Pf]:Pf,startMillis:0,endMillis:0},pb=(e,t)=>e>t?rT:{[Pf]:Pf,startMillis:e,endMillis:t},jB=f(2,(e,t)=>zB(e,t)===e),zB=f(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),BB=e=>e.startMillis>=e.endMillis,KB=f(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return pb(n,r)}),WB=e=>da(e.endMillis-e.startMillis),HB=e=>pb(e,Number.POSITIVE_INFINITY),fw=pb,sT=rT,JB=jB,VB=BB,GB=KB,QB=WB,YB=HB,XB="effect/ScheduleIntervals",dw=Symbol.for(XB),oT=e=>({[dw]:dw,intervals:e}),ZB=f(2,(e,t)=>eK(e.intervals,t.intervals,xe())),eK=(e,t,n)=>{let r=e,s=t,o=n;for(;Lr(r)&&Lr(s);){const i=d(sr(r),GB(sr(s))),c=VB(i)?o:d(o,Ft(i));d(sr(r),JB(sr(s)))?r=Ir(r):s=Ir(s),o=c}return oT(Nr(o))},Rp=e=>d(e.intervals,Id,je(()=>sT)).startMillis,tK=e=>d(e.intervals,Id,je(()=>sT)).endMillis,nK=f(2,(e,t)=>Rp(e)<Rp(t)),rK=e=>Lr(e.intervals),sK=oT,oK=ZB,Pp=Rp,Fp=tK,iK=nK,cK=rK,mb="Continue",iT="Done",aK=e=>({_tag:mb,intervals:e}),uK=e=>({_tag:mb,intervals:sK(ke(e))}),lK={_tag:iT},fK=e=>e._tag===mb,dK=e=>e._tag===iT,hK=aK,cT=uK,Aa=lK,hw=fK,Na=dK,aT=Hn,In=lI,gK=$a,yt=cp,_h=Lo,yb=Yd,wh=Sc,pK=Ud,bb=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends Ry{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError}(),mK=e=>{const t={BaseEffectError:class extends bb{constructor(){super(...arguments);a(this,"_tag",e)}}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},yK="effect/Schedule",uT=Symbol.for(yK),lT=e=>j(e,uT),bK="effect/ScheduleDriver",SK=Symbol.for(bK),_K={_Out:e=>e,_In:e=>e,_R:e=>e},wK={_Out:e=>e,_In:e=>e,_R:e=>e};var IE;IE=uT;class $K{constructor(t,n){a(this,"initial");a(this,"step");a(this,IE,_K);this.initial=t,this.step=n}pipe(){return D(this,arguments)}}var TE;TE=SK;class EK{constructor(t,n){a(this,"schedule");a(this,"ref");a(this,TE,wK);this.schedule=t,this.ref=n}get state(){return G(cs(this.ref),t=>t[1])}get last(){return k(cs(this.ref),([t,n])=>{switch(t._tag){case"None":return pu(()=>new wu);case"Some":return R(t.value)}})}get reset(){return Ta(this.ref,[M(),this.schedule.initial])}next(t){return d(G(cs(this.ref),n=>n[1]),k(n=>d(rq,k(r=>d(B(()=>this.schedule.step(r,t,n)),k(([s,o,i])=>{const c=Ta(this.ref,[x(o),s]);if(Na(i))return ge(c,Me(M()));const u=Pp(i.intervals)-r;return u<=0?rt(c,o):d(c,ge(Gy(da(u))),rt(o))}))))))}}const wc=(e,t)=>new $K(e,t),fT=f(2,(e,t)=>kK(e,n=>O(()=>t(n)))),kK=f(2,(e,t)=>RK(e,(n,r)=>G(t(n),s=>Hx(r,pn(s))))),vK=f(2,(e,t)=>Sb(e,(n,r)=>O(()=>t(n,r)))),Sb=f(2,(e,t)=>wc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>Na(c)?R([o,i,Aa]):G(t(r,i),u=>u?[o,i,c]:[o,i,Aa])))),CK=e=>fT(e,t=>t),dT=e=>d(_f([M(),e.initial]),G(t=>new EK(e,t))),IK=(e,t=2)=>{const n=pn(e);return CK(gT(xu,r=>Wx(n,Math.pow(t,r))))},hT=f(2,(e,t)=>TK(e,t,oK)),TK=f(3,(e,t,n)=>wc([e.initial,t.initial],(r,s,o)=>d(rI(e.step(r,s,o[0]),t.step(r,s,o[1]),(i,c)=>[i,c]),k(([[i,c,u],[l,g,h]])=>hw(u)&&hw(h)?Mp(e,t,s,i,c,u.intervals,l,g,h.intervals,n):R([[i,l],[c,g],Aa]))))),Mp=(e,t,n,r,s,o,i,c,u,l)=>{const g=l(o,u);return cK(g)?R([[r,i],[s,c],hK(g)]):d(o,iK(u))?k(e.step(Fp(o),n,r),([h,p,m])=>Na(m)?R([[h,i],[p,c],Aa]):Mp(e,t,n,h,p,m.intervals,i,c,u,l)):k(t.step(Fp(u),n,i),([h,p,m])=>Na(m)?R([[r,h],[s,p],Aa]):Mp(e,t,n,r,s,o,h,p,m.intervals,l))},gT=f(2,(e,t)=>OK(e,n=>O(()=>t(n)))),OK=f(2,(e,t)=>wc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>G(t(i),u=>[o,u,c])))),RK=f(2,(e,t)=>wc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>{if(Na(c))return R([o,i,c]);const u=c.intervals,l=QB(fw(n,Pp(u)));return G(t(i,l),g=>{const h=pn(g),p=Pp(u),m=n+Ci(h),b=m-p,$=Math.max(0,Fp(u)+b),_=fw(m,$);return[o,i,cT(_)]})}))),PK=e=>wc(e.initial,(t,n,r)=>d(e.step(t,n,r),G(([s,o,i])=>[s,n,i]))),pT=e=>xK(xu,t=>t<e),FK=e=>fT(xu,()=>e),MK=(e,t)=>wc(e,(n,r,s)=>O(()=>[t(s),s,cT(YB(n))])),mT=f(2,(e,t)=>Sb(e,(n,r)=>Gq(t(n)))),yT=f(2,(e,t)=>Sb(e,(n,r)=>t(n))),xK=f(2,(e,t)=>vK(e,(n,r)=>t(r))),Fl=Symbol.for("effect/Schedule/ScheduleDefect");var OE;OE=Fl;class AK{constructor(t){a(this,"error");a(this,OE);this.error=t,this[Fl]=Fl}}const NK=e=>j(e,Fl),Ff=e=>Ai(e,t=>_a(new AK(t))),bT=e=>gu(e,t=>Re(Kd(t,n=>my(n)&&NK(n.defect)?x(n.defect):M()),{onNone:()=>Be(t),onSome:n=>Me(n.error)})),gw=f(2,(e,t)=>DK(e,t,(n,r)=>Me(n))),LK=f(2,(e,t)=>{if(lT(t))return gw(e,t);const n=t.schedule??PK(xu),r=t.while?yT(n,i=>{const c=t.while(i);return typeof c=="boolean"?R(c):Ff(c)}):n,s=t.until?mT(r,i=>{const c=t.until(i);return typeof c=="boolean"?R(c):Ff(c)}):r,o=t.times?hT(s,pT(t.times)).pipe(gT(i=>i[0])):s;return bT(gw(e,o))}),DK=f(3,(e,t,n)=>k(dT(t),r=>ar(e,{onFailure:s=>n(s,M()),onSuccess:s=>ST(e,r,n,s)}))),ST=(e,t,n,r)=>ar(t.next(r),{onFailure:()=>Cy(t.last),onSuccess:s=>ar(e,{onFailure:o=>n(o,x(s)),onSuccess:o=>ST(e,t,n,o)})}),pw=f(2,(e,t)=>UK(e,t,(n,r)=>Me(n))),qK=f(2,(e,t)=>{if(lT(t))return pw(e,t);const n=t.schedule??xu,r=t.while?yT(n,i=>{const c=t.while(i);return typeof c=="boolean"?R(c):Ff(c)}):n,s=t.until?mT(r,i=>{const c=t.until(i);return typeof c=="boolean"?R(c):Ff(c)}):r,o=t.times?hT(s,pT(t.times)):s;return bT(pw(e,o))}),UK=f(3,(e,t,n)=>k(dT(t),r=>_T(e,r,n))),_T=(e,t,n)=>Ai(e,r=>ar(t.next(r),{onFailure:()=>d(t.last,Cy,k(s=>n(r,s))),onSuccess:()=>_T(e,t,n)})),xu=MK(0,e=>e+1);class jK{constructor(t){a(this,"permits");a(this,"waiters",new Set);a(this,"taken",0);a(this,"take",t=>es(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(R(t)))};return this.waiters.add(r),O(()=>{this.waiters.delete(r)})}return this.taken+=t,n(R(t))}));a(this,"updateTaken",t=>oe(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(uh).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(xo)),R(this.free))));a(this,"release",t=>this.updateTaken(n=>n-t));a(this,"releaseAll",this.updateTaken(t=>0));a(this,"withPermits",t=>n=>Qt(r=>k(r(this.take(t)),s=>Ki(r(n),this.release(s)))));a(this,"withPermitsIfAvailable",t=>n=>Qt(r=>B(()=>this.free<t?Ra:(this.taken+=t,Ki(r(Nq(n)),this.release(t))))));this.permits=t}get free(){return this.permits-this.taken}}const Zc=e=>new jK(e),zK=e=>O(()=>Zc(e));class BK extends Hr{constructor(n){super();a(this,"isOpen");a(this,"waiters",[]);a(this,"scheduled",!1);a(this,"flushWaiters",()=>{this.scheduled=!1;const n=this.waiters;this.waiters=[];for(let r=0;r<n.length;r++)n[r](Ot)});a(this,"open",oe(n=>this.isOpen?ne:(this.isOpen=!0,this.unsafeSchedule(n))));a(this,"release",oe(n=>this.isOpen?ne:this.unsafeSchedule(n)));a(this,"await",es(n=>this.isOpen?n(ne):(this.waiters.push(n),O(()=>{const r=this.waiters.indexOf(n);r!==-1&&this.waiters.splice(r,1)}))));a(this,"close",O(()=>{this.isOpen=!1}));a(this,"whenOpen",n=>ge(this.await,n));this.isOpen=n}commit(){return this.await}unsafeSchedule(n){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,n.currentScheduler.scheduleTask(this.flushWaiters,n.getFiberRef(xo))),ne}unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}unsafeClose(){this.isOpen=!1}}const wT=e=>new BK(e??!1),Mf=f(2,(e,t)=>oe((n,r)=>{const s=t,o=db(e,n,r.runtimeFlags,Tu);if(s.state._tag==="Open"){const i=()=>Fo(u=>H(u,o.id())?ne:cn(wa(o))),c={};s.state.finalizers.set(c,i),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(c)})}else o.unsafeInterruptAsFork(n.id());return R(o)})),KK=e=>ph(t=>Mf(e,t)),WK=f(2,(e,t)=>d(Ln(e),Y0(Ln(t)),n=>uc(n))),HK=f(2,(e,t)=>JK(e,{onTimeout:()=>vL(t),duration:t})),JK=f(2,(e,{duration:t,onTimeout:n})=>uc(VK(e,{onTimeout:()=>pu(n),onSuccess:R,duration:t}))),VK=f(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>Fo(s=>Qt(o=>X0(o(e),Li(Gy(t)),{onSelfWin:(i,c)=>k(i.await,u=>u._tag==="Success"?k(i.inheritAll,()=>rt(Or(c,s),n(u.value))):k(Or(c,s),()=>ye(u.cause))),onOtherWin:(i,c)=>k(i.await,u=>u._tag==="Success"?k(i.inheritAll,()=>rt(Or(c,s),r())):k(Or(c,s),()=>ye(u.cause))),otherScope:Tu})))),GK="effect/Ref/SynchronizedRef",$T=Symbol.for(GK),ET={_A:e=>e};var RE,PE,FE,ME;class QK extends(ME=Hr,FE=$T,PE=Wy,RE=qi,ME){constructor(n,r){super();a(this,"ref");a(this,"withLock");a(this,FE,ET);a(this,PE,Hy);a(this,RE,qi);a(this,"get");this.ref=n,this.withLock=r,this.get=cs(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>R(n(r)))}modifyEffect(n){return this.withLock(d(k(cs(this.ref),n),k(([r,s])=>rt(Ta(this.ref,s),r))))}}const YK=e=>O(()=>kT(e)),kT=e=>{const t=NI(e),n=Zc(1);return new QK(t,n.withPermits(1))},XK=Symbol.for("effect/ManagedRuntime"),ZK="Fold",eW="Fresh",tW="FromEffect",nW="Scoped",rW="Suspend",sW="Provide",oW="ProvideMerge",iW="ZipWith",vT=y0,cW=hj,mw=fj,tn=wa,CT=Or,aW=dj,yw=ji,Au=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},$h=Au((e,t,n)=>{const r=SC(),s=[[Wn,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([uh,[[r,n.scheduler]]]);let o=dq(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const i=new j0(r,o,e.runtimeFlags);let c=t;n!=null&&n.scope&&(c=k(yb(n.scope,Iu),l=>ge(lI(l,Fo(g=>H(g,i.id())?ne:Or(i,g))),ur(t,g=>yt(l,g)))));const u=i.currentSupervisor;return u!==dh&&(u.onStart(e.context,c,M(),i),i.addObserver(l=>u.onEnd(l,i))),Tu.add(e.runtimeFlags,i),(n==null?void 0:n.immediate)===!1?i.resume(c):i.start(c),i}),uW=Au((e,t)=>{const n=hW(e)(t);if(n._tag==="Failure")throw IT(n.effect_instruction_i0);return n.effect_instruction_i0});class lW extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);a(this,"fiber");a(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const fW=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new lW(e);return Error.stackTraceLimit=t,n},bg=Symbol.for("effect/Runtime/FiberFailure"),al=Symbol.for("effect/Runtime/FiberFailure/Cause");var xE,AE;class dW extends Error{constructor(n){const r=HC(n)[0];super((r==null?void 0:r.message)||"An error has occurred");a(this,AE);a(this,xE);this[bg]=bg,this[al]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[al].toJSON()}}toString(){return"(FiberFailure) "+$s(this[al],{renderErrorCause:!0})}[(AE=bg,xE=al,fe)](){return this.toString()}}const IT=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new dW(e);return Error.stackTraceLimit=t,n},TT=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return Ea(t.left);case"Right":return de(t.right);case"Some":return de(t.value);case"None":return Ea(wu())}},hW=Au((e,t)=>{const n=TT(t);if(n)return n;const r=new p0,s=$h(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||ti($y(fW(s),Ly(s)))}),gW=Au((e,t,n)=>OT(e,t,n).then(r=>{switch(r._tag){case _t:return r.effect_instruction_i0;case St:throw IT(r.effect_instruction_i0)}})),OT=Au((e,t,n)=>new Promise(r=>{const s=TT(t);s&&r(s);const o=$h(e)(t);o.addObserver(i=>{r(i)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class RT{constructor(t,n,r){a(this,"context");a(this,"runtimeFlags");a(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return D(this,arguments)}}const PT=e=>new RT(e.context,e.runtimeFlags,e.fiberRefs),pW=()=>oe((e,t)=>R(new RT(e.getFiberRef(Wn),t.runtimeFlags,e.getFiberRefs()))),mW=xC(sc,FC,PC),La=PT({context:ds(),runtimeFlags:mW,fiberRefs:hq()}),yW=f(2,(e,t)=>PT({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),bW=$h(La),SW=gW(La),_W=uW(La),wW=f(2,(e,t)=>e.modifyEffect(t)),$W="effect/Layer",FT=Symbol.for($W),EW={_RIn:e=>e,_E:e=>e,_ROut:e=>e},_o={[FT]:EW,pipe(){return D(this,arguments)}},kW="effect/Layer/MemoMap",Sg=Symbol.for(kW),vW=nc()("effect/Layer/CurrentMemoMap",{defaultValue:()=>TW()}),MT=e=>j(e,FT),CW=e=>e._op_layer===eW;var NE;NE=Sg;class xT{constructor(t){a(this,"ref");a(this,NE);this.ref=t,this[Sg]=Sg}getOrElseMemoize(t,n){return d(wW(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,i]=s,c=d(o,k(([u,l])=>d(XI(u),rt(l))),ur(eh({onFailure:()=>ne,onSuccess:()=>$a(n,i)})));return R([c,r])}return d(_f(0),k(o=>d(hc(),k(i=>d(_f(()=>ne),G(c=>{const u=Qt(g=>d(Sc(),k(h=>d(g(k(AT(t,h,!0),p=>zq(p(this)))),Ln,k(p=>{switch(p._tag){case St:return d(pI(i,p.effect_instruction_i0),ge(cp(h,p)),ge(Be(p.effect_instruction_i0)));case _t:return d(Ta(c,m=>d(cp(h,m),yu(LI(o,b=>[b===1,b-1])),cn)),ge(dp(o,m=>m+1)),ge($a(n,m=>d(O(()=>r.delete(t)),ge(cs(c)),k(b=>b(m))))),ge($u(i,p.effect_instruction_i0)),rt(p.effect_instruction_i0[1]))}}))))),l=[d(jn(i),ur(up({onFailure:()=>ne,onSuccess:()=>dp(o,g=>g+1)}))),g=>d(cs(c),k(h=>h(g)))];return[u,CW(t)?r:r.set(t,l)]}))))))}),uc)}}const IW=B(()=>G(YK(new Map),e=>new xT(e))),TW=()=>new xT(kT(new Map)),OW=e=>ph(t=>Nu(e,t)),Nu=f(2,(e,t)=>k(IW,n=>RW(e,n,t))),RW=f(3,(e,t,n)=>k(AT(e,n),r=>Oa(r(t),vW,t))),AT=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return O(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return O(()=>s=>ph(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return O(()=>s=>d(s.getOrElseMemoize(r.layer,t),sn({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return O(()=>s=>d(r.layer,Nu(t)));case"FromEffect":return O(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return O(()=>s=>d(s.getOrElseMemoize(r.first,t),k(o=>d(s.getOrElseMemoize(r.second,t),xy(o)))));case"Scoped":return O(n?()=>s=>Lo(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return O(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return O(()=>s=>d(s.getOrElseMemoize(r.first,t),rI(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return O(()=>s=>d(s.getOrElseMemoize(r.first,t),Mu(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},PW=()=>Lu(pc()),FW=e=>NT(_c(e)),NT=e=>Lu(Be(e)),_b=f(2,(e,t)=>AW(e,{onFailure:FW,onSuccess:t})),LT=f(2,(e,t)=>{const n=$d(e),r=n?e:t;return Lu(G(n?t:e,o=>uu(r,o)))});function Lu(e){const t=Object.create(_o);return t._op_layer=tW,t.effect=e,t}const MW=e=>J0(ge(ph(t=>d(e,Nu(t))),Q2)),xW=f(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(_o);return r._op_layer=ZK,r.layer=e,r.failureK=t,r.successK=n,r}),AW=f(2,(e,{onFailure:t,onSuccess:n})=>xW(e,{onFailure:r=>{const s=yh(r);switch(s._tag){case"Left":return t(s.left);case"Right":return NT(s.right)}},onSuccess:n})),DT=f(2,(e,t)=>qW(e,t,(n,r)=>Kr(n,r))),qT=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=DT(t,e[n]);return t},UT=f(2,(e,t)=>{const n=$d(e),r=n?e:t;return jT(G(n?t:e,o=>uu(r,o)))}),Eh=e=>jT(d(e,rt(ds()))),jT=e=>{const t=Object.create(_o);return t._op_layer=nW,t.effect=e,t},NW=f(2,(e,t)=>{const n=$d(e);return Lu(R(uu(n?e:t,n?t:e)))}),zT=e=>{const t=Object.create(_o);return t._op_layer=rW,t.evaluate=e,t},LW=f(2,(e,t)=>{const n=$d(e),r=n?e:t,s=n?t:e;return Lu(O(()=>uu(r,s())))}),DW=f(2,(e,t)=>zT(()=>{const n=Object.create(_o);return n._op_layer=sW,n.first=Object.create(_o,{_op_layer:{value:oW,enumerable:!0},first:{value:PW(),enumerable:!0},second:{value:Array.isArray(t)?qT(...t):t},zipK:{value:(r,s)=>d(r,Kr(s))}}),n.second=e,n})),qW=f(3,(e,t,n)=>zT(()=>{const r=Object.create(_o);return r._op_layer=iW,r.first=e,r.second=t,r.zipK=n,r})),UW=e=>{const t=on("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return _b(LT(t,e),n=>en(n,t))},jW=e=>{const t=on("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return _b(UT(t,e),n=>en(n,t))},bw=f(2,(e,t)=>H0(n=>k(Nu(t,n),r=>Ay(e,r)))),Sw=f(2,(e,t)=>{const n=Fa(La.fiberRefs,t.fiberRefs),r=os(La.runtimeFlags,t.runtimeFlags);return Qt(s=>oe(o=>{const i=o.getFiberRef(Wn),c=o.getFiberRefs(),u=Ma(o.id(),c)(n),l=o.currentRuntimeFlags,g=ui(r)(l),h=Fa(u,c),p=os(g,l);return o.setFiberRefs(u),o.currentRuntimeFlags=g,Ki(Ay(s(e),Kr(i,t.context)),oe(m=>(m.setFiberRefs(Ma(m.id(),m.getFiberRefs())(h)),m.currentRuntimeFlags=ui(p)(m.currentRuntimeFlags),ne)))}))}),zW=f(2,(e,t)=>Array.isArray(t)?bw(e,qT(...t)):MT(t)?bw(e,t):wx(t)?Ay(e,t):XK in t?k(t.runtimeEffect,n=>Sw(e,n)):Sw(e,t)),BW=Hz,_w=mo,pr=yn,_g=Vq,wb=gh,Et=zi,KW=Un,ps=oe,zn=Me,Vt=Be,Hi=_a,BT=sp,q=J2,WW=Yq,be=R,Ce=B,te=O,re=ne,HW=bu,$b=Ai,ms=gu,KT=Lq,JW=ZC,wg=Dq,WT=qq,VW=QI,Eb=Kq,kb=qK,Du=HI,GW=nU,ea=tU,QW=OB,Xr=st,ut=Li,HT=Es,ni=Wr,ys=Qt,xr=rt,qu=cn,ie=G,JT=vy,dr=Vd,ot=lb,VT=wy,mr=W0,Ds=Ki,GT=B2,YW=ur,kh=V0,xp=H0,wo=J0,QT=Fo,vb=yB,YT=Bi,nn=Mf,mn=KK,XW=jq,Cb=Gy,Ib=HK,XT=pc,ZW=Ny,hn=zW,di=Oa,e3=oU,t3=iU,Go=Ni,tt=Ln,vh=ky,n3=sU,U=k,hi=j2,Ps=uc,$g=Y0,ZT=WK,eO=Q0,Dn=Ur,$c=Xq,Tb=Vy,ww=LK,r3=Ty,s3=VI,Da=tI,En=sn,o3=ar,tO=Wq,wn=YI,ir=Hq,Ap=Jq,Xs=Aq,i3=pL,tr=Cy,vs=pW,Ob=zK,c3=wT,Cs=bW,nO=SW,us=_W,Np=_B,Rb=wB,Ie=$B,Ch=Mu,a3=eU,Lp=cU,Pb=e0,u3=aU,l3=gp,It=uU,Fb=FB,qs=pp,Mb=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return $w(e.length,function(...i){const c=Error.stackTraceLimit;Error.stackTraceLimit=2;const u=new Error;return Error.stackTraceLimit=c,Ew({self:this,body:e,args:i,pipeables:t,spanName:"<anonymous>",spanOptions:{context:Sf.context(!0)},errorDef:r,errorCall:u})});const s=e,o=t[0];return(i,...c)=>$w(i.length,{[s](...u){const l=Error.stackTraceLimit;Error.stackTraceLimit=2;const g=new Error;return Error.stackTraceLimit=l,Ew({self:this,body:i,args:u,pipeables:c,spanName:s,spanOptions:o,errorDef:r,errorCall:g})}}[s])};function $w(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function Ew(e){let t,n;if(jP(e.body))t=pf(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(i){n=i,t=Hi(i)}if(e.pipeables.length>0)try{for(const i of e.pipeables)t=i(t,...e.args)}catch(i){t=n?Vt(lt(Jt(n),Jt(i))):Hi(i)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const i=e.errorDef.stack.trim().split(`
`),c=e.errorCall.stack.trim().split(`
`);let u=i.slice(2).join(`
`).trim();u.includes("(")||(u=u.replace(/at (.*)/,"at ($1)"));let l=c.slice(2).join(`
`).trim();return l.includes("(")||(l=l.replace(/at (.*)/,"at ($1)")),r=`${u}
${l}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return It(t,e.spanName,o)}const Dp=V2,xb=kt,f3=Su,d3=lc,Ab=Wn,h3=xo,g3=hh,rO=uh,p3=uI,m3=Qd,y3=f(2,(e,t)=>Mo(z0,t)(e)),b3=e=>Eh(hb(hh,ai(e))),S3=e=>Eh(hb(hh,ay(e))),_3=f(2,(e,t)=>_b(S3(e),()=>b3(t))),w3=e=>Eh(PB(e)),$3=MT,E3=OW,k3=Nu,Nb=LT,v3=MW,C3=DT,I3=UT,T3=Eh,sO=NW,O3=LW,Lb=DW,R3=UW,P3=jW,F3=w3,M3="effect/QueueEnqueue",oO=Symbol.for(M3),x3="effect/QueueDequeue",Db=Symbol.for(x3),A3="effect/QueueStrategy",qb=Symbol.for(A3),N3="effect/BackingQueue",L3=Symbol.for(N3),Ub={_A:e=>e},D3={_A:e=>e},iO={_In:e=>e},jb={_Out:e=>e};var LE,DE,qE;class q3 extends(qE=Hr,DE=oO,LE=Db,qE){constructor(n,r,s,o,i){super();a(this,"queue");a(this,"takers");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,DE,iO);a(this,LE,jb);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=i}pipe(){return D(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return B(()=>Ai(this.unsafeSize(),()=>st))}unsafeSize(){return le(this.shutdownFlag)?M():x(this.queue.length()-jy(this.takers)+this.strategy.surplusSize())}get isEmpty(){return G(this.size,n=>n<=0)}get isFull(){return G(this.size,n=>n>=this.capacity())}get shutdown(){return Wr(oe(n=>(d(this.shutdownFlag,Ro(!0)),d(Mr(gi(this.takers),r=>My(r,n.id()),!1,!1),ge(this.strategy.shutdown),yu($u(this.shutdownHook,void 0)),cn))))}get isShutdown(){return O(()=>le(this.shutdownFlag))}get awaitShutdown(){return jn(this.shutdownHook)}isActive(){return!le(this.shutdownFlag)}unsafeOffer(n){if(le(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const o=d(this.takers,Pr(et));o!==et?(Zs(o,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return Us(this.strategy,this.queue,this.takers),s}offer(n){return B(()=>{if(le(this.shutdownFlag))return st;let r;if(this.queue.length()===0){const o=d(this.takers,Pr(et));o!==et?(Zs(o,n),r=!0):r=!1}else r=!1;if(r)return R(!0);const s=this.queue.offer(n);return Us(this.strategy,this.queue,this.takers),s?R(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return B(()=>{if(le(this.shutdownFlag))return st;const r=pe(n),s=this.queue.length()===0?pe(sH(this.takers,r.length)):fs,[o,i]=d(r,ev(s.length));for(let u=0;u<s.length;u++){const l=s[u],g=o[u];Zs(l,g)}if(i.length===0)return R(!0);const c=this.queue.offerAll(i);return Us(this.strategy,this.queue,this.takers),Cd(c)?R(!0):this.strategy.handleSurplus(c,this.queue,this.takers,this.shutdownFlag)})}get take(){return oe(n=>{if(le(this.shutdownFlag))return st;const r=this.queue.poll(et);if(r!==et)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),R(r);{const s=dc(n.id());return d(B(()=>(d(this.takers,Di(s)),Us(this.strategy,this.queue,this.takers),le(this.shutdownFlag)?st:jn(s))),Es(()=>O(()=>oH(this.takers,s))))}})}get takeAll(){return B(()=>le(this.shutdownFlag)?st:O(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ao(n)}))}takeUpTo(n){return B(()=>le(this.shutdownFlag)?st:O(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ao(r)}))}takeBetween(n,r){return B(()=>cO(this,n,r,xe()))}}const cO=(e,t,n,r)=>n<t?R(r):d(Y3(e,n),k(s=>{const o=t-s.length;return o===1?d(qp(e),G(i=>d(r,Ne(s),fa(i)))):o>1?d(qp(e),k(i=>cO(e,o-1,n-s.length-1,d(r,Ne(s),fa(i))))):R(d(r,Ne(s)))})),U3=e=>d(O(()=>Uy(e)),k(t=>Ih(Th(t),Z3()))),j3=e=>d(O(()=>Uy(e)),k(t=>Ih(Th(t),aO()))),z3=e=>d(O(()=>Uy(e)),k(t=>Ih(Th(t),eH()))),zb=()=>d(O(()=>th()),k(e=>Ih(Th(e),aO()))),B3=(e,t,n,r,s)=>new q3(e,t,n,r,s),Ih=(e,t)=>d(hc(),G(n=>B3(e,th(),n,Oo(!1),t)));var UE;UE=L3;class K3{constructor(t){a(this,"mutable");a(this,UE,D3);this.mutable=t}poll(t){return Pr(this.mutable,t)}pollUpTo(t){return nh(this.mutable,t)}offerAll(t){return zy(this.mutable,t)}offer(t){return Di(this.mutable,t)}capacity(){return oD(this.mutable)}length(){return jy(this.mutable)}}const Th=e=>new K3(e),W3=e=>e.size,H3=e=>e.isShutdown,J3=e=>e.shutdown,V3=f(2,(e,t)=>e.offer(t)),G3=f(2,(e,t)=>e.offerAll(t)),qp=e=>e.take,Q3=e=>e.takeAll,Y3=f(2,(e,t)=>e.takeUpTo(t)),X3=f(3,(e,t,n)=>e.takeBetween(t,n)),Z3=()=>new tH,aO=()=>new nH,eH=()=>new rH;var jE;jE=qb;class tH{constructor(){a(this,jE,Ub);a(this,"putters",th())}surplusSize(){return jy(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!Qs(this.putters)&&!Qs(t);){const n=Pr(t,void 0),r=Pr(this.putters,void 0);r[2]&&Zs(r[1],!0),Zs(n,r[0])}}get shutdown(){return d(mu,k(t=>d(O(()=>gi(this.putters)),k(n=>Mr(n,([r,s,o])=>o?d(My(s,t),cn):ne,!1,!1)))))}handleSurplus(t,n,r,s){return oe(o=>{const i=dc(o.id());return d(B(()=>(this.unsafeOffer(t,i),this.unsafeOnQueueEmptySpace(n,r),Us(this,n,r),le(s)?st:jn(i))),Es(()=>O(()=>this.unsafeRemove(i))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=d(this.putters,Pr(et));if(s===et)r=!1;else{const o=t.offer(s[0]);o&&s[2]?Zs(s[1],!0):o||xf(this.putters,d(gi(this.putters),Ft(s))),Us(this,t,n)}}}unsafeOffer(t,n){const r=pe(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?d(this.putters,Di([o,n,!0])):d(this.putters,Di([o,n,!1]))}}unsafeRemove(t){xf(this.putters,d(gi(this.putters),vd(([,n])=>n!==t)))}}var zE;let nH=(zE=qb,class{constructor(){a(this,zE,Ub)}surplusSize(){return 0}get shutdown(){return ne}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return R(!1)}unsafeOnQueueEmptySpace(t,n){}});var BE;BE=qb;class rH{constructor(){a(this,BE,Ub)}surplusSize(){return 0}get shutdown(){return ne}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return O(()=>(this.unsafeOffer(n,t),Us(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(et),o=t.offer(s.value)}}}const Zs=(e,t)=>Eu(e,R(t)),xf=(e,t)=>d(e,zy(t)),gi=e=>d(e,nh(Number.POSITIVE_INFINITY)),sH=(e,t)=>d(e,nh(t)),oH=(e,t)=>{xf(e,d(gi(e),vd(n=>t!==n)))},Us=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=d(n,Pr(et));if(s!==et){const o=t.poll(et);o!==et?(Zs(s,o),e.unsafeOnQueueEmptySpace(t,n)):xf(n,d(gi(n),Ft(s))),r=!0}else r=!1}r&&t.length()===0&&!Qs(n)&&e.onCompleteTakersWithEmptyQueue(n)},Zn=Symbol.for("effect/PubSub/AbsentValue"),uO=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},iH=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},cH=e=>B(()=>{const t=fH(e);return bH(t,new vH)}),aH=e=>e.shutdown,uH=f(2,(e,t)=>e.publish(t)),lH=e=>e.subscribe,fH=e=>new gH(e!=null&&e.replay?new TH(e.replay):void 0),dH=(e,t,n)=>G(hc(),r=>hH(e,t,e.subscribe(),th(),r,Oo(!1),n)),hH=(e,t,n,r,s,o,i)=>new mH(e,t,n,r,s,o,i,e.replayWindow());class gH{constructor(t){a(this,"replayBuffer");a(this,"publisherHead",{value:Zn,subscribers:0,next:null});a(this,"publisherTail",this.publisherHead);a(this,"publisherIndex",0);a(this,"subscribersIndex",0);a(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new OH(this.replayBuffer):RH}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return xe()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=Zn,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new pH(this,this.publisherTail,this.publisherIndex,!1)}}class pH{constructor(t,n,r,s){a(this,"self");a(this,"subscriberHead");a(this,"subscriberIndex");a(this,"unsubscribed");this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==Zn?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==Zn&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Zn,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=Zn;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return ao(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==Zn&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Zn,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}var KE,WE;class mH extends(WE=Hr,KE=Db,WE){constructor(n,r,s,o,i,c,u,l){super();a(this,"pubsub");a(this,"subscribers");a(this,"subscription");a(this,"pollers");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,"replayWindow");a(this,KE,jb);this.pubsub=n,this.subscribers=r,this.subscription=s,this.pollers=o,this.shutdownHook=i,this.shutdownFlag=c,this.strategy=u,this.replayWindow=l}commit(){return this.take}pipe(){return D(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!le(this.shutdownFlag)}get size(){return B(()=>le(this.shutdownFlag)?st:R(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return le(this.shutdownFlag)?M():x(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return B(()=>le(this.shutdownFlag)?st:R(this.subscription.size()===this.capacity()))}get isEmpty(){return G(this.size,n=>n===0)}get shutdown(){return Wr(oe(n=>(Ro(this.shutdownFlag,!0),d(fb(Bb(this.pollers),r=>My(r,n.id()),!1),ge(O(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),yu($u(this.shutdownHook,void 0)),cn))))}get isShutdown(){return O(()=>le(this.shutdownFlag))}get awaitShutdown(){return jn(this.shutdownHook)}get take(){return oe(n=>{if(le(this.shutdownFlag))return st;if(this.replayWindow.remaining>0){const s=this.replayWindow.take();return R(s)}const r=Qs(this.pollers)?this.subscription.poll(et):et;if(r===et){const s=dc(n.id());return d(B(()=>(d(this.pollers,Di(s)),d(this.subscribers,uO(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),le(this.shutdownFlag)?st:jn(s))),Es(()=>O(()=>kH(this.pollers,s))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),R(r)})}get takeAll(){return B(()=>{if(le(this.shutdownFlag))return st;const n=Qs(this.pollers)?wH(this.subscription):xe();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?R(Ne(this.replayWindow.takeAll(),n)):R(n)})}takeUpTo(n){return B(()=>{if(le(this.shutdownFlag))return st;let r;if(this.replayWindow.remaining>=n){const o=this.replayWindow.takeN(n);return R(o)}else this.replayWindow.remaining>0&&(r=this.replayWindow.takeAll(),n=n-r.length);const s=Qs(this.pollers)?$H(this.subscription,n):xe();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),R(r?Ne(r,s):s)})}takeBetween(n,r){return B(()=>lO(this,n,r,xe()))}}const lO=(e,t,n,r)=>n<t?R(r):d(e.takeUpTo(n),k(s=>{const o=t-s.length;return o===1?d(e.take,G(i=>d(r,Ne(s),fa(i)))):o>1?d(e.take,k(i=>lO(e,o-1,n-s.length-1,d(r,Ne(s),fa(i))))):R(d(r,Ne(s)))}));var HE,JE;JE=oO,HE=Db;class yH{constructor(t,n,r,s,o,i){a(this,"pubsub");a(this,"subscribers");a(this,"scope");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,JE,iO);a(this,HE,jb);this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=i}capacity(){return this.pubsub.capacity}get size(){return B(()=>le(this.shutdownFlag)?st:O(()=>this.pubsub.size()))}unsafeSize(){return le(this.shutdownFlag)?M():x(this.pubsub.size())}get isFull(){return G(this.size,t=>t===this.capacity())}get isEmpty(){return G(this.size,t=>t===0)}get awaitShutdown(){return jn(this.shutdownHook)}get isShutdown(){return O(()=>le(this.shutdownFlag))}get shutdown(){return Wr(oe(t=>(d(this.shutdownFlag,Ro(!0)),d(this.scope.close(Py(t.id())),ge(this.strategy.shutdown),yu($u(this.shutdownHook,void 0)),cn))))}publish(t){return B(()=>le(this.shutdownFlag)?st:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),R(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ke(t),this.shutdownFlag))}isActive(){return!le(this.shutdownFlag)}unsafeOffer(t){return le(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return B(()=>{if(le(this.shutdownFlag))return st;const n=EH(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Cd(n)?R(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=Ur(gh([this.scope.fork(Iu),dH(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return G(lb(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return D(this,arguments)}}const bH=(e,t)=>k(Sc(),n=>G(hc(),r=>SH(e,new Map,n,r,Oo(!1),t))),SH=(e,t,n,r,s,o)=>new yH(e,t,n,r,s,o),_H=(e,t)=>{Eu(e,R(t))},fO=(e,t)=>d(e,zy(t)),Bb=e=>d(e,nh(Number.POSITIVE_INFINITY)),wH=e=>e.pollUpTo(Number.POSITIVE_INFINITY),$H=(e,t)=>e.pollUpTo(t),EH=(e,t)=>e.publishAll(t),kH=(e,t)=>{fO(e,d(Bb(e),vd(n=>n!==t)))};class vH{get shutdown(){return ne}handleSurplus(t,n,r,s){return R(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return CH(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return IH(this,t,n)}}const CH=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const i=d(s,Pr(et));if(i===et)d(n,iH(r,s)),Qs(s)?o=!1:d(n,uO(r,s));else{const c=r.poll(et);c===et?fO(s,d(Bb(s),Ft(i))):(_H(i,c),e.unsafeOnPubSubEmptySpace(t,n))}}},IH=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class TH{constructor(t){a(this,"capacity");a(this,"head",{value:Zn,next:null});a(this,"tail",this.head);a(this,"size",0);a(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:Zn,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class OH{constructor(t){a(this,"buffer");a(this,"head");a(this,"index");a(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return xe();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,Ze(r)}takeAll(){return this.takeN(this.remaining)}}const RH={remaining:0,take:()=>{},takeN:()=>xe(),takeAll:()=>xe()},dO=cH,Up=aH,Kb=uH,kw=lH,qa=U3,hO=j3,gO=z3,ln=zb,PH=W3,FH=H3,Kt=J3,He=V3,Wb=G3,Ji=qp,MH=Q3,pO=X3,mO="Continue",xH="Close",AH="Yield",NH="effect/ChannelChildExecutorDecision",vw=Symbol.for(NH),LH={[vw]:vw},yO=e=>{const t=Object.create(LH);return t._tag=mO,t},Ml="ContinuationK",DH="ContinuationFinalizer",bO=Symbol.for("effect/ChannelContinuation"),SO={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};var VE;VE=bO;class Hb{constructor(t,n){a(this,"onSuccess");a(this,"onHalt");a(this,"_tag",Ml);a(this,VE,SO);this.onSuccess=t,this.onHalt=n}onExit(t){return yc(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}var GE;GE=bO;class qH{constructor(t){a(this,"finalizer");a(this,"_tag",DH);a(this,GE,SO);this.finalizer=t}}const _O="PullAfterNext",UH="PullAfterAllEnqueued",jH="effect/ChannelUpstreamPullStrategy",zH=Symbol.for(jH),BH={_A:e=>e},KH={[zH]:BH},wO=e=>{const t=Object.create(KH);return t._tag=_O,t.emitSeparator=e,t},$O="BracketOut",EO="Bridge",Jb="ConcatAll",kO="Emit",vO="Ensuring",CO="Fail",Vb="Fold",IO="FromEffect",TO="PipeTo",OO="Provide",RO="Read",PO="Succeed",FO="SucceedNow",MO="Suspend",WH="effect/Channel",Af=Symbol.for(WH),HH={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Lt={[Af]:HH,pipe(){return D(this,arguments)}},xO=e=>j(e,Af)||pr(e),JH=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=$O,n.acquire=()=>e,n.finalizer=t,n}),AO=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=Vb,n.channel=e,n.k=new Hb(Do,t),n}),NO=(e,t,n)=>{const r=Object.create(Lt);return r._tag=Jb,r.combineInners=t,r.combineAll=n,r.onPull=()=>wO(M()),r.onEmit=()=>yO,r.value=()=>e,r.k=K,r},VH=f(4,(e,t,n,r)=>{const s=Object.create(Lt);return s._tag=Jb,s.combineInners=n,s.combineAll=r,s.onPull=()=>wO(M()),s.onEmit=()=>yO,s.value=()=>e,s.k=t,s}),Gb=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=EO,n.input=t,n.channel=e,n}),Qb=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=vO,n.channel=e,n.finalizer=t,n}),Uu=e=>nt(_c(e)),nt=e=>GH(()=>e),GH=e=>{const t=Object.create(Lt);return t._tag=CO,t.error=e,t},he=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=Vb,n.channel=e,n.k=new Hb(t,nt),n}),ct=e=>{const t=Object.create(Lt);return t._tag=IO,t.effect=()=>e,t},Rt=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=TO,n.left=()=>e,n.right=()=>t,n}),jp=f(2,(e,t)=>{const n=Object.create(Lt);return n._tag=OO,n.context=()=>t,n.inner=e,n}),Oh=e=>Jn({onInput:e.onInput,onFailure:t=>Tt(yh(t),{onLeft:e.onFailure,onRight:nt}),onDone:e.onDone}),Jn=e=>{const t=Object.create(Lt);return t._tag=RO,t.more=e.onInput,t.done=new Hb(e.onDone,e.onFailure),t},Do=e=>LO(()=>e),bs=e=>{const t=Object.create(Lt);return t._tag=FO,t.terminal=e,t},Rh=e=>{const t=Object.create(Lt);return t._tag=MO,t.channel=e,t},LO=e=>{const t=Object.create(Lt);return t._tag=PO,t.evaluate=e,t},Pt=bs(void 0),Te=e=>{const t=Object.create(Lt);return t._tag=kO,t.out=e,t},ju="Done",zu="Emit",Ec="FromEffect",Bu="Read",QH=Symbol.for("effect/ChannelState"),YH={_E:e=>e,_R:e=>e},Ph={[QH]:YH},Qo=()=>{const e=Object.create(Ph);return e._tag=ju,e},Eg=()=>{const e=Object.create(Ph);return e._tag=zu,e},Ac=e=>{const t=Object.create(Ph);return t._tag=Ec,t.effect=e,t},kg=(e,t,n,r)=>{const s=Object.create(Ph);return s._tag=Bu,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},Nf=e=>e._tag===Ec,XH=e=>Nf(e)?e.effect:re,Cw=e=>Nf(e)?VW(e.effect):void 0,DO="PullFromChild",zp="PullFromUpstream",Bp="DrainChildExecutors",qO="Emit";class ul{constructor(t,n,r){a(this,"childExecutor");a(this,"parentSubexecutor");a(this,"onEmit");a(this,"_tag",DO);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?Ch(tt(n),tt(r),(s,o)=>d(s,Ca(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Fs{constructor(t,n,r,s,o,i,c,u){a(this,"upstreamExecutor");a(this,"createChild");a(this,"lastDone");a(this,"activeChildExecutors");a(this,"combineChildResults");a(this,"combineWithChildResult");a(this,"onPull");a(this,"onEmit");a(this,"_tag",zp);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c,this.onEmit=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?Ch(o,tt(i),(c,u)=>Ca(c,u)):o!==void 0?o:i!==void 0?tt(i):void 0,void 0);return s}enqueuePullFromChild(t){return new Fs(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class ri{constructor(t,n,r,s,o,i,c){a(this,"upstreamExecutor");a(this,"lastDone");a(this,"activeChildExecutors");a(this,"upstreamDone");a(this,"combineChildResults");a(this,"combineWithChildResult");a(this,"onPull");a(this,"_tag",Bp);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?Ch(o,tt(i),(c,u)=>Ca(c,u)):o!==void 0?o:i!==void 0?tt(i):void 0,void 0);return s}enqueuePullFromChild(t){return new ri(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class vg{constructor(t,n){a(this,"value");a(this,"next");a(this,"_tag",qO);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const ZH="Pulled",e5="NoUpstream",t5="effect/ChannelUpstreamPullRequest",n5=Symbol.for(t5),r5={_A:e=>e},UO={[n5]:r5},Iw=e=>{const t=Object.create(UO);return t._tag=ZH,t.value=e,t},s5=e=>{const t=Object.create(UO);return t._tag=e5,t.activeDownstreamCount=e,t};class js{constructor(t,n,r){a(this,"_activeSubexecutor");a(this,"_cancelled");a(this,"_closeLastSubstream");a(this,"_currentChannel");a(this,"_done");a(this,"_doneStack",[]);a(this,"_emitted");a(this,"_executeCloseLastSubstream");a(this,"_input");a(this,"_inProgressFinalizer");a(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=Qo();else switch(pr(this._currentChannel)&&(this._currentChannel=ct(this._currentChannel)),this._currentChannel._tag){case $O:{t=this.runBracketOut(this._currentChannel);break}case EO:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>U(n.awaitRead(),()=>Ce(()=>{const o=r.run();switch(o._tag){case ju:return or(r.getDone(),{onFailure:i=>n.error(i),onSuccess:i=>n.done(i)});case zu:return U(n.emit(r.getEmit()),()=>s());case Ec:return En(o.effect,{onFailure:i=>n.error(i),onSuccess:()=>s()});case Bu:return Yb(o,()=>s(),i=>n.error(i))}}));t=Ac(U(YT(ut(s())),o=>te(()=>this.addFinalizer(i=>U(tn(o),()=>Ce(()=>{const c=this.restorePipe(i,r);return c!==void 0?c:re}))))))}break}case Jb:{const n=new js(this._currentChannel.value(),this._providedEnv,s=>te(()=>{const o=this._closeLastSubstream===void 0?re:this._closeLastSubstream;this._closeLastSubstream=d(o,Ie(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Fs(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case kO:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Pt,t=Eg();break}case vO:{this.runEnsuring(this._currentChannel);break}case CO:{t=this.doneHalt(this._currentChannel.error());break}case Vb:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case IO:{const n=this._providedEnv===void 0?this._currentChannel.effect():d(this._currentChannel.effect(),hn(this._providedEnv));t=Ac(En(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&Nf(s)?s.effect:re},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&Nf(s)?s.effect:re}}));break}case TO:{const n=this._input,r=new js(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:re}),this._currentChannel=this._currentChannel.right();break}case OO:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>te(()=>{this._providedEnv=n}));break}case RO:{const n=this._currentChannel;t=kg(this._input,K,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(va(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case PO:{t=this.doneSucceed(this._currentChannel.evaluate());break}case FO:{t=this.doneSucceed(this._currentChannel.terminal);break}case MO:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=nt(Wi(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?re:Ig(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ml)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):re}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=d(r,Ds(te(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=d(o,Ds(te(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(i===void 0&&n===void 0&&s===void 0))return d(tt(Cg(i)),Np(tt(Cg(n))),Np(tt(Cg(s))),ie(([[c,u],l])=>d(c,Ca(u),Ca(l))),ni,U(c=>Ce(()=>c)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Je(t),this._currentChannel=void 0,Qo();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ml){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Je(t),this._currentChannel=void 0,Qo();const s=Ig(r.map(i=>i.finalizer),Je(t));this.storeInProgressFinalizer(s);const o=d(s,Ds(te(()=>this.clearInProgressFinalizer())),ni,U(()=>te(()=>this.doneSucceed(t))));return Ac(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=bt(t),this._currentChannel=void 0,Qo();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ml){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(i){this._currentChannel=nt(Wi(i))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=bt(t),this._currentChannel=void 0,Qo();const s=Ig(r.map(i=>i.finalizer),bt(t));this.storeInProgressFinalizer(s);const o=d(s,Ds(te(()=>this.clearInProgressFinalizer())),ni,U(()=>te(()=>this.doneHalt(t))));return Ac(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Qo()}runBracketOut(t){const n=ni(En(this.provide(t.acquire()),{onFailure:r=>te(()=>{this._currentChannel=nt(r)}),onSuccess:r=>te(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=Te(r)})}));return Ac(n)}provide(t){return this._providedEnv===void 0?t:d(t,hn(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new qH(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case DO:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case zp:return this.pullFromUpstream(t);case Bp:return this.drainChildExecutors(t);case qO:return this._emitted=t.value,this._activeSubexecutor=t.next,Eg()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=or(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?re:XH(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>d(n,Et(s=>d(te(()=>s(t)),U(o=>o!==void 0?o:re)),{discard:!0})));const r=d(t,or({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case _O:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case UH:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return kg(t,K,o=>{const i=r(o);switch(i._tag){case mO:break;case xH:{this.finishWithDoneValue(t,n,i.value);break}case AH:{const c=n.enqueuePullFromChild(s);this.replaceSubexecutor(c);break}}this._activeSubexecutor=new vg(o,this._activeSubexecutor)},or({onFailure:o=>{const i=this.handleSubexecutorFailure(t,n,o);return i===void 0?void 0:Cw(i)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case zp:{const o=new Fs(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Je(r)),this.replaceSubexecutor(o);break}case Bp:{const o=new ri(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Je(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(bt(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Fs(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new ul(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return kg(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?re:this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(r),Ie(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(i),ie(()=>{const c=new js(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);c._input=this._input;const[u,l]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(Iw(n)));this._activeSubexecutor=new ul(c,new Fs(t.upstreamExecutor,t.createChild,t.lastDone,l,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),_e(u)&&(this._activeSubexecutor=new vg(u.value,this._activeSubexecutor))}))}const r=new js(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(Iw(n)));this._activeSubexecutor=new ul(r,new Fs(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),_e(s)&&(this._activeSubexecutor=new vg(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new ri(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(i),ie(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(d(n,WL(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:Cw(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>be(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,i=>t.upstreamExecutor.close(i))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,i]=this.applyUpstreamPullStrategy(!0,r,t.onPull(s5(r.reduce((c,u)=>u!==void 0?c+1:c,0))));return this.replaceSubexecutor(new ri(t.upstreamExecutor,t.lastDone,i,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),_e(o)?(this._emitted=o.value,Eg()):void 0}const s=new ri(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new ul(n.childExecutor,s,n.onEmit))}}const Cg=e=>e!==void 0?e:re,Ig=(e,t)=>d(Et(e,n=>tt(n(t))),ie(n=>d(BL(n),je(()=>xt))),U(n=>Ce(()=>n))),Yb=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return BT("Unexpected end of input for channel execution");const i=o.upstream.run();switch(i._tag){case zu:{const c=o.onEmit(o.upstream.getEmit());return r.length===0?c===void 0?Ce(t):d(c,En({onFailure:n,onSuccess:t})):c===void 0?Ce(()=>s()):d(c,En({onFailure:n,onSuccess:()=>s()}))}case ju:{const c=o.onDone(o.upstream.getDone());return r.length===0?c===void 0?Ce(t):d(c,En({onFailure:n,onSuccess:t})):c===void 0?Ce(()=>s()):d(c,En({onFailure:n,onSuccess:()=>s()}))}case Ec:return r.push(o),d(o.onEffect(i.effect),ms(c=>Ce(()=>{const u=o.onDone(bt(c));return u===void 0?re:u})),En({onFailure:n,onSuccess:()=>s()}));case Bu:return r.push(o),r.push(i),Ce(()=>s())}};return s()},jO=f(2,(e,t)=>{const n=(r,s,o)=>VT(te(()=>new js(e,void 0,K)),i=>Ce(()=>xl(i.run(),i).pipe(vh(r),Ie(De(r)),Rb(De(s)))),(i,c)=>{const u=i.close(c);return u===void 0?re:$c(u,l=>In(o,Vt(l)))});return ys(r=>wb([yb(t,Pa),ue(),ue()]).pipe(U(([s,o,i])=>r(n(o,i,s)).pipe(nn(t),U(c=>t.addFinalizer(u=>{const l=yc(u)?DB(u.cause):void 0;return yf(o).pipe(U(g=>g?qe(i,void 0).pipe(Ie(vT(c)),Ie(mw(c))):qe(i,void 0).pipe(Ie(l&&cy(l)>0?CT(c,jA(l)):tn(c)),Ie(mw(c)))))}).pipe(Ie(r(De(o)))))))))}),xl=(e,t)=>{const n=e;switch(n._tag){case Ec:return d(n.effect,U(()=>xl(t.run(),t)));case zu:return xl(t.run(),t);case ju:return Ce(()=>t.getDone());case Bu:return Yb(n,()=>xl(t.run(),t),Vt)}},zO="Done",o5="Await",i5="effect/ChannelMergeDecision",c5=Symbol.for(i5),BO={[c5]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},a5=e=>{const t=Object.create(BO);return t._tag=zO,t.effect=e,t},Kp=e=>{const t=Object.create(BO);return t._tag=o5,t.f=e,t},KO="BothRunning",WO="LeftDone",HO="RightDone",u5="effect/ChannelMergeState",Tw=Symbol.for(u5),Xb={[Tw]:Tw},Tg=(e,t)=>{const n=Object.create(Xb);return n._tag=KO,n.left=e,n.right=t,n},Ow=e=>{const t=Object.create(Xb);return t._tag=WO,t.f=e,t},Rw=e=>{const t=Object.create(Xb);return t._tag=HO,t.f=e,t},JO="BackPressure",VO="BufferSliding",l5="effect/ChannelMergeStrategy",Pw=Symbol.for(l5),GO={[Pw]:Pw},f5=e=>{const t=Object.create(GO);return t._tag=JO,t},d5=e=>{const t=Object.create(GO);return t._tag=VO,t},h5=f(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case JO:return t();case VO:return n()}}),Xo="Empty",jc="Emit",zc="Error",Bc="Done",QO=e=>({_tag:Xo,notifyProducer:e}),Og=e=>({_tag:jc,notifyConsumers:e}),g5=e=>({_tag:zc,cause:e}),p5=e=>({_tag:Bc,done:e});class m5{constructor(t){a(this,"ref");this.ref=t}awaitRead(){return Ps(Fc(this.ref,t=>t._tag===Xo?[De(t.notifyProducer),t]:[re,t]))}get close(){return QT(t=>this.error(mh(t)))}done(t){return Ps(Fc(this.ref,n=>{switch(n._tag){case Xo:return[De(n.notifyProducer),n];case jc:return[Et(n.notifyConsumers,r=>qe(r,W(t)),{discard:!0}),p5(t)];case zc:return[Xr,n];case Bc:return[Xr,n]}}))}emit(t){return U(ue(),n=>Ps(Fc(this.ref,r=>{switch(r._tag){case Xo:return[De(r.notifyProducer),r];case jc:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[qe(s,V(t)),o.length===0?QO(n):Og(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case zc:return[Xr,r];case Bc:return[Xr,r]}})))}error(t){return Ps(Fc(this.ref,n=>{switch(n._tag){case Xo:return[De(n.notifyProducer),n];case jc:return[Et(n.notifyConsumers,r=>Yc(r,t),{discard:!0}),g5(t)];case zc:return[Xr,n];case Bc:return[Xr,n]}}))}get take(){return this.takeWith(t=>bt(bh(t,W)),t=>Je(t),t=>ku(V(t)))}takeWith(t,n,r){return U(ue(),s=>Ps(Fc(this.ref,o=>{switch(o._tag){case Xo:return[Ie(qe(o.notifyProducer,void 0),Da(De(s),{onFailure:t,onSuccess:Tt({onLeft:r,onRight:n})})),Og([s])];case jc:return[Da(De(s),{onFailure:t,onSuccess:Tt({onLeft:r,onRight:n})}),Og([...o.notifyConsumers,s])];case zc:return[be(t(o.cause)),o];case Bc:return[be(r(o.done)),o]}})))}}const Zb=()=>d(ue(),U(e=>No(QO(e))),ie(e=>new m5(e))),Wp=(e,t,n)=>he(ct(No(()=>re)),r=>d(ct(ni(Dn(e,s=>Cu(r,o=>n(s,o))))),he(t),Qb(s=>U(as(r),o=>o(s))))),Lf=f(2,(e,t)=>VH(e,t,()=>{},()=>{})),eS=e=>{const t=Jn({onInput:()=>t,onFailure:nt,onDone:Do});return Rt(e,t)},YO=f(2,(e,t)=>Qb(e,()=>t)),y5=e=>he(e,K),Fh=e=>Tn(e.takeWith(nt,t=>he(Te(t),()=>Fh(e)),Do)),XO=()=>Oh({onInput:e=>he(Te(e),()=>XO()),onFailure:Uu,onDone:bs}),ZO=f(2,(e,t)=>he(e,n=>LO(()=>t(n)))),b5=f(2,(e,t)=>S5(e,bh(t))),S5=f(2,(e,t)=>AO(e,n=>nt(t(n)))),Mh=f(2,(e,t)=>{const n=Oh({onInput:r=>he(Te(t(r)),()=>n),onFailure:Uu,onDone:bs});return Rt(e,n)}),_5=f(2,(e,t)=>{const n=Jn({onInput:r=>d(ct(t(r)),he(Te),he(()=>n)),onFailure:nt,onDone:bs});return Rt(e,n)}),w5=f(3,(e,t,n)=>tS(r=>q(function*(){const s=yield*Zb(),o=Fh(s),i=yield*qa(n);yield*In(r,Kt(i));const c=yield*ue(),u=n===Number.POSITIVE_INFINITY?h=>K:(yield*Ob(n)).withPermits;yield*(yield*o.pipe(Rt(e),pi(r))).pipe(En({onFailure:h=>He(i,Vt(h)),onSuccess:Tt({onLeft:h=>Ie(ut(u(n)(re)),qu(He(i,be(W(h))))),onRight:h=>q(function*(){const p=yield*ue(),m=yield*ue();yield*He(i,ie(De(p),V)),yield*qe(m,void 0).pipe(Ie(ys(b=>tt(b(De(c))).pipe(ZT(tt(b(t(h)))),U(K))).pipe($c(b=>Yc(c,b)),vh(p))),u(1),nn(r)),yield*De(m)})})}),Tb,ut,nn(r));const g=Tn(Da(Ps(Ji(i)),{onFailure:nt,onSuccess:Tt({onLeft:bs,onRight:h=>he(Te(h),()=>g)})}));return Gb(g,s)}))),$5=e=>t=>E5(e)(t,ua),E5=({bufferSize:e=16,concurrency:t,mergeStrategy:n=f5()})=>(r,s)=>tS(o=>q(function*(){const i=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,c=yield*Zb(),u=Fh(c),l=yield*qa(e);yield*In(o,Kt(l));const g=yield*ln();yield*In(o,Kt(g));const h=yield*No(M()),p=yield*ue(),m=(yield*Ob(i)).withPermits,b=yield*pi(Rt(u,r),o);function $(w){return w.pipe(U(Tt({onLeft:S=>be(x(S)),onRight:S=>xr(He(l,be(V(S))),M())})),ww({until:S=>_e(S)}),U(S=>Tq(h,Re({onNone:()=>x(S.value),onSome:P=>x(s(P,S.value))}))),ms(S=>xa(S)?Vt(S):He(l,Vt(S)).pipe(Ie(qe(p,void 0)),qu)))}yield*b.pipe(En({onFailure:w=>He(l,Vt(w)).pipe(Ie(be(!1))),onSuccess:Tt({onLeft:w=>eO(ut(De(p)),ut(m(i)(re)),{onSelfDone:(S,P)=>xr(tn(P),!1),onOtherDone:(S,P)=>Ie(tn(P),as(h).pipe(U(Re({onNone:()=>He(l,be(W(w))),onSome:y=>He(l,be(W(s(y,w))))})),xr(!1)))}),onRight:w=>h5(n,{onBackPressure:()=>q(function*(){const S=yield*ue(),P=xp(E=>pi(Rt(u,w),E).pipe(U(C=>$g(tt($(C)),tt(ut(De(p))))),U(K)));return yield*qe(S,void 0).pipe(Ie(P),m(1),nn(o)),yield*De(S),!(yield*yf(p))}),onBufferSliding:()=>q(function*(){const S=yield*ue(),P=yield*ue(),y=yield*PH(g);yield*Ji(g).pipe(U(I=>qe(I,void 0)),n3(()=>y>=i)),yield*He(g,S);const E=xp(I=>pi(Rt(u,w),I).pipe(U(T=>tt($(T)).pipe($g(tt(ut(De(p)))),$g(tt(ut(De(S)))))),U(K)));return yield*qe(P,void 0).pipe(Ie(E),m(1),nn(o)),yield*De(P),!(yield*yf(p))})})})}),ww({while:w=>w}),nn(o));const _=d(Ji(l),Ps,Da({onFailure:nt,onSuccess:Tt({onLeft:bs,onRight:w=>he(Te(w),()=>_)})}),Tn);return Gb(_,c)})),eR=f(3,(e,t,n)=>$5(n)(Mh(e,t))),tR=f(2,(e,t)=>{function n(r){return q(function*(){const s=yield*Zb(),o=Fh(s),i=yield*pi(Rt(o,e),r),c=yield*pi(Rt(o,t.other),r);function u(g,h,p){return(m,b,$)=>{function _(w){const S=w;return S._tag===zO?be(ct(Ie(tn(h),S.effect))):ie(vT(h),or({onFailure:P=>ct(S.f(bt(P))),onSuccess:Tt({onLeft:P=>ct(S.f(Je(P))),onRight:P=>Ku(Te(P),l($(S.f)))})}))}return or(g,{onFailure:w=>_(m(bt(w))),onSuccess:Tt({onLeft:w=>_(m(Je(w))),onRight:w=>be(he(Te(w),()=>he(ct(nn(ut(p),r)),S=>l(b(S,h)))))})})}}function l(g){switch(g._tag){case KO:{const h=ut(yw(g.left)),p=ut(yw(g.right));return Tn(eO(h,p,{onSelfDone:(m,b)=>Ie(tn(b),u(m,g.right,i)(t.onSelfDone,Tg,$=>Ow($))),onOtherDone:(m,b)=>Ie(tn(b),u(m,g.left,c)(t.onOtherDone,($,_)=>Tg(_,$),$=>Rw($)))}))}case WO:return Tn(ie(tt(c),or({onFailure:h=>ct(g.f(bt(h))),onSuccess:Tt({onLeft:h=>ct(g.f(Je(h))),onRight:h=>he(Te(h),()=>l(Ow(g.f)))})})));case HO:return Tn(ie(tt(i),or({onFailure:h=>ct(g.f(bt(h))),onSuccess:Tt({onLeft:h=>ct(g.f(Je(h))),onRight:h=>he(Te(h),()=>l(Rw(g.f)))})})))}}return ct(ps(g=>{const h=ps(b=>(b.transferChildren(g.scope()),re)),p=ut(i).pipe(Ds(h),nn(r)),m=ut(c).pipe(Ds(h),nn(r));return Ch(p,m,(b,$)=>Tg(b,$))})).pipe(he(l),Gb(s))})}return tS(n)}),nR=f(2,(e,t)=>Rh(()=>{let n;const r=Oh({onInput:o=>he(Te(o),()=>r),onFailure:o=>(n=I5(o),nt(Wi(n))),onDone:bs}),s=Jn({onInput:o=>d(Te(o),he(()=>s)),onFailure:o=>LB(o)&&T5(o.defect)&&H(o.defect,n)?Uu(o.defect.error):nt(o),onDone:bs});return Rt(Rt(Rt(e,r),t),s)})),k5=e=>xp(t=>jO(e,t)),v5=e=>k5(eS(e)),rR=e=>Tn(ys(t=>ie(wh(),n=>JH($c(t(_h(e,n)),r=>yt(n,bt(r))),(r,s)=>yt(n,s))))),sR=e=>oR(ie(kh,t=>he(ct(e(t)),Te))),pi=f(2,(e,t)=>Np(te(()=>new js(e,void 0,K)),vs()).pipe(Dn(([n,r])=>gK(t,s=>{const o=n.close(s);return o!==void 0?hn(o,r):re})),ni,ie(([n])=>Ce(()=>Hp(n.run(),n))))),Hp=(e,t)=>{const n=e;switch(n._tag){case ju:return or(t.getDone(),{onFailure:Vt,onSuccess:r=>be(W(r))});case zu:return be(V(t.getEmit()));case Ec:return d(n.effect,U(()=>Hp(t.run(),t)));case Bu:return Yb(n,()=>Hp(t.run(),t),r=>Vt(r))}},Tn=e=>y5(ct(e)),oR=e=>NO(rR(e),(t,n)=>t,(t,n)=>t),tS=e=>NO(sR(e),(t,n)=>t,(t,n)=>t),Fw=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Fr(e?arguments[2]:arguments[1]),r=wb([u3(t,n),XT(),XW,f3(m3)]);if(e){const s=arguments[0];return Wp(r,([o,i])=>jp(s,er(i,lr,o)),([o,,i,c],u)=>wf(o,u,i,c))}return s=>Wp(r,([o,i])=>jp(s,er(i,lr,o)),([o,,i,c],u)=>wf(o,u,i,c))},xh=e=>iR(0,e.length,e),iR=(e,t,n)=>e===t?Pt:d(Te(d(n,ss(e))),he(()=>iR(e+1,t,n))),C5=f(e=>xO(e[1]),(e,t,n)=>n!=null&&n.concurrent?tR(e,{other:t,onSelfDone:r=>Kp(s=>Ce(()=>O_(r,s))),onOtherDone:r=>Kp(s=>Ce(()=>O_(s,r)))}):he(e,r=>ZO(t,s=>[r,s]))),Ku=f(e=>xO(e[1]),(e,t,n)=>n!=null&&n.concurrent?ZO(C5(e,t,{concurrent:!0}),r=>r[1]):he(e,()=>t)),Jp=Symbol.for("effect/Channel/ChannelException"),I5=e=>({_tag:"ChannelException",[Jp]:Jp,error:e}),T5=e=>j(e,Jp),Vp=Symbol.for("effect/Sink"),O5={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};var QE;QE=Vp;class Ah{constructor(t){a(this,"channel");a(this,QE,O5);this.channel=t}pipe(){return D(this,arguments)}}const R5=()=>new Ah(cR(xe())),cR=e=>Jn({onInput:t=>cR(d(e,Ne(t))),onFailure:nt,onDone:()=>Do(e)}),P5=new Ah(eS(XO())),F5=e=>{const t=Jn({onInput:n=>d(ct(e(n)),he(()=>t)),onFailure:nt,onDone:()=>Pt});return new Ah(t)},M5=e=>new Ah(ct(e)),aR=e=>pr(e)?aR(M5(e)):e.channel,x5=a5,A5=Kp,nS=$h,N5=OT,uR=yW,L5=IK,D5=FK,q5="Left",U5="Right",j5="Both",z5="Either",B5={_tag:q5},K5={_tag:U5},lR={_tag:j5},W5={_tag:z5},H5=e=>{switch(e){case"left":return B5;case"right":return K5;case"both":return lR;case"either":return W5;default:return e}},J5=lR;class fR{constructor(t){a(this,"value");this.value=t}}const dR=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),hR=e=>e.newValue,gR=(e,t)=>{e.isChanged=!0,e.newValue=t},V5=e=>{e.ref.versioned=new fR(e.newValue)},G5=e=>e.ref.versioned!==e.expected,Q5=e=>e.isChanged,Df="Invalid",rS="ReadWrite",Y5="ReadOnly",pR=e=>{for(const t of e)V5(t[1])},mR=e=>{let t=Y5;for(const[,n]of e)if(t=G5(n)?Df:Q5(n)?rS:t,t===Df)return t;return t},X5=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},Z5=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},eJ=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},yR="WithSTMRuntime",Gp="OnFailure",Mw="OnRetry",Qp="OnSuccess",tJ="Provide",bR="Sync",SR="Succeed",_R="Retry",wR="Fail",$R="Die",ER="Interrupt",mi="Fail",yi="Die",bi="Interrupt",eo="Succeed",kc="Retry",sS="Done",oS="Suspend",Al="Done",Yp="Interrupted",qf="Running",Nh="effect/STM/State",$o=Symbol.for(Nh),iS=e=>j(e,$o),kR=e=>e._tag===qf,nJ=e=>e._tag===Al,ll=e=>({[$o]:$o,_tag:Al,exit:e,[Y](){return d(A(Nh),J(A(Al)),J(A(e)),$e(this))},[Q](t){return iS(t)&&t._tag===Al&&H(e,t.exit)}}),rJ=d(A(Nh),J(A(Yp)),J(A("interrupted"))),sJ={[$o]:$o,_tag:Yp,[Y](){return rJ},[Q](e){return iS(e)&&e._tag===Yp}},oJ=d(A(Nh),J(A(qf)),J(A("running"))),iJ={[$o]:$o,_tag:qf,[Y](){return oJ},[Q](e){return iS(e)&&e._tag===qf}},fl=e=>{switch(e._tag){case mi:return ll(ku(e.error));case yi:return ll(va(e.defect));case bi:return ll(KL(e.fiberId));case eo:return ll(Je(e.value));case kc:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},vc="effect/TExit",Cc=Symbol.for(vc),Wu={_A:e=>e,_E:e=>e},Hu=e=>j(e,Cc),cJ=e=>e._tag===eo,aJ=e=>e._tag===kc,uJ=e=>({[Cc]:Wu,_tag:mi,error:e,[Y](){return d(A(vc),J(A(mi)),J(A(e)),$e(this))},[Q](t){return Hu(t)&&t._tag===mi&&H(e,t.error)}}),lJ=e=>({[Cc]:Wu,_tag:yi,defect:e,[Y](){return d(A(vc),J(A(yi)),J(A(e)),$e(this))},[Q](t){return Hu(t)&&t._tag===yi&&H(e,t.defect)}}),fJ=e=>({[Cc]:Wu,_tag:bi,fiberId:e,[Y](){return d(A(vc),J(A(bi)),J(A(e)),$e(this))},[Q](t){return Hu(t)&&t._tag===bi&&H(e,t.fiberId)}}),xw=e=>({[Cc]:Wu,_tag:eo,value:e,[Y](){return d(A(vc),J(A(eo)),J(A(e)),$e(this))},[Q](t){return Hu(t)&&t._tag===eo&&H(e,t.value)}}),dJ=d(A(vc),J(A(kc)),J(A("retry"))),hJ={[Cc]:Wu,_tag:kc,[Y](){return dJ},[Q](e){return Hu(e)&&aJ(e)}},gJ=e=>({_tag:sS,exit:e}),vR=e=>({_tag:oS,journal:e}),Aw={ref:0},pJ=()=>{const e=Aw.ref+1;return Aw.ref=e,e},mJ="effect/STM",yJ=Symbol.for(mJ),dl={_R:e=>e,_E:e=>e,_A:e=>e};var YE,XE,ZE,ek;class Jr{constructor(t){a(this,"effect_instruction_i0");a(this,"_op",nu);a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,ek);a(this,ZE);a(this,XE);a(this,YE);this.effect_instruction_i0=t,this[_w]=so,this[qg]=dl,this[Vp]=dl,this[Af]=dl}get[(ek=_w,ZE=qg,XE=Vp,YE=Af,yJ)](){return dl}[Q](t){return this===t}[Y](){return $e(this,ld(this))}[Symbol.iterator](){return new ac(new Xi(this))}commit(){return bJ(this,ua)}pipe(){return D(this,arguments)}}const bJ=(e,t,n)=>oe(r=>{const s=r.id(),o=r.getFiberRef(Ab),i=r.getFiberRef(rO),c=r.getFiberRef(h3),u=_J(s,e,o,i,c);switch(u._tag){case sS:return t(u.exit),u.exit;case oS:{const l=pJ(),g={value:iJ},h=KW(p=>CR(s,e,l,g,o,i,c,p));return ys(p=>d(p(h),ms(m=>{let b=g.value;return kR(b)&&(g.value=sJ),b=g.value,nJ(b)?(t(b.exit),b.exit):Vt(m)})))}}}),SJ=(e,t,n,r,s,o)=>{const i=new Map,c=new IR(t,i,e,r).run(),u=mR(i);if(u===rS)pR(i);else if(u===Df)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(c._tag){case eo:return n.value=fl(c),ts(Je(c.value),i,s,o);case mi:{n.value=fl(c);const l=_c(c.error);return ts(bt(l),i,s,o)}case yi:{n.value=fl(c);const l=Wi(c.defect);return ts(bt(l),i,s,o)}case bi:{n.value=fl(c);const l=mh(e);return ts(bt(l),i,s,o)}case kc:return vR(i)}},_J=(e,t,n,r,s)=>{const o=new Map,i=new IR(t,o,e,n).run(),c=mR(o);if(c===rS&&cJ(i))pR(o);else if(c===Df)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(i._tag){case eo:return ts(Je(i.value),o,r,s);case mi:{const u=_c(i.error);return ts(bt(u),o,r,s)}case yi:{const u=Wi(i.defect);return ts(bt(u),o,r,s)}case bi:{const u=mh(e);return ts(bt(u),o,r,s)}case kc:return vR(o)}},CR=(e,t,n,r,s,o,i,c)=>{if(kR(r.value)){const u=SJ(e,t,r,s,o,i);switch(u._tag){case sS:{wJ(u.exit,c);break}case oS:{eJ(n,u.journal,()=>CR(e,t,n,r,s,o,i,c));break}}}},ts=(e,t,n,r)=>{const s=X5(t);return s.size>0&&n.scheduleTask(()=>Z5(s),r),gJ(e)},wJ=(e,t)=>{t(e)};class IR{constructor(t,n,r,s){a(this,"self");a(this,"journal");a(this,"fiberId");a(this,"contStack",[]);a(this,"env");this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Qp;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Gp;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Mw;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=Lh((s,o,i)=>Ed(i,r));break}case"Left":{t=Xp(r.left);break}case"None":{t=Xp(new Sh);break}case"Right":{t=gt(r.right);break}case"Some":{t=gt(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case $R:{n=lJ(Pe(()=>r.effect_instruction_i1()));break}case wR:{const s=this.nextFailure();s===void 0?n=uJ(Pe(()=>r.effect_instruction_i1())):t=Pe(()=>s.effect_instruction_i2(Pe(()=>r.effect_instruction_i1())));break}case _R:{const s=this.nextRetry();s===void 0?n=hJ:t=Pe(()=>s.effect_instruction_i2());break}case ER:{n=fJ(this.fiberId);break}case yR:{t=Pe(()=>r.effect_instruction_i1(this));break}case Qp:case Gp:case Mw:{this.pushStack(r),t=r.effect_instruction_i1;break}case tJ:{const s=this.env;this.env=Pe(()=>r.effect_instruction_i2(s)),t=d(r.effect_instruction_i1,vJ(TR(()=>this.env=s)));break}case SR:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=xw(s):t=Pe(()=>o.effect_instruction_i2(s));break}case bR:{const s=Pe(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=xw(s):t=Pe(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=EJ(r)}return n}}const $J=f(2,(e,t)=>{const n=new Jr(Gp);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),EJ=e=>kJ(()=>e),kJ=e=>{const t=new Jr($R);return t.effect_instruction_i1=e,t},Lh=e=>Yn(t=>gt(e(t.journal,t.fiberId,t.getEnv()))),vJ=f(2,(e,t)=>IJ(e,{onFailure:n=>Nw(t,Xp(n)),onSuccess:n=>Nw(t,gt(n))})),Xp=e=>CJ(()=>e),CJ=e=>{const t=new Jr(wR);return t.effect_instruction_i1=e,t},Dh=f(2,(e,t)=>{const n=new Jr(Qp);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),IJ=f(2,(e,{onFailure:t,onSuccess:n})=>d(e,Ua(V),$J(r=>d(t(r),Ua(W))),Dh(r=>{switch(r._tag){case"Left":return gt(r.left);case"Right":return n(r.right)}}))),Yn=e=>{const t=new Jr(yR);return t.effect_instruction_i1=e,t},Vr=e=>{const t=new Jr(ER);return t.effect_instruction_i1=e,t},Ua=f(2,(e,t)=>d(e,Dh(n=>TR(()=>t(n))))),Nc=new Jr(_R),gt=e=>{const t=new Jr(SR);return t.effect_instruction_i1=e,t},TR=e=>{const t=new Jr(bR);return t.effect_instruction_i1=e,t},Nw=f(2,(e,t)=>d(e,Dh(()=>t))),Lw="BackPressure",Zp="Dropping",Dw="Sliding",qw=gt(void 0),TJ="effect/TRef",OJ=Symbol.for(TJ),RJ={_A:e=>e};var tk;tk=OJ;class PJ{constructor(t){a(this,tk,RJ);a(this,"todos");a(this,"versioned");this.versioned=new fR(t),this.todos=new Map}modify(t){return Lh(n=>{const r=cS(this,n),[s,o]=t(hR(r));return gR(r,o),s})}pipe(){return D(this,arguments)}}const FJ=e=>Lh(t=>{const n=new PJ(e);return t.set(n,dR(n,!0)),n}),cS=(e,t)=>{if(t.has(e))return t.get(e);const n=dR(e,!1);return t.set(e,n),n},_r=f(2,(e,t)=>hR(cS(e,t))),wr=f(3,(e,t,n)=>{const r=cS(e,n);gR(r,t)}),MJ="effect/TQueue/TEnqueue",xJ=Symbol.for(MJ),AJ="effect/TQueue/TDequeue",NJ=Symbol.for(AJ),LJ={_tag:Zp},DJ={_Out:e=>e},qJ={_In:e=>e};var nk,rk;rk=NJ,nk=xJ;class UJ{constructor(t,n,r){a(this,"ref");a(this,"requestedCapacity");a(this,"strategy");a(this,rk,DJ);a(this,nk,qJ);a(this,"size",Yn(t=>{const n=_r(this.ref,t.journal);return n===void 0?Vr(t.fiberId):gt(n.length)}));a(this,"isFull",Ua(this.size,t=>t===this.requestedCapacity));a(this,"isEmpty",Ua(this.size,t=>t===0));a(this,"shutdown",Yn(t=>(wr(this.ref,void 0,t.journal),qw)));a(this,"isShutdown",Lh(t=>_r(this.ref,t)===void 0));a(this,"awaitShutdown",Dh(this.isShutdown,t=>t?qw:Nc));a(this,"peek",Yn(t=>{const n=_r(this.ref,t.journal);return n===void 0?Vr(t.fiberId):n.length===0?Nc:gt(n[0])}));a(this,"peekOption",Yn(t=>{const n=_r(this.ref,t.journal);return n===void 0?Vr(t.fiberId):gt(Co(n[0]))}));a(this,"take",Yn(t=>{const n=_r(this.ref,t.journal);if(n===void 0)return Vr(t.fiberId);if(n.length===0)return Nc;const r=n.shift();return wr(this.ref,n,t.journal),gt(r)}));a(this,"takeAll",Yn(t=>{const n=_r(this.ref,t.journal);return n===void 0?Vr(t.fiberId):(wr(this.ref,[],t.journal),gt(n))}));this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}offer(t){return Yn(n=>{const r=d(this.ref,_r(n.journal));if(r===void 0)return Vr(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),wr(this.ref,r,n.journal),gt(!0);switch(this.strategy._tag){case Lw:return Nc;case Zp:return gt(!1);case Dw:return r.length===0||(r.shift(),r.push(t),wr(this.ref,r,n.journal)),gt(!0)}})}offerAll(t){return Yn(n=>{const r=Array.from(t),s=_r(this.ref,n.journal);if(s===void 0)return Vr(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return wr(this.ref,[...s,...r],n.journal),gt(!0);switch(this.strategy._tag){case Lw:return Nc;case Zp:{const o=r.slice(0,this.requestedCapacity-s.length);return wr(this.ref,[...s,...o],n.journal),gt(!1)}case Dw:{const o=r.slice(0,this.requestedCapacity-s.length),i=s.length+o.length-this.requestedCapacity,c=s.slice(i);return wr(this.ref,[...c,...o],n.journal),gt(!0)}}})}takeUpTo(t){return Yn(n=>{const r=_r(this.ref,n.journal);if(r===void 0)return Vr(n.fiberId);const[s,o]=Qv(Ze(r),t);return wr(this.ref,Array.from(o),n.journal),gt(Array.from(s))})}}const jJ=f(2,(e,t)=>e.offer(t)),zJ=e=>e.peek,BJ=e=>e.take,KJ=()=>WJ(Number.MAX_SAFE_INTEGER,LJ),WJ=(e,t)=>Ua(FJ([]),n=>new UJ(n,e,t)),HJ=jJ,JJ=zJ,VJ=BJ,GJ=KJ,QJ=e=>Object.assign(e,{chunk(n){return this(be(n))},die(n){return this(Hi(n))},dieMessage(n){return this(BT(n))},done(n){return this(Ce(()=>HL(n,{onFailure:x,onSuccess:ke})))},end(){return this(zn(M()))},fail(n){return this(zn(x(n)))},fromEffect(n){return this(JT(n,{onFailure:x,onSuccess:ke}))},fromEffectChunk(n){return this(d(n,dr(x)))},halt(n){return this(Vt(d(n,bh(x))))},single(n){return this(be(ke(n)))}}),YJ=(e,t)=>{let n=!1,r=[],s=!1;function o(u){if(n)return!1;if(u.length<=5e4)r.push.apply(r,u);else for(let l=0;l<u.length;l++)r.push(u[0]);return s||(s=!0,t.scheduleTask(i,0)),!0}function i(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function c(u){n||(n=!0,u._tag==="Success"&&r.push(u.value),i(),e.unsafeOffer(u._tag==="Success"?xt:u))}return{single(u){return n?!1:(r.push(u),s||(s=!0,t.scheduleTask(i,0)),!0)},array:o,chunk(u){return o(dn(u))},done:c,end(){n||(n=!0,i(),e.unsafeOffer(xt))},halt(u){return c(bt(u))},fail(u){return c(ku(u))},die(u){return c(va(u))},dieMessage(u){return c(va(new Error(u)))}}},XJ="effect/Take",ZJ=Symbol.for(XJ),eV={_A:e=>e,_E:e=>e};var sk;sk=ZJ;class qh{constructor(t){a(this,"exit");a(this,sk,eV);this.exit=t}pipe(){return D(this,arguments)}}const em=e=>new qh(Je(e)),tV=e=>Ce(()=>e.exit),tm=new qh(ku(M())),OR=e=>new qh(bt(d(e,bh(x)))),nV=e=>Da(e,{onFailure:t=>Re(eT(t),{onNone:()=>tm,onSome:OR}),onSuccess:em}),rV=e=>new qh(Je(ke(e))),RR=()=>zn(M()),sV=e=>dr(Vt(e),x),oV="effect/Stream",PR=Symbol.for(oV),iV={_R:e=>e,_E:e=>e,_A:e=>e};var ok;ok=PR;class we{constructor(t){a(this,"channel");a(this,ok,iV);this.channel=t}pipe(){return D(this,arguments)}}const Ju=e=>j(e,PR)||pr(e),aS=4096,cV=e=>{if(e==="unbounded")return ln();if(typeof e=="number"||e===void 0)return qa(e??16);switch(e.strategy){case"dropping":return hO(e.bufferSize??16);case"sliding":return gO(e.bufferSize??16);default:return qa(e.bufferSize??16)}},aV=e=>{if((e==null?void 0:e.bufferSize)==="unbounded"||(e==null?void 0:e.bufferSize)===void 0&&(e==null?void 0:e.strategy)===void 0)return ln();switch(e==null?void 0:e.strategy){case"sliding":return gO(e.bufferSize??16);default:return hO((e==null?void 0:e.bufferSize)??16)}},uV=(e,t)=>ot(aV(t),Kt).pipe(Dn(n=>d3(rO,r=>e(YJ(n,r)))),ie(n=>{const r=he(Ji(n),s=>jL(s)?ka(s)?Pt:nt(s.cause):Ku(Te(Ze(s)),r));return r}),oR,MR),lV=(e,t)=>d(ot(cV(t),n=>Kt(n)),U(n=>d(vs(),U(r=>d(e(QJ(s=>d(nV(s),U(o=>He(n,o)),qu,N5(r)).then(o=>{if(yc(o)&&!xa(o.cause))throw gb(o.cause)}))),Ie(No(!1)),U(s=>d(as(s),ie(o=>o?RR():d(Ji(n),U(tV),GT(()=>d(Cu(s,!0),Ie(Kt(n)))))))))))),fS,Vu(uS)),fV=f(2,(e,t)=>dV(e,n=>Tt(yh(n),{onLeft:t,onRight:bV}))),dV=f(2,(e,t)=>new we(d(Se(e),AO(n=>Se(t(n)))))),hV=f(2,(e,t)=>new we(d(Se(e),Ku(Se(t))))),gV=e=>Gu(Hi(e)),pV=new we(Pt),Uf=f(2,(e,t)=>new we(d(Se(e),YO(t)))),mV=f(2,(e,t)=>new we(Qb(Se(e),t))),yV=e=>xR(zn(x(e))),bV=e=>Gu(Vt(e)),SV=f(2,(e,t)=>NR(e,vd(t))),_V=f(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?Jn({onInput:o=>n(o[Symbol.iterator]()),onFailure:nt,onDone:Do}):d(t(s.value),ie(o=>o?d(Te(ke(s.value)),he(()=>n(r))):n(r)),Tn)};return new we(Rh(()=>d(Se(e),Rt(n(xe()[Symbol.iterator]())))))}),wV=f(2,(e,t)=>NR(e,Vv(t))),Vu=f(e=>Ju(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?nm(n==null?void 0:n.concurrency,()=>Uw(e,1,r,t),s=>Uw(e,s,r,t)):nm(n==null?void 0:n.concurrency,()=>new we(Lf(Se(e),s=>d(s,Gv(o=>Se(t(o))),Fx(Pt,(o,i)=>d(o,Ku(i)))))),s=>new we(d(Se(e),Lf(xh),eR(o=>Se(t(o)),n))))}),nm=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},Uw=f(4,(e,t,n,r)=>new we(d(Se(e),Lf(xh),eR(s=>Se(r(s)),{concurrency:t,mergeStrategy:d5(),bufferSize:n})))),Uh=f(e=>Ju(e[0]),(e,t)=>Vu(e,K,t)),$V=e=>{const t=Jn({onInput:n=>he(xh(n),()=>t),onFailure:nt,onDone:()=>Pt});return new we(d(Se(e),Rt(t)))},EV=e=>{const t=(r,s)=>{const[o,i]=d(r,Rx(u=>!ka(u))),c=d(Id(i),Re({onNone:()=>s,onSome:or({onFailure:u=>Re(eT(u),{onNone:()=>Pt,onSome:nt}),onSuccess:()=>Pt})}));return d(Te(d(o,Vv(u=>ka(u)?x(u.value):M()))),he(()=>c))},n=Jn({onInput:r=>t(r,n),onFailure:r=>nt(r),onDone:()=>Pt});return new we(d(Se(e),Rt(n)))},FR=e=>$V(EV(d(e,jf(t=>t.exit)))),MR=e=>new we(e),Se=e=>{if("channel"in e)return e.channel;if(pr(e))return Se(Gu(e));throw new TypeError("Expected a Stream.")},kV=e=>new we(Cd(e)?Pt:Te(e)),Gu=e=>d(e,dr(x),xR),xR=e=>new we(Tn(s3(e,{onFailure:Re({onNone:()=>Pt,onSome:Uu}),onSuccess:t=>Te(ke(t))}))),AR=(e,t)=>{const n=(t==null?void 0:t.maxChunkSize)??aS;if(t!=null&&t.scoped){const s=ie(kw(e),o=>ja(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?ie(s,Uf(Up(e))):s}const r=Vu(fS(kw(e)),s=>ja(s,{maxChunkSize:n}));return t!=null&&t.shutdown?Uf(r,Up(e)):r},vV=e=>dS(()=>kd(e)?kV(e):CV(e[Symbol.iterator]())),CV=(e,t=aS)=>d(te(()=>{let n=[];const r=s=>d(te(()=>{let o=s.next();if(t===1)return o.done?Pt:d(Te(ke(o.value)),he(()=>r(s)));n=[];let i=0;for(;o.done===!1&&(n.push(o.value),i=i+1,!(i>=t));)o=s.next();return i>0?d(Te(Ze(n)),he(()=>r(s))):Pt}),Tn);return new we(r(e))}),DR),ja=(e,t)=>d(pO(e,1,(t==null?void 0:t.maxChunkSize)??aS),ms(n=>d(FH(e),U(r=>r&&xa(n)?RR():sV(n)))),uS,t!=null&&t.shutdown?Uf(Kt(e)):K),IV=(...e)=>{const t=e.length===1?e[0].evaluate:e[0],n=e.length===1?e[0].onError:e[1],r=e.length===1?e[0].releaseLockOnEnd===!0:!1;return hS(ie(ot(te(()=>t().getReader()),s=>r?te(()=>s.releaseLock()):WW(()=>s.cancel())),s=>AV(U(ea({try:()=>s.read(),catch:o=>x(n(o))}),({done:o,value:i})=>o?zn(M()):be(i)))))},TV=(...e)=>vV(e),jf=f(2,(e,t)=>new we(d(Se(e),Mh(Gv(t))))),NR=f(2,(e,t)=>new we(d(Se(e),Mh(t)))),OV=f(2,(e,t)=>new we(d(Se(e),_5(t)))),rm=f(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return Jn({onInput:o=>n(o[Symbol.iterator]()),onFailure:nt,onDone:Do});{const o=s.value;return Tn(ie(t(o),i=>he(Te(ke(i)),()=>n(r))))}};return new we(d(Se(e),Rt(Rh(()=>n(xe()[Symbol.iterator]())))))}),RV=f(3,(e,t,n)=>new we(d(Se(e),Lf(xh),w5(n,t),Mh(ke)))),PV=f(2,(e,t)=>new we(d(Se(e),b5(t)))),FV=f(e=>Ju(e[1]),(e,t,n)=>MV(e,t,{onSelf:K,onOther:K,haltStrategy:n==null?void 0:n.haltStrategy})),MV=f(3,(e,t,n)=>{const r=n.haltStrategy?H5(n.haltStrategy):J5,s=o=>i=>o||!ka(i)?x5(Ce(()=>i)):A5(c=>Ce(()=>c));return new we(tR(Se(jf(e,n.onSelf)),{other:Se(jf(t,n.onOther)),onSelfDone:s(r._tag==="Either"||r._tag==="Left"),onOtherDone:s(r._tag==="Either"||r._tag==="Right")}))}),xV=f(2,(e,t)=>new we(d(Se(e),jp(t)))),uS=e=>BV(e,t=>d(ie(t,n=>x([n,t])),$b(Re({onNone:()=>be(M()),onSome:zn})))),AV=e=>uS(d(e,ie(ke))),lS=f(2,(e,t)=>Se(e).pipe(nR(aR(t)),v5)),NV=e=>lS(e,R5()),LV=e=>lS(e,P5),LR=f(2,(e,t)=>lS(e,F5(t))),fS=e=>new we(YO(rR(d(e,ie(ke))),re)),DV=e=>new we(sR(t=>e(t).pipe(ie(ke)))),dS=e=>new we(Rh(()=>Se(e()))),qV=f(2,(e,t)=>{if(!Number.isInteger(t))return gV(new qB(`${t} must be an integer`));const n=r=>Oh({onInput:s=>{const o=d(s,vi(Math.min(r,Number.POSITIVE_INFINITY))),i=Math.max(0,r-o.length);return i>0?d(Te(o),he(()=>n(i))):Te(o)},onFailure:Uu,onDone:Do});return new we(d(Se(e),nR(0<t?n(t):Pt)))}),UV=f(2,(e,t)=>rm(e,n=>xr(t(n),n))),jV=f(e=>Ju(e[0]),(e,t)=>ie(vs(),n=>zV(e,n,t))),zV=f(e=>Ju(e[0]),(e,t,n)=>{const r=nS(t);let s,o;const i=c3(!1);return new ReadableStream({start(c){o=r(LR(e,u=>i.whenOpen(te(()=>{i.unsafeClose();for(const l of u)c.enqueue(l);s(),s=void 0})))),o.addObserver(u=>{u._tag==="Failure"?c.error(gb(u.cause)):c.close()})},pull(){return new Promise(c=>{s=c,us(i.open)})},cancel(){if(o)return nO(qu(tn(o)))}},n==null?void 0:n.strategy)}),BV=(e,t)=>dS(()=>{const n=r=>Tn(ie(t(r),Re({onNone:()=>Pt,onSome:([s,o])=>he(Te(s),()=>n(o))})));return new we(n(e))}),DR=e=>Uh(Gu(e)),hS=e=>Uh(fS(e)),KV=e=>Uh(DV(t=>e(t))),WV=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Fr(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new we(Fw(Se(r),t,n))}return r=>new we(Fw(Se(r),t,n))},HV=(e,t,n)=>uV(r=>ot(te(()=>e.addEventListener(t,r.single,n)),()=>te(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),JV=Wp,qR="effect/Redacted",Nl=ee("effect/Redacted/redactedRegistry",()=>new WeakMap),UR=Symbol.for(qR),VV={[UR]:{_A:e=>e},pipe(){return D(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[fe](){return"<redacted>"},[Y](){return d(A(qR),J(A(Nl.get(this))),$e(this))},[Q](e){return GV(e)&&H(Nl.get(this),Nl.get(e))}},GV=e=>j(e,UR),QV=e=>{const t=Object.create(VV);return Nl.set(t,e),t},jw=Symbol.for("effect/Encoding/errors/Decode"),Rg=(e,t)=>{const n={_tag:"DecodeException",[jw]:jw,input:e};return Gt(t)&&(n.message=t),n},YV=new TextEncoder,zw=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=$r[e[r-2]>>2],n+=$r[(e[r-2]&3)<<4|e[r-1]>>4],n+=$r[(e[r-1]&15)<<2|e[r]>>6],n+=$r[e[r]&63];return r===t+1&&(n+=$r[e[r-2]>>2],n+=$r[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=$r[e[r-2]>>2],n+=$r[(e[r-2]&3)<<4|e[r-1]>>4],n+=$r[(e[r-1]&15)<<2],n+="="),n},XV=e=>{const t=ZV(e),n=t.length;if(n%4!==0)return W(Rg(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return W(Rg(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let i=0,c=0;i<n;i+=4,c+=3){const u=hl(t.charCodeAt(i))<<18|hl(t.charCodeAt(i+1))<<12|hl(t.charCodeAt(i+2))<<6|hl(t.charCodeAt(i+3));o[c]=u>>16,o[c+1]=u>>8&255,o[c+2]=u&255}return V(o)}catch(s){return W(Rg(t,s instanceof Error?s.message:"Invalid input"))}},ZV=e=>e.replace(/[\n\r]/g,"");function hl(e){if(e>=Bw.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=Bw[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const $r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Bw=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],e4=e=>zw(typeof e=="string"?YV.encode(e):e),t4=e=>XV(e),sm=Symbol.for("effect/FiberHandle"),n4=e=>j(e,sm),r4={[sm]:sm,toString(){return Oe(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},s4=e=>{const t=Object.create(r4);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},o4=()=>ot(ie(ue(),e=>s4(e)),e=>ps(t=>{const n=e.state;return n._tag==="Closed"?re:(e.state={_tag:"Closed"},n.fiber?vh(qu(CT(n.fiber,Gs(t.id(),Ll))),e.deferred):ks(e.deferred,xt))})),jR=-1,Ll=bC(jR,0),i4=tT(void 0,{emptyCase:An,failCase:An,dieCase:An,interruptCase:(e,t)=>iy(fy(t),jR),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),c4=f(e=>n4(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(Gs((n==null?void 0:n.interruptAs)??Cn,Ll));return}else if(e.state.fiber!==void 0){if((n==null?void 0:n.onlyIfMissing)===!0){t.unsafeInterruptAsFork(Gs((n==null?void 0:n.interruptAs)??Cn,Ll));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(Gs((n==null?void 0:n.interruptAs)??Cn,Ll)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),yc(r)&&((n==null?void 0:n.propagateInterruption)===!0?!i4(r.cause):!Ys(r.cause))&&Ns(e.deferred,r)})}),a4=function(){let e;return()=>(e===void 0&&(e=Cs(Xr)),e)}(),Kw=function(){const e=arguments[0];if(pr(arguments[1]))return Ww(e,arguments[1],arguments[2]);const t=arguments[1];return n=>Ww(e,n,t)},Ww=(e,t,n)=>QT(r=>e.state._tag==="Closed"?Xr:e.state.fiber!==void 0&&(n==null?void 0:n.onlyIfMissing)===!0?te(a4):Dn(YT(t),s=>c4(e,s,{...n,interruptAs:r}))),om=Symbol.for("effect/FiberSet"),u4=e=>j(e,om),l4={[om]:om,[Symbol.iterator](){return this.state._tag==="Closed"?OF():this.state.backing[Symbol.iterator]()},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[fe](){return this.toJSON()},pipe(){return D(this,arguments)}},f4=(e,t)=>{const n=Object.create(l4);return n.state={_tag:"Open",backing:e},n.deferred=t,n},zR=()=>ot(ie(ue(),e=>f4(new Set,e)),e=>ps(t=>{const n=e.state;if(n._tag==="Closed")return re;e.state={_tag:"Closed"};const r=n.backing;return aW(r,Gs(t.id(),KR)).pipe(vh(e.deferred))})),BR=-1,KR=bC(BR,0),d4=tT(void 0,{emptyCase:An,failCase:An,dieCase:An,interruptCase:(e,t)=>iy(fy(t),BR),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),im=f(e=>u4(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(Gs((n==null?void 0:n.interruptAs)??Cn,KR));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),yc(r)&&((n==null?void 0:n.propagateInterruption)===!0?!d4(r.cause):!Ys(r.cause))&&Ns(e.deferred,r))})}),h4=e=>De(e.deferred),g4="effect/GroupBy",WR=Symbol.for(g4),p4={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},m4=e=>j(e,WR),y4=f(e=>m4(e[0]),(e,t,n)=>Vu(e.grouped,([r,s])=>t(r,FR(ja(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:(n==null?void 0:n.bufferSize)??16})),b4=e=>({[WR]:p4,pipe(){return D(this,arguments)},grouped:e}),S4=f(e=>typeof e[0]!="function",(e,t,n)=>n!=null&&n.key?y4(_4(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>rm(s,t)):nm(n==null?void 0:n.concurrency,()=>rm(e,t),r=>n!=null&&n.unordered?Vu(e,s=>Gu(t(s)),{concurrency:r}):RV(e,r,t))),_4=f(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>Jn({onInput:i=>he(ct(Et(w4(i,t),([c,u])=>{const l=s.get(c);return l===void 0?d(qa((n==null?void 0:n.bufferSize)??16),U(g=>d(te(()=>{s.set(c,g)}),Ie(He(o,rV([c,g]))),Ie(d(He(g,em(u)),wg(h=>Ys(h)?x(re):M())))))):wg(He(l,em(u)),g=>Ys(g)?x(re):M())},{discard:!0})),()=>r(s,o)),onFailure:i=>ct(He(o,OR(i))),onDone:()=>d(ct(d(Et(s.entries(),([i,c])=>d(He(c,tm),wg(u=>Ys(u)?x(re):M())),{discard:!0}),Ie(He(o,tm)))))});return b4(KV(s=>q(function*(){const o=new Map,i=yield*ln();return yield*In(s,Kt(i)),yield*Se(e).pipe(Rt(r(o,i)),eS,jO(s),nn(s),xr(FR(ja(i,{shutdown:!0}))))})))}),w4=f(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const i=o.value,c=t(i);if(s.has(c))s.get(c).push(i);else{const u=[i];n.push([c,u]),s.set(c,u)}}return Ze(n.map(i=>[i[0],Ze(i[1])]))});class vt{constructor(t,n,r){a(this,"path");a(this,"actual");a(this,"issue");a(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class Hw{constructor(t,n){a(this,"actual");a(this,"message");a(this,"_tag","Unexpected");this.actual=t,this.message=n}}class Lc{constructor(t,n){a(this,"ast");a(this,"message");a(this,"_tag","Missing");a(this,"actual");this.ast=t,this.message=n}}class Ge{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"issues");a(this,"output");a(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class Pg{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"kind");a(this,"issue");a(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Fg{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"kind");a(this,"issue");a(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Wt{constructor(t,n,r){a(this,"ast");a(this,"actual");a(this,"message");a(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class Jw{constructor(t,n,r){a(this,"ast");a(this,"actual");a(this,"message");a(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const cm=Symbol.for("effect/Schema/ParseErrorTypeId"),$4=e=>j(e,cm);var ik;class E4 extends mK("ParseError"){constructor(){super(...arguments);a(this,ik,cm)}get message(){return this.toString()}toString(){return Dl.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(ik=cm,fe)](){return this.toJSON()}}const jh=e=>new E4({issue:e}),Ss=V,zh=W,Ut=Wk,ns=f(2,(e,t)=>Ut(e)?Tt(e,{onLeft:W,onRight:t}):U(e,t)),un=f(2,(e,t)=>Ut(e)?aF(e,t):ie(e,t)),ta=f(2,(e,t)=>Ut(e)?Dm(e,t):dr(e,t)),k4=f(2,(e,t)=>Ut(e)?cF(e,{onLeft:t.onFailure,onRight:t.onSuccess}):JT(e,t)),HR=f(2,(e,t)=>Ut(e)?Tt(e,{onLeft:t,onRight:V}):$b(e,t)),Bh=(e,t)=>t===void 0||Ar(t)?e:e===void 0?t:{...e,...t},JR=(e,t,n)=>{const r=$t(e,t);return(s,o)=>r(s,Bh(n,o))},gS=(e,t,n)=>{const r=JR(e,t,n);return(s,o)=>Hk(r(s,o),jh)},VR=(e,t,n)=>{const r=$t(e,t);return(s,o)=>r(s,{...Bh(n,o),isEffectAllowed:!0})},v4=(e,t)=>gS(e.ast,!0,t),C4=(e,t)=>JR(e.ast,!0,t),Kh=(e,t)=>VR(e.ast,!0,t),I4=(e,t)=>gS(e.ast,!1,t),Qu=(e,t)=>VR(e.ast,!1,t),T4=v4,O4=Kh,Wh=(e,t)=>gS(Xe(e.ast),!0,t),at=(e,t)=>{const n=$t(Xe(e.ast),!0);return(r,s)=>nr(n(r,{exact:!0,...Bh(t,s)}))},GR=I4,R4=Qu,P4=ee(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),F4=ee(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),$t=(e,t)=>{const n=t?P4:F4,r=n.get(e);if(r)return r;const s=M4(e,t),o=SM(e),i=_e(o)?(l,g)=>s(l,Bh(g,o.value)):s,c=_M(e),u=t&&_e(c)?(l,g)=>Wc(HR(i(l,g),c.value),e,l,g):i;return n.set(e,u),u},Mg=e=>Fn(mM(e)),xg=e=>Fn(yM(e)),M4=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=$t(e.from,!0);return(r,s)=>{s=s??ag;const o=(s==null?void 0:s.errors)==="all",i=ns(HR(n(r,s),c=>{const u=new Pg(e,r,"From",c);return o&&$M(e)&&e1(c)?Re(e.filter(r,s,e),{onNone:()=>W(u),onSome:l=>W(new Ge(e,r,[u,new Pg(e,r,"Predicate",l)]))}):W(u)}),c=>Re(e.filter(c,s,e),{onNone:()=>V(c),onSome:u=>W(new Pg(e,r,"Predicate",u))}));return Wc(i,e,r,s)}}else{const n=$t(Xe(e),!0),r=$t(YR(e.from),!1);return(s,o)=>Wc(ns(n(s,o),i=>r(i,o)),e,s,o)}case"Transformation":{const n=A4(e.transformation,t),r=t?$t(e.from,!0):$t(e.to,!1),s=t?$t(e.to,!0):$t(e.from,!1);return(o,i)=>Wc(ns(ta(r(o,i),c=>new Fg(e,o,t?"Encoded":"Type",c)),c=>ns(ta(n(c,i??ag,e,o),u=>new Fg(e,o,"Transformation",u)),u=>ta(s(u,i),l=>new Fg(e,o,t?"Type":"Encoded",l)))),e,o,i)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>Wc(n(r,s??ag,e),e,r,s)}case"Literal":return an(e,n=>n===e.literal);case"UniqueSymbol":return an(e,n=>n===e.symbol);case"UndefinedKeyword":return an(e,EP);case"NeverKeyword":return an(e,kP);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return V;case"StringKeyword":return an(e,Gt);case"NumberKeyword":return an(e,Ar);case"BooleanKeyword":return an(e,no);case"BigIntKeyword":return an(e,cd);case"SymbolKeyword":return an(e,Kl);case"ObjectKeyword":return an(e,hr);case"Enums":return an(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=xv(e);return an(e,r=>Gt(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(l=>$t(l.type,t)),r=e.rest.map(l=>$t(l.type,t));let s=e.elements.filter(l=>!l.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,i=e.elements.length>0?e.elements.map((l,g)=>g).join(" | "):"never",c=Mg(e),u=xg(e);return(l,g)=>{if(!NF(l))return W(new Wt(e,l));const h=(g==null?void 0:g.errors)==="all",p=[];let m=0;const b=[],$=l.length;for(let P=$;P<=o-1;P++){const y=new vt(P,l,new Lc(s[P-$]));if(h){p.push([m++,y]);continue}else return W(new Ge(e,l,y,b))}if(e.rest.length===0)for(let P=e.elements.length;P<=$-1;P++){const y=new vt(P,l,new Hw(l[P],`is unexpected, expected: ${i}`));if(h){p.push([m++,y]);continue}else return W(new Ge(e,l,y,b))}let _=0,w;for(;_<n.length;_++)if($<_+1){if(e.elements[_].isOptional)continue}else{const P=n[_],y=P(l[_],g);if(Ut(y)){if(pt(y)){const E=new vt(_,l,y.left);if(h){p.push([m++,E]);continue}else return W(new Ge(e,l,E,On(b)))}b.push([m++,y.right])}else{const E=m++,C=_;w||(w=[]),w.push(({es:I,output:T})=>U(Go(y),N=>{if(pt(N)){const v=new vt(C,l,N.left);return h?(I.push([E,v]),re):W(new Ge(e,l,v,On(T)))}return T.push([E,N.right]),re}))}}if(ze(r)){const[P,...y]=r;for(;_<$-y.length;_++){const E=P(l[_],g);if(Ut(E))if(pt(E)){const C=new vt(_,l,E.left);if(h){p.push([m++,C]);continue}else return W(new Ge(e,l,C,On(b)))}else b.push([m++,E.right]);else{const C=m++,I=_;w||(w=[]),w.push(({es:T,output:N})=>U(Go(E),v=>{if(pt(v)){const L=new vt(I,l,v.left);return h?(T.push([C,L]),re):W(new Ge(e,l,L,On(N)))}else return N.push([C,v.right]),re}))}}for(let E=0;E<y.length;E++)if(_+=E,!($<_+1)){const C=y[E](l[_],g);if(Ut(C)){if(pt(C)){const I=new vt(_,l,C.left);if(h){p.push([m++,I]);continue}else return W(new Ge(e,l,I,On(b)))}b.push([m++,C.right])}else{const I=m++,T=_;w||(w=[]),w.push(({es:N,output:v})=>U(Go(C),L=>{if(pt(L)){const X=new vt(T,l,L.left);return h?(N.push([I,X]),re):W(new Ge(e,l,X,On(v)))}return v.push([I,L.right]),re}))}}}const S=({es:P,output:y})=>El(P)?W(new Ge(e,l,On(P),On(y))):V(On(y));if(w&&w.length>0){const P=w;return Ce(()=>{const y={es:Uc(p),output:Uc(b)};return U(Et(P,E=>E(y),{concurrency:c,batching:u,discard:!0}),()=>S(y))})}return S({output:b,es:p})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return an(e,vP);const n=[],r={},s=[];for(const g of e.propertySignatures)n.push([$t(g.type,t),g]),r[g.name]=null,s.push(g.name);const o=e.indexSignatures.map(g=>[$t(g.parameter,t),$t(g.type,t),g.parameter]),i=zt.make(e.indexSignatures.map(g=>g.parameter).concat(s.map(g=>Kl(g)?new CM(g):new tf(g)))),c=$t(i,t),u=Mg(e),l=xg(e);return(g,h)=>{if(!TP(g))return W(new Wt(e,g));const p=(h==null?void 0:h.errors)==="all",m=[];let b=0;const $=(h==null?void 0:h.onExcessProperty)==="error",_=(h==null?void 0:h.onExcessProperty)==="preserve",w={};let S;if($||_){S=Nn(g);for(const C of S){const I=c(C,h);if(Ut(I)&&pt(I))if($){const T=new vt(C,g,new Hw(g[C],`is unexpected, expected: ${String(i)}`));if(p){m.push([b++,T]);continue}else return W(new Ge(e,g,T,w))}else w[C]=g[C]}}let P;const y=(h==null?void 0:h.exact)===!0;for(let C=0;C<n.length;C++){const I=n[C][1],T=I.name,N=Object.prototype.hasOwnProperty.call(g,T);if(!N){if(I.isOptional)continue;if(y){const X=new vt(T,g,new Lc(I));if(p){m.push([b++,X]);continue}else return W(new Ge(e,g,X,w))}}const v=n[C][0],L=v(g[T],h);if(Ut(L)){if(pt(L)){const X=new vt(T,g,N?L.left:new Lc(I));if(p){m.push([b++,X]);continue}else return W(new Ge(e,g,X,w))}w[T]=L.right}else{const X=b++,me=T;P||(P=[]),P.push(({es:z,output:Ae})=>U(Go(L),Ee=>{if(pt(Ee)){const We=new vt(me,g,N?Ee.left:new Lc(I));return p?(z.push([X,We]),re):W(new Ge(e,g,We,Ae))}return Ae[me]=Ee.right,re}))}}for(let C=0;C<o.length;C++){const I=o[C],T=I[0],N=I[1],v=sv(g,I[2]);for(const L of v){const X=T(L,h);if(Ut(X)&&nr(X)){const me=N(g[L],h);if(Ut(me))if(pt(me)){const z=new vt(L,g,me.left);if(p){m.push([b++,z]);continue}else return W(new Ge(e,g,z,w))}else Object.prototype.hasOwnProperty.call(r,L)||(w[L]=me.right);else{const z=b++,Ae=L;P||(P=[]),P.push(({es:Ee,output:We})=>U(Go(me),ht=>{if(pt(ht)){const Gn=new vt(Ae,g,ht.left);return p?(Ee.push([z,Gn]),re):W(new Ge(e,g,Gn,We))}else return Object.prototype.hasOwnProperty.call(r,L)||(We[L]=ht.right),re}))}}}}const E=({es:C,output:I})=>{if(El(C))return W(new Ge(e,g,On(C),I));if((h==null?void 0:h.propertyOrder)==="original"){const T=S||Nn(g);for(const v of s)T.indexOf(v)===-1&&T.push(v);const N={};for(const v of T)Object.prototype.hasOwnProperty.call(I,v)&&(N[v]=I[v]);return V(N)}return V(I)};if(P&&P.length>0){const C=P;return Ce(()=>{const I={es:Uc(m),output:Object.assign({},w)};return U(Et(C,T=>T(I),{concurrency:u,batching:l,discard:!0}),()=>E(I))})}return E({es:m,output:w})}}case"Union":{const n=QR(e.types,t),r=Nn(n.keys),s=r.length,o=e.types.length,i=new Map;for(let l=0;l<o;l++)i.set(e.types[l],$t(e.types[l],t));const c=Mg(e)??1,u=xg(e);return(l,g)=>{const h=[];let p=0,m=[];if(s>0)if(ad(l))for(let _=0;_<s;_++){const w=r[_],S=n.keys[w].buckets;if(Object.prototype.hasOwnProperty.call(l,w)){const P=String(l[w]);if(Object.prototype.hasOwnProperty.call(S,P))m=m.concat(S[P]);else{const{candidates:y,literals:E}=n.keys[w],C=zt.make(E),I=y.length===o?new vn([new Ye(w,C,!1,!0)],[]):zt.make(y);h.push([p++,new Ge(I,l,new vt(w,l,new Wt(C,l[w])))])}}else{const{candidates:P,literals:y}=n.keys[w],E=new Ye(w,zt.make(y),!1,!0),C=P.length===o?new vn([E],[]):zt.make(P);h.push([p++,new Ge(C,l,new vt(w,l,new Lc(E)))])}}else{const _=n.candidates.length===o?e:zt.make(n.candidates);h.push([p++,new Wt(_,l)])}n.otherwise.length>0&&(m=m.concat(n.otherwise));let b;for(let _=0;_<m.length;_++){const w=m[_],S=i.get(w)(l,g);if(Ut(S)&&(!b||b.length===0)){if(nr(S))return S;h.push([p++,S.left])}else{const P=p++;b||(b=[]),b.push(y=>Ce(()=>"finalResult"in y?re:U(Go(S),E=>(nr(E)?y.finalResult=E:y.es.push([P,E.left]),re))))}}const $=_=>El(_)?_.length===1&&_[0][1]._tag==="Type"?W(_[0][1]):W(new Ge(e,l,On(_))):W(new Wt(e,l));if(b&&b.length>0){const _=b;return Ce(()=>{const w={es:Uc(h)};return U(Et(_,S=>S(w),{concurrency:c,batching:u,discard:!0}),()=>"finalResult"in w?w.finalResult:$(w.es))})}return $(h)}}case"Suspend":{const n=zm(()=>$t(ki(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},an=(e,t)=>n=>t(n)?V(n):W(new Wt(e,n)),Kc=(e,t)=>{switch(e._tag){case"Declaration":{const n=Io(e);if(_e(n))return Kc(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?Kg(s.type):Xe(s.type);Gc(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?Kg(s.type):Xe(s.type);Gc(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return Kc(e.from,t);case"Suspend":return Kc(e.f(),t);case"Transformation":return Kc(t?e.from:e.to,t)}return[]},QR=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const i=e[o],c=Kc(i,t);if(c.length>0){s.push(i);for(let u=0;u<c.length;u++){const[l,g]=c[u],h=String(g.literal);n[l]=n[l]||{buckets:{},literals:[],candidates:[]};const p=n[l].buckets;if(Object.prototype.hasOwnProperty.call(p,h)){if(u<c.length-1)continue;p[h].push(i),n[l].literals.push(g),n[l].candidates.push(i)}else{p[h]=[i],n[l].literals.push(g),n[l].candidates.push(i);break}}}else r.push(i)}return{keys:n,otherwise:r,candidates:s}},YR=e=>ii(e)?YR(e.from):e,Wc=(e,t,n,r)=>{if((r==null?void 0:r.isEffectAllowed)===!0||Ut(e))return e;const s=new p0,o=Cs(e,{scheduler:s});s.flush();const i=o.unsafePoll();if(i){if(ka(i))return V(i.value);const c=i.cause;return Z0(c)?W(c.error):W(new Jw(t,n,nT(c)))}return W(new Jw(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},x4=([e],[t])=>e>t?1:e<t?-1:0;function On(e){return e.sort(x4).map(t=>t[1])}const A4=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return V;case"TypeLiteralTransformation":return n=>{let r=V(n);for(const s of e.propertySignatureTransformations){const[o,i]=t?[s.from,s.to]:[s.to,s.from],c=t?s.decode:s.encode;r=un(r,l=>{const g=c(Object.prototype.hasOwnProperty.call(l,o)?x(l[o]):M());return delete l[o],_e(g)&&(l[i]=g.value),l})}return r}}},Dt=(e,t=[])=>({value:e,forest:t}),Dl={formatIssue:e=>un(Zo(e),N4),formatIssueSync:e=>{const t=Dl.formatIssue(e);return Ut(t)?lF(t):us(t)},formatError:e=>Dl.formatIssue(e.issue),formatErrorSync:e=>Dl.formatIssueSync(e.issue)},N4=e=>e.value+XR(`
`,e.forest),XR=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const i=o===r-1;n+=e+(i?"└":"├")+"─ "+s.value,n+=XR(e+(r>1&&!i?"│  ":"   "),s.forest)}return n},L4=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},D4=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},ZR=e=>"ast"in e?x(e.ast):M(),am=V(void 0),q4=e=>ZR(e).pipe(ec(gM),Re({onNone:()=>am,onSome:t=>{const n=t(e);return Gt(n)?V({message:n,override:!1}):pr(n)?ie(n,r=>({message:r,override:!1})):Gt(n.message)?V({message:n.message,override:n.override}):ie(n.message,r=>({message:r,override:n.override}))}})),pS=e=>t=>t._tag===e,e1=pS("Composite"),Vw=pS("Refinement"),Gw=pS("Transformation"),na=e=>ns(q4(e),t=>t!==void 0?!t.override&&(e1(e)||Vw(e)&&e.kind==="From"||Gw(e)&&e.kind!=="Transformation")?Gw(e)||Vw(e)?na(e.issue):am:V(t.message):am),t1=e=>ZR(e).pipe(ec(bM),mF(t=>t(e)),Fn);function U4(e){return kv(e).pipe(rs(()=>$v(e)),rs(()=>Ev(e)),rs(()=>md(e)),je(()=>`{ ${e.from} | filter }`))}function j4(e){return e.message!==void 0?e.message:`Expected ${ii(e.ast)?U4(e.ast):String(e.ast)}, actual ${kn(e.actual)}`}const z4=e=>un(na(e),t=>t??t1(e)??j4(e)),gl=e=>t1(e)??String(e.ast),B4=e=>e.message??"is forbidden",K4=e=>e.message??"is unexpected",W4=e=>{const t=pM(e.ast);if(_e(t)){const n=t.value();return Gt(n)?V(n):n}return V(e.message??"is missing")},Zo=e=>{switch(e._tag){case"Type":return un(z4(e),Dt);case"Forbidden":return V(Dt(gl(e),[Dt(B4(e))]));case"Unexpected":return V(Dt(K4(e)));case"Missing":return un(W4(e),Dt);case"Transformation":return ns(na(e),t=>t!==void 0?V(Dt(t)):un(Zo(e.issue),n=>Dt(gl(e),[Dt(L4(e.kind),[n])])));case"Refinement":return ns(na(e),t=>t!==void 0?V(Dt(t)):un(Zo(e.issue),n=>Dt(gl(e),[Dt(D4(e.kind),[n])])));case"Pointer":return un(Zo(e.issue),t=>Dt(iv(e.path),[t]));case"Composite":return ns(na(e),t=>{if(t!==void 0)return V(Dt(t));const n=gl(e);return ov(e.issues)?un(Et(e.issues,Zo),r=>Dt(n,r)):un(Zo(e.issues),r=>Dt(n,[r]))})}},Qw=Symbol.for("effect/Pool"),H4={_E:e=>e,_A:e=>e},n1=e=>Qt(t=>k(pc(),n=>{const r=en(n,Hn),s=Ny(e.acquire,u=>Kr(n,u)),o=new G4(r,s,e.concurrency??1,e.min,e.max,e.strategy,Math.min(Math.max(e.targetUtilization??1,.1),1)),i=Ur(Bi(t(o.resize)),u=>r.addFinalizer(()=>wa(u))),c=Ur(Bi(t(e.strategy.run(o))),u=>r.addFinalizer(()=>wa(u)));return R(o).pipe(is(r.addFinalizer(()=>o.shutdown)),is(i),is(c))})),J4=e=>n1({...e,min:e.size,max:e.size,strategy:Q4()}),V4=e=>k(e.timeToLiveStrategy==="creation"?Y4(e.timeToLive):X4(e.timeToLive),t=>n1({...e,strategy:t}));var ck,ak;class G4 extends(ak=Hr,ck=Qw,ak){constructor(n,r,s,o,i,c,u){super();a(this,"scope");a(this,"acquire");a(this,"concurrency");a(this,"minSize");a(this,"maxSize");a(this,"strategy");a(this,"targetUtilization");a(this,ck);a(this,"isShuttingDown",!1);a(this,"semaphore");a(this,"items",new Set);a(this,"available",new Set);a(this,"availableLatch",wT(!1));a(this,"invalidated",new Set);a(this,"waiters",0);a(this,"allocate",wy(Sc(),n=>this.acquire.pipe(Lo(n),Ln,k(r=>{const s={exit:r,finalizer:gu(n.close(r),Z4),refCount:0,disableReclaim:!1};return this.items.add(s),this.available.add(s),rt(r._tag==="Success"?this.strategy.onAcquire(s):ge(s.finalizer,this.strategy.onAcquire(s)),s)})),(n,r)=>r._tag==="Failure"?n.close(r):ne));a(this,"resizeLoop",B(()=>{if(this.activeSize>=this.targetSize)return ne;const n=this.targetSize-this.activeSize;return this.strategy.reclaim(this).pipe(k(Re({onNone:()=>this.allocate,onSome:R})),mB(n,{concurrency:n}),is(this.availableLatch.open),k(r=>r.some(s=>s.exit._tag==="Failure")?ne:this.resizeLoop))}));a(this,"resizeSemaphore",Zc(1));a(this,"resize",this.resizeSemaphore.withPermits(1)(this.resizeLoop));a(this,"getPoolItem",Qt(n=>n(this.semaphore.take(1)).pipe(ge(Hn),k(r=>B(()=>{if(this.waiters++,this.isShuttingDown)return st;if(this.targetSize>this.activeSize){const s=this;return k(this.resizeSemaphore.withPermitsIfAvailable(1)(Mf(Li(this.resize),this.scope)),function o(){return s.isShuttingDown?st:s.available.size>0?R(Ug(s.available)):(s.availableLatch.unsafeClose(),k(s.availableLatch.await,o))})}return R(Ug(this.available))}).pipe(Ki(O(()=>this.waiters--)),Ur(s=>s.exit._tag==="Failure"?(this.items.delete(s),this.invalidated.delete(s),this.available.delete(s),this.semaphore.release(1)):(s.refCount++,this.available.delete(s),s.refCount<this.concurrency&&this.available.add(s),r.addFinalizer(()=>ge(B(()=>(s.refCount--,this.invalidated.has(s)?this.invalidatePoolItem(s):(this.available.add(s),Ot))),this.semaphore.release(1))))),Es(()=>this.semaphore.release(1)))))));a(this,"get",k(B(()=>this.isShuttingDown?st:this.getPoolItem),n=>n.exit));this.scope=n,this.acquire=r,this.concurrency=s,this.minSize=o,this.maxSize=i,this.strategy=c,this.targetUtilization=u,this[Qw]=H4,this.semaphore=Zc(s*i)}get currentUsage(){let n=this.waiters;for(const r of this.items)n+=r.refCount;return n}get targetSize(){if(this.isShuttingDown)return 0;const n=this.currentUsage/this.targetUtilization,r=Math.ceil(n/this.concurrency);return Math.min(Math.max(this.minSize,r),this.maxSize)}get activeSize(){return this.items.size-this.invalidated.size}commit(){return this.get}invalidate(n){return B(()=>{if(this.isShuttingDown)return ne;for(const r of this.items)if(r.exit._tag==="Success"&&r.exit.value===n)return r.disableReclaim=!0,Wr(this.invalidatePoolItem(r));return ne})}invalidatePoolItem(n){return B(()=>{if(this.items.has(n)){if(n.refCount===0)return this.items.delete(n),this.available.delete(n),this.invalidated.delete(n),ge(n.finalizer,Mf(Li(this.resize),this.scope))}else return ne;return this.invalidated.add(n),this.available.delete(n),ne})}get shutdown(){return B(()=>{if(this.isShuttingDown)return ne;this.isShuttingDown=!0;const n=this.items.size,r=Zc(n);return yo(this.items,s=>s.refCount>0?(s.finalizer=is(s.finalizer,r.release(1)),this.invalidated.add(s),r.take(1)):(this.items.delete(s),this.available.delete(s),this.invalidated.delete(s),s.finalizer)).pipe(ge(this.semaphore.releaseAll),ge(this.availableLatch.open),ge(r.take(n)))})}pipe(){return D(this,arguments)}}const Q4=()=>({run:e=>ne,onAcquire:e=>ne,reclaim:e=>Ra}),Y4=e=>sh(t=>G(zb(),n=>{const r=Ci(e),s=new WeakMap;return K({run:o=>{const i=c=>B(()=>{if(!o.items.has(c)||o.invalidated.has(c))return ne;const u=t.unsafeCurrentTimeMillis(),l=s.get(c),g=r-(u-l);return g>0?JI(i(c),g):o.invalidatePoolItem(c)});return n.take.pipe(Ur(i),Vy)},onAcquire:o=>B(()=>(s.set(o,t.unsafeCurrentTimeMillis()),n.offer(o))),reclaim:o=>Ra})})),X4=e=>G(zb(),t=>K({run:n=>{const r=B(()=>n.activeSize-n.targetSize<=0?ne:t.take.pipe(Ur(o=>n.invalidatePoolItem(o)),ge(r)));return r.pipe(JI(e),Vy)},onAcquire:n=>t.offer(n),reclaim(n){return B(()=>{if(n.invalidated.size===0)return Ra;const r=vF(RF(n.invalidated,s=>!s.disableReclaim));return r._tag==="None"?Ra:(n.invalidated.delete(r.value),r.value.refCount<n.concurrency&&n.available.add(r.value),rt(t.offer(r.value),r))})}})),Z4=e=>oe(t=>{const n=t.getFiberRef(Oy);return n._tag==="Some"&&t.log("Unhandled error in pool finalizer",e,n),ne}),eG=_3,tG=y3,nG=B0,rG=Tj,sG=K0,um=Symbol.for("effect/Mailbox"),Yw=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Ms=xe(),Xw=de(Ms),pl=de(!1),ml=de(!0),Zw=[Ms,!0];var uk,lk;class oG extends Hr{constructor(n,r,s){super();a(this,"scheduler");a(this,"capacity");a(this,"strategy");a(this,lk,um);a(this,uk,Yw);a(this,"state",{_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set});a(this,"messages",[]);a(this,"messagesChunk",xe());a(this,"shutdown",O(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Ms;const n=this.state.offers;if(this.finalize(this.state._tag==="Open"?Ot:this.state.exit),n.size>0){for(const r of n)r._tag==="Single"?r.resume(pl):r.resume(de(Ze(r.remaining.slice(r.offset))));n.clear()}return!0}));a(this,"end",this.done(Ot));a(this,"clear",B(()=>{if(this.state._tag==="Done")return Tl(this.state.exit,Ms);const n=this.unsafeTakeAll();return this.releaseCapacity(),R(n)}));a(this,"takeAll",B(()=>{if(this.state._tag==="Done")return Tl(this.state.exit,Zw);const n=this.unsafeTakeAll();return n.length===0?ge(this.awaitTake,this.takeAll):R([n,this.releaseCapacity()])}));a(this,"take",B(()=>this.unsafeTake()??ge(this.awaitTake,this.take)));a(this,"await",es(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.awaiters.add(n),O(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(n)}))));a(this,"size",O(()=>this.unsafeSize()));a(this,"awaitTake",es(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.takers.add(n),O(()=>{this.state._tag!=="Done"&&this.state.takers.delete(n)}))));a(this,"scheduleRunning",!1);a(this,"releaseTaker",()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const n=Ug(this.state.takers);this.state.takers.delete(n),n(Ot)});this.scheduler=n,this.capacity=r,this.strategy=s}offer(n){return B(()=>{if(this.state._tag!=="Open")return pl;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return pl;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),ml):this.offerRemainingSingle(n);case"sliding":return this.unsafeTake(),this.messages.push(n),ml}return this.messages.push(n),this.scheduleReleaseTaker(),ml})}unsafeOffer(n){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(n),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),!0):!1:(this.messages.push(n),this.scheduleReleaseTaker(),!0)}offerAll(n){return B(()=>{if(this.state._tag!=="Open")return R(ao(n));const r=this.unsafeOfferAllArray(n);return r.length===0?Xw:this.strategy==="dropping"?R(Ze(r)):this.offerRemainingArray(r)})}unsafeOfferAll(n){return Ze(this.unsafeOfferAllArray(n))}unsafeOfferAllArray(n){if(this.state._tag!=="Open")return pe(n);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=Ne(this.messagesChunk,Ze(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(Ne(ao(n)),Px(this.capacity)):kd(n)?this.messagesChunk=Ne(this.messagesChunk,n):this.messages=pe(n),this.scheduleReleaseTaker(),[];const r=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(r===0)return pe(n);const s=[];let o=0;for(const i of n)o<r?this.messages.push(i):s.push(i),o++;return this.scheduleReleaseTaker(),s}fail(n){return this.done(Ea(n))}failCause(n){return this.done(ye(n))}unsafeDone(n){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(n),!0):(this.state={...this.state,_tag:"Closing",exit:n},!0)}done(n){return O(()=>this.unsafeDone(n))}takeN(n){return B(()=>{if(this.state._tag==="Done")return Tl(this.state.exit,Zw);if(n<=0)return R([Ms,!1]);n=Math.min(n,this.capacity);let r;if(n<=this.messagesChunk.length)r=vi(this.messagesChunk,n),this.messagesChunk=Cr(this.messagesChunk,n);else if(n<=this.messages.length+this.messagesChunk.length)this.messagesChunk=Ne(this.messagesChunk,Ze(this.messages)),this.messages=[],r=vi(this.messagesChunk,n),this.messagesChunk=Cr(this.messagesChunk,n);else return ge(this.awaitTake,this.takeN(n));return R([r,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return hI(this.state.exit,Ea(new Sh));let n;if(this.messagesChunk.length>0)n=Td(this.messagesChunk),this.messagesChunk=Cr(this.messagesChunk,1);else if(this.messages.length>0)n=this.messages[0],this.messagesChunk=Cr(Ze(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?de(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),de(n)}unsafeSize(){const n=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?M():x(n)}commit(){return this.takeAll}pipe(){return D(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return Oe(this)}[(lk=um,uk=Yw,fe)](){return Oe(this)}offerRemainingSingle(n){return es(r=>{if(this.state._tag!=="Open")return r(pl);const s={_tag:"Single",message:n,resume:r};return this.state.offers.add(s),O(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}offerRemainingArray(n){return es(r=>{if(this.state._tag!=="Open")return r(de(Ze(n)));const s={_tag:"Array",remaining:n,offset:0,resume:r};return this.state.offers.add(s),O(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let n=this.capacity-this.messages.length-this.messagesChunk.length;for(const r of this.state.offers){if(n===0)return!1;if(r._tag==="Single")this.messages.push(r.message),n--,r.resume(ml),this.state.offers.delete(r);else{for(;r.offset<r.remaining.length;r.offset++){if(n===0)return!1;this.messages.push(r.remaining[r.offset]),n--}r.resume(Xw),this.state.offers.delete(r)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){const n=this.messages.length>0?Ne(this.messagesChunk,Ze(this.messages)):this.messagesChunk;return this.messagesChunk=Ms,this.messages=[],n}else if(this.messages.length>0){const n=Ze(this.messages);return this.messages=[],n}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,ke(this.messages.pop());return Ms}finalize(n){if(this.state._tag==="Done")return;const r=this.state;this.state={_tag:"Done",exit:n};for(const s of r.takers)s(n);r.takers.clear();for(const s of r.awaiters)s(n);r.awaiters.clear()}}const iG=e=>oe(t=>R(new oG(t.currentScheduler,typeof e=="number"?e:(e==null?void 0:e.capacity)??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":(e==null?void 0:e.strategy)??"suspend"))),cG=e=>{const t=he(e.takeAll,([n,r])=>r?n.length===0?Pt:Te(n):Ku(Te(n),t));return t},aG=um,uG=e=>j(e,aG),r1=iG,lG=cG,fG=Symbol.for("@effect/matcher/Matcher"),dG={[fG]:{_input:K,_filters:K,_result:K,_return:K},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?lm(this.provided,V(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?lm(this.provided,V(e.evaluate(this.provided))):this},pipe(){return D(this,arguments)}};function lm(e,t){const n=Object.create(dG);return n.provided=e,n.value=t,n}const hG=(e,t)=>({_tag:"When",guard:e,evaluate:t}),gG=e=>lm(e,W(e)),pG=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(hG(s,n))},mG=pG("_tag"),yG=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?V(n.evaluate(r)):W(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return V(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return V(s.evaluate(n))}return W(n)}},e$="effect/Match/exhaustive: absurd",bG=e=>{const t=yG(e);if(Wk(t)){if(t._tag==="Right")return t.right;throw new Error(e$)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(e$)}},SG=gG,Ag=mG,_G=bG,wG=J4,$G=V4,t$=QV,EG=f(e=>hr(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),kG=f(e=>hr(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),Vi=Symbol.for("effect/Schema");function ve(e){var t,n,r;return n=Vi,t=Vi,r=class{constructor(){a(this,n,fm)}static annotations(o){return ve(Vn(this.ast,o))}static pipe(){return D(this,arguments)}static toString(){return String(e)}},a(r,"ast",e),a(r,"Type"),a(r,"Encoded"),a(r,"Context"),a(r,t,fm),r}const fm={_A:e=>e,_I:e=>e,_R:e=>e},n$={schemaId:lM,message:fv,missingMessage:Km,identifier:Wm,title:gr,description:ou,examples:dv,default:hv,documentation:fM,jsonSchema:gv,arbitrary:pv,pretty:mv,equivalence:Hm,concurrency:yv,batching:bv,parseIssueTitle:Sv,parseOptions:_v,decodingFallback:wv},qo=e=>{if(!e)return{};const t={...e};for(const n in n$)if(n in e){const r=n$[n];t[r]=e[n],delete t[n]}return t},Vn=(e,t)=>ki(e,qo(t));const Hh=e=>String(e.ast),Jh=e=>ve(Kg(e.ast)),Eo=e=>ve(Xe(e.ast)),mS=(e,t)=>{const n=Qu(e,t);return(r,s)=>ta(n(r,s),jh)},Yu=mS,za=(e,t)=>{const n=Kh(e,t);return(r,s)=>ta(n(r,s),jh)},vG=(e,t)=>{const n=C4(e,t);return(r,s)=>Dm(n(r,s),jh)},yl=za,Xu=vG,_s=e=>j(e,Vi)&&hr(e[Vi]);function CG(e){return Vm(e)?zt.make(BM(e,t=>new tf(t))):new tf(e[0])}function s1(e,t=CG(e)){var n;return n=class extends ve(t){static annotations(s){return s1(this.literals,Vn(this.ast,s))}},a(n,"literals",[...e]),n}function ce(...e){return ze(e)?s1(e):Gh}const IG=(e,t,n)=>yS(e,new bd(e.map(r=>r.ast),(...r)=>t.decode(...r.map(ve)),(...r)=>t.encode(...r.map(ve)),qo(n))),TG=(e,t)=>{const n=()=>(s,o,i)=>e(s)?Ss(s):zh(new Wt(i,s)),r=n;return yS([],new bd([],n,r,qo(t)))};function yS(e,t){var n;return n=class extends ve(t){static annotations(s){return yS(this.typeParameters,Vn(this.ast,s))}},a(n,"typeParameters",[...e]),n}const Vh=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return IG(n,r,s)}const e=arguments[0],t=arguments[1];return TG(e,t)},r$=Symbol.for("effect/SchemaId/Brand"),o1=(e,t)=>n=>m1(n,new au(n.ast,function(o,i,c){const u=e.either(o);return pt(u)?x(new Wt(c,o,u.left.map(l=>l.message).join(", "))):M()},qo({schemaId:r$,[r$]:{constructor:e},...t})));class i1 extends ve(nf){}class zs extends ve(OM){}class OG extends ve(vM){}class Gh extends ve(Sd){}class s$ extends ve(vv){}class Yt extends ve(Cv){}class F extends ve(jg){}class wt extends ve(zg){}class ko extends ve(Bg){}const RG=e=>zt.make(e.map(t=>t.ast));function c1(e,t=RG(e)){var n;return n=class extends ve(t){static annotations(s){return c1(this.members,Vn(this.ast,s))}},a(n,"members",[...e]),n}function ae(...e){return Vm(e)?c1(e):ze(e)?e[0]:Gh}const bS=e=>ae(e,i1),PG=(e,t)=>new wd(e.map(n=>_s(n)?new To(n.ast,!1):n.ast),t.map(n=>_s(n)?new _d(n.ast):n.ast),!0);function a1(e,t,n=PG(e,t)){var r;return r=class extends ve(n){static annotations(o){return a1(this.elements,this.rest,Vn(this.ast,o))}},a(r,"elements",[...e]),a(r,"rest",[...t]),r}function u1(e,t){var n;return n=class extends a1([],[e],t){static annotations(s){return u1(this.value,Vn(this.ast,s))}},a(n,"value",e),n}const Ke=e=>u1(e),dm=e=>e?'"?:"':'":"';class Qh extends To{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"defaultValue");a(this,"_tag","PropertySignatureDeclaration");this.isReadonly=s,this.defaultValue=i}toString(){const n=dm(this.isOptional),r=String(this.type);return`PropertySignature<${n}, ${r}, never, ${n}, ${r}>`}}class FG extends To{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"fromKey");this.isReadonly=s,this.fromKey=i}}class zf extends To{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"defaultValue");this.isReadonly=s,this.defaultValue=i}}const MG=e=>e===void 0?"never":Gt(e)?JSON.stringify(e):String(e);class Bf{constructor(t,n,r,s){a(this,"from");a(this,"to");a(this,"decode");a(this,"encode");a(this,"_tag","PropertySignatureTransformation");this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${dm(this.to.isOptional)}, ${this.to.type}, ${MG(this.from.fromKey)}, ${dm(this.from.isOptional)}, ${this.from.type}>`}}const l1=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new Qh(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Bf(e.from,new zf(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},f1=Symbol.for("effect/PropertySignature"),SS=e=>j(e,f1);var fk,dk;dk=Vi,fk=f1;const LS=class LS{constructor(t){a(this,"ast");a(this,dk);a(this,fk,null);a(this,"_TypeToken");a(this,"_Key");a(this,"_EncodedToken");a(this,"_HasDefault");this.ast=t}pipe(){return D(this,arguments)}annotations(t){return new LS(l1(this.ast,qo(t)))}toString(){return String(this.ast)}};let Kf=LS;const Wf=e=>new Kf(e);class Yh extends Kf{constructor(n,r){super(n);a(this,"from");this.from=r}annotations(n){return new Yh(l1(this.ast,qo(n)),this.from)}}const d1=e=>new Yh(new Qh(e.ast,!1,!0,{},void 0),e),_S=f(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Wf(new Qh(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Wf(new Bf(n.from,new zf(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),o$=(e,t)=>Re(e,{onNone:()=>x(t()),onSome:n=>x(n===void 0?t():n)}),Hf=e=>nx(e,Hf,t=>{const n=Hf(t.to);if(n)return new rr(t.from,n,t.transformation)}),xG=f(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=Xe(n.type);return Wf(new Bf(new FG(n.type,n.isOptional,n.isReadonly,n.annotations),new zf(Hf(r)??r,!1,!0,{},n.defaultValue),s=>o$(s,t),K))}case"PropertySignatureTransformation":{const r=n.to.type;return Wf(new Bf(n.from,new zf(Hf(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>o$(n.decode(s),t),n.encode))}}}),h1=f(2,(e,t)=>e.pipe(xG(t.decoding),_S(t.constructor))),gn=e=>{const t=e.ast===nf||e.ast===Sd?nf:bS(e).ast;return new Yh(new Qh(t,!0,!0,{},void 0),e)},AG=Nv([Km]),NG=(e,t)=>{const n=Nn(e),r=[];if(n.length>0){const o=[],i=[],c=[];for(let u=0;u<n.length;u++){const l=n[u],g=e[l];if(SS(g)){const h=g.ast;switch(h._tag){case"PropertySignatureDeclaration":{const p=h.type,m=h.isOptional,b=h.annotations;o.push(new Ye(l,p,m,!0,AG(h))),i.push(new Ye(l,Xe(p),m,!0,b)),r.push(new Ye(l,p,m,!0,b));break}case"PropertySignatureTransformation":{const p=h.from.fromKey??l;o.push(new Ye(p,h.from.type,h.from.isOptional,!0,h.from.annotations)),i.push(new Ye(l,h.to.type,h.to.isOptional,!0,h.to.annotations)),c.push(new JM(p,l,h.decode,h.encode));break}}}else o.push(new Ye(l,g.ast,!1,!0)),i.push(new Ye(l,Xe(g.ast),!1,!0)),r.push(new Ye(l,g.ast,!1,!0))}if(ze(c)){const u=[],l=[];for(const g of t){const{indexSignatures:h,propertySignatures:p}=n_(g.key.ast,g.value.ast);p.forEach(m=>{o.push(m),i.push(new Ye(m.name,Xe(m.type),m.isOptional,m.isReadonly,m.annotations))}),h.forEach(m=>{u.push(m),l.push(new iu(m.parameter,Xe(m.type),m.isReadonly))})}return new rr(new vn(o,u,{[oi]:"Struct (Encoded side)"}),new vn(i,l,{[oi]:"Struct (Type side)"}),new of(c))}}const s=[];for(const o of t){const{indexSignatures:i,propertySignatures:c}=n_(o.key.ast,o.value.ast);c.forEach(u=>r.push(u)),i.forEach(u=>s.push(u))}return new vn(r,s)},g1=(e,t)=>{const n=Nn(e);for(const r of n){const s=e[r];if(t[r]===void 0&&SS(s)){const o=s.ast,i=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;i!==void 0&&(t[r]=i())}}return t};function wS(e,t,n=NG(e,t)){var r;return r=class extends ve(n){static annotations(o){return wS(this.fields,this.records,Vn(this.ast,o))}static pick(...o){return Z(EG(e,...o))}static omit(...o){return Z(kG(e,...o))}},a(r,"fields",{...e}),a(r,"records",[...t]),a(r,"make",(o,i)=>{const c=g1(e,{...o});return Zh(i)?c:Wh(r)(c)}),r}function Z(e,...t){return wS(e,t)}const LG=e=>ce(e).pipe(d1,_S(()=>e)),se=(e,t)=>Z({_tag:LG(e),...t});function p1(e,t,n){var r;return r=class extends wS({},[{key:e,value:t}],n){static annotations(o){return p1(e,t,Vn(this.ast,o))}},a(r,"key",e),a(r,"value",t),r}const Xh=e=>p1(e.key,e.value),DG=(...e)=>t=>ve(Xn(t.ast,e)),qG=(...e)=>t=>ve(YM(t.ast,e)),UG=f(2,(e,t)=>{const n=As(Xe(e.ast),t),r=ve(n.isOptional?XM(n.type):n.type);return Ic(e.pipe(DG(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function m1(e,t){var n;return n=class extends ve(t){static annotations(s){return m1(this.from,Vn(this.ast,s))}},a(n,"make",(s,o)=>Zh(o)?s:Wh(n)(s)),a(n,"from",e),n}const jG=e=>ve(Yo(e.ast)),Dc=(e,t,n)=>{if(sf(e)&&sf(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,i=r.findIndex(c=>c.name===o);if(i===-1)r.push(s);else{const{isOptional:c,type:u}=r[i];r[i]=new Ye(o,Jf(u,s.type,n.concat(o)),c,!0)}}return new vn(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(av(e,t,n))},zG=ZM([Wm]),qc=(e,t)=>t.map(n=>new au(n,e.filter,zG(e))),Jf=(e,t,n)=>zt.make(Er([e],[t],n)),Ts=e=>cu(e)?e.types:[e],Er=(e,t,n)=>Xl(e,r=>Xl(t,s=>{switch(s._tag){case"Literal":{if(Gt(s.literal)&&rf(r)||Ar(s.literal)&&XS(r)||no(s.literal)&&ZS(r))return[s];break}case"StringKeyword":{if(s===jg){if(rf(r)||Gc(r)&&Gt(r.literal))return[r];if(ii(r))return qc(r,Er(Ts(r.from),[s],n))}else if(r===jg)return[s];break}case"NumberKeyword":{if(s===zg){if(XS(r)||Gc(r)&&Ar(r.literal))return[r];if(ii(r))return qc(r,Er(Ts(r.from),[s],n))}else if(r===zg)return[s];break}case"BooleanKeyword":{if(s===Bg){if(ZS(r)||Gc(r)&&no(r.literal))return[r];if(ii(r))return qc(r,Er(Ts(r.from),[s],n))}else if(r===Bg)return[s];break}case"Union":return Er(Ts(r),s.types,n);case"Suspend":return[new Ei(()=>Jf(r,s.f(),n))];case"Refinement":return qc(s,Er(Ts(r),Ts(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return Er(r.types,[s],n);case"Suspend":return[new Ei(()=>Jf(r.f(),s,n))];case"Refinement":return qc(r,Er(Ts(r.from),[s],n));case"TypeLiteral":return[Dc(r,s,n)];case"Transformation":{const o=r.transformation,i=Dc(r.from,s,n),c=Dc(r.to,Xe(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new rr(i,c,new of(o.propertySignatureTransformations))];case"ComposeTransformation":return[new rr(i,c,Pv)];case"FinalTransformation":return[new rr(i,c,new Rv((u,l,g,h)=>un(o.decode(u,l,g,h),p=>({...u,...p})),(u,l,g,h)=>un(o.encode(u,l,g,h),p=>({...u,...p}))))]}}}break}case"Transformation":{if(KM(r)){if(t_(s.transformation)&&t_(r.transformation))return[new rr(Dc(r.from,s.from,n),Dc(r.to,s.to,n),new of(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return Er([s],[r],n);break}}throw new Error(av(r,s,n))})),y1=f(2,(e,t)=>ve(Jf(e.ast,t.ast,[]))),Ba=e=>ve(new Ei(()=>e().ast)),b1=Symbol.for("effect/SchemaId/Refine");function S1(e,t,n){var r,s,o;return o=class extends(s=ve(n),r=b1,s){static annotations(c){return S1(this.from,this.filter,Vn(this.ast,c))}},a(o,r,e),a(o,"from",e),a(o,"filter",t),a(o,"make",(c,u)=>Zh(u)?c:Wh(o)(c)),o}const i$=(e,t,n)=>{if(no(e))return e?M():x(new Wt(t,n));if(Gt(e))return x(new Wt(t,n,e));if(e!==void 0){if("_tag"in e)return x(e);const r=new Wt(t,n,e.message);return x(ze(e.path)?new vt(e.path,n,r):r)}return M()},BG=(e,t,n)=>{if(tM(e))return i$(e,t,n);if(ze(e)){const r=tv(e,s=>i$(s,t,n));if(ze(r))return x(r.length===1?r[0]:new Ge(t,n,r))}return M()};function _1(e,t){return n=>{function r(o,i,c){return BG(e(o,i,c),c,o)}const s=new au(n.ast,r,qo(t));return S1(n,r,s)}}function w1(e,t,n){var r;return r=class extends ve(n){static annotations(o){return w1(this.from,this.to,Vn(this.ast,o))}},a(r,"from",e),a(r,"to",t),r}const Gi=f(e=>_s(e[0])&&_s(e[1]),(e,t,n)=>w1(e,t,new rr(e.ast,t.ast,new Rv(n.decode,n.encode)))),Ic=f(e=>_s(e[0])&&_s(e[1]),(e,t,n)=>Gi(e,t,{strict:!0,decode:(r,s,o,i)=>Ss(n.decode(r,i)),encode:(r,s,o,i)=>Ss(n.encode(r,i))})),KG=cM,WG=e=>t=>t.pipe(_1(n=>Number.isSafeInteger(n),{schemaId:KG,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),HG=aM,JG=(e,t,n)=>r=>r.pipe(_1(s=>s>=e&&s<=t,{schemaId:HG,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n}));class Vf extends wt.pipe(WG({identifier:"Int"})){}const $1=(e,t,n,r)=>k4(e,{onFailure:s=>new Ge(n,r,s),onSuccess:t});class $S extends Vh(CP,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>pd(H)}){}class VG extends wt.pipe(JG(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class GG extends Ic(Ke(VG).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),$S,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const QG=(e,t,n)=>Gi(F.annotations({description:"a string to be decoded into a Uint8Array"}),$S,{strict:!0,decode:(r,s,o)=>Dm(t(r),i=>new Wt(o,r,i.message)),encode:r=>Ss(n(r))}).annotations({identifier:e}),YG=QG("Uint8ArrayFromBase64",t4,e4),XG=Z({_tag:ce("None")}).annotations({description:"NoneEncoded"}),ZG=e=>Z({_tag:ce("Some"),value:e}).annotations({description:`SomeEncoded<${Hh(e)}>`}),e6=e=>ae(XG,ZG(e)).annotations({description:`OptionEncoded<${Hh(e)}>`}),E1=e=>e._tag==="None"?M():x(e.value),t6=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(E1),n6=e=>Re({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),c$=e=>(t,n,r)=>hF(t)?Ue(t)?Ss(M()):$1(e(t.value,n),x,r,t):zh(new Wt(r,t)),r6=e=>Vh([e],{decode:t=>c$(Kh(t)),encode:t=>c$(Qu(t))},{description:`Option<${Hh(e)}>`,pretty:n6,arbitrary:t6,equivalence:SF}),s6={_tag:"None"},o6=e=>({_tag:"Some",value:e});function ql(e){const t=e;return Ic(e6(t),r6(Eo(t)),{strict:!0,decode:r=>E1(r),encode:r=>Re(r,{onNone:()=>s6,onSome:o6})})}const i6=e=>_s(e)||SS(e),k1=e=>Nn(e).every(t=>i6(e[t])),ES=e=>"fields"in e?e.fields:ES(e[b1]),kS=e=>k1(e)?Z(e):_s(e)?e:Z(ES(e)),vS=e=>k1(e)?e:ES(e),Uo=e=>(t,n)=>Si({kind:"Class",identifier:e,schema:kS(t),fields:vS(t),Base:pK,annotations:n}),v1=e=>_S(d1(ce(e)),()=>e),yr=e=>(t,n,r)=>{class s extends bb{}s.prototype.name=t;const o=vS(n),i=kS(n),c={_tag:v1(t)},u=ra(c,o),l="message"in u;class g extends Si({kind:"TaggedError",identifier:t,schema:y1(i,Z(c)),fields:u,Base:s,annotations:r,disableToString:!0}){}return a(g,"_tag",t),l||Object.defineProperty(g.prototype,"message",{get(){return`{ ${Nn(o).map(h=>`${Bm(h)}: ${kn(this[h])}`).join(", ")} }`},enumerable:!1,configurable:!0}),g},ra=(e,t)=>{const n={...e};for(const r of Nn(t)){if(r in e)throw new Error(lv(r));n[r]=t[r]}return n};function Zh(e){return no(e)?e:(e==null?void 0:e.disableValidation)??!1}const a$=ee("effect/Schema/astCache",()=>new WeakMap),c6=e=>e===void 0?[]:Array.isArray(e)?e:[e],Si=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:i})=>{var P,y;const c=Symbol.for(`effect/Schema/${o}/${s}`),[u,l,g]=c6(t),h=Eo(i),p=h.annotations({identifier:s,...u}),m=h.annotations({[oi]:`${s} (Type side)`,...u}),b=i.annotations({[oi]:`${s} (Constructor)`,...u}),$=i.annotations({[oi]:`${s} (Encoded side)`,...g}),_=i.annotations({[yd]:s,...g,...u,...l}),w=E=>j(E,c)&&at(m)(E),S=(y=class extends e{constructor(E={},C=!1){E={...E},o!=="Class"&&delete E._tag,E=g1(r,E),Zh(C)||(E=Wh(b)(E)),super(E,!0)}static get ast(){let E=a$.get(this);if(E)return E;const C=Vh([i],{decode:()=>(I,T,N)=>I instanceof this||w(I)?Ss(I):zh(new Wt(N,I)),encode:()=>(I,T)=>I instanceof this?Ss(I):un(Qu(m)(I,T),N=>new this(N,!0))},{identifier:s,pretty:I=>T=>`${s}(${I(T)})`,arbitrary:I=>T=>I(T).map(N=>new this(N)),equivalence:K,[ef]:p.ast,...u});return E=Ic($,C,{strict:!0,decode:I=>new this(I,!0),encode:K}).annotations({[ef]:_.ast,...l}).ast,a$.set(this,E),E}static pipe(){return D(this,arguments)}static annotations(E){return ve(this.ast).annotations(E)}static toString(){return`(${String($)} <-> ${s})`}static make(...E){return new this(...E)}static extend(E){return(C,I)=>{const T=vS(C),N=kS(C),v=ra(r,T);return Si({kind:o,identifier:E,schema:y1(i,N),fields:v,Base:this,annotations:I})}}static transformOrFail(E){return(C,I,T)=>{const N=ra(r,C);return Si({kind:o,identifier:E,schema:Gi(i,Eo(Z(N)),I),fields:N,Base:this,annotations:T})}}static transformOrFailFrom(E){return(C,I,T)=>{const N=ra(r,C);return Si({kind:o,identifier:E,schema:Gi(Jh(i),Z(N),I),fields:N,Base:this,annotations:T})}}get[(P=Vi,c)](){return c}},a(y,P,fm),a(y,"fields",{...r}),a(y,"identifier",s),y);return n!==!0&&Object.defineProperty(S.prototype,"toString",{value(){return`${s}({ ${Nn(r).map(E=>`${Bm(E)}: ${kn(this[E])}`).join(", ")} })`},configurable:!0,writable:!0}),S},a6=Z({_tag:ce("None")}).annotations({identifier:"FiberIdNoneEncoded"}),u6=Z({_tag:ce("Runtime"),id:Vf,startTimeMillis:Vf}).annotations({identifier:"FiberIdRuntimeEncoded"}),l6=Z({_tag:ce("Composite"),left:Ba(()=>hm),right:Ba(()=>hm)}).annotations({identifier:"FiberIdCompositeEncoded"}),hm=ae(a6,u6,l6).annotations({identifier:"FiberIdEncoded"}),f6=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Gf),gm=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${gm(e.right)}, ${gm(e.left)})`}},Gf=e=>{switch(e._tag){case"None":return Cn;case"Runtime":return qA(e.id,e.startTimeMillis);case"Composite":return UA(Gf(e.left),Gf(e.right))}},d6=e=>Z({_tag:ce("Die"),defect:e}),h6=Z({_tag:ce("Empty")}),g6=e=>Z({_tag:ce("Fail"),error:e}),p6=Z({_tag:ce("Interrupt"),fiberId:hm});let m6=0;const pm=(e,t)=>{const n=e,r=t,s=Ba(()=>o),o=ae(h6,g6(n),d6(r),p6,Z({_tag:ce("Sequential"),left:s,right:s}),Z({_tag:ce("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${Hh(e)}>`,[yd]:`CauseEncoded${m6++}`});return o},y6=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:f6(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(Bs),b6=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${nT(r)})`;case"Interrupt":return`Cause.interrupt(${gm(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},u$=e=>(t,n,r)=>NB(t)?$1(e(si(t),n),Bs,r,t):zh(new Wt(r,t)),S6=({defect:e,error:t})=>Vh([t,e],{decode:(n,r)=>u$(Kh(pm(n,r))),encode:(n,r)=>u$(Qu(pm(n,r)))},{title:`Cause<${t.ast}>`,pretty:b6,arbitrary:y6});function Bs(e){switch(e._tag){case"Empty":return MB;case"Fail":return _c(e.error);case"Die":return Wi(e.defect);case"Interrupt":return mh(Gf(e.fiberId));case"Sequential":return AB(Bs(e.left),Bs(e.right));case"Parallel":return xB(Bs(e.left),Bs(e.right))}}function si(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:si(e.left),right:si(e.right)};case"Parallel":return{_tag:"Parallel",left:si(e.left),right:si(e.right)}}}const _6=({defect:e,error:t})=>{const n=t,r=e;return Ic(pm(n,r),S6({error:Eo(n),defect:Eo(r)}),{strict:!1,decode:o=>Bs(o),encode:o=>si(o)})};class Ka extends Ic(s$,s$,{strict:!0,decode:t=>{if(hr(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:WC(t)}).annotations({identifier:"Defect"}){}const C1=Symbol.for("effect/Schema/Serializable/symbol"),w6=e=>mS(e[C1])(e),Zu=Symbol.for("effect/Schema/Serializable/symbolResult"),l$=e=>e[Zu].failure,f$=e=>e[Zu].success,$6=f(2,(e,t)=>Yu(e[Zu].failure)(t)),E6=f(2,(e,t)=>Yu(e[Zu].success)(t)),qt=e=>(t,n,r)=>{var o;const s=ra({_tag:v1(t)},n.payload);return o=class extends Si({kind:"TaggedRequest",identifier:t,schema:Z(s),fields:s,Base:BW,annotations:r}){get[C1](){return this.constructor}get[Zu](){return{failure:n.failure,success:n.success}}},a(o,"_tag",t),a(o,"success",n.success),a(o,"failure",n.failure),o},I1=e=>Rn(e.ast,[]),k6=Nt(Hm),Rn=(e,t)=>{const n=k6(e);if(_e(n))switch(e._tag){case"Declaration":return n.value(...e.typeParameters.map(r=>Rn(r,t)));case"Refinement":return n.value(Rn(e.from,t));default:return n.value()}switch(e._tag){case"NeverKeyword":throw new Error(nM(e,t));case"Transformation":return Rn(e.to,t);case"Declaration":case"Literal":case"StringKeyword":case"TemplateLiteral":case"UniqueSymbol":case"SymbolKeyword":case"UnknownKeyword":case"AnyKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"UndefinedKeyword":case"VoidKeyword":case"Enums":case"ObjectKeyword":return H;case"Refinement":return Rn(e.from,t);case"Suspend":{const r=zm(()=>Rn(e.f(),t));return(s,o)=>r()(s,o)}case"TupleType":{const r=e.elements.map((o,i)=>Rn(o.type,t.concat(i))),s=e.rest.map(o=>Rn(o.type,t));return Ks((o,i)=>{const c=o.length;if(c!==i.length)return!1;let u=0;for(;u<Math.min(c,e.elements.length);u++)if(!r[u](o[u],i[u]))return!1;if(ze(s)){const[l,...g]=s;for(;u<c-g.length;u++)if(!l(o[u],i[u]))return!1;for(let h=0;h<g.length;h++)if(u+=h,!g[h](o[u],i[u]))return!1}return!0})}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return H;const r=e.propertySignatures.map(o=>Rn(o.type,t.concat(o.name))),s=e.indexSignatures.map(o=>Rn(o.type,t));return Ks((o,i)=>{const c=Object.keys(o),u=Object.getOwnPropertySymbols(o);for(let h=0;h<r.length;h++){const p=e.propertySignatures[h],m=p.name,b=Object.prototype.hasOwnProperty.call(o,m),$=Object.prototype.hasOwnProperty.call(i,m);if(p.isOptional&&b!==$||b&&$&&!r[h](o[m],i[m]))return!1}let l,g;for(let h=0;h<s.length;h++){const p=e.indexSignatures[h],m=io(p.parameter),b=Jm(m);if(b){if(l=l||Object.getOwnPropertySymbols(i),u.length!==l.length)return!1}else if(g=g||Object.keys(i),c.length!==g.length)return!1;const $=b?u:c;for(let _=0;_<$.length;_++){const w=$[_];if(!Object.prototype.hasOwnProperty.call(i,w)||!s[h](o[w],i[w]))return!1}}return!0})}case"Union":{const r=QR(e.types,!0),s=Nn(r.keys),o=s.length;return Ks((i,c)=>{let u=[];if(o>0&&ad(i))for(let g=0;g<o;g++){const h=s[g],p=r.keys[h].buckets;if(Object.prototype.hasOwnProperty.call(i,h)){const m=String(i[h]);Object.prototype.hasOwnProperty.call(p,m)&&(u=u.concat(p[m]))}}r.otherwise.length>0&&(u=u.concat(r.otherwise));const l=u.map(g=>[Rn(g,t),at({ast:g})]);for(let g=0;g<l.length;g++){const[h,p]=l[g];if(p(i)&&p(c)&&h(i,c))return!0}return!1})}}},v6=lV,C6=fV,I6=pV,T6=Uf,O6=mV,R6=yV,vo=SV,T1=_V,P6=wV,Wa=Uh,F6=MR,O1=AR,Qi=ja,M6=IV,jo=jf,x6=OV,A6=S4,N6=PV,L6=FV,D6=xV,q6=NV,qn=LV,U6=LR,R1=dS,Qf=qV,ls=UV,j6=jV,d$=DR,z6=hS,B6=WV,eg=HV,h$=Symbol.for("effect/Subscribable"),K6=$T,W6="effect/SubscriptionRef",H6=Symbol.for(W6),J6={_A:e=>e};var hk,gk,pk,mk,yk,bk;class V6 extends(bk=Hr,yk=qi,mk=h$,pk=Cq,gk=K6,hk=H6,bk){constructor(n,r,s){super();a(this,"ref");a(this,"pubsub");a(this,"semaphore");a(this,yk,qi);a(this,mk,h$);a(this,pk,Hy);a(this,gk,ET);a(this,hk,J6);a(this,"get");this.ref=n,this.pubsub=r,this.semaphore=s,this.get=as(this.ref)}commit(){return this.get}get changes(){return d(as(this.ref),U(n=>ie(AR(this.pubsub,{scoped:!0}),r=>hV(TV(n),r))),this.semaphore.withPermits(1),hS)}modify(n){return this.modifyEffect(r=>be(n(r)))}modifyEffect(n){return d(as(this.ref),U(n),U(([r,s])=>d(Cu(this.ref,s),xr(r),Rb(Kb(this.pubsub,s)))),this.semaphore.withPermits(1))}}const G6=e=>as(e.ref),Q6=e=>d(wb([dO(),No(e),Ob(1)]),ie(([t,n,r])=>new V6(n,t,r))),Y6=f(2,(e,t)=>d(Cu(e.ref,t),Rb(Kb(e.pubsub,t)),e.semaphore.withPermits(1))),X6=G6,P1=Q6,sa=Y6,F1=e=>t=>x6(t,n=>d(e(n),ie(()=>n))),Yf=f(2,(e,t)=>d(e.changes,vo(t),Qf(1),q6,ie(Td))),Z6=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,eQ=e=>eG(nG,rG({formatDate:t=>`${Z6(t)} ${e}`})),tQ={};var nQ={};const M1=()=>typeof process<"u"&&nQ!==void 0||tQ!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),rQ=e=>{const t=e==null?void 0:e.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},mm=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",jt=(e,...t)=>{if(console.error(e,...t),M1())debugger;throw new Error(`This should never happen: ${e}`)};var xs;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(xs||(xs={}));const sQ=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan");xs.INTERNAL,xs.CLIENT,xs.SERVER,xs.PRODUCER,xs.CONSUMER;const oQ=U(Pb,e=>sQ in e?be(e.span):zn(new Sh)),x1=oQ,bl=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),g$=e=>e!==void 0,p$={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var m$={};const Ha=e=>{if(typeof process<"u"&&m$!==void 0)return m$[e];if(p$!==void 0)return p$[e]};Ha("LS_TRACE_VERBOSE")!==void 0||Ha("VITE_LS_TRACE_VERBOSE");const Ja=mm(Ha("LS_DEV"))||mm(Ha("VITE_LS_DEV"));mm(Ha("CI"));function A1(e){debugger;throw new Error(`A case was not handled for value: ${iQ(rQ(e),1e3)}`)}const iQ=(e,t)=>e.length>t?e.slice(0,t)+"...":e,zo=e=>q(function*(){const t=yield*wh();return yield*mr(n=>yt(t,n)),yield*e(t).pipe(_h(t))}),cQ=(...e)=>mr(()=>tO(...e)),Ct=e=>$c(e,t=>q(function*(){if(Ys(t))return;const n=yield*x1.pipe(WT("NoSuchElementException",s=>be(void 0))),r=t.toString().split(`
`)[0];yield*Ap(r,t).pipe(s=>n===void 0?s:Xs({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),fn=(e,t)=>r3(tO(e).pipe(Xs(t??{})),g3,()=>Nd(sG)),y$=({label:e,duration:t})=>n=>q(function*(){const r=yield*vs();let s=!1;const o=Cb(t).pipe(Dn(()=>(s=!0,ir(`${e}: Took longer than ${t}ms`))),hn(r),Cs),i=Date.now(),c=yield*n.pipe(tt,HT(Mb(function*(){const u=Date.now();yield*tn(o),s&&(yield*ir(`${e}: Interrupted after ${u-i}ms`))})));if(s){const u=Date.now();yield*ir(`${e}: Actual duration: ${u-i}ms`)}return yield*tn(o),yield*c}),N1=()=>{const e=cW();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},aQ=()=>console.log(N1());globalThis.getSpanTrace=N1;globalThis.logSpanTrace=aQ;const L1=(e,t)=>{class n extends bb{constructor(){super(...arguments);a(this,"_tag",t)}}return n.prototype[e]=e,n.prototype.name=t,n},b$=Symbol.for("@effect/platform/Cookies"),S$=Symbol.for("@effect/platform/Cookies/Cookie"),uQ={[b$]:b$,...dd,toJSON(){return{_id:"@effect/platform/Cookies",cookies:PF(this.cookies,e=>e.toJSON())}},pipe(){return D(this,arguments)}},lQ=e=>{const t=Object.create(uQ);return t.cookies=e,t},fQ=e=>{const t={};for(const n of e)t[n.name]=n;return lQ(t)},dQ=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=hQ(r.trim());_e(s)&&n.push(s.value)}return fQ(n)};function hQ(e){const t=e.split(";").map(c=>c.trim()).filter(c=>c!=="");if(t.length===0)return M();const n=t[0].indexOf("=");if(n===-1)return M();const r=t[0].slice(0,n);if(!gQ.test(r))return M();const s=t[0].slice(n+1),o=pQ(s);if(t.length===1)return x(Object.assign(Object.create(_$),{name:r,value:o,valueEncoded:s}));const i={};for(let c=1;c<t.length;c++){const u=t[c],l=u.indexOf("="),g=l===-1?u:u.slice(0,l).trim(),h=l===-1?void 0:u.slice(l+1).trim();switch(g.toLowerCase()){case"domain":{if(h===void 0)break;const p=h.trim().replace(/^\./,"");p&&(i.domain=p);break}case"expires":{if(h===void 0)break;const p=new Date(h);isNaN(p.getTime())||(i.expires=p);break}case"max-age":{if(h===void 0)break;const p=parseInt(h,10);isNaN(p)||(i.maxAge=Ym(p));break}case"path":{if(h===void 0)break;h[0]==="/"&&(i.path=h);break}case"priority":{if(h===void 0)break;switch(h.toLowerCase()){case"low":i.priority="low";break;case"medium":i.priority="medium";break;case"high":i.priority="high";break}break}case"httponly":{i.httpOnly=!0;break}case"secure":{i.secure=!0;break}case"partitioned":{i.partitioned=!0;break}case"samesite":{if(h===void 0)break;switch(h.toLowerCase()){case"lax":i.sameSite="lax";break;case"strict":i.sameSite="strict";break;case"none":i.sameSite="none";break}break}}}return x(Object.assign(Object.create(_$),{name:r,value:o,valueEncoded:s,options:Object.keys(i).length>0?i:void 0}))}const gQ=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,_$={[S$]:S$,...dd,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},pQ=e=>{try{return decodeURIComponent(e)}catch{return e}},w$=Symbol.for("@effect/platform/Headers"),Va=Object.assign(Object.create(null),{[w$]:w$,[hd](e){return bm(this,oh(e,q1))}}),tg=e=>Object.assign(Object.create(Va),e),D1=Object.create(Va),CS=e=>{if(e===void 0)return D1;if(Symbol.iterator in e){const n=Object.create(Va);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(Va);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},mQ=e=>Object.setPrototypeOf(e,Va),ym=f(3,(e,t,n)=>{const r=tg(e);return r[t.toLowerCase()]=n,r}),yQ=f(2,(e,t)=>tg({...e,...CS(t)})),bQ=f(2,(e,t)=>{const n=tg(e);return Object.assign(n,t),n}),SQ=f(2,(e,t)=>{const n=tg(e),r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&delete n[o]}else for(const o in e)s.test(o)&&delete n[o]};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),bm=f(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=t$(e[o]))}else for(const o in e)s.test(o)&&(n[o]=t$(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),q1=ee("@effect/platform/Headers/currentRedactedNames",()=>xb(["authorization","cookie","set-cookie","x-api-key"])),_Q=Symbol.for("@effect/platform/HttpClientError"),U1=_Q;class j1 extends L1(U1,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Os extends L1(U1,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const IS=e=>{const t=z1(e),n=[];for(let r=0;r<t.length;r++)if(Array.isArray(t[r][0])){const[s,o]=t[r];n.push([`${s[0]}[${s.slice(1).join("][")}]`,o])}else n.push(t[r]);return n},z1=e=>{const t=Symbol.iterator in e?pe(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else if(typeof s=="object"){const o=z1(s);for(const[i,c]of o)n.push([[r,...typeof i=="string"?[i]:i],c])}else s!==void 0&&n.push([r,String(s)]);return n},wQ=[],$Q=f(2,(e,t)=>{const n=IS(t),r=n.map(([s])=>s);return Um(nv(e,([s])=>r.includes(s)),n)}),EQ=(e,t,n)=>{try{const r=new URL(e,kQ());for(let s=0;s<t.length;s++){const[o,i]=t[s];i!==void 0&&r.searchParams.append(o,i)}return n._tag==="Some"&&(r.hash=n.value),V(r)}catch(r){return W(r)}},kQ=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},oa=Symbol.for("@effect/platform/HttpIncomingMessage"),vQ=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=us(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=us(e.text)}catch{}const s={...t,headers:ro(e.headers),remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},CQ=e=>mQ({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),Ng=Symbol.for("@effect/platform/HttpBody");var Sk;class IQ{constructor(){a(this,Sk);this[Ng]=Ng}[(Sk=Ng,fe)](){return this.toJSON()}toString(){return Oe(this)}}class TQ extends IQ{constructor(){super(...arguments);a(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const OQ=new TQ,$$=Symbol.for("@effect/platform/HttpClientRequest"),RQ={[$$]:$$,...dd,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:ro(this.headers),body:this.body.toJSON()}},pipe(){return D(this,arguments)}};function jr(e,t,n,r,s,o){const i=Object.create(RQ);return i.method=e,i.url=t,i.urlParams=n,i.hash=r,i.headers=s,i.body=o,i}const PQ=jr("GET","",wQ,M(),D1,OQ),Bo=e=>(t,n)=>qQ(PQ,{method:e,url:t,...n??void 0}),FQ=Bo("GET"),MQ=Bo("POST"),xQ=Bo("PUT"),AQ=Bo("PATCH"),NQ=Bo("DELETE"),LQ=Bo("HEAD"),DQ=Bo("OPTIONS"),qQ=f(2,(e,t)=>{let n=e;return t.method&&(n=zQ(n,t.method)),t.url&&(n=BQ(n,t.url)),t.headers&&(n=B1(n,t.headers)),t.urlParams&&(n=KQ(n,t.urlParams)),t.hash&&(n=WQ(n,t.hash)),t.body&&(n=HQ(n,t.body)),t.accept&&(n=K1(n,t.accept)),t.acceptJson&&(n=jQ(n)),n}),UQ=f(3,(e,t,n)=>jr(e.method,e.url,e.urlParams,e.hash,ym(e.headers,t,n),e.body)),B1=f(2,(e,t)=>jr(e.method,e.url,e.urlParams,e.hash,yQ(e.headers,t),e.body)),K1=f(2,(e,t)=>UQ(e,"Accept",t)),jQ=K1("application/json"),zQ=f(2,(e,t)=>jr(t,e.url,e.urlParams,e.hash,e.headers,e.body)),BQ=f(2,(e,t)=>{if(typeof t=="string")return jr(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=IS(n.searchParams),s=n.hash?x(n.hash.slice(1)):M();return n.search="",n.hash="",jr(e.method,n.toString(),r,s,e.headers,e.body)}),KQ=f(2,(e,t)=>jr(e.method,e.url,$Q(e.urlParams,t),e.hash,e.headers,e.body)),WQ=f(2,(e,t)=>jr(e.method,e.url,e.urlParams,x(t),e.headers,e.body)),HQ=f(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty"||t._tag==="FormData")n=SQ(n,["Content-type","Content-length"]);else{const r=t.contentType;r&&(n=ym(n,"content-type",r));const s=t.contentLength;s&&(n=ym(n,"content-length",s.toString()))}return jr(e.method,e.url,e.urlParams,e.hash,n,t)}),ia=Symbol.for("@effect/platform/HttpClientResponse"),JQ=(e,t)=>new VQ(e,t);var _k,wk,$k;class VQ extends($k=KP,wk=oa,_k=ia,$k){constructor(n,r){super();a(this,"request");a(this,"source");a(this,wk);a(this,_k);a(this,"cachedCookies");a(this,"textBody");a(this,"formDataBody");a(this,"arrayBufferBody");this.request=n,this.source=r,this[oa]=oa,this[ia]=ia}toJSON(){return vQ(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return CS(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=dQ(this.source.headers.getSetCookie())}get remoteAddress(){return M()}get stream(){return this.source.body?M6(()=>this.source.body,n=>new Os({request:this.request,response:this,reason:"Decode",cause:n})):R6(new Os({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return GW(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new Os({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=ea({try:()=>this.source.text(),catch:n=>new Os({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(_g,us))}get urlParamsBody(){return U(this.text,n=>Du({try:()=>IS(new URLSearchParams(n)),catch:r=>new Os({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=ea({try:()=>this.source.formData(),catch:n=>new Os({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(_g,us))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=ea({try:()=>this.source.arrayBuffer(),catch:n=>new Os({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(_g,us))}}const E$=Symbol.for("@effect/platform/HttpClient"),W1=on("@effect/platform/HttpClient"),GQ=ee(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>xb(An)),QQ=ee(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>xb(!0)),YQ=nc()("@effect/platform/HttpClient/SpanNameGenerator",{defaultValue:()=>e=>`http.client ${e.method}`}),XQ={[E$]:E$,pipe(){return D(this,arguments)},...dd,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(FQ(e,t))},head(e,t){return this.execute(LQ(e,t))},post(e,t){return this.execute(MQ(e,t))},put(e,t){return this.execute(xQ(e,t))},patch(e,t){return this.execute(AQ(e,t))},del(e,t){return this.execute(NQ(e,t))},options(e,t){return this.execute(DQ(e,t))}},H1=(e,t)=>{const n=Object.create(XQ);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},Xf=ee("@effect/platform/HttpClient/responseRegistry",()=>{if("FinalizationRegistry"in globalThis&&globalThis.FinalizationRegistry){const t=new FinalizationRegistry(n=>{n.abort()});return{register(n,r){t.register(n,r,n)},unregister(n){t.unregister(n)}}}const e=new Map;return{register(t,n){e.set(t,setTimeout(()=>n.abort(),5e3))},unregister(t){const n=e.get(t);n!==void 0&&(clearTimeout(n),e.delete(t))}}}),ZQ=ee("@effect/platform/HttpClient/scopedRequests",()=>new WeakMap),e8=e=>H1(t=>U(t,n=>ps(r=>{const s=ZQ.get(n),o=s??new AbortController,i=EQ(n.url,n.urlParams,n.hash);if(i._tag==="Left")return zn(new j1({request:n,reason:"InvalidUrl",cause:i.left}));const c=i.right;if(!r.getFiberRef(p3)||r.getFiberRef(GQ)(n)){const g=e(n,c,o.signal,r);return s?g:ys(h=>En(h(g),{onSuccess(p){return Xf.register(p,o),be(new k$(p,o))},onFailure(p){return xa(p)&&o.abort(),Vt(p)}}))}const l=en(r.currentContext,YQ);return l3(l(n),{kind:"client",captureStackTrace:!1},g=>{g.attribute("http.request.method",n.method),g.attribute("server.address",c.origin),c.port!==""&&g.attribute("server.port",+c.port),g.attribute("url.full",c.toString()),g.attribute("url.path",c.pathname),g.attribute("url.scheme",c.protocol.slice(0,-1));const h=c.search.slice(1);h!==""&&g.attribute("url.query",h);const p=r.getFiberRef(q1),m=bm(n.headers,p);for(const b in m)g.attribute(`http.request.header.${b}`,String(m[b]));return n=r.getFiberRef(QQ)?B1(n,CQ(g)):n,ys(b=>b(e(n,c,o.signal,r)).pipe(qs(g),En({onSuccess:$=>{g.attribute("http.response.status_code",$.status);const _=bm($.headers,p);for(const w in _)g.attribute(`http.response.header.${w}`,String(_[w]));return s?be($):(Xf.register($,o),be(new k$($,o)))},onFailure($){return!s&&xa($)&&o.abort(),Vt($)}})))})})),be);var Ek,kk;class k${constructor(t,n){a(this,"original");a(this,"controller");a(this,kk,ia);a(this,Ek,oa);this.original=t,this.controller=n}applyInterrupt(t){return Ce(()=>(Xf.unregister(this.original),HT(t,()=>te(()=>{this.controller.abort()}))))}get request(){return this.original.request}get status(){return this.original.status}get headers(){return this.original.headers}get cookies(){return this.original.cookies}get remoteAddress(){return this.original.remoteAddress}get formData(){return this.applyInterrupt(this.original.formData)}get text(){return this.applyInterrupt(this.original.text)}get json(){return this.applyInterrupt(this.original.json)}get urlParamsBody(){return this.applyInterrupt(this.original.urlParamsBody)}get arrayBuffer(){return this.applyInterrupt(this.original.arrayBuffer)}get stream(){return R1(()=>(Xf.unregister(this.original),O6(this.original.stream,t=>(zL(t)&&this.controller.abort(),re))))}toJSON(){return this.original.toJSON()}[(kk=ia,Ek=oa,fe)](){return this.original[fe]()}}const{del:E7,execute:k7,get:v7,head:C7,options:I7,patch:T7,post:O7,put:R7}=e3(W1),t8=f(2,(e,t)=>{const n=e;return H1(r=>t(n.postprocess(r)),n.preprocess)}),n8=e=>Nb(W1,U(XT(),t=>ie(e,n=>t8(n,ZW(r=>Kr(t,r)))))),r8="@effect/platform/FetchHttpClient/Fetch",s8="@effect/platform/FetchHttpClient/FetchOptions",o8=e8((e,t,n,r)=>{const s=r.getFiberRef(Ab),o=s.unsafeMap.get(r8)??globalThis.fetch,i=s.unsafeMap.get(s8)??{},c=i.headers?bQ(CS(i.headers),e.headers):e.headers,u=l=>ie(ea({try:()=>o(t,{...i,method:e.method,headers:c,body:l,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:g=>new j1({request:e,reason:"Transport",cause:g})}),g=>JQ(e,g));switch(e.body._tag){case"Raw":case"Uint8Array":return u(e.body.body);case"FormData":return u(e.body.formData);case"Stream":return U(j6(e.body.stream),u)}return u(void 0)}),i8=n8(be(o8)),c8=i8;class to extends Wv("@effect/platform/Transferable/Collector")(){}const TS=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return to.of({unsafeAddAll:t,addAll:s=>te(()=>t(s)),unsafeRead:n,read:te(n),unsafeClear:r,clear:te(r)})},a8=te(TS),u8=e=>U(t3(to),Re({onNone:()=>re,onSome:t=>t.addAll(e)})),J1=f(2,(e,t)=>Gi(Jh(e),e,{strict:!0,decode:Ss,encode:n=>xr(u8(t(n)),n)})),ng=J1(Yt,e=>[e]),_i=J1($S,e=>[e.buffer]),l8=Symbol.for("@effect/platform/WorkerError"),Sm=l8,f8=e=>j(e,Sm);var vk,Ck;const Zr=class Zr extends(Ck=yr()("WorkerError",{reason:ce("spawn","decode","send","unknown","encode"),cause:Ka}),vk=Sm,Ck){constructor(){super(...arguments);a(this,vk,Sm)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};a(Zr,"Cause",_6({error:Zr,defect:Ka})),a(Zr,"encodeCause",GR(Zr.Cause)),a(Zr,"decodeCause",T4(Zr.Cause));let Mt=Zr;const v$=Symbol.for("@effect/platform/Worker/PlatformWorker"),OS=on("@effect/platform/Worker/PlatformWorker"),C$=Symbol.for("@effect/platform/Worker/WorkerManager"),Ga=on("@effect/platform/Worker/WorkerManager"),V1=on("@effect/platform/Worker/Spawner"),d8=q(function*(){const e=yield*OS;let t=0;return Ga.of({[C$]:C$,spawn({encode:n,initialMessage:r}){return q(function*(){const s=t++;let o=0;const i=new Map,c=TS(),u=n?_=>Ie(c.clear,di(n(_),to,c)):be,l=yield*ue(),g=yield*e.spawn(s);yield*g.run(_=>_[0]===0?qL(l,re):h(_[1])).pipe(GT(_=>Et(i.values(),w=>Is in w?Yc(w,_):w.failCause(_))),$c(ir),kb(D5(1e3)),Xs({package:"@effect/platform",module:"Worker"}),ut,mn),yield*mr(()=>Ie(Et(i.values(),_=>Is in _?T_(_):_.end,{discard:!0}),te(()=>i.clear())));const h=_=>Ce(()=>{const w=i.get(_[0]);if(!w)return re;switch(_[1]){case 0:return Is in w?qe(w,_[2][0]):w.offerAll(_[2]);case 1:return _.length===2?Is in w?T_(w):w.end:Is in w?qe(w,_[2][0]):Ie(w.offerAll(_[2]),w.end);case 2:case 3:{if(_[1]===2)return Is in w?mI(w,_[2]):w.fail(_[2]);const S=Mt.decodeCause(_[2]);return Is in w?Yc(w,S):w.failCause(S)}}}),p=(_,w)=>ps(S=>{const P=S.getFiberRef(Ab),y=Br(P,DI).pipe(bF(C=>C._tag==="Span")),E=o++;return w.pipe(Dn(C=>(i.set(E,C),u(_).pipe(Dn(I=>g.send([E,0,I,y._tag==="Some"?[y.value.traceId,y.value.spanId,y.value.sampled]:void 0],c.unsafeRead())),ms(I=>uG(C)?C.failCause(I):Yc(C,I))))),ie(C=>({id:E,mailbox:C})))}),m=({id:_},w)=>{const S=te(()=>i.delete(_));return yc(w)?Ie(tr(g.send([_,1])),S):S},b=_=>F6(JV(p(_,r1()),({mailbox:w})=>lG(w),m)),$=_=>VT(p(_,ue()),({mailbox:w})=>De(w),m);return yield*De(l),r&&(yield*te(r).pipe(U($),dr(_=>new Mt({reason:"spawn",cause:_})))),{id:s,execute:b,executeEffect:$}})}})}),h8=Nb(Ga,d8),g8=e=>q(function*(){const n=yield*(yield*Ga).spawn({...e,encode(o){return dr(w6(o),i=>new Mt({reason:"encode",cause:i}))}}),r=o=>{const i=yl(f$(o)),c=yl(l$(o));return d(n.execute(o),C6(u=>U(c(u),zn)),A6(i))},s=o=>{const i=yl(f$(o)),c=yl(l$(o));return o3(n.executeEffect(o),{onFailure:u=>U(c(u),zn),onSuccess:i})};return K({id:n.id,execute:r,executeEffect:s})}),p8=e=>q(function*(){const t=yield*Ga,n=new Set,r=d(g8(e),Dn(i=>te(()=>n.add(i))),Dn(i=>mr(()=>te(()=>n.delete(i)))),e.onCreate?Dn(e.onCreate):K,di(Ga,t)),s=yield*"timeToLive"in e?$G({acquire:r,min:e.minSize,max:e.maxSize,concurrency:e.concurrency,targetUtilization:e.targetUtilization,timeToLive:e.timeToLive}):wG({acquire:r,size:e.size,concurrency:e.concurrency,targetUtilization:e.targetUtilization}),o={backing:s,broadcast:i=>Et(n,c=>c.executeEffect(i),{concurrency:"unbounded",discard:!0}),execute:i=>z6(ie(s.get,c=>c.execute(i))),executeEffect:i=>wo(U(s.get,c=>c.executeEffect(i)))};return yield*wo(s.get),o}),m8=e=>sO(V1,e),y8=()=>e=>OS.of({[v$]:v$,spawn(t){return q(function*(){const n=yield*V1;let r;const s=[];return{run:c=>ys(u=>q(function*(){const l=yield*kh,g=yield*e.setup({worker:n(t),scope:l});r=g,yield*In(l,te(()=>{r=void 0}));const h=(yield*vs()).pipe(uR(Kv(aT))),p=yield*zR(),m=nS(h);if(yield*e.listen({port:g,scope:l,emit(b){im(p,m(c(b)))},deferred:p.deferred}),s.length>0){for(const[b,$]of s)g.postMessage([0,b],$);s.length=0}return yield*u(h4(p))}).pipe(wo)),send:(c,u)=>Du({try:()=>{r===void 0?s.push([c,u]):r.postMessage([0,c],u)},catch:l=>new Mt({reason:"send",cause:l})})}})}}),b8=y8,S8=OS,_8=h8,w8=p8,$8=m8,E8=Symbol.for("@effect/platform/Runner/PlatformRunner"),G1=on("@effect/platform/Runner/PlatformRunner"),Q1=nc()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>UL(Cn)}),k8=Nb(Q1,ue()),v8=Dp(function*(e,t){const n=yield*ps(be),r=yield*G1,s=yield*Q1,o=yield*r.start(s),i=new Map;yield*De(s).pipe(YW(()=>(n.currentScheduler.scheduleTask(()=>{n.unsafeInterruptAsFork(n.id())},0),re)),mn),yield*o.run((c,[u,l,g,h])=>{if(l===1){const p=i.get(u);return p?tn(p):re}return ps(p=>(i.set(u,p),t!=null&&t.decode?t.decode(g):be(g))).pipe(U(p=>{const m=TS(),b=e(p);let $=pr(b)?U(b,_=>d(t!=null&&t.encodeOutput?di(t.encodeOutput(p,_),to,m):be(_),U(w=>o.send(c,[u,0,[w]],m.unsafeRead())))):d(b,U6(_=>{if((t==null?void 0:t.encodeOutput)===void 0){const w=dn(_);return o.send(c,[u,0,w])}return m.unsafeClear(),d(Et(_,w=>t.encodeOutput(p,w)),di(to,m),U(w=>o.send(c,[u,0,w],m.unsafeRead())))}),hi(o.send(c,[u,1])));return h&&($=qs($,{_tag:"ExternalSpan",traceId:h[0],spanId:h[1],sampled:h[2],context:ds()})),ys(_=>_($).pipe(JW(f8,w=>o.send(c,[u,3,Mt.encodeCause(_c(w))])),ms(w=>Tt(yh(w),{onLeft:S=>(m.unsafeClear(),d(t!=null&&t.encodeError?di(t.encodeError(p,S),to,m):be(S),U(P=>o.send(c,[u,2,P],m.unsafeRead())),ms(P=>o.send(c,[u,3,Mt.encodeCause(P)])))),onRight:S=>o.send(c,[u,3,Mt.encodeCause(S)])}))))}),Ds(te(()=>i.delete(u))))})}),C8=(e,t)=>q(function*(){const n=yield*kh;let r=ds();const s=za(e);return yield*v8(o=>{const i=t[o._tag](o);return $3(i)?U(k3(i,n),c=>te(()=>{r=Kr(r,c)})):pr(i)?hn(i,r):D6(i,r)},{decode(o){return dr(s(o),i=>new Mt({reason:"decode",cause:i}))},encodeError(o,i){return dr($6(o,i),c=>new Mt({reason:"encode",cause:c}))},encodeOutput(o,i){return ms(E6(o,i),c=>new Mt({reason:"encode",cause:c}))}})}),I8=(e,t)=>T3(C8(e,t)).pipe(Lb(k8)),I$=E8,Y1=G1,T8=I8,O8=e=>(t,n)=>{const r=[];return _m(e.ast,t,n,"",r),r},_m=(e,t,n,r,s)=>{if(I1({ast:e})(t,n)===!1)if(cu(e))if(R8(e)){s.push({path:r,a:t,b:n,ast:e});return}else for(const i of e.types)try{_m(i,t,n,r,s);return}catch{}else if(sf(e)){const i=Qc(e);for(const c of i)_m(c.type,t[c.name],n[c.name],`${r}.${c.name.toString()}`,s)}else s.push({path:r,a:t,b:n,ast:e})},R8=e=>{if(cu(e))return e.types.every(t=>sf(t)===!1?!1:Qc(t).some(r=>r.name.toString()==="_tag"))},RS=(e,t)=>(n,r)=>q(function*(){const s=yield*a8;return[yield*Yu(e,t)(n,r).pipe(di(to,s)),s.unsafeRead()]}),P8=e=>Gi(Eo(e),Jh(e),{decode:R4(e),encode:O4(e)});P8(YG);const Yi=ae(F,wt,ko,OG,Ke(Ba(()=>Yi)),Xh({key:F,value:Ba(()=>Yi)})).annotations({title:"JsonValue"}),At=Symbol("WebChannel"),Qa=se("WebChannel.DebugPing",{message:F,payload:gn(F)}),Zf=se("WebChannel.Ping",{requestId:F}),ed=se("WebChannel.Pong",{requestId:F}),F8=ae(Zf,ed),T$=e=>({send:ae(e.send,Qa,Zf,ed),listen:ae(e.listen,Qa,Zf,ed)}),el=e=>j(e,"send")&&j(e,"listen")?T$(e):T$({send:e,listen:e}),rg=e=>t=>t.pipe(T1(Mb(function*(n){return n._tag==="Right"&&at(Qa)(n.right)?(yield*wn(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),X1=({channelName:e,schema:t})=>zo(n=>q(function*(){const r=el(t),s=new BroadcastChannel(e);yield*mr(()=>Du(()=>s.close()).pipe(Eb));const o=l=>q(function*(){const g=yield*Yu(r.send)(l);s.postMessage(g)}),i=eg(s,"message").pipe(jo(l=>Xu(r.listen)(l.data)),rg(e)),c=yield*ue().pipe(ot(ks(xt))),u=!1;return{[At]:At,send:o,listen:i,closedDeferred:c,shutdown:yt(n,Je("shutdown")),schema:r,supportsTransferables:u}}).pipe(It(`WebChannel:broadcastChannel(${e})`))),O$=({listenWindow:e,sendWindow:t,targetOrigin:n="*",ids:r,schema:s})=>zo(o=>q(function*(){const i=el(s),c={sendTotal:0,listenTotal:0,targetOrigin:n,ids:r},u=Z({message:i.listen,from:ce(r.other),to:ce(r.own)}).annotations({title:"webmesh.WindowMessageListen"}),l=Z({message:i.send,from:ce(r.own),to:ce(r.other)}).annotations({title:"webmesh.WindowMessageSend"}),g=b=>q(function*(){c.sendTotal++;const[$,_]=yield*RS(l)({message:b,from:r.own,to:r.other});t.postMessage($,n,_)}),h=eg(e,"message").pipe(vo(b=>at(Jh(u))(b.data)),jo(b=>(c.listenTotal++,Xu(i.listen)(b.data.message))),rg("window")),p=yield*ue().pipe(ot(ks(xt))),m=!0;return{[At]:At,send:g,listen:h,closedDeferred:p,shutdown:yt(o,Je("shutdown")),schema:i,supportsTransferables:m,debugInfo:c}}).pipe(It("WebChannel:windowChannel"))),Z1=({port:e,schema:t,debugId:n})=>zo(r=>q(function*(){const s=el(t),o=n===void 0?"messagePort":`messagePort:${n}`,i=g=>q(function*(){const[h,p]=yield*RS(s.send)(g);e.postMessage(h,p)}),c=eg(e,"message").pipe(jo(g=>Xu(s.listen)(g.data)),rg(o));e.start();const u=yield*ue().pipe(ot(ks(xt))),l=!0;return yield*mr(()=>Du(()=>e.close()).pipe(Eb)),{[At]:At,send:i,listen:c,closedDeferred:u,shutdown:yt(r,Je("shutdown")),schema:s,supportsTransferables:l}}).pipe(It("WebChannel:messagePortChannel")));ee("livestore:sameThreadChannels",()=>new Map);const R$=({port:e,schema:t,debugId:n})=>zo(r=>q(function*(){const s=el(t),o=n===void 0?"messagePort":`messagePort:${n}`,i=new Map,c=se("ChannelRequest",{id:F,payload:ae(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),u=se("ChannelRequestAck",{reqId:F}).annotations({title:"webmesh.ChannelRequestAck"}),l=ae(c,u).annotations({title:"webmesh.ChannelMessage"}),g={sendTotal:0,sendPending:0,listenTotal:0,id:n},h=$=>q(function*(){g.sendTotal++,g.sendPending++;const _=crypto.randomUUID(),[w,S]=yield*RS(l)({_tag:"ChannelRequest",id:_,payload:$}),P=yield*ue();i.set(_,P),e.postMessage(w,S),yield*P,i.delete(_),g.sendPending--}),p=eg(e,"message").pipe(jo($=>Xu(l)($.data)),ls($=>q(function*(){$._tag==="Right"&&($.right._tag==="ChannelRequestAck"?yield*qe(i.get($.right.reqId),void 0):$.right._tag==="ChannelRequest"&&(g.listenTotal++,e.postMessage(GR(l)({_tag:"ChannelRequestAck",reqId:$.right.id}))))})),P6($=>$._tag==="Left"?x($):$.right._tag==="ChannelRequest"?x(V($.right.payload)):M()),$=>$,rg(o));e.start();const m=yield*ue().pipe(ot(ks(xt))),b=!0;return yield*mr(()=>Du(()=>e.close()).pipe(Eb)),{[At]:At,send:h,listen:p,closedDeferred:m,shutdown:yt(r,Je("shutdown")),schema:s,supportsTransferables:b,debugInfo:g}}).pipe(It("WebChannel:messagePortChannelWithAck"))),P$=(e,t)=>q(function*(){const n=yield*ln().pipe(ot(Kt)),r={current:void 0};if(yield*e.listen.pipe(t!=null&&t.heartbeat?T1(Mb(function*(o){if(o._tag==="Right"&&at(F8)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(ed.make({requestId:o.right.requestId}));else{const{deferred:i,requestId:c}=r.current??jt("No pending ping");c!==o.right.requestId&&jt("Received pong for unexpected requestId",c,o.right.requestId),yield*qe(i,void 0)}return!1}return!0})):K,F1(o=>Wb(n,o)),qn,mn),t!=null&&t.heartbeat){const{interval:o,timeout:i}=t.heartbeat;yield*q(function*(){for(;;){yield*Cb(o);const c=crypto.randomUUID();yield*e.send(Zf.make({requestId:c}));const u=yield*ue();r.current={deferred:u,requestId:c},yield*u.pipe(Ib(i),WT("TimeoutException",()=>e.shutdown))}}).pipe(It("WebChannel:heartbeat"),mn)}const s=Qi(n,{maxChunkSize:1});return{[At]:At,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}}),M8=e=>t=>{if(j(console,"createTask")===!1)return t;const n=q(function*(){const s=yield*a3;return Oq({span:(o,...i)=>{const c=s.span(o,...i),u=e(o);return c.runInTask=l=>u.run(l),c},context:(o,i)=>{const c=Br(DI)(i.currentContext);if(c._tag==="None")return s.context(o,i);const u=c.value;if(u._tag==="ExternalSpan")return s.context(o,i);const l=u;return"runInTask"in l&&typeof l.runInTask=="function"?l.runInTask(()=>s.context(o,i)):s.context(o,i)}})}),r=d(n,ie(F3),R3);return hn(t,r)},x8=b8()({setup({scope:e,worker:t}){const n="port"in t?t.port:t;return xr(In(e,te(()=>{n.postMessage([1])})),n)},listen({deferred:e,emit:t,port:n,scope:r}){function s(i){t(i.data)}function o(i){Ns(e,new Mt({reason:"unknown",cause:i.error??i.message}))}return n.addEventListener("message",s),n.addEventListener("error",o),"start"in n&&n.start(),In(r,te(()=>{n.removeEventListener("message",s),n.removeEventListener("error",o)}))}}),A8=sO(S8,x8),N8=Lb(_8,A8),L8=e=>C3(N8,$8(e)),D8=L8,wm=ee("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function q8(e){wm.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=q8);const U8=e=>Y1.of({[I$]:I$,start:Dp(function*(t){const n=yield*r1();let r=0;const s=new Map,o=(c,u,l)=>te(()=>{var g;(((g=s.get(c))==null?void 0:g[0])??e).postMessage([1,u],{transfer:l})}),i=Dp(function*(c){const u=yield*kh,l=(yield*ut(vs())).pipe(uR(Kv(aT))),g=yield*zR(),h=nS(l);function p(S){S._tag==="Failure"&&!Ys(S.cause)&&Ns(t,va(gb(S.cause)))}function m(S){return function(P){const y=P.data;if(y[0]===0){const E=c(S,y[1]);if(pr(E)){const C=h(E);C.addObserver(p),im(g,C)}}else{const E=s.get(S);if(E){if(s.size===1)return Ns(t,xt)}else return;s.delete(S),Cs(yt(E[1],xt))}}}function b(S){Ns(t,new Mt({reason:"decode",cause:S.data}))}function $(S){Ns(t,new Mt({reason:"unknown",cause:S.data}))}function _(S){const P=yb(u,Pa).pipe(U(y=>{const E=r++;s.set(E,[S,y]);const C=m(E);return S.addEventListener("message",C),S.addEventListener("messageerror",b),"start"in S&&S.start(),S.postMessage([0]),In(y,te(()=>{S.removeEventListener("message",C),S.removeEventListener("messageerror",$),S.close()}))}),h);P.addObserver(p),im(g,P)}e.addEventListener("error",$);let w;if("onconnect"in e){w=e.onconnect,e.onconnect=function(S){const P=S.ports[0];_(P)};for(const S of wm)_(S);wm.clear(),yield*In(u,te(()=>e.close()))}else _(e);yield*In(u,te(()=>{e.removeEventListener("error",$),"onconnect"in e&&(e.onconnect=w)}))});return K({run:i,send:o,disconnects:n})})}),j8=O3(Y1,()=>U8(self)),z8=j8,B8=Dv(),K8=o1(B8)(Vf),W8=Dv(),$m=o1(W8)(Vf),td=0,Xt=Z({global:$m,client:K8}).annotations({title:"LiveStore.EventSequenceNumber"}),Ya=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,H8=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:td},parentSeqNum:{global:e.global,client:td}},J8=Z({mergeCounter:wt,eventNum:Xt});Z({fileName:F},{key:F,value:Yt}).annotations({title:"LiveStore.PersistenceInfo"});const Lg=Z({done:wt,total:wt}),V8=ae(Z({stage:ce("loading")}),Z({stage:ce("migrating"),progress:Lg}),Z({stage:ce("rehydrating"),progress:Lg}),Z({stage:ce("syncing"),progress:Lg}),Z({stage:ce("done")})).annotations({title:"BootStatus"}),kr=class kr extends yr()("LiveStore.UnexpectedError",{cause:Ka,note:gn(F),payload:gn(Yt)}){};a(kr,"mapToUnexpectedError",t=>t.pipe(dr(n=>at(kr)(n)?n:new kr({cause:n})),KT(n=>new kr({cause:n})))),a(kr,"mapToUnexpectedErrorStream",t=>t.pipe(N6(n=>at(kr)(n)?n:new kr({cause:n}))));let Fe=kr;class G8 extends yr()("LiveStore.IntentionalShutdownCause",{reason:ce("devtools-reset","devtools-import","adapter-reset","manual")}){}class P7 extends yr()("LiveStore.StoreInterrupted",{reason:F}){}class F7 extends yr()("LiveStore.SqliteError",{query:gn(Z({sql:F,bindValues:ae(Xh({key:F,value:Yt}),Ke(Yt))})),code:gn(ae(wt,F)),cause:Ka,note:gn(F)}){}const Q8=Z({tableName:F,hashes:Z({expected:wt,actual:gn(wt)})}),Y8=Z({migrations:Ke(Q8)});Z({name:F,args:Yt,seqNum:Xt,parentSeqNum:Xt,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyDecoded"});const X8=Z({name:F,args:Yt,seqNum:Xt,parentSeqNum:Xt,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyEncoded"}),Z8=Z({name:F,args:Yt,seqNum:$m,parentSeqNum:$m,clientId:F,sessionId:F}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),eY=Z({name:F,args:Yt}),aa=class aa extends Uo("LiveStoreEvent.EncodedWithMeta")({name:F,args:Yt,seqNum:Xt,parentSeqNum:Xt,clientId:F,sessionId:F,meta:Z({sessionChangeset:ae(se("sessionChangeset",{data:GG,debug:Yt.pipe(gn)}),se("no-op",{}),se("unset",{})),syncMetadata:ql(Yi),materializerHashLeader:ql(wt),materializerHashSession:ql(wt)}).pipe(jG,gn,h1({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:M(),materializerHashLeader:M(),materializerHashSession:M()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:M(),materializerHashLeader:M(),materializerHashSession:M()})}))}){constructor(){super(...arguments);a(this,"toJSON",()=>({seqNum:`${Ya(this.seqNum)} → ${Ya(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args}));a(this,"rebase",(n,r)=>new aa({...this,...H8(n,r)}));a(this,"toGlobal",()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global}))}};a(aa,"fromGlobal",(n,r)=>new aa({...n,seqNum:{global:n.seqNum,client:td},parentSeqNum:{global:n.parentSeqNum,client:td},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:r.syncMetadata,materializerHashLeader:r.materializerHashLeader,materializerHashSession:r.materializerHashSession}}));let Bn=aa;class M7 extends yr()("IsOfflineError",{}){}class x7 extends yr()("InvalidPushError",{reason:ae(se("Unexpected",{message:F}),se("ServerAhead",{minimumExpectedNum:wt,providedNum:wt}))}){}class A7 extends yr()("InvalidPullError",{message:F}){}class tY extends yr()("LeaderAheadError",{minimumExpectedNum:Xt,providedNum:Xt}){}class sg extends Uo("SyncState")({pending:Ke(Bn),upstreamHead:Xt,localHead:Xt}){constructor(){super(...arguments);a(this,"toJSON",()=>({pending:this.pending.map(n=>n.toJSON()),upstreamHead:Ya(this.upstreamHead),localHead:Ya(this.localHead)}))}}class eP extends se("upstream-rebase",{rollbackEvents:Ke(Bn),newEvents:Ke(Bn)}){}class tP extends se("upstream-advance",{newEvents:Ke(Bn)}){}class nY extends se("local-push",{newEvents:Ke(Bn)}){}class rY extends ae(eP,tP,nY){}class nP extends ae(eP,tP){}class PS extends Uo("MergeContext")({payload:rY,syncState:sg}){constructor(){super(...arguments);a(this,"toJSON",()=>({payload:SG(this.payload).pipe(Ag("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),Ag("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),Ag("upstream-rebase",r=>({_tag:"upstream-rebase",newEvents:r.newEvents.map(s=>s.toJSON()),rollbackEvents:r.rollbackEvents.map(s=>s.toJSON())})),_G),syncState:this.syncState.toJSON()}))}}class sY extends Uo("MergeResultAdvance")({_tag:ce("advance"),newSyncState:sg,newEvents:Ke(Bn),confirmedEvents:Ke(Bn),mergeContext:PS}){constructor(){super(...arguments);a(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),confirmedEvents:this.confirmedEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class oY extends Uo("MergeResultRebase")({_tag:ce("rebase"),newSyncState:sg,newEvents:Ke(Bn),rollbackEvents:Ke(Bn),mergeContext:PS}){constructor(){super(...arguments);a(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),rollbackEvents:this.rollbackEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class iY extends Uo("MergeResultReject")({_tag:ce("reject"),expectedMinimumId:Xt,mergeContext:PS}){constructor(){super(...arguments);a(this,"toJSON",()=>({_tag:this._tag,expectedMinimumId:Ya(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()}))}}class cY extends Uo("MergeResultUnexpectedError")({_tag:ce("unexpected-error"),cause:Fe}){}class N7 extends ae(sY,oY,iY,cY){}const aY="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nd=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=aY[n[e]&63];return t};const uY=se("RequestSessions",{}),lY=se("SessionInfo",{storeId:F,clientId:F,sessionId:F,schemaAlias:F,isLeader:ko}),fY=ae(uY,lY),rP="0.3.1",dY=Z({isConnected:ko,timestampMs:wt,latchClosed:ko}),Ul=F,hY=F,jl=ce(rP),sP=(e,t)=>se(e,{liveStoreVersion:jl,...t}).annotations({identifier:e}),gY=(e,t)=>sP(e,{clientId:hY,...t}),Ve=(e,t)=>gY(e,{requestId:Ul,...t}),FS=(e,t)=>{const n=se(`${e}.Response.Success`,{requestId:Ul,liveStoreVersion:jl,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?se(`${e}.Response.Error`,{requestId:Ul,liveStoreVersion:jl,...t.error}).annotations({identifier:`${e}.Response.Error`}):Gh;return{Request:se(`${e}.Request`,{requestId:Ul,liveStoreVersion:jl,...t.payload}).annotations({identifier:`${e}.Request`}),Response:ae(n,r),Success:n,Error:r}};class L7 extends Ve("LSD.Leader.ResetAllDataReq",{mode:ce("all-data","only-app-db")}){}class pY extends Ve("LSD.Leader.DatabaseFileInfoReq",{}){}class F$ extends Z({fileSize:wt,persistenceInfo:Z({fileName:F},{key:F,value:Yt})}){}class mY extends Ve("LSD.Leader.DatabaseFileInfoRes",{state:F$,eventlog:F$}){}class yY extends Ve("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:F}){}class bY extends Ve("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:F}){}class SY extends Ve("LSD.Leader.NetworkStatusRes",{networkStatus:dY,subscriptionId:F}){}class _Y extends Ve("LSD.Leader.SyncingInfoReq",{}){}class wY extends Z({enabled:ko,metadata:Xh({key:F,value:Yt})}){}class $Y extends Ve("LSD.Leader.SyncingInfoRes",{syncingInfo:wY}){}class EY extends Ve("LSD.Leader.SyncHistorySubscribe",{subscriptionId:F}){}class kY extends Ve("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:F}){}class vY extends Ve("LSD.Leader.SyncHistoryRes",{eventEncoded:Z8,metadata:ql(Yi),subscriptionId:F}){}class CY extends Ve("LSD.Leader.SyncHeadSubscribe",{subscriptionId:F}){}class IY extends Ve("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:F}){}class TY extends Ve("LSD.Leader.SyncHeadRes",{local:Xt,upstream:Xt,subscriptionId:F}){}class OY extends Ve("LSD.Leader.SnapshotReq",{}){}class RY extends Ve("LSD.Leader.SnapshotRes",{snapshot:_i}){}const oP=FS("LSD.Leader.LoadDatabaseFile",{payload:{data:_i},success:{},error:{cause:ae(se("unsupported-file",{}),se("unsupported-database",{}),se("unexpected-error",{cause:Ka}))}});class PY extends sP("LSD.Leader.SyncPull",{payload:nP}){}class FY extends Ve("LSD.Leader.CommitEventReq",{eventEncoded:eY}){}class MY extends Ve("LSD.Leader.CommitEventRes",{}){}class xY extends Ve("LSD.Leader.EventlogReq",{}){}class AY extends Ve("LSD.Leader.EventlogRes",{eventlog:_i}){}class NY extends Ve("LSD.Leader.Ping",{}){}class LY extends Ve("LSD.Leader.Pong",{}){}class iP extends Ve("LSD.Leader.Disconnect",{}){}const cP=FS("LSD.Leader.SetSyncLatch",{payload:{closeLatch:ko},success:{}}),aP=FS("LSD.Leader.ResetAllData",{payload:{mode:ce("all-data","only-app-db")},success:{}}),DY=ae(OY,oP.Request,xY,aP.Request,yY,bY,iP,FY,NY,pY,EY,kY,_Y,CY,IY,cP.Request).annotations({identifier:"LSD.Leader.MessageToApp"});ae(RY,oP.Response,AY,iP,PY,SY,MY,LY,mY,vY,$Y,TY,aP.Success,cP.Success).annotations({identifier:"LSD.Leader.MessageFromApp"});const qY=ae(se("node",{url:F}),se("web",{}),se("browser-extension",{}));qY.pipe(UG("_tag"),Eo);const UY={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},tl=F.pipe(gn,h1({constructor:()=>nd(10),decoding:()=>nd(10)})),Ko={id:tl,target:F,source:F,channelName:F,hops:Ke(F)},uP=i1.pipe(gn);class zl extends se("DirectChannelRequest",{...Ko,remainingHops:Ke(F).pipe(gn),channelVersion:wt,reqId:bS(F),sourceId:F}){}class lP extends se("DirectChannelResponseSuccess",{...Ko,reqId:F,port:ng,remainingHops:Ke(F),channelVersion:wt}){}class MS extends se("DirectChannelResponseNoTransferables",{...Ko,reqId:F,remainingHops:Ke(F)}){}class fP extends se("ProxyChannelRequest",{...Ko,remainingHops:uP,channelIdCandidate:F}){}class dP extends se("ProxyChannelResponseSuccess",{...Ko,reqId:F,remainingHops:Ke(F),combinedChannelId:F,channelIdCandidate:F}){}class hP extends se("ProxyChannelPayload",{...Ko,remainingHops:uP,payload:Yt,combinedChannelId:F}){}class gP extends se("ProxyChannelPayloadAck",{...Ko,reqId:F,remainingHops:Ke(F),combinedChannelId:F}){}class Em extends se("NetworkEdgeAdded",{id:tl,source:F,target:F}){}class km extends se("NetworkTopologyRequest",{id:tl,hops:Ke(F),source:F,target:ce("-")}){}class vm extends se("NetworkTopologyResponse",{id:tl,reqId:F,remainingHops:Ke(F),nodeName:F,edges:Ke(F),source:F,target:ce("-")}){}const Bl=se("BroadcastChannelPacket",{id:tl,channelName:F,payload:Yt,hops:Ke(F),source:F,target:ce("-")});class Cm extends ae(zl,lP,MS){}class pP extends ae(fP,dP,hP,gP){}class xS extends ae(Cm,pP,Em,km,vm,Bl){}class Sl extends se("DirectChannelPing",{}){}class _l extends se("DirectChannelPong",{}){}class jY extends yr()("EdgeAlreadyExistsError",{target:F}){}const ca=e=>({packetId:e.id,"span.label":e.id+(j(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});Z({channelName:F,source:F,mode:ae(ce("proxy"),ce("direct"))});const zY=ue,BY=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:i,channelVersion:c,scope:u,sourceId:l})=>q(function*(){const g=yield*zY(),h=yield*x1.pipe($b(()=>be(void 0))),p={send:ae(o.send,Sl,_l),listen:ae(o.listen,Sl,_l)},m={current:{_tag:"Initial"}},b=({packet:S,respondToSender:P})=>q(function*(){const y=m.current;if(h==null||h.addEvent(`process:${S._tag}`,{channelState:y._tag,packetId:S.id,packetReqId:S.reqId,packetChannelVersion:j("channelVersion")(S)?S.channelVersion:void 0}),y._tag==="Initial")return jt();if(S._tag==="DirectChannelResponseNoTransferables")return yield*mI(g,S),"close";if(S.channelVersion>c)return h==null||h.addEvent(`incoming packet has higher version (${S.channelVersion}), closing channel`),yield*yt(u,Je("higher-version-expected")),"close";if(S.channelVersion<c){const E=zl.make({source:e,sourceId:l,target:n,channelName:s,channelVersion:c,hops:[],remainingHops:S.hops,reqId:void 0});h==null||h.addEvent(`incoming packet has lower version (${S.channelVersion}), sending request to reconnect (${E.id})`),yield*i(E);return}if(y._tag==="Established"&&S._tag==="DirectChannelRequest")return S.sourceId===y.otherSourceId?void 0:(h==null||h.addEvent("force-new-channel"),yield*yt(u,Je("force-new-channel")),"close");switch(S._tag){case"DirectChannelRequest":{if(y._tag!=="RequestSent")return;if(S.reqId!==y.reqPacketId){const C=zl.make({source:e,sourceId:l,target:n,channelName:s,channelVersion:c,hops:[],remainingHops:S.hops,reqId:S.id});h==null||h.addEvent(`Re-sending new request (${C.id}) for incoming request (${S.id})`),yield*i(C)}if(e>n){h==null||h.addEvent("winner side: creating direct channel and sending response");const C=new MessageChannel,I=yield*R$({port:C.port1,schema:p,debugId:c}).pipe(hi(P$));yield*P(lP.make({reqId:S.id,target:n,source:e,channelName:S.channelName,hops:[],remainingHops:S.hops.slice(0,-1),port:C.port2,channelVersion:c})),m.current={_tag:"winner:ResponseSent",channel:I,otherSourceId:S.sourceId},yield*I.listen.pipe(Wa(),vo(at(Sl)),Qf(1),qn),yield*I.send(_l.make({})),h==null||h.addEvent("winner side: established"),m.current={_tag:"Established",otherSourceId:S.sourceId},yield*qe(g,I)}else h==null||h.addEvent("loser side: waiting for response"),m.current={_tag:"loser:WaitingForResponse",otherSourceId:S.sourceId};break}case"DirectChannelResponseSuccess":{if(y._tag!=="loser:WaitingForResponse")return jt(`Expected to find direct channel response from ${n}, but was in ${y._tag} state`);const E=yield*R$({port:S.port,schema:p,debugId:c}).pipe(hi(P$)),C=yield*E.listen.pipe(Wa(),vo(at(_l)),Qf(1),qn,vb);yield*E.send(Sl.make({})).pipe(Ib(10),kb({times:2})),yield*C,h==null||h.addEvent("loser side: established"),m.current={_tag:"Established",otherSourceId:y.otherSourceId},yield*qe(g,E);return}default:return A1(S)}}).pipe(It(`handleMessagePacket:${S._tag}:${S.source}→${S.target}`,{attributes:ca(S)}));yield*q(function*(){for(;;){const S=yield*Ji(t);if((yield*b(S))==="close")return}}).pipe(ut,Ct,mn);const $=m.current;return $._tag!=="Initial"?jt(`Expected channel to be in Initial state, but was in ${$._tag} state`):(yield*q(function*(){const S=zl.make({source:e,sourceId:l,target:n,channelName:s,channelVersion:c,hops:[],reqId:void 0});m.current={_tag:"RequestSent",reqPacketId:S.id};const P=r(S);if(P!==void 0)return yield*fn(`No transferable edges found for ${S.source}→${S.target}`),yield*zn(P);yield*i(S),h==null||h.addEvent(`initial edge request sent (${S.id})`)}),yield*g)}).pipe(Fb(`makeDirectChannel:${c}`)),KY=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:i,sendPacket:c})=>zo(u=>q(function*(){const l=nd(),g=yield*ln(),h=yield*GJ(),p=yield*ue(),m={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*q(function*(){const P=yield*ue();for(;;){m.connectCounter++;const I=m.connectCounter;yield*fn(`Connecting#${I}`);const T=yield*wh();yield*mr(X=>yt(T,X));const N=yield*O1(t).pipe(ls(X=>fn(`new-conn:${X}`)),Qf(1),qn,xr("new-edge"),vb),v=BY({nodeName:s,sourceId:l,incomingPacketsQueue:o,target:i,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:I,sendPacket:c,scope:T}).pipe(_h(T),nn(T),i3(M())),L=yield*ZT(v,N.pipe(QW));if(L==="new-edge")yield*yt(T,ku("new-edge"));else{const X=yield*L.pipe(tt);if(X._tag==="Failure")yield*yt(T,X),Z0(X.cause)&&at(MS)(X.cause.error)&&(yield*N.pipe(tt));else{const me=X.value;yield*qe(P,{channel:me,makeDirectChannelScope:T,channelVersion:I});break}}}const{channel:y,makeDirectChannelScope:E,channelVersion:C}=yield*P;yield*fn(`Connected#${C}`),m.isConnected=!0,m.innerChannelRef.current=y,yield*qe(p,void 0),yield*y.listen.pipe(Wa(),F1(I=>Wb(g,I)),qn,Ct,nn(E)),yield*q(function*(){for(;;){const[I,T]=yield*JJ(h);yield*y.send(I),yield*qe(T,void 0),yield*VJ(h)}}).pipe(nn(E)),yield*y.closedDeferred,yield*yt(E,Je("channel-closed")),yield*fn(`Disconnected#${C}`),m.isConnected=!1,m.innerChannelRef.current=void 0}).pipe(wo,Tb,Ct,mn);const b=yield*Pb.pipe(tr),$=P=>q(function*(){const y=yield*ue();m.pendingSends++,m.totalSends++,yield*HJ(h,[P,y]),yield*y,m.pendingSends--}).pipe(wo,qs(b)),_=Qi(g,{maxChunkSize:1}).pipe(jo(V)),w=yield*ue().pipe(ot(ks(xt)));return{webChannel:{[At]:At,send:$,listen:_,closedDeferred:w,supportsTransferables:!0,schema:e,debugInfo:m,shutdown:yt(u,Je("shutdown"))},initialEdgeDeferred:p}})),WY=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:i})=>zo(c=>q(function*(){const u={current:{_tag:"Initial"}},l={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},g=nd(5);yield*Lp({channelIdCandidate:g});const h=yield*Pb.pipe(tr),p=yield*P1(!1),m=q(function*(){return yield*Yf(p,L=>L!==!1)}),b=v=>q(function*(){yield*fn(`Connected (${v})`).pipe(qs(h)),u.current={_tag:"Established",listenSchema:i.listen,listenQueue:P,ackMap:y,combinedChannelId:v},yield*sa(p,u.current),l.isConnected=!0}),$=Ce(()=>r(fP.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:g}))),_=v=>[g,v].sort().join("_"),w=yield*ln().pipe(ot(Kt)),S=({packet:v,respondToSender:L})=>q(function*(){const me=`target:${v.source}, channelName:${v.channelName}`,z=u.current;switch(v._tag){case"ProxyChannelRequest":{const Ae=_(v.channelIdCandidate);z._tag==="Established"?z.combinedChannelId===Ae||(yield*ir(`[${t}] Received ProxyChannelRequest with different channel ID (${Ae}) while established with ${z.combinedChannelId}. Re-establishing.`),yield*sa(p,!1),u.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*fn("Reconnecting (received conflicting ProxyChannelRequest)").pipe(qs(h)),l.isConnected=!1,l.connectCounter++,yield*$):z._tag==="Initial"&&(yield*sa(p,!1),u.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*fn("Connecting (received ProxyChannelRequest)").pipe(qs(h)),l.isConnected=!1,l.connectCounter++),yield*L(dP.make({reqId:v.id,remainingHops:v.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:Ae,channelIdCandidate:g}));return}case"ProxyChannelResponseSuccess":{if(z._tag!=="Pending"){if(z._tag==="Established"&&z.combinedChannelId!==v.combinedChannelId)return jt(`ProxyChannel[${me}]: Expected proxy channel to have the same combinedChannelId as the packet:
${z.combinedChannelId} (channel) === ${v.combinedChannelId} (packet)`);if(z._tag==="Established")return;yield*ir(`[${t}] Ignoring ResponseSuccess ${v.id} received in unexpected state ${z._tag}`);return}const Ae=_(v.channelIdCandidate);if(Ae!==v.combinedChannelId)return yield*Hi(`ProxyChannel[${me}]: Expected proxy channel to have the same combinedChannelId as the packet:
${Ae} (channel) === ${v.combinedChannelId} (packet)`);yield*b(v.combinedChannelId);const Ee=u.current;if(Ee._tag==="Established"){const We=yield*MH(w);for(const ht of We){if(Ee.combinedChannelId!==ht.combinedChannelId){yield*ir(`[${t}] Discarding buffered payload ${ht.id}: Combined channel ID mismatch during drain. Expected ${Ee.combinedChannelId}, got ${ht.combinedChannelId}`);continue}const Gn=yield*za(Ee.listenSchema)(ht.payload);yield*Ee.listenQueue.pipe(He(Gn))}}else yield*Ap(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${Ee._tag}`);return}case"ProxyChannelPayload":{if(z._tag==="Established"&&z.combinedChannelId!==v.combinedChannelId)return yield*Hi(`ProxyChannel[${me}]: Expected proxy channel to have the same combinedChannelId as the packet:
${z.combinedChannelId} (channel) === ${v.combinedChannelId} (packet)`);if(yield*L(gP.make({reqId:v.id,remainingHops:v.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:z._tag==="Established"?z.combinedChannelId:v.combinedChannelId})),z._tag==="Established"){const Ae=yield*za(z.listenSchema)(v.payload);yield*z.listenQueue.pipe(He(Ae))}else yield*He(w,v);return}case"ProxyChannelPayloadAck":{if(z._tag!=="Established"){yield*fn(`Not yet connected to ${s}. dropping message`),yield*ir(`[${t}] Received Ack but not established (State: ${z._tag}). Dropping Ack for ${v.reqId}`);return}const Ae=z.ackMap.get(v.reqId)??jt(`[ProxyChannel[${me}]] Expected ack for ${v.reqId}`);yield*qe(Ae,void 0),z.ackMap.delete(v.reqId);return}default:return A1(v)}}).pipe(It(`handleProxyPacket:${v._tag}:${v.source}->${v.target}`,{attributes:ca(v)}));yield*Qi(e).pipe(ls(S),qn,Ct,mn);const P=yield*ln();yield*fn("Connecting");const y=new Map;{if(u.current._tag!=="Initial")return jt("Expected proxy channel to be Initial");u.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*$;const v=yield*O1(n).pipe(ls(()=>$),qn,mn),{combinedChannelId:L}=yield*m;yield*tn(v),yield*b(L)}const E=v=>q(function*(){const L=yield*mS(i.send)(v),X=yield*o4(),me=yield*ue();l.pendingSends++,l.totalSends++;const z=q(function*(){const{combinedChannelId:Ee}=yield*Yf(p,ht=>ht!==!1);yield*q(function*(){const ht=yield*ue(),Gn=hP.make({channelName:o,payload:L,hops:[],source:t,target:s,combinedChannelId:Ee});y.set(Gn.id,ht),yield*r(Gn),yield*ht,yield*qe(me,void 0),l.pendingSends--}).pipe(Ib(100),kb(L5(10)),tr)}).pipe($c(Ap)),Ae=yield*p.changes.pipe(vo(Ee=>Ee===!1),ls(()=>Kw(X,z)),qn,vb);yield*Kw(X,z),yield*me,yield*tn(Ae)}).pipe(wo,It("sendAckWithRetry:ProxyChannelPayload"),qs(h)),C=Qi(P).pipe(jo(V)),I=yield*ue().pipe(ot(ks(xt))),T=yield*vs();return{[At]:At,send:E,listen:C,closedDeferred:I,supportsTransferables:!1,schema:i,shutdown:yt(c,xt),debugInfo:l,debug:{ping:(v="ping")=>E(Qa.make({message:v})).pipe(hn(T),Ct,Cs)}}}).pipe(Fb("makeProxyChannel"))),rd=class rd{constructor({timeout:t}){a(this,"values",new Map);a(this,"timeoutHandle");a(this,"timeoutMs");a(this,"onShutdown",()=>clearTimeout(this.timeoutHandle));this.timeoutMs=Ci(t)}add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}};a(rd,"make",t=>q(function*(){const n=new rd({timeout:t});return yield*mr(()=>te(()=>n.onShutdown())),n}));let Im=rd;const HY=e=>q(function*(){const t=new Map,n=yield*Im.make(eC(1)),r=yield*dO().pipe(ot(Up)),s=new Map,o=yield*ln().pipe(ot(Kt)),i=new Map,c=new Map,u=y=>{var E;if(y._tag==="DirectChannelRequest"&&(t.size===0||((E=t.get(y.target))==null?void 0:E.channel.supportsTransferables)===!1)||![...t.values()].some(C=>C.channel.supportsTransferables===!0))return MS.make({reqId:y.id,channelName:y.channelName,source:y.target,target:y.source,remainingHops:y.hops,hops:[]})},l=y=>q(function*(){var E,C;if(at(Em)(y)){yield*fn("NetworkEdgeAdded",{packet:y,nodeName:e}),yield*Kb(r,y.target);const I=Array.from(t).filter(([T])=>T!==y.source).map(([T,N])=>N.channel);yield*Et(I,T=>T.send(y),{concurrency:"unbounded"});return}if(at(Bl)(y)){const I=Array.from(t).filter(([v])=>!y.hops.includes(v)).map(([v,L])=>L.channel),T={...y,hops:[...y.hops,e]};if(yield*Et(I,v=>v.send(T),{concurrency:"unbounded"}),y.source===e)return;const N=c.get(y.channelName);N!==void 0&&(yield*He(N,y));return}if(at(km)(y)){if(y.source!==e){const N=y.hops.at(-1)??jt(`${e}: Expected hops for packet`,y),v=t.get(N).channel,L=vm.make({reqId:y.id,source:y.source,target:y.target,remainingHops:y.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*v.send(L)}const I=Array.from(t).filter(([N])=>!y.hops.includes(N)).map(([N,v])=>v.channel),T={...y,hops:[...y.hops,e]};yield*Et(I,N=>N.send(T),{concurrency:"unbounded"});return}if(at(vm)(y)){if(y.source===e)i.get(y.reqId).set(y.nodeName,new Set(y.edges));else{const T=y.remainingHops.at(-1)??jt(`${e}: Expected remaining hops for packet`,y);yield*(((E=t.get(T))==null?void 0:E.channel)??jt(`${e}: Expected edge channel (${T}) for packet`,y,"Available edges:",Array.from(t.keys()))).send({...y,remainingHops:y.remainingHops.slice(0,-1)})}return}if(t.has(y.target)){const I=t.get(y.target).channel,T=y.source===e?[]:[...y.hops,e];yield*Lp({hasDirectEdge:!0}),yield*I.send({...y,hops:T})}else if(y.remainingHops!==void 0){const I=y.remainingHops.at(-1)??jt(`${e}: Expected remaining hops for packet`,y),T=(C=t.get(I))==null?void 0:C.channel;if(T===void 0){yield*ir(`${e}: Expected to find hop target ${I} in edges. Dropping packet.`,y);return}yield*T.send({...y,remainingHops:y.remainingHops.slice(0,-1),hops:[...y.hops,e]})}else{const I=y.source===e?[]:[...y.hops,e],T=Array.from(t).filter(([v])=>v!==y.source).map(([v,L])=>({name:v,channel:L.channel}));I.length===0&&T.length===0&&Ja&&(yield*ir(e,"no route found to",y.target,y._tag,"TODO handle better"));const N={...y,hops:I};yield*Lp({edgesToForwardTo:T.map(({name:v})=>v)}),yield*Et(T,({channel:v})=>v.send(N),{concurrency:"unbounded"})}}).pipe(It(`sendPacket:${y._tag}:${y.source}→${y.target}`,{attributes:ca(y)}),tr),g=({target:y,edgeChannel:E,replaceIfExists:C=!1})=>q(function*(){if(t.has(y))if(C)yield*h(y).pipe(tr);else return yield*new jY({target:y});const I=yield*E.listen.pipe(Wa(),ls(N=>q(function*(){const v=yield*za(xS)(N);if(!n.has(v.id))switch(n.add(v.id),v._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*l(v);break}default:if(v.target===e){const L=`target:${v.source}, channelName:${v.channelName}`;if(!s.has(L)){const z=yield*ln().pipe(ot(Kt));s.set(L,{queue:z,debugInfo:void 0})}const X=s.get(L).queue,me=z=>E.send(z).pipe(It(`respondToSender:${z._tag}:${z.source}→${z.target}`,{attributes:ca(z)}),tr);at(pP)(v)?yield*He(X,{packet:v,respondToSender:me}):at(Cm)(v)&&(yield*He(X,{packet:v,respondToSender:me})),(v._tag==="ProxyChannelRequest"||v._tag==="DirectChannelRequest")&&(yield*He(o,{channelName:v.channelName,source:v.source,mode:v._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(at(Cm)(v)){const L=u(v);if(L!==void 0)return yield*fn(`No transferable edges found for ${v.source}→${v.target}`),yield*E.send(L).pipe(It(`sendNoTransferableResponse:${v.source}→${v.target}`,{attributes:ca(L)}))}yield*l(v)}}})),qn,ut,tr,Ct,mn);t.set(y,{channel:E,listenFiber:I});const T=Em.make({source:e,target:y});yield*l(T).pipe(tr)}).pipe(Xs({"addEdge:target":y,nodeName:e}),It(`addEdge:${e}→${y}`,{attributes:{supportsTransferables:E.supportsTransferables}})),h=y=>q(function*(){t.has(y)||(yield*new Sh(`No edge found for ${y}`)),yield*tn(t.get(y).listenFiber),t.delete(y)}),p=({target:y,channelName:E})=>te(()=>s.has(`target:${y}, channelName:${E}`)),m=({target:y,channelName:E,schema:C,mode:I,timeout:T=Ym(1),closeExisting:N=!1})=>q(function*(){var me;const v=el(C),L=`target:${y}, channelName:${E}`;if(s.has(L)){const z=(me=s.get(L).debugInfo)==null?void 0:me.channel;z&&(N?(yield*z.shutdown,s.delete(L)):jt(`Channel ${L} already exists`,z))}if(s.has(L)===!1){const z=yield*ln().pipe(ot(Kt));s.set(L,{queue:z,debugInfo:void 0})}const X=s.get(L).queue;if(yield*mr(()=>te(()=>s.delete(L))),I==="direct"){const z=yield*ln().pipe(ot(Kt));yield*pO(X,1,10).pipe(Dn(We=>Wb(z,We)),Tb,ut,Ct,mn);const{webChannel:Ae,initialEdgeDeferred:Ee}=yield*KY({nodeName:e,incomingPacketsQueue:z,newEdgeAvailablePubSub:r,target:y,channelName:E,schema:v,sendPacket:l,checkTransferableEdges:u});return s.set(L,{queue:X,debugInfo:{channel:Ae,target:y}}),yield*Ee,Ae}else{const z=yield*WY({nodeName:e,newEdgeAvailablePubSub:r,target:y,channelName:E,schema:v,queue:X,sendPacket:l});return s.set(L,{queue:X,debugInfo:{channel:z,target:y}}),z}}).pipe(Fb(`makeChannel:${e}→${y}(${E})`,{attributes:{target:y,channelName:E,mode:I,timeout:T}}),Xs({nodeName:e,target:y,channelName:E}));let b=!1;const $=R1(()=>{if(b)return jt("listenForChannel already started");b=!0;const y=C=>`${C.channelName}:${C.source}:${C.mode}`,E=new Set;return Qi(o).pipe(vo(C=>{const I=y(C);return E.has(I)?!1:(E.add(I),!0)}))}),_=({channelName:y,schema:E})=>zo(C=>q(function*(){if(c.has(y))return jt(`Broadcast channel ${y} already exists`,c.get(y));const I={},T=yield*ln().pipe(ot(Kt));c.set(y,T);const N=X=>q(function*(){const me=yield*Yu(E)(X),z=Bl.make({channelName:y,payload:me,source:e,target:"-",hops:[]});yield*l(z)}),v=Qi(T).pipe(vo(at(Bl)),jo(X=>Xu(E)(X.payload))),L=yield*ue().pipe(ot(ks(xt)));return{[At]:At,send:N,listen:v,closedDeferred:L,supportsTransferables:!1,schema:{listen:E,send:E},shutdown:yt(C,xt),debugInfo:I}})),w=te(()=>new Set(t.keys())),S=yield*vs();return{nodeName:e,addEdge:g,removeEdge:h,hasChannel:p,makeChannel:m,listenForChannel:$,makeBroadcastChannel:_,edgeKeys:w,debug:{print:()=>{var y,E,C,I;console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[T,N]of t)console.log(`  ${T}: supportsTransferables=${N.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[T,N]of s)console.log(bl(T,2),`
`,Object.entries({target:(y=N.debugInfo)==null?void 0:y.target,supportsTransferables:(E=N.debugInfo)==null?void 0:E.channel.supportsTransferables,...(C=N.debugInfo)==null?void 0:C.channel.debugInfo}).map(([v,L])=>bl(`${v}=${L}`,4)).join(`
`),"    ",(I=N.debugInfo)==null?void 0:I.channel,`
`,bl(`Queue: ${N.queue.unsafeSize().pipe(Fn)}`,4),N.queue);console.log("Broadcast channels:",c.size);for(const[T,N]of c)console.log(bl(T,2))},ping:y=>{q(function*(){const E=C=>Qa.make({message:`ping from ${e} via ${C}`,payload:y});for(const[C,I]of t)yield*wn(`sending ping via edge ${C}`),yield*I.channel.send(E(`edge ${C}`));for(const[C,I]of s){if(I.debugInfo===void 0){yield*wn(`channel ${C} has no debug info`);continue}yield*wn(`sending ping via channel ${C}`),yield*I.debugInfo.channel.send(E(`channel ${C}`))}}).pipe(hn(S),Ct,Cs)},requestTopology:(y=1e3)=>q(function*(){const E=km.make({source:e,target:"-",hops:[]}),C=new Map;C.set(e,new Set(t.keys())),i.set(E.id,C),yield*l(E),yield*wn(`Waiting ${y}ms for topology response`),yield*Cb(y),yield*wn(`Topology response (from ${e}):`);for(const[I,T]of C)yield*wn(`  node '${I}' has edge to: ${Array.from(T.values()).join(", ")}`)}).pipe(hn(S),Ct,nO)}}}).pipe(It(`makeMeshNode:${e}`),Xs({"makeMeshNode.nodeName":e}));let og=class extends qt()("DevtoolsWebCommon.CreateConnection",{payload:{from:F,port:ng},success:Z({}),failure:Gh}){};class q7 extends ae(og){}X1({channelName:"session-info",schema:fY});const JY={sharedWorker:({storeId:e})=>`shared-worker-${e}`,browserExtension:{contentscriptMain:e=>`contentscript-main-${e}`,contentscriptIframe:e=>`contentscript-iframe-${e}`}},M$=se("ClientSessionContentscriptMainReq",{storeId:F,clientId:F,sessionId:F}),x$=se("ClientSessionContentscriptMainRes",{tabId:wt});Ce(()=>O$({listenWindow:window,sendWindow:window,schema:{listen:M$,send:x$},ids:{own:"contentscript-main-static",other:"client-session-static"}})),Ce(()=>O$({listenWindow:window,sendWindow:window,schema:{listen:x$,send:M$},ids:{own:"client-session-static",other:"contentscript-main-static"}}));const VY=({node:e,target:t,worker:n})=>q(function*(){const r=new MessageChannel,s=yield*ue();Ja&&(yield*cQ(`@livestore/devtools-web-common: closing message channel ${e.nodeName} → ${t}`)),yield*n.execute(og.make({from:e.nodeName,port:r.port1})).pipe(ls(()=>qe(s,!0)),qn,Ct,mn),yield*s;const o=yield*Z1({port:r.port2,schema:xS});yield*e.addEdge({target:t,edgeChannel:o,replaceIfExists:!0}),Ja&&(yield*wn(`@livestore/devtools-web-common: initiated connection: ${e.nodeName} → ${t}`))}).pipe(Fe.mapToUnexpectedError),sd=class sd extends Wv("@livestore/devtools-web-common:CacheService")(){};a(sd,"layer",({nodeName:t})=>q(function*(){const n=yield*HY(t);return globalThis.__debugWebmeshNode=n,{node:n}}).pipe(I3(sd)));let Xa=sd;const GY=({from:e,port:t})=>v6(n=>q(function*(){const{node:r}=yield*Xa,s=yield*Z1({port:t,schema:xS});yield*r.addEdge({target:e,edgeChannel:s,replaceIfExists:!0}),Ja&&(yield*wn(`@livestore/devtools-web-common: accepted edge: ${r.nodeName} ← ${e}`)),n.single({}),yield*fn({connectedTo:[...r.edgeKeys]})}).pipe(tr)).pipe(B6(`@livestore/devtools-web-common:worker:create-connection:${e}`));class QY extends ae(G8,Fe){}const YY=e=>X1({channelName:`livestore.shutdown.${e}`,schema:QY}),XY=Z({type:ce("opfs"),directory:gn(F)}),ZY=ae(XY);Xh({key:F,value:Yi});var A$;(function(e){class t extends qt()("InitialMessage",{payload:{port:ng,storeId:F,clientId:F},success:zs,failure:Fe}){}e.InitialMessage=t;class n extends ae(t){}e.Request=n})(A$||(A$={}));var Zt;(function(e){class t extends qt()("InitialMessage",{payload:{storageOptions:ZY,devtoolsEnabled:ko,storeId:F,clientId:F,debugInstanceId:F,syncPayload:bS(Yi)},success:zs,failure:Fe}){}e.InitialMessage=t;class n extends qt()("BootStatusStream",{payload:{},success:V8,failure:Fe}){}e.BootStatusStream=n;class r extends qt()("PushToLeader",{payload:{batch:Ke(X8)},success:zs,failure:ae(Fe,tY)}){}e.PushToLeader=r;class s extends qt()("PullStream",{payload:{cursor:J8},success:Z({payload:nP,mergeCounter:wt}),failure:Fe}){}e.PullStream=s;class o extends qt()("Export",{payload:{},success:_i,failure:Fe}){}e.Export=o;class i extends qt()("ExportEventlog",{payload:{},success:_i,failure:Fe}){}e.ExportEventlog=i;class c extends qt()("GetRecreateSnapshot",{payload:{},success:Z({snapshot:_i,migrationsReport:Y8}),failure:Fe}){}e.GetRecreateSnapshot=c;class u extends qt()("GetLeaderHead",{payload:{},success:Xt,failure:Fe}){}e.GetLeaderHead=u;class l extends qt()("GetLeaderSyncState",{payload:{},success:sg,failure:Fe}){}e.GetLeaderSyncState=l;class g extends qt()("Shutdown",{payload:{},success:zs,failure:Fe}){}e.Shutdown=g;class h extends qt()("ExtraDevtoolsMessage",{payload:{message:DY},success:zs,failure:Fe}){}e.ExtraDevtoolsMessage=h,e.Request=ae(t,n,r,s,o,i,c,u,l,g,h,og)})(Zt||(Zt={}));var Tm;(function(e){class t extends se("FromClientSession",{initialMessage:Zt.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends qt()("InitialMessage",{payload:{payload:ae(t,se("FromWebBridge",{})),liveStoreVersion:ce(rP)},success:zs,failure:Fe}){}e.InitialMessage=n;class r extends qt()("UpdateMessagePort",{payload:{port:ng},success:zs,failure:Fe}){}e.UpdateMessagePort=r;class s extends ae(n,r,Zt.BootStatusStream,Zt.PushToLeader,Zt.PullStream,Zt.Export,Zt.GetRecreateSnapshot,Zt.ExportEventlog,Zt.GetLeaderHead,Zt.GetLeaderSyncState,Zt.Shutdown,Zt.ExtraDevtoolsMessage,og){}e.Request=s})(Tm||(Tm={}));M1()&&(globalThis.__debugLiveStoreUtils={blobUrl:e=>URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),runSync:e=>us(e),runFork:e=>Cs(e)});const e7=q(function*(){const e=yield*P1(void 0),t=yield*ue().pipe(hi(No)),n=Yf(e,g$).pipe(ie(c=>c.worker)),r=c=>n.pipe(hi(u=>u.executeEffect(c)),ut,y$({label:`@livestore/adapter-web:shared-worker:forwardRequest:${c._tag}`,duration:500}),dr(u=>at(Fe)(u)?u:$4(u)||at(Mt)(u)?new Fe({cause:u}):u),KT(u=>new Fe({cause:u})),Ct),s=c=>q(function*(){yield*wn(`forwardRequestStream: ${c._tag}`);const{worker:u,scope:l}=yield*Yf(e,g$),g=u.execute(c),h=yield*ue();yield*In(l,qe(h,void 0));const p=q(function*(){return yield*h,I6}).pipe(d$);return L6(g,p,{haltStrategy:"either"})}).pipe(ut,Fe.mapToUnexpectedError,Ct,d$,T6(wn(`shutting down stream for ${c._tag}`)),Fe.mapToUnexpectedErrorStream),o=q(function*(){const c=yield*X6(e);c!==void 0&&(yield*sa(e,void 0),yield*HW(),yield*yt(c.scope,xt).pipe(y$({label:"@livestore/adapter-web:shared-worker:close-previous-worker",duration:500})))}).pipe(It("@livestore/adapter-web:shared-worker:resetCurrentWorkerCtx")),i=q(function*(){yield*wn("reset");const c=yield*ue();yield*Cu(t,c),yield*o});return T8(Tm.Request,{InitialMessage:c=>q(function*(){if(c.payload._tag==="FromWebBridge")return;const u=yield*as(t),l=yield*yf(u),g=c.payload.initialMessage;if(l){const h=yield*De(u),p=Zt.InitialMessage.pipe(qG("devtoolsEnabled","debugInstanceId"));if(I1(p)(g,h.initialMessage)===!1){const b=O8(p)(h.initialMessage,g);yield*new Fe({cause:"Initial message already sent and was different now",payload:{diff:b,previousInitialMessage:h.initialMessage,newInitialMessage:g}})}}else yield*qe(u,c.payload)}),UpdateMessagePort:({port:c})=>q(function*(){const u=yield*t.get.pipe(hi(De));yield*o;const l=yield*wh();yield*q(function*(){yield*(yield*YY(u.initialMessage.storeId)).listen.pipe(Wa(),ls(()=>i),qn,Ct,mn);const h=yield*E3(D8(()=>c)),p=yield*w8({size:1,concurrency:100,initialMessage:()=>u.initialMessage}).pipe(hn(h),It("@livestore/adapter-web:shared-worker:makeWorkerProxyFromPort")),{node:m}=yield*Xa,{storeId:b,clientId:$}=u.initialMessage;yield*VY({node:m,worker:p,target:UY.client.leader({storeId:b,clientId:$})}).pipe(Ct,mn),yield*sa(e,{worker:p,scope:l})}).pipe(Ct,_h(l),nn(l))}).pipe(It("@livestore/adapter-web:shared-worker:updateMessagePort"),Fe.mapToUnexpectedError,Ct),BootStatusStream:s,PushToLeader:r,PullStream:s,Export:r,GetRecreateSnapshot:r,ExportEventlog:r,Setup:r,GetLeaderSyncState:r,GetLeaderHead:r,Shutdown:r,ExtraDevtoolsMessage:r,"DevtoolsWebCommon.CreateConnection":GY})}).pipe(P3),t7=()=>{const e=self.name.replace("livestore-shared-worker-","");e7.pipe(Lb(z8),v3,wo,Ct,Xs({thread:self.name}),hn(eQ(self.name)),hn(c8),hn(Xa.layer({nodeName:JY.sharedWorker({storeId:e})})),Ja?M8(t=>console.createTask(t)):K,t=>t,tG(By),Cs)};t7();
