var wM=Object.defineProperty;var K0=e=>{throw TypeError(e)};var EM=(e,t,n)=>t in e?wM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>EM(e,typeof t!="symbol"?t+"":t,n),z_=(e,t,n)=>t.has(e)||K0("Cannot "+n);var Ae=(e,t,n)=>(z_(e,t,"read from private field"),n?n.call(e):t.get(e)),Br=(e,t,n)=>t.has(e)?K0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Jd=(e,t,n,r)=>(z_(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),et=(e,t,n)=>(z_(e,t,"access private method"),n);const kM=e=>typeof e=="function",y=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(a){return t(a,n,r,s)}};case 5:return function(n,r,s,o,a){return arguments.length>=5?t(n,r,s,o,a):function(u){return t(u,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},ie=e=>e,mp=e=>()=>e,J0=mp(!0),Jn=mp(!1),o1=mp(void 0),Ll=o1;function w(e,t,n,r,s,o,a,u,f){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return a(o(s(r(n(t(e))))));case 8:return u(a(o(s(r(n(t(e)))))));case 9:return f(u(a(o(s(r(n(t(e))))))));default:{let h=arguments[0];for(let p=1;p<arguments.length;p++)h=arguments[p](h);return h}}}const zf=e=>(t,n)=>t===n||e(t,n),$M=(e,t)=>e===t,CM=()=>$M,TM=CM(),i1=y(2,(e,t)=>zf((n,r)=>e(t(n),t(r)))),IM=i1(TM,e=>e.getTime()),RM=e=>zf((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let OM="3.15.5";const pp=()=>OM,Gd=`effect/GlobalValue/globalStoreId/${pp()}`;let el;const Ee=(e,t)=>(el||(globalThis[Gd]??(globalThis[Gd]=new Map),el=globalThis[Gd]),el.has(e)||el.set(e,t()),el.get(e)),qM=e=>e instanceof Set,Rn=e=>typeof e=="string",mo=e=>typeof e=="number",na=e=>typeof e=="boolean",gp=e=>typeof e=="bigint",Wh=e=>typeof e=="symbol",fu=kM,AM=e=>e===void 0,PM=e=>!1,xS=e=>typeof e=="object"&&e!==null,Ms=e=>xS(e)||fu(e),ne=y(2,(e,t)=>Ms(e)&&t in e),_p=y(2,(e,t)=>ne(e,"_tag")&&e._tag===t),Ja=e=>e==null,FM=e=>e!=null,NM=e=>e instanceof Uint8Array,a1=e=>e instanceof Date,DS=e=>ne(e,Symbol.iterator),xM=e=>xS(e)&&!Array.isArray(e),c1=e=>ne(e,"then")&&fu(e.then),yp=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let u1=class l1{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new l1(this.self)}};const DM=335903614,MM=4150755663,LM=1481765933,jM=1284865837,UM=9007199254740992,zM=134217728;class BM{constructor(t,n,r,s){d(this,"_state");return Ja(n)&&Ja(t)?(n=Math.random()*4294967295>>>0,t=0):Ja(n)&&(n=t,t=0),Ja(s)&&Ja(r)?(s=this._state?this._state[3]:MM,r=this._state?this._state[2]:DM):Ja(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),G0(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*zM+n)/UM}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;HM(this._state,t,n,LM,jM),G0(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,a=t>>>27,u=(-a>>>0&31)>>>0;return(o>>>a|o<<u)>>>0}}function HM(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,a=(n&65535)*(s>>>16)>>>0,u=(n&65535)*(s&65535)>>>0,f=(n>>>16)*(s>>>16)+((a>>>16)+(o>>>16))>>>0;a=a<<16>>>0,u=u+a>>>0,u>>>0<a>>>0&&(f=f+1>>>0),o=o<<16>>>0,u=u+o>>>0,u>>>0<o>>>0&&(f=f+1>>>0),f=f+Math.imul(n,r)>>>0,f=f+Math.imul(t,s)>>>0,e[0]=f,e[1]=u}function G0(e,t,n,r,s){let o=t+r>>>0;const a=n+s>>>0;a>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=a}const Py=Symbol.for("effect/Utils/YieldWrap");var jf;class du{constructor(t){Br(this,jf);Jd(this,jf,t)}[Py](){return Ae(this,jf)}}jf=new WeakMap;function f1(e){if(typeof e=="object"&&e!==null&&Py in e)return e[Py]();throw new Error(yp("yieldWrapGet"))}const wr=Ee("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),d1={effect_internal_function:e=>e()},VM={effect_internal_function:e=>{try{return e()}finally{}}};var fT;const WM=((fT=d1.effect_internal_function(()=>new Error().stack))==null?void 0:fT.includes("effect_internal_function"))===!0,gt=WM?d1.effect_internal_function:VM.effect_internal_function,KM=(function*(){}).constructor,JM=e=>Ms(e)&&e.constructor===KM,B_=Ee(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),pe=Symbol.for("effect/Hash"),Q=e=>{if(wr.enabled===!0)return 0;switch(typeof e){case"number":return MS(e);case"bigint":return Tt(e.toString(10));case"boolean":return Tt(String(e));case"symbol":return Tt(String(e));case"string":return Tt(e);case"undefined":return Tt("undefined");case"function":case"object":return e===null?Tt("null"):e instanceof Date?Q(e.toISOString()):e instanceof URL?Q(e.href):GM(e)?e[pe]():bp(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},bp=e=>(B_.has(e)||B_.set(e,MS(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),B_.get(e)),ue=e=>t=>t*53^e,Sp=e=>e&3221225471|e>>>1&1073741824,GM=e=>ne(e,pe),MS=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return Sp(t)},Tt=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return Sp(t)},QM=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=w(Tt(t[r]),ue(Q(e[t[r]])));return Sp(n)},h1=e=>QM(e,Object.keys(e)),Bf=e=>{let t=6151;for(let n=0;n<e.length;n++)t=w(t,ue(Q(e[n])));return Sp(t)},at=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,pe,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,pe,{value(){return t},enumerable:!1}),t},ge=Symbol.for("effect/Equal");function de(){return arguments.length===1?e=>Kh(e,arguments[0]):Kh(arguments[0],arguments[1])}function Kh(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(jl(e)&&jl(t))return Q(e)===Q(t)&&e[ge](t)?!0:wr.enabled&&wr.tester?wr.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(wr.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Kh(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Kh(e[o],t[o])))return wr.tester?wr.tester(e,t):!1;return!0}}return wr.tester?wr.tester(e,t):!1}}return wr.enabled&&wr.tester?wr.tester(e,t):!1}const jl=e=>ne(e,ge),LS=()=>de,Ue=Symbol.for("nodejs.util.inspect.custom"),Ot=e=>{try{if(ne(e,"toJSON")&&fu(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(Ot)}catch{return{}}return sa(e)},dt=e=>JSON.stringify(e,null,2),vp={toJSON(){return Ot(this)},[Ue](){return this.toJSON()},toString(){return dt(this.toJSON())}};let YM=class{[Ue](){return this.toJSON()}toString(){return dt(this.toJSON())}};const ra=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?m1(e,t):String(e)}catch{return String(e)}},m1=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(Vi.fiberRefs!==void 0&&p1(o)?o[wp](Vi.fiberRefs):o):o,t);return n=void 0,r},wp=Symbol.for("effect/Inspectable/Redactable"),p1=e=>typeof e=="object"&&e!==null&&wp in e,Vi=Ee("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),XM=(e,t)=>{const n=Vi.fiberRefs;Vi.fiberRefs=e;try{return t()}finally{Vi.fiberRefs=n}},sa=e=>p1(e)&&Vi.fiberRefs!==void 0?e[wp](Vi.fiberRefs):e,ee=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},El="Async",Hf="Commit",cn="Failure",_h="OnFailure",Jh="OnSuccess",Gh="OnSuccessAndFailure",un="Success",g1="Sync",ZM="Tag",hu="UpdateRuntimeFlags",Qh="While",kl="Iterator",_1="WithRuntime",yh="Yield",jS="RevertFlags",eL=Symbol.for("effect/Effect"),Fy=Symbol.for("effect/Stream"),tL=Symbol.for("effect/Sink"),nL=Symbol.for("effect/Channel"),oa={_R:e=>e,_E:e=>e,_A:e=>e,_V:pp()},rL={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},sL={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Vf={[eL]:oa,[Fy]:oa,[tL]:rL,[nL]:sL,[ge](e){return this===e},[pe](){return at(this,bp(this))},[Symbol.iterator](){return new u1(new du(this))},pipe(){return ee(this,arguments)}},US={[pe](){return at(this,h1(this))},[ge](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&de(this[r],e[r])))return!1;return!0}},Wf={...Vf,_op:Hf},oL={...Wf,...US},iL=function(){function e(){}return e.prototype=Wf,e}(),y1=Symbol.for("effect/Option"),b1={...Vf,[y1]:{_A:e=>e},[Ue](){return this.toJSON()},toString(){return dt(this.toJSON())}},aL=Object.assign(Object.create(b1),{_tag:"Some",_op:"Some",[ge](e){return zS(e)&&v1(e)&&de(this.value,e.value)},[pe](){return at(this,ue(Q(this._tag))(Q(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:Ot(this.value)}}}),cL=Q("None"),uL=Object.assign(Object.create(b1),{_tag:"None",_op:"None",[ge](e){return zS(e)&&S1(e)},[pe](){return cL},toJSON(){return{_id:"Option",_tag:this._tag}}}),zS=e=>ne(e,y1),S1=e=>e._tag==="None",v1=e=>e._tag==="Some",w1=Object.create(uL),Ny=e=>{const t=Object.create(aL);return t.value=e,t},E1=Symbol.for("effect/Either"),k1={...Vf,[E1]:{_R:e=>e},[Ue](){return this.toJSON()},toString(){return dt(this.toJSON())}},lL=Object.assign(Object.create(k1),{_tag:"Right",_op:"Right",[ge](e){return BS(e)&&C1(e)&&de(this.right,e.right)},[pe](){return ue(Q(this._tag))(Q(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:Ot(this.right)}}}),fL=Object.assign(Object.create(k1),{_tag:"Left",_op:"Left",[ge](e){return BS(e)&&$1(e)&&de(this.left,e.left)},[pe](){return ue(Q(this._tag))(Q(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:Ot(this.left)}}}),BS=e=>ne(e,E1),$1=e=>e._tag==="Left",C1=e=>e._tag==="Right",dL=e=>{const t=Object.create(fL);return t.left=e,t},hL=e=>{const t=Object.create(lL);return t.right=e,t},ce=hL,oe=dL,HS=e=>{if(fu(e))try{return ce(e())}catch(t){return oe(t)}else try{return ce(e.try())}catch(t){return oe(e.catch(t))}},T1=BS,tn=$1,ys=C1,mL=y(2,(e,{onLeft:t,onRight:n})=>tn(e)?oe(t(e.left)):ce(n(e.right))),ia=y(2,(e,t)=>tn(e)?oe(t(e.left)):ce(e.right)),pL=y(2,(e,t)=>ys(e)?ce(t(e.right)):oe(e.left)),sn=y(2,(e,{onLeft:t,onRight:n})=>tn(e)?t(e.left):n(e.right)),gL=sn({onLeft:ie,onRight:ie}),I1=y(2,(e,t)=>{if(ys(e))return e.right;throw t(e.left)}),_L=I1(()=>new Error("getOrThrow called on a Left")),VS=e=>e.length>0,R1=e=>(t,n)=>t===n?0:e(t,n),yL=R1((e,t)=>e<t?-1:1),O1=y(2,(e,t)=>R1((n,r)=>e(t(n),t(r)))),bL=e=>y(2,(t,n)=>e(t,n)===1),V=()=>w1,W=Ny,SL=zS,Ft=S1,lt=v1,st=y(2,(e,{onNone:t,onSome:n})=>Ft(e)?t():n(e.value)),Et=y(2,(e,t)=>Ft(e)?t():e.value),ro=y(2,(e,t)=>Ft(e)?t():e),vL=y(2,(e,t)=>Ft(e)?W(t()):e),Ca=e=>e==null?V():W(e),lr=Et(o1),wL=e=>(...t)=>{try{return W(e(...t))}catch{return V()}},Zo=y(2,(e,t)=>Ft(e)?V():W(t(e.value))),mu=y(2,(e,t)=>Ft(e)?V():t(e.value)),EL=y(2,(e,t)=>Ft(e)?V():Ca(t(e.value))),kL=mu(ie),$L=e=>zf((t,n)=>Ft(t)?Ft(n):Ft(n)?!1:e(t.value,n.value)),CL=e=>y(2,(t,n)=>Ft(t)?!1:e(t.value,n)),TL=LS(),IL=CL(TL),RL=y(2,(e,t)=>Ft(e)?!1:t(e.value)),Q0=e=>(t,n)=>Ft(t)?n:Ft(n)?t:W(e(t.value,n.value)),OL=(...e)=>e,qL=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},AL=y(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(na(s)){if(s)return W(r)}else if(lt(s))return s;n++}return V()}),PL={[Symbol.iterator](){return FL}},FL={next(){return{done:!0,value:void 0}}},q1=()=>PL,NL=y(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){const s=n.next();return s.done?{done:!0,value:void 0}:{done:!1,value:t(s.value,r++)}}}}})),xL=y(2,(e,t)=>{const n={...e};for(const r of DL(e))n[r]=t(e[r],r);return n}),DL=e=>Object.keys(e),Ep=e=>new Array(e),ML=y(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),je=e=>Array.isArray(e)?e:Array.from(e),WS=e=>Array.isArray(e)?e:[e],LL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>bt(e)?n(e):t()),jL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>bt(e)?n(Ln(e),aa(e)):t()),Yh=y(2,(e,t)=>[t,...e]),UL=y(2,(e,t)=>[...e,t]),kp=y(2,(e,t)=>je(e).concat(je(t))),zL=Array.isArray,BL=e=>e.length===0,HL=BL,bh=VS,bt=VS,A1=(e,t)=>e<0||e>=t.length,VL=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),WL=y(2,(e,t)=>{const n=Math.floor(t);return A1(n,e)?V():W(e[n])}),P1=y(2,(e,t)=>{const n=Math.floor(t);if(A1(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),_c=WL(0),Ln=P1(0),KL=e=>bt(e)?W(F1(e)):V(),F1=e=>e[e.length-1],aa=e=>e.slice(1),N1=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},x1=y(2,(e,t)=>M1(e,N1(e,t))),JL=y(2,(e,t)=>{const n=je(e);return n.slice(VL(t,n),n.length)}),GL=y(2,(e,t)=>je(e).slice(N1(e,t))),QL=AL,Y0=e=>Array.from(e).reverse(),Ul=y(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),X0=y(2,(e,t)=>YL(e,t,OL)),YL=y(3,(e,t,n)=>{const r=je(e),s=je(t);if(bt(r)&&bt(s)){const o=[n(Ln(r),Ln(s))],a=Math.min(r.length,s.length);for(let u=1;u<a;u++)o[u]=n(r[u],s[u]);return o}return[]}),XL=e=>{const t=je(e);if(bt(t)){const n=[t[0][0]],r=[t[0][1]];for(let s=1;s<t.length;s++)n[s]=t[s][0],r[s]=t[s][1];return[n,r]}return[[],[]]},ZL=e=>y(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),D1=LS(),ej=y(2,(e,t)=>{const n=je(e);if(bt(n)){const[r,s]=t(n),o=[r];let a=s;for(;VS(a);){const[u,f]=t(a);o.push(u),a=f}return o}return[]}),M1=y(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return bt(n)?r>=1?L1(n,r):[[],n]:[n,[]]}),L1=y(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[ll(e),[]]:[Yh(e.slice(1,n),Ln(e)),e.slice(n)]}),j1=y(2,(e,t)=>x1(e,(n,r)=>!t(n,r))),ll=e=>e.slice(),tj=y(2,(e,t)=>{const n=je(e);return bt(n)?ej(n,L1(t)):[]}),nj=y(3,(e,t,n)=>{const r=je(e),s=je(t);return bt(r)?bt(s)?B1(n)(kp(r,s)):r:s}),Sh=y(2,(e,t)=>nj(e,t,D1)),rj=e=>{const t=ZL(e);return y(2,(n,r)=>je(n).filter(s=>t(r,s)))},sj=rj(D1),oi=()=>[],cr=e=>[e],so=y(2,(e,t)=>e.map(t)),Xh=y(2,(e,t)=>{if(HL(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),oj=Xh(ie),U1=y(2,(e,t)=>{const n=je(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);lt(o)&&r.push(o.value)}return r}),z1=y(2,(e,t)=>{const n=je(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),KS=y(3,(e,t,n)=>je(e).reduce((r,s,o)=>n(r,s,o),t)),Z0=(e,t)=>{const n=[];let r=e,s;for(;lt(s=t(r));){const[o,a]=s.value;n.push(o),r=a}return n},Kf=RM,B1=y(2,(e,t)=>{const n=je(e);if(bt(n)){const r=[Ln(n)],s=aa(n);for(const o of s)r.every(a=>!t(o,a))&&r.push(o);return r}return[]}),ij=e=>B1(e,LS()),Ta=y(2,(e,t)=>je(e).join(t)),H1=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return H1(e,t.from)}},ws=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),V1=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},W1=e=>{try{return e.toISOString()}catch{return String(e)}},Pr=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>Pr(n,t)).join(",")}]`;if(a1(e))return W1(e);if(ne(e,"toString")&&fu(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Rn(e))return JSON.stringify(e);if(mo(e)||e==null||na(e)||Wh(e))return String(e);if(gp(e))return String(e)+"n";if(DS(e))return`${e.constructor.name}(${Pr(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${ws(e).map(s=>`${Rn(s)?JSON.stringify(s):String(s)}:${Pr(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},JS=e=>typeof e=="string"?JSON.stringify(e):String(e),K1=e=>Array.isArray(e),aj=e=>!Array.isArray(e),ek=e=>`[${JS(e)}]`,J1=e=>K1(e)?e.map(ek).join(""):ek(e),Oo=(e,t,n,r)=>{let s=e;return n&&bt(n)&&(s+=`
at path: ${J1(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},cj=(e,t,n)=>Oo("Unsupported schema",e,t,n),G1=(e,t,n)=>Oo("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),zl=e=>cj(void 0,void 0,e),uj=e=>Oo("Unsupported key schema",void 0,void 0,e),lj=e=>Oo("Unsupported literal",`literal value: ${Pr(e)}`),tk=e=>Oo("Duplicate index signature",`${e} index signature`),fj=Oo("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),dj=Oo("Invalid element","A required element cannot follow an optional element. ts(1257)"),nk=e=>Oo("Duplicate property signature transformation",`Duplicate key ${Pr(e)}`),Q1=e=>Oo("Duplicate property signature",`Duplicate key ${Pr(e)}`),hj=Symbol.for("effect/SchemaId/DateFromSelf"),mj=Symbol.for("effect/SchemaId/GreaterThanOrEqualTo"),pj=Symbol.for("effect/SchemaId/Int"),gj=Symbol.for("effect/SchemaId/Between"),Pc=yL,Zh=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Y1=Symbol.for("effect/annotation/Brand"),_j=Symbol.for("effect/annotation/SchemaId"),X1=Symbol.for("effect/annotation/Message"),GS=Symbol.for("effect/annotation/MissingMessage"),QS=Symbol.for("effect/annotation/Identifier"),Ls=Symbol.for("effect/annotation/Title"),yc=Symbol.for("effect/annotation/AutoTitle"),Jf=Symbol.for("effect/annotation/Description"),Z1=Symbol.for("effect/annotation/Examples"),eR=Symbol.for("effect/annotation/Default"),tR=Symbol.for("effect/annotation/JSONSchema"),nR=Symbol.for("effect/annotation/Arbitrary"),rR=Symbol.for("effect/annotation/Pretty"),sR=Symbol.for("effect/annotation/Equivalence"),yj=Symbol.for("effect/annotation/Documentation"),oR=Symbol.for("effect/annotation/Concurrency"),iR=Symbol.for("effect/annotation/Batching"),aR=Symbol.for("effect/annotation/ParseIssueTitle"),cR=Symbol.for("effect/annotation/ParseOptions"),uR=Symbol.for("effect/annotation/DecodingFallback"),em=Symbol.for("effect/annotation/Surrogate"),bj=Symbol.for("effect/annotation/StableFilter"),Hn=y(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?W(e.annotations[t]):V()),lR=Hn(Y1),Sj=Hn(X1),vj=Hn(GS),fR=Hn(Ls),dR=Hn(yc),$p=Hn(QS),hR=Hn(Jf),wj=Hn(oR),Ej=Hn(iR),kj=Hn(aR),$j=Hn(cR),Cj=Hn(uR),pu=Hn(em),Tj=Hn(bj),Ij=e=>RL(Tj(e),t=>t===!0),Cp=Symbol.for("effect/annotation/JSONIdentifier"),Rj=Hn(Cp),Oj=e=>ro(Rj(e),()=>$p(e)),qj=Symbol.for("effect/schema/ParseJson");class Tp{constructor(t,n,r,s={}){d(this,"typeParameters");d(this,"decodeUnknown");d(this,"encodeUnknown");d(this,"annotations");d(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return Et(Ts(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:Zt(this.annotations)}}}const js=e=>t=>t._tag===e;let tm=class{constructor(t,n={}){d(this,"literal");d(this,"annotations");d(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return Et(Ts(this),()=>Pr(this.literal))}toJSON(){return{_tag:this._tag,literal:gp(this.literal)?String(this.literal):this.literal,annotations:Zt(this.annotations)}}};const $l=js("Literal"),Aj=new tm(null);class mR{constructor(t,n={}){d(this,"symbol");d(this,"annotations");d(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return Et(Ts(this),()=>Pr(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:Zt(this.annotations)}}}class Pj{constructor(t={}){d(this,"annotations");d(this,"_tag","UndefinedKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const Fc=new Pj({[Ls]:"undefined"});class Fj{constructor(t={}){d(this,"annotations");d(this,"_tag","VoidKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const Nj=new Fj({[Ls]:"void"});class xj{constructor(t={}){d(this,"annotations");d(this,"_tag","NeverKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const Ip=new xj({[Ls]:"never"}),Dj=js("NeverKeyword");class Mj{constructor(t={}){d(this,"annotations");d(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const pR=new Mj({[Ls]:"unknown"});class Lj{constructor(t={}){d(this,"annotations");d(this,"_tag","AnyKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const gR=new Lj({[Ls]:"any"});class jj{constructor(t={}){d(this,"annotations");d(this,"_tag","StringKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const xy=new jj({[Ls]:"string",[Jf]:"a string"}),Dy=js("StringKeyword");class Uj{constructor(t={}){d(this,"annotations");d(this,"_tag","NumberKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const My=new Uj({[Ls]:"number",[Jf]:"a number"}),rk=js("NumberKeyword");class zj{constructor(t={}){d(this,"annotations");d(this,"_tag","BooleanKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:Zt(this.annotations)}}}const Ly=new zj({[Ls]:"boolean",[Jf]:"a boolean"}),sk=js("BooleanKeyword"),_R=js("SymbolKeyword");let Gf=class{constructor(t,n={}){d(this,"type");d(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:Zt(this.annotations)}}toString(){return String(this.type)}};class pi extends Gf{constructor(n,r,s={}){super(n,s);d(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:Zt(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Rp=e=>e.map(t=>t.type);class Qf{constructor(t,n,r,s={}){d(this,"elements");d(this,"rest");d(this,"isReadonly");d(this,"annotations");d(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,a=!1;for(const u of t)if(u.isOptional)o=!0;else if(o){a=!0;break}if(a||o&&n.length>1)throw new Error(dj)}toString(){return Et(Ts(this),()=>Bj(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:Zt(this.annotations)}}}const Bj=e=>{const t=e.elements.map(String).join(", ");return jL(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const a=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${a}]`:`readonly [...${o}[], ${a}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Nt extends pi{constructor(n,r,s,o,a){super(r,s,a);d(this,"name");d(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:Zt(this.annotations)}}}const yR=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return yR(e.from)}return!1};class gu{constructor(t,n,r){d(this,"type");d(this,"isReadonly");d(this,"parameter");if(this.type=n,this.isReadonly=r,yR(t))this.parameter=t;else throw new Error(fj)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Fr{constructor(t,n,r={}){d(this,"annotations");d(this,"_tag","TypeLiteral");d(this,"propertySignatures");d(this,"indexSignatures");this.annotations=r;const s={};for(let a=0;a<t.length;a++){const u=t[a].name;if(Object.prototype.hasOwnProperty.call(s,u))throw new Error(Q1(u));s[u]=null}const o={string:!1,symbol:!1};for(let a=0;a<n.length;a++){const u=rm(n[a].parameter);if(Dy(u)){if(o.string)throw new Error(tk("string"));o.string=!0}else if(_R(u)){if(o.symbol)throw new Error(tk("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return Et(Ts(this),()=>Hj(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:Zt(this.annotations)}}}const ok=e=>e.map(String).join("; "),Hj=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${ok(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${ok(e.indexSignatures)} }`:"{}"},ik=js("TypeLiteral"),Vj=Ul(O1(Pc,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Wj={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},bR=e=>Xh(e,t=>XS(t)?bR(t.types):[t]),Kj=e=>{const t=Vj(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[gR];case"UnknownKeyword":return[pR];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const a=typeof o.literal;switch(a){case"string":case"number":case"bigint":case"boolean":{const u=Wj[a];!r[u]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};var Qs;let nn=(Qs=class{constructor(t,n={}){d(this,"types");d(this,"annotations");d(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return Et(Ts(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:Zt(this.annotations)}}},d(Qs,"make",(t,n)=>YS(t)?new Qs(t,n):t.length===1?t[0]:Ip),d(Qs,"unify",(t,n)=>Qs.make(Kj(bR(t)),n)),Qs);const Jj=(e,t)=>e.map(t),YS=e=>e.length>1,XS=js("Union"),H_=Ee(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class ca{constructor(t,n={}){d(this,"f");d(this,"annotations");d(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=V1(t)}toString(){return Ts(this).pipe(ro(()=>mu(wL(this.f)(),t=>Ts(t))),Et(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=H_.get(t);return n||(H_.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:Zt(this.annotations)},H_.set(t,n),n)}}let Yf=class{constructor(t,n,r={}){d(this,"from");d(this,"filter");d(this,"annotations");d(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return $p(this).pipe(Et(()=>st(CR(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>bc(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:Zt(this.annotations)}}};const bc=js("Refinement"),V_={};let Rr=class{constructor(t,n,r,s={}){d(this,"from");d(this,"to");d(this,"transformation");d(this,"annotations");d(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return Et(Ts(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:Zt(this.annotations)}}};const Gj=js("Transformation");class SR{constructor(t,n){d(this,"decode");d(this,"encode");d(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const Qj=e=>t=>t._tag===e;class Yj{constructor(){d(this,"_tag","ComposeTransformation")}}const ZS=new Yj;let Xj=class{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");this.from=t,this.to=n,this.decode=r,this.encode=s}};const Zj=e=>e.decode===ie&&e.encode===ie;class nm{constructor(t){d(this,"propertySignatureTransformations");d(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(nk(o));n[o]=!0;const a=s.to;if(r[a])throw new Error(nk(a));r[a]=!0}}}const jy=Qj("TypeLiteralTransformation"),ua=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=pu(e);return lt(s)&&(r[em]=ua(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},eU="[\\s\\S]*",tU="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",vR=(e,t)=>{switch(e._tag){case"Literal":return Zh(String(e.literal));case"StringKeyword":return eU;case"NumberKeyword":return tU;case"TemplateLiteral":return wR(e);case"Union":return e.types.map(n=>vR(n)).join("|")}},nU=(e,t,n,r)=>XS(e)?`(${t})`:t,wR=(e,t,n)=>{let r="";if(e.head!==""){const s=Zh(e.head);r+=s}for(const s of e.spans){const o=vR(s.type);if(r+=nU(s.type,o),s.literal!==""){const a=Zh(s.literal);r+=a}}return r},ER=e=>new RegExp(`^${wR(e)}$`),vh=e=>{const t=pu(e);if(lt(t))return vh(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return vh(e.f());case"Refinement":return vh(e.from)}return Ri(e).map(n=>xi(e,n))},wh=e=>{switch(e._tag){case"TupleType":{let t=!1,n=[];for(const r of e.elements)r.isOptional&&(t=!0),n.push(r.type);return t&&n.push(Fc),n=n.concat(Rp(e.rest)),nn.make(n)}case"Refinement":return wh(e.from);case"Union":return nn.make(e.types.map(wh));case"Suspend":return wh(e.f())}throw new Error(zl(e))},kR=(e,t)=>{const n=QL(e.propertySignatures,r=>r.name===t);if(lt(n))return n.value;if(Rn(t)){let r;for(const s of e.indexSignatures){const o=rm(s.parameter);switch(o._tag){case"TemplateLiteral":{if(ER(o).test(t))return new Nt(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new Nt(t,s.type,!1,!0))}}if(r)return r}else if(Wh(t))for(const r of e.indexSignatures){const s=rm(r.parameter);if(_R(s))return new Nt(t,r.type,!1,!0)}},xi=(e,t)=>{const n=pu(e);if(lt(n))return xi(n.value,t);switch(e._tag){case"TypeLiteral":{const r=kR(e,t);if(r)return r;break}case"Union":return new Nt(t,nn.make(e.types.map(r=>xi(r,t).type)),!1,!0);case"Suspend":return xi(e.f(),t);case"Refinement":return xi(e.from,t)}throw new Error(zl(e))},Ri=e=>{const t=pu(e);if(lt(t))return Ri(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>sj(n,Ri(r)),Ri(e.types[0]));case"Suspend":return Ri(e.f());case"Refinement":return Ri(e.from);case"Transformation":return Ri(e.to)}return[]},ak=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new gu(o,t,!0));break;case"Literal":if(Rn(o.literal)||mo(o.literal))n.push(new Nt(o.literal,t,!1,!0));else throw new Error(lj(o.literal));break;case"Enums":{for(const[a,u]of o.enums)n.push(new Nt(u,t,!1,!0));break}case"UniqueSymbol":n.push(new Nt(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(uj(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Ws=(e,t)=>{const n=pu(e);if(lt(n))return Ws(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const a=kR(e,o);a&&r.push(a)}return new Fr(r,[])}case"Union":return new Fr(t.map(r=>xi(e,r)),[]);case"Suspend":return Ws(e.f(),t);case"Refinement":return Ws(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new Rr(Ws(e.from,t),Ws(e.to,t),ZS);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const a=e.transformation.propertySignatureTransformations.find(u=>u.to===o);a?(r.push(a),s.push(a.from)):s.push(o)}return bt(r)?new Rr(Ws(e.from,s),Ws(e.to,t),new nm(r)):Ws(e.from,s)}}}throw new Error(zl(e))},Eh=e=>nn.make([e,Fc]),fl=(e,t)=>{switch(e._tag){case"TupleType":return new Qf(e.elements.map(n=>new pi(Eh(n.type),!0)),LL(e.rest,{onEmpty:()=>e.rest,onNonEmpty:n=>[new Gf(nn.make([...Rp(n),Fc]))]}),e.isReadonly);case"TypeLiteral":return new Fr(e.propertySignatures.map(n=>new Nt(n.name,Eh(n.type),!0,n.isReadonly,n.annotations)),e.indexSignatures.map(n=>new gu(n.parameter,Eh(n.type),n.isReadonly)));case"Union":return nn.make(e.types.map(n=>fl(n)));case"Suspend":return new ca(()=>fl(e.f()));case"Declaration":case"Refinement":throw new Error(zl(e));case"Transformation":{if(jy(e.transformation)&&e.transformation.propertySignatureTransformations.every(Zj))return new Rr(fl(e.from),fl(e.to),e.transformation);throw new Error(zl(e))}}return e},tc=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new Qf(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=Mn(e.propertySignatures,r=>r.isReadonly===!1?r:new Nt(r.name,r.type,r.isOptional,!1,r.annotations)),n=Mn(e.indexSignatures,r=>r.isReadonly===!1?r:new gu(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new Fr(t,n,e.annotations)}case"Union":{const t=Mn(e.types,tc);return t===e.types?e:nn.make(t,e.annotations)}case"Suspend":return new ca(()=>tc(e.f()),e.annotations);case"Refinement":{const t=tc(e.from);return t===e.from?e:new Yf(t,e.filter,e.annotations)}case"Transformation":{const t=tc(e.from),n=tc(e.to);return t===e.from&&n===e.to?e:new Rr(t,n,e.transformation,e.annotations)}}return e},$R=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},rU=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},sU=$R([Z1,eR,tR,nR,rR,sR]),xt=e=>{switch(e._tag){case"Declaration":{const t=Mn(e.typeParameters,xt);return t===e.typeParameters?e:new Tp(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=Mn(e.elements,s=>{const o=xt(s.type);return o===s.type?s:new pi(o,s.isOptional)}),n=Rp(e.rest),r=Mn(n,xt);return t===e.elements&&r===n?e:new Qf(t,r.map(s=>new Gf(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=Mn(e.propertySignatures,r=>{const s=xt(r.type);return s===r.type?r:new Nt(r.name,s,r.isOptional,r.isReadonly)}),n=Mn(e.indexSignatures,r=>{const s=xt(r.type);return s===r.type?r:new gu(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new Fr(t,n,e.annotations)}case"Union":{const t=Mn(e.types,xt);return t===e.types?e:nn.make(t,e.annotations)}case"Suspend":return new ca(()=>xt(e.f()),e.annotations);case"Refinement":{const t=xt(e.from);return t===e.from?e:new Yf(t,e.filter,e.annotations)}case"Transformation":{const t=sU(e);return xt(t!==void 0?ua(e.to,t):e.to)}}return e},Ga=e=>st(Oj(e),{onNone:()=>{},onSome:t=>({[Cp]:t})});function Mn(e,t){let n=!1;const r=Ep(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=t(o);a!==o&&(n=!0),r[s]=a}return n?r:e}const us=(e,t)=>{switch(e._tag){case"Declaration":{const n=Mn(e.typeParameters,r=>us(r));return n===e.typeParameters?e:new Tp(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=Mn(e.elements,o=>{const a=us(o.type);return a===o.type?o:new pi(a,o.isOptional)}),r=Rp(e.rest),s=Mn(r,o=>us(o));return n===e.elements&&s===r?e:new Qf(n,s.map(o=>new Gf(o)),e.isReadonly,Ga(e))}case"TypeLiteral":{const n=Mn(e.propertySignatures,s=>{const o=us(s.type);return o===s.type?s:new Nt(s.name,o,s.isOptional,s.isReadonly)}),r=Mn(e.indexSignatures,s=>{const o=us(s.type);return o===s.type?s:new gu(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new Fr(n,r,Ga(e))}case"Union":{const n=Mn(e.types,r=>us(r));return n===e.types?e:nn.make(n,Ga(e))}case"Suspend":return new ca(()=>us(e.f()),Ga(e));case"Refinement":{const n=us(e.from),r=Ga(e);return r?ua(n,r):n}case"Transformation":{const n=Ga(e);return us(n?ua(e.from,n):e.from)}}return e},Uy=e=>us(e),Zt=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},rm=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return rm(e.from)}},oU=(e,t)=>new Rr(e,t,ZS),gi=e=>Et(Ts(e),()=>e._tag);function iU(e){return st(lR(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${Pr(n)}>`).join("")})}const CR=e=>fR(e).pipe(ro(()=>hR(e)),ro(()=>dR(e)),Zo(t=>t+iU(e))),Ts=e=>ro($p(e),()=>CR(e)),aU=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return Ip;case"Union":{const r=[];let s=!1;for(const o of e.types){const a=t(o);a?(s=!0,Dj(a)||r.push(a)):r.push(o)}if(s)return nn.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},ck=Symbol.for("effect/Brand/Refined"),TR=()=>Object.assign(e=>e,{[ck]:ck,option:e=>W(e),either:e=>ce(e),is:e=>!0}),IR=Symbol.for("effect/Context/Tag"),sm=Symbol.for("effect/Context/Reference"),cU="effect/STM",uU=Symbol.for(cU),ev={...Vf,_op:"Tag",[uU]:oa,[IR]:{_Service:e=>e,_Identifier:e=>e},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[Ue](){return this.toJSON()},of(e){return e},context(e){return qR(this,e)}},lU={...ev,[sm]:sm},fU=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(ev);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},dU=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,ev),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},hU=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,lU),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},RR=Symbol.for("effect/Context"),mU={[RR]:{_Services:e=>e},[ge](e){if(OR(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!de(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[pe](){return at(this,MS(this.unsafeMap.size))},pipe(){return ee(this,arguments)},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(Ot)}},[Ue](){return this.toJSON()}},la=e=>{const t=Object.create(mU);return t.unsafeMap=e,t},pU=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},OR=e=>ne(e,RR),gU=e=>ne(e,IR),_U=e=>ne(e,sm),yU=la(new Map),bU=()=>yU,qR=(e,t)=>la(new Map([[e.key,t]])),SU=y(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),la(r)}),W_=Ee("effect/Context/defaultValueCache",()=>new Map),tv=e=>{if(W_.has(e.key))return W_.get(e.key);const t=e.defaultValue();return W_.set(e.key,t),t},vU=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):tv(t),AR=y(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(sm in t)return tv(t);throw pU(t)}return e.unsafeMap.get(t.key)}),wU=AR,EU=y(2,(e,t)=>e.unsafeMap.has(t.key)?Ny(e.unsafeMap.get(t.key)):_U(t)?Ny(tv(t)):w1),kU=y(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return la(n)}),$U=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return la(n)},tr=fU,CU=OR,Op=gU,po=bU,Xf=qR,gs=SU,Gn=wU,qp=AR,Dr=EU,qo=kU,TU=$U,nv=dU,_u=hU,PR=Symbol.for("effect/Chunk");function IU(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const FR=[],RU=e=>zf((t,n)=>t.length===n.length&&dr(t).every((r,s)=>e(r,oo(n,s)))),OU=RU(de),qU={[PR]:{_A:e=>e},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Chunk",values:dr(this).map(Ot)}},[Ue](){return this.toJSON()},[ge](e){return Wi(e)&&OU(this,e)},[pe](){return at(this,Bf(dr(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return FR[Symbol.iterator]();default:return dr(this)[Symbol.iterator]()}},pipe(){return ee(this,arguments)}},Ut=e=>{const t=Object.create(qU);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Kr,t.right=Kr;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Kr,t.right=Kr;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Kr,t.right=Kr;break}}return t},Wi=e=>ne(e,PR),Kr=Ut({_tag:"IEmpty"}),yt=()=>Kr,K_=(...e)=>FU(e),ft=e=>Ut({_tag:"ISingleton",a:e}),go=e=>Wi(e)?e:zt(je(e)),zy=(e,t,n)=>{switch(e.backing._tag){case"IArray":{IU(e.backing.array,0,t,n,e.length);break}case"IConcat":{zy(e.left,t,n),zy(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=oo(e,r),r+=1,s+=1;break}}},AU=e=>{switch(e.backing._tag){case"IEmpty":return FR;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return zy(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Kr,e.right=Kr,e.depth=0,t}}},dr=AU,PU=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Ut({_tag:"IArray",array:Y0(e.backing.array)});case"IConcat":return Ut({_tag:"IConcat",left:_o(e.backing.right),right:_o(e.backing.left)});case"ISlice":return zt(Y0(dr(e)))}},_o=PU,NR=y(2,(e,t)=>t<0||t>=e.length?V():W(oo(e,t))),zt=e=>e.length===0?yt():e.length===1?ft(e[0]):Ut({_tag:"IArray",array:e}),FU=e=>zt(e),oo=y(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?oo(e.left,t):oo(e.right,t-e.left.length);case"ISlice":return oo(e.backing.chunk,t+e.backing.offset)}}),Bl=y(2,(e,t)=>Rt(e,ft(t))),wn=y(2,(e,t)=>Rt(ft(t),e)),Nc=y(2,(e,t)=>{if(t<=0)return Kr;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Ut({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Ut({_tag:"IConcat",left:e.left,right:Nc(e.right,t-e.left.length)}):Nc(e.left,t);default:return Ut({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Ys=y(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Kr;switch(e.backing._tag){case"ISlice":return Ut({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Ys(e.right,t-e.left.length):Ut({_tag:"IConcat",left:Ys(e.left,t),right:e.right});default:return Ut({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Rt=y(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Ut({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Rt(e.right,t);return Ut({_tag:"IConcat",left:e.left,right:r})}else{const r=Rt(e.right.right,t);if(r.depth===e.depth-3){const s=Ut({_tag:"IConcat",left:e.right.left,right:r});return Ut({_tag:"IConcat",left:e.left,right:s})}else{const s=Ut({_tag:"IConcat",left:e.left,right:e.right.left});return Ut({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Rt(e,t.left);return Ut({_tag:"IConcat",left:r,right:t.right})}else{const r=Rt(e,t.left.left);if(r.depth===t.depth-3){const s=Ut({_tag:"IConcat",left:r,right:t.left.right});return Ut({_tag:"IConcat",left:s,right:t.right})}else{const s=Ut({_tag:"IConcat",left:t.left.right,right:t.right});return Ut({_tag:"IConcat",left:r,right:s})}}}),xR=y(2,(e,t)=>zt(U1(e,t))),Ap=y(2,(e,t)=>zt(z1(e,t))),Zf=e=>e.length===0,yo=e=>e.length>0,Pp=NR(0),Fp=e=>oo(e,0),bs=Fp,NU=e=>NR(e,e.length-1),Qa=e=>oo(e,e.length-1),uc=y(2,(e,t)=>e.backing._tag==="ISingleton"?ft(t(e.backing.a,0)):zt(w(dr(e),so((n,r)=>t(n,r))))),DR=y(2,(e,t)=>[Nc(e,t),Ys(e,t)]),xU=y(2,(e,t)=>{let n=0;for(const r of dr(e)){if(t(r))break;n++}return DR(e,n)}),Xs=e=>Ys(e,1),DU=y(2,(e,t)=>Ys(e,e.length-t)),MU=KS,By=Symbol.for("effect/Duration"),MR=BigInt(0),uk=BigInt(24),Qd=BigInt(60),Hy=BigInt(1e3),lk=BigInt(1e6),fk=BigInt(1e9),LU=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,gr=e=>{if(rv(e))return e;if(mo(e))return fa(e);if(gp(e))return kh(e);if(Array.isArray(e)&&e.length===2&&e.every(mo))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?LR:e[0]===1/0||e[1]===1/0?jR:kh(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Rn(e)){const t=LU.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return kh(BigInt(r));case"micro":case"micros":return BU(BigInt(r));case"milli":case"millis":return fa(o);case"second":case"seconds":return sv(o);case"minute":case"minutes":return UR(o);case"hour":case"hours":return HU(o);case"day":case"days":return VU(o);case"week":case"weeks":return WU(o)}}}throw new Error("Invalid DurationInput")},dk={_tag:"Millis",millis:0},jU={_tag:"Infinity"},UU={[By]:By,[pe](){return at(this,h1(this.value))},[ge](e){return rv(e)&&ZU(this,e)},toString(){return`Duration(${HR(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:JU(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},Yn=e=>{const t=Object.create(UU);return mo(e)?isNaN(e)||e<=0?t.value=dk:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=jU:e<=MR?t.value=dk:t.value={_tag:"Nanos",nanos:e},t},rv=e=>ne(e,By),zU=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===MR;case"Infinity":return!1}},LR=Yn(0),jR=Yn(1/0),kh=e=>Yn(e),BU=e=>Yn(e*Hy),fa=e=>Yn(e),sv=e=>Yn(e*1e3),UR=e=>Yn(e*6e4),HU=e=>Yn(e*36e5),VU=e=>Yn(e*864e5),WU=e=>Yn(e*6048e5),xc=e=>zR(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),KU=e=>{const t=gr(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},JU=e=>{const t=gr(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/fk),Number(t.value.nanos%fk)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},zR=y(2,(e,t)=>{const n=gr(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Np=y(3,(e,t,n)=>{const r=gr(e),s=gr(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(xc(r),xc(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),a=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,a)}return n.onMillis(r.value.millis,s.value.millis)}),BR=(e,t)=>Np(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),GU=y(2,(e,t)=>zR(e,{onMillis:n=>Yn(n*t),onNanos:n=>Yn(n*BigInt(t))})),QU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>Yn(n+r),onNanos:(n,r)=>Yn(n+r)})),YU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),XU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),ZU=y(2,(e,t)=>BR(gr(e),gr(t))),ez=e=>{const t=gr(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=KU(t),r=n/lk,s=r/Hy,o=s/Qd,a=o/Qd,u=a/uk;return{days:Number(u),hours:Number(a%uk),minutes:Number(o%Qd),seconds:Number(s%Qd),millis:Number(r%Hy),nanos:Number(n%lk)}},HR=e=>{const t=gr(e);if(t.value._tag==="Infinity")return"Infinity";if(zU(t))return"0";const n=ez(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},da=5,ov=Math.pow(2,da),tz=ov-1,nz=ov/2,rz=ov/4;function sz(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Dc(e,t){return t>>>e&tz}function lc(e){return 1<<e}function VR(e,t){return sz(e&t-1)}const oz=(e,t)=>({value:e,previous:t});function Sc(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let a=0;a<o;++a)s[a]=r[a]}return s[t]=n,s}function WR(e,t,n){const r=n.length-1;let s=0,o=0,a=n;if(e)s=o=t;else for(a=new Array(r);s<t;)a[o++]=n[s++];for(++s;s<=r;)a[o++]=n[s++];return e&&(a.length=r),a}function iz(e,t,n,r){const s=r.length;if(e){let f=s;for(;f>=t;)r[f--]=r[f];return r[t]=n,r}let o=0,a=0;const u=new Array(s+1);for(;o<t;)u[a++]=r[o++];for(u[t]=n;o<s;)u[++a]=r[o++];return u}class ii{constructor(){d(this,"_tag","EmptyNode")}modify(t,n,r,s,o,a){const u=r(V());return Ft(u)?new ii:(++a.value,new Ki(t,s,o,u))}}function Qr(e){return _p(e,"EmptyNode")}function az(e){return Qr(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function xp(e,t){return Qr(e)?!1:t===e.edit}class Ki{constructor(t,n,r,s){d(this,"edit");d(this,"hash");d(this,"key");d(this,"value");d(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,a){if(de(o,this.key)){const f=r(this.value);return f===this.value?this:Ft(f)?(--a.value,new ii):xp(this,t)?(this.value=f,this):new Ki(t,s,o,f)}const u=r(V());return Ft(u)?this:(++a.value,KR(t,n,this.hash,this,s,new Ki(t,s,o,u)))}}class iv{constructor(t,n,r){d(this,"edit");d(this,"hash");d(this,"children");d(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,a){if(s===this.hash){const f=xp(this,t),h=this.updateCollisionList(f,t,this.hash,this.children,r,o,a);return h===this.children?this:h.length>1?new iv(t,this.hash,h):h[0]}const u=r(V());return Ft(u)?this:(++a.value,KR(t,n,this.hash,this,s,new Ki(t,s,o,u)))}updateCollisionList(t,n,r,s,o,a,u){const f=s.length;for(let p=0;p<f;++p){const g=s[p];if("key"in g&&de(a,g.key)){const k=g.value,T=o(k);return T===k?s:Ft(T)?(--u.value,WR(t,p,s)):Sc(t,p,new Ki(n,r,a,T),s)}}const h=o(V());return Ft(h)?s:(++u.value,Sc(t,f,new Ki(n,r,a,h),s))}}class Mc{constructor(t,n,r){d(this,"edit");d(this,"mask");d(this,"children");d(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,a){const u=this.mask,f=this.children,h=Dc(n,s),p=lc(h),g=VR(u,p),k=u&p,T=xp(this,t);if(!k){const _=new ii().modify(t,n+da,r,s,o,a);return _?f.length>=nz?uz(t,h,_,u,f):new Mc(t,u|p,iz(T,g,_,f)):this}const O=f[g],M=O.modify(t,n+da,r,s,o,a);if(O===M)return this;let E=u,S;if(Qr(M)){if(E&=~p,!E)return new ii;if(f.length<=2&&az(f[g^1]))return f[g^1];S=WR(T,g,f)}else S=Sc(T,g,M,f);return T?(this.mask=E,this.children=S,this):new Mc(t,E,S)}}class av{constructor(t,n,r){d(this,"edit");d(this,"size");d(this,"children");d(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,a){let u=this.size;const f=this.children,h=Dc(n,s),p=f[h],g=(p||new ii).modify(t,n+da,r,s,o,a);if(p===g)return this;const k=xp(this,t);let T;if(Qr(p)&&!Qr(g))++u,T=Sc(k,h,g,f);else if(!Qr(p)&&Qr(g)){if(--u,u<=rz)return cz(t,u,h,f);T=Sc(k,h,new ii,f)}else T=Sc(k,h,g,f);return k?(this.size=u,this.children=T,this):new av(t,u,T)}}function cz(e,t,n,r){const s=new Array(t-1);let o=0,a=0;for(let u=0,f=r.length;u<f;++u)if(u!==n){const h=r[u];h&&!Qr(h)&&(s[o++]=h,a|=1<<u)}return new Mc(e,a,s)}function uz(e,t,n,r,s){const o=[];let a=r,u=0;for(let f=0;a;++f)a&1&&(o[f]=s[u++]),a>>>=1;return o[t]=n,new av(e,u+1,o)}function lz(e,t,n,r,s,o){if(n===s)return new iv(e,n,[o,r]);const a=Dc(t,n),u=Dc(t,s);if(a===u)return f=>new Mc(e,lc(a)|lc(u),[f]);{const f=a<u?[r,o]:[o,r];return new Mc(e,lc(a)|lc(u),f)}}function KR(e,t,n,r,s,o){let a,u=t;for(;;){const f=lz(e,u,n,r,s,o);if(typeof f=="function")a=oz(f,a),u=u+da;else{let h=f;for(;a!=null;)h=a.value(h),a=a.previous;return h}}}const JR="effect/HashMap",Vy=Symbol.for(JR),fz={[Vy]:Vy,[Symbol.iterator](){return new Dp(this,(e,t)=>[e,t])},[pe](){let e=Q(JR);for(const t of this)e^=w(Q(t[0]),ue(Q(t[1])));return at(this,e)},[ge](e){if(mz(e)){if(e._size!==this._size)return!1;for(const t of this){const n=w(e,uv(t[0],Q(t[0])));if(Ft(n))return!1;if(!de(t[1],n.value))return!1}return!0}return!1},toString(){return dt(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(Ot)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},cv=(e,t,n,r)=>{const s=Object.create(fz);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Dp{constructor(t,n){d(this,"map");d(this,"f");d(this,"v");this.map=t,this.f=n,this.v=GR(this.map._root,this.f,void 0)}next(){if(Ft(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=om(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Dp(this.map,this.f)}}const om=e=>e?QR(e[0],e[1],e[2],e[3],e[4]):V(),GR=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return lt(e.value)?W({value:t(e.key,e.value.value),cont:n}):om(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return QR(r.length,r,0,t,n)}default:return om(n)}},QR=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!Qr(o))return GR(o,r,[e,t,n,r,s])}return om(s)},dz=cv(!1,0,new ii,0),Mp=()=>dz,hz=e=>{const t=XR(Mp());for(const n of e)Hl(t,n[0],n[1]);return bz(t)},mz=e=>ne(e,Vy),pz=e=>e&&Qr(e._root),gz=y(2,(e,t)=>uv(e,t,Q(t))),uv=y(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return de(t,r.key)?r.value:V();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let a=0,u=o.length;a<u;++a){const f=o[a];if("key"in f&&de(t,f.key))return f.value}}return V()}case"IndexedNode":{const o=Dc(s,n),a=lc(o);if(r.mask&a){r=r.children[VR(r.mask,a)],s+=da;break}return V()}case"ArrayNode":{if(r=r.children[Dc(s,n)],r){s+=da;break}return V()}default:return V()}}),_z=y(2,(e,t)=>lt(uv(e,t,Q(t)))),Hl=y(3,(e,t,n)=>lv(e,t,()=>W(n))),yz=y(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:cv(e._editable,e._edit,t,n)),YR=e=>new Dp(e,t=>t),im=e=>e._size,XR=e=>cv(!0,e._edit+1,e._root,e._size),bz=e=>(e._editable=!1,e),lv=y(3,(e,t,n)=>Sz(e,t,Q(t),n)),Sz=y(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return w(e,yz(o,s.value))}),hk=y(2,(e,t)=>lv(e,t,V)),vz=y(2,(e,t)=>Lp(e,Mp(),(n,r,s)=>Hl(n,s,t(r,s)))),ZR=y(2,(e,t)=>Lp(e,void 0,(n,r,s)=>t(r,s))),Lp=y(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return lt(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let a=0,u=o.length;a<u;){const f=o[a++];f&&!Qr(f)&&(f._tag==="LeafNode"?lt(f.value)&&(t=n(t,f.value.value,f.key)):s.push(f.children))}return t}),eO="effect/HashSet",Wy=Symbol.for(eO),wz={[Wy]:Wy,[Symbol.iterator](){return YR(this._keyMap)},[pe](){return at(this,ue(Q(this._keyMap))(Q(eO)))},[ge](e){return Ez(e)?im(this._keyMap)===im(e._keyMap)&&de(this._keyMap,e._keyMap):!1},toString(){return dt(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(Ot)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},jp=e=>{const t=Object.create(wz);return t._keyMap=e,t},Ez=e=>ne(e,Wy),kz=jp(Mp()),Up=()=>kz,$z=e=>{const t=fv(Up());for(const n of e)Vl(t,n);return dv(t)},Cz=(...e)=>{const t=fv(Up());for(const n of e)Vl(t,n);return dv(t)},Tz=y(2,(e,t)=>_z(e._keyMap,t)),Iz=e=>im(e._keyMap),fv=e=>jp(XR(e._keyMap)),dv=e=>(e._keyMap._editable=!1,e),tO=y(2,(e,t)=>{const n=fv(e);return t(n),dv(n)}),Vl=y(2,(e,t)=>e._keyMap._editable?(Hl(t,!0)(e._keyMap),e):jp(Hl(t,!0)(e._keyMap))),nO=y(2,(e,t)=>e._keyMap._editable?(hk(t)(e._keyMap),e):jp(hk(t)(e._keyMap))),Rz=y(2,(e,t)=>tO(e,n=>{for(const r of t)nO(n,r)})),Oz=y(2,(e,t)=>tO(Up(),n=>{qz(e,r=>Vl(n,r));for(const r of t)Vl(n,r)})),qz=y(2,(e,t)=>ZR(e._keyMap,(n,r)=>t(r))),Az=y(3,(e,t,n)=>Lp(e._keyMap,t,(r,s,o)=>n(r,o))),ha=Up,Pz=$z,zp=Cz,Bp=Tz,hv=Iz,vc=Vl,mv=nO,mk=Rz,Wl=Oz,Kl=Az,pk=Symbol.for("effect/MutableRef"),Fz={[pk]:pk,toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableRef",current:Ot(this.current)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},Ia=e=>{const t=Object.create(Fz);return t.current=e,t},Nz=y(3,(e,t,n)=>de(t,e.current)?(e.current=n,!0):!1),ze=e=>e.current,Ra=y(2,(e,t)=>(e.current=t,e)),Hp="effect/FiberId",ma=Symbol.for(Hp),Lc="None",Ky="Runtime",Jy="Composite",xz=Tt(`${Hp}-${Lc}`);var dT;let Dz=class{constructor(){d(this,dT,ma);d(this,"_tag",Lc);d(this,"id",-1);d(this,"startTimeMillis",-1)}[(dT=ma,pe)](){return xz}[ge](t){return gv(t)&&t._tag===Lc}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[Ue](){return this.toJSON()}};var hT;class pv{constructor(t,n){d(this,"id");d(this,"startTimeMillis");d(this,hT,ma);d(this,"_tag",Ky);this.id=t,this.startTimeMillis=n}[(hT=ma,pe)](){return at(this,Tt(`${Hp}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[ge](t){return gv(t)&&t._tag===Ky&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[Ue](){return this.toJSON()}}var mT;let rO=class{constructor(t,n){d(this,"left");d(this,"right");d(this,mT,ma);d(this,"_tag",Jy);d(this,"_hash");this.left=t,this.right=n}[(mT=ma,pe)](){return w(Tt(`${Hp}-${this._tag}`),ue(Q(this.left)),ue(Q(this.right)),at(this))}[ge](t){return gv(t)&&t._tag===Jy&&de(this.left,t.left)&&de(this.right,t.right)}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:Ot(this.left),right:Ot(this.right)}}[Ue](){return this.toJSON()}};const sO=new Dz,Mz=(e,t)=>new pv(e,t),Lz=(e,t)=>new rO(e,t),gv=e=>ne(e,ma),oO=y(2,(e,t)=>e._tag===Lc?t:t._tag===Lc?e:new rO(e,t)),jz=e=>w(e,Kl(sO,(t,n)=>oO(n)(t))),am=e=>{switch(e._tag){case Lc:return ha();case Ky:return zp(e.id);case Jy:return w(am(e.left),Wl(am(e.right)))}},gk=Ee(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Ia(0)),Uz=(e,t)=>new pv(e,t),Vp=e=>Array.from(am(e)).map(n=>`#${n}`).join(","),zz=()=>{const e=ze(gk);return w(gk,Ra(e+1)),new pv(e,Date.now())},jn=sO,Bz=Mz,Hz=Lz,hr=oO,Vz=jz,Wp=am,_v=Uz,Wz=Vp,iO=zz,Kp=Mp,Kz=hz,Jz=pz,aO=gz,jc=Hl,cO=YR,uO=im,Gz=lv,Qz=vz,Yz=ZR,lO=Lp,Jl=Symbol.for("effect/List"),Gy=e=>je(e),Xz=e=>i1(Kf(e),Gy),Zz=Xz(de),eB={[Jl]:Jl,_tag:"Cons",toString(){return dt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Gy(this).map(Ot)}},[Ue](){return this.toJSON()},[ge](e){return dO(e)&&this._tag===e._tag&&Zz(this,e)},[pe](){return at(this,Bf(Gy(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return ee(this,arguments)}},cm=(e,t)=>{const n=Object.create(eB);return n.head=e,n.tail=t,n},tB=Tt("Nil"),nB={[Jl]:Jl,_tag:"Nil",toString(){return dt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[Ue](){return this.toJSON()},[pe](){return tB},[ge](e){return dO(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return ee(this,arguments)}},fO=Object.create(nB),dO=e=>ne(e,Jl),io=e=>e._tag==="Nil",yv=e=>e._tag==="Cons",rB=()=>fO,pa=(e,t)=>cm(e,t),Uc=rB,bv=e=>cm(e,fO),sB=y(2,(e,t)=>iB(t,e)),oB=y(2,(e,t)=>pa(t,e)),iB=y(2,(e,t)=>{if(io(e))return t;if(io(t))return e;{const n=cm(t.head,e);let r=n,s=t.tail;for(;!io(s);){const o=cm(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),aB=y(3,(e,t,n)=>{let r=t,s=e;for(;!io(s);)r=n(r,s.head),s=s.tail;return r}),cB=e=>{let t=Uc(),n=e;for(;!io(n);)t=oB(t,n.head),n=n.tail;return t},Jp=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=US,e}(),uB=Symbol.for("effect/DifferContextPatch");function _k(e){return e}const ed={...Jp.prototype,[uB]:{_Value:_k,_Patch:_k}},lB=Object.assign(Object.create(ed),{_tag:"Empty"}),fB=Object.create(lB),hO=()=>fB,dB=Object.assign(Object.create(ed),{_tag:"AndThen"}),hB=(e,t)=>{const n=Object.create(dB);return n.first=e,n.second=t,n},mB=Object.assign(Object.create(ed),{_tag:"AddService"}),pB=(e,t)=>{const n=Object.create(mB);return n.key=e,n.service=t,n},gB=Object.assign(Object.create(ed),{_tag:"RemoveService"}),_B=e=>{const t=Object.create(gB);return t.key=e,t},yB=Object.assign(Object.create(ed),{_tag:"UpdateService"}),bB=(e,t)=>{const n=Object.create(yB);return n.key=e,n.update=t,n},SB=(e,t)=>{const n=new Map(e.unsafeMap);let r=hO();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const a=n.get(s);n.delete(s),de(a,o)||(r=$h(bB(s,()=>o))(r))}else n.delete(s),r=$h(pB(s,o))(r);for(const[s]of n.entries())r=$h(_B(s))(r);return r},$h=y(2,(e,t)=>hB(e,t)),vB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=ft(e);const s=new Map(t.unsafeMap);for(;yo(r);){const a=bs(r),u=Xs(r);switch(a._tag){case"Empty":{r=u;break}case"AddService":{s.set(a.key,a.service),r=u;break}case"AndThen":{r=wn(wn(u,a.second),a.first);break}case"RemoveService":{s.delete(a.key),r=u;break}case"UpdateService":{s.set(a.key,a.update(s.get(a.key))),n=!0,r=u;break}}}if(!n)return la(s);const o=new Map;for(const[a]of t.unsafeMap)s.has(a)&&(o.set(a,s.get(a)),s.delete(a));for(const[a,u]of s)o.set(a,u);return la(o)}),wB=Symbol.for("effect/DifferHashSetPatch");function J_(e){return e}const Gp={...Jp.prototype,[wB]:{_Value:J_,_Key:J_,_Patch:J_}},EB=Object.assign(Object.create(Gp),{_tag:"Empty"}),kB=Object.create(EB),mO=()=>kB,$B=Object.assign(Object.create(Gp),{_tag:"AndThen"}),CB=(e,t)=>{const n=Object.create($B);return n.first=e,n.second=t,n},TB=Object.assign(Object.create(Gp),{_tag:"Add"}),IB=e=>{const t=Object.create(TB);return t.value=e,t},RB=Object.assign(Object.create(Gp),{_tag:"Remove"}),OB=e=>{const t=Object.create(RB);return t.value=e,t},qB=(e,t)=>{const[n,r]=Kl([e,mO()],([s,o],a)=>Bp(a)(s)?[mv(a)(s),o]:[s,Qy(IB(a))(o)])(t);return Kl(r,(s,o)=>Qy(OB(o))(s))(n)},Qy=y(2,(e,t)=>CB(e,t)),AB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=ft(e);for(;yo(r);){const s=bs(r),o=Xs(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=wn(s.first)(wn(s.second)(o));break}case"Add":{n=vc(s.value)(n),r=o;break}case"Remove":n=mv(s.value)(n),r=o}}return n}),PB=Symbol.for("effect/DifferReadonlyArrayPatch");function yk(e){return e}const td={...Jp.prototype,[PB]:{_Value:yk,_Patch:yk}},FB=Object.assign(Object.create(td),{_tag:"Empty"}),NB=Object.create(FB),pO=()=>NB,xB=Object.assign(Object.create(td),{_tag:"AndThen"}),DB=(e,t)=>{const n=Object.create(xB);return n.first=e,n.second=t,n},MB=Object.assign(Object.create(td),{_tag:"Append"}),LB=e=>{const t=Object.create(MB);return t.values=e,t},jB=Object.assign(Object.create(td),{_tag:"Slice"}),UB=(e,t)=>{const n=Object.create(jB);return n.from=e,n.until=t,n},zB=Object.assign(Object.create(td),{_tag:"Update"}),BB=(e,t)=>{const n=Object.create(zB);return n.index=e,n.patch=t,n},HB=e=>{let t=0,n=pO();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);de(o,e.differ.empty)||(n=Ch(n,BB(t,o))),t=t+1}return t<e.oldValue.length&&(n=Ch(n,UB(0,t))),t<e.newValue.length&&(n=Ch(n,LB(JL(t)(e.newValue)))),n},Ch=y(2,(e,t)=>DB(e,t)),VB=y(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=cr(e);for(;bh(s);){const o=Ln(s),a=aa(s);switch(o._tag){case"Empty":{s=a;break}case"AndThen":{a.unshift(o.first,o.second),s=a;break}case"Append":{for(const u of o.values)r.push(u);s=a;break}case"Slice":{r=r.slice(o.from,o.until),s=a;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=a;break}}}return r}),WB=Symbol.for("effect/Differ"),KB={[WB]:{_P:ie,_V:ie},pipe(){return ee(this,arguments)}},yu=e=>{const t=Object.create(KB);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},JB=()=>yu({empty:hO(),combine:(e,t)=>$h(t)(e),diff:(e,t)=>SB(e,t),patch:(e,t)=>vB(t)(e)}),GB=()=>yu({empty:mO(),combine:(e,t)=>Qy(t)(e),diff:(e,t)=>qB(e,t),patch:(e,t)=>AB(t)(e)}),QB=e=>yu({empty:pO(),combine:(t,n)=>Ch(t,n),diff:(t,n)=>HB({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>VB(t,n,e)}),gO=()=>YB((e,t)=>t),YB=e=>yu({empty:ie,combine:(t,n)=>t===ie?n:n===ie?t:r=>n(t(r)),diff:(t,n)=>de(t,n)?ie:mp(n),patch:(t,n)=>e(n,t(n))}),Gl=255,_O=8,Yy=e=>e&Gl,Xy=e=>e>>_O&Gl,nd=(e,t)=>(e&Gl)+((t&e&Gl)<<_O),XB=nd(0,0),ZB=e=>nd(e,e),eH=e=>nd(e,0),tH=y(2,(e,t)=>nd(Yy(e)&~t,Xy(e))),nH=y(2,(e,t)=>e|t),rH=e=>~e>>>0&Gl,sH=0,bu=1,oH=2,yO=4,Zy=16,bO=32,iH=e=>Qp(e,bO),aH=y(2,(e,t)=>e|t),Wo=e=>SO(e)&&!uH(e),SO=e=>Qp(e,bu),Qp=y(2,(e,t)=>(e&t)!==0),vO=(...e)=>e.reduce((t,n)=>t|n,0),cH=vO(sH),bk=e=>Qp(e,yO),uH=e=>Qp(e,Zy),ei=y(2,(e,t)=>nd(e^t,t)),wc=y(2,(e,t)=>e&(rH(Yy(t))|Xy(t))|Yy(t)&Xy(t)),Sk=yu({empty:XB,diff:(e,t)=>ei(e,t),combine:(e,t)=>nH(t)(e),patch:(e,t)=>wc(t,e)}),lH=ZB,wO=eH,vk=tH,EO=(e,t)=>({_tag:"Par",left:e,right:t}),Yd=(e,t)=>({_tag:"Seq",left:e,right:t}),fH=e=>{let t=bv(e),n=Uc();for(;;){const[r,s]=aB(t,[kO(),Uc()],([o,a],u)=>{const[f,h]=dH(u);return[_H(o,f),sB(a,h)]});if(n=hH(n,r),io(s))return cB(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},dH=e=>{let t=e,n=kO(),r=Uc(),s=Uc();for(;;)switch(t._tag){case"Empty":{if(io(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=pa(t.right,r),t=t.left;break}case"Seq":{const o=t.left,a=t.right;switch(o._tag){case"Empty":{t=a;break}case"Par":{const u=o.left,f=o.right;t=EO(Yd(u,a),Yd(f,a));break}case"Seq":{const u=o.left,f=o.right;t=Yd(u,Yd(f,a));break}case"Single":{t=o,s=pa(a,s);break}}break}case"Single":{if(n=gH(n,t),io(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},hH=(e,t)=>{if(io(e))return bv(G_(t));if(yH(t))return e;const n=kH(e.head),r=bH(t);return n.length===1&&r.length===1&&de(n[0],r[0])?pa(EH(e.head,G_(t)),e.tail):pa(G_(t),e)},mH=Symbol.for("effect/RequestBlock/RequestBlockParallel"),pH={_R:e=>e};var pT;pT=mH;class Sv{constructor(t){d(this,"map");d(this,pT,pH);this.map=t}}const kO=()=>new Sv(Kp()),gH=(e,t)=>new Sv(Gz(e.map,t.dataSource,n=>vL(Zo(n,Bl(t.blockedRequest)),()=>ft(t.blockedRequest)))),_H=(e,t)=>new Sv(lO(e.map,t.map,(n,r,s)=>jc(n,s,st(aO(n,s),{onNone:()=>r,onSome:o=>Rt(r,o)})))),yH=e=>Jz(e.map),bH=e=>Array.from(cO(e.map)),G_=e=>wH(Qz(e.map,t=>ft(t))),SH=Symbol.for("effect/RequestBlock/RequestBlockSequential"),vH={_R:e=>e};var gT;gT=SH;class $O{constructor(t){d(this,"map");d(this,gT,vH);this.map=t}}const wH=e=>new $O(e),EH=(e,t)=>new $O(lO(t.map,e.map,(n,r,s)=>jc(n,s,st(aO(n,s),{onNone:()=>yt(),onSome:o=>Rt(o,r)})))),kH=e=>Array.from(cO(e.map)),$H=e=>Array.from(e.map),Su="Die",ga="Empty",Oa="Fail",vu="Interrupt",zc="Parallel",Bc="Sequential",CO="effect/Cause",TO=Symbol.for(CO),CH={_E:e=>e},wu={[TO]:CH,[pe](){return w(Q(CO),ue(Q(NH(this))),at(this))},[ge](e){return vv(e)&&FH(this,e)},pipe(){return ee(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:Ot(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:Ot(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:Ot(this.left),right:Ot(this.right)}}},toString(){return _i(this)},[Ue](){return this.toJSON()}},bo=(()=>{const e=Object.create(wu);return e._tag=ga,e})(),_a=e=>{const t=Object.create(wu);return t._tag=Oa,t.error=e,t},Un=e=>{const t=Object.create(wu);return t._tag=Su,t.defect=e,t},$r=e=>{const t=Object.create(wu);return t._tag=vu,t.fiberId=e,t},So=(e,t)=>{const n=Object.create(wu);return n._tag=zc,n.left=e,n.right=t,n},Yt=(e,t)=>{const n=Object.create(wu);return n._tag=Bc,n.left=e,n.right=t,n},vv=e=>ne(e,TO),TH=e=>e._tag===ga,IH=e=>e._tag===Oa,wv=e=>e._tag===Su,Ev=e=>e._tag===ga?!0:Hc(e,!0,(t,n)=>{switch(n._tag){case ga:return W(t);case Su:case Oa:case vu:return W(!1);default:return V()}}),kv=e=>lt(qH(e)),Yp=e=>tg(void 0,DH)(e),RH=e=>_o(Hc(e,yt(),(t,n)=>n._tag===Oa?W(w(t,wn(n.error))):V())),IO=e=>_o(Hc(e,yt(),(t,n)=>n._tag===Su?W(w(t,wn(n.defect))):V())),$v=e=>Hc(e,ha(),(t,n)=>n._tag===vu?W(w(t,vc(n.fiberId))):V()),RO=e=>Zp(e,t=>t._tag===Oa?W(t.error):V()),Xp=e=>{const t=RO(e);switch(t._tag){case"None":return ce(e);case"Some":return oe(t.value)}},OH=e=>eg(e,{onEmpty:W(bo),onFail:Zo(_a),onDie:t=>W(Un(t)),onInterrupt:t=>W($r(t)),onSequential:Q0(Yt),onParallel:Q0(So)}),qH=e=>Zp(e,t=>t._tag===vu?W(t.fiberId):V()),wk=e=>eg(e,{onEmpty:bo,onFail:()=>bo,onDie:Un,onInterrupt:$r,onSequential:Yt,onParallel:So}),AH=e=>eg(e,{onEmpty:bo,onFail:Un,onDie:Un,onInterrupt:$r,onSequential:Yt,onParallel:So}),OO=y(2,(e,t)=>PH(e,n=>_a(t(n)))),PH=y(2,(e,t)=>eg(e,{onEmpty:bo,onFail:n=>t(n),onDie:n=>Un(n),onInterrupt:n=>$r(n),onSequential:(n,r)=>Yt(n,r),onParallel:(n,r)=>So(n,r)})),FH=(e,t)=>{let n=ft(e),r=ft(t);for(;yo(n)&&yo(r);){const[s,o]=w(bs(n),Hc([ha(),yt()],([f,h],p)=>{const[g,k]=eb(p);return W([w(f,Wl(g)),w(h,Rt(k))])})),[a,u]=w(bs(r),Hc([ha(),yt()],([f,h],p)=>{const[g,k]=eb(p);return W([w(f,Wl(g)),w(h,Rt(k))])}));if(!de(s,a))return!1;n=o,r=u}return!0},NH=e=>xH(ft(e),yt()),xH=(e,t)=>{for(;;){const[n,r]=w(e,KS([ha(),yt()],([o,a],u)=>{const[f,h]=eb(u);return[w(o,Wl(f)),w(a,Rt(h))]})),s=hv(n)>0?w(t,wn(n)):t;if(Zf(r))return _o(s);e=r,t=s}throw new Error(yp("Cause.flattenCauseLoop"))},Zp=y(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Bc:case zc:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return V()}),eb=e=>{let t=e;const n=[];let r=ha(),s=yt();for(;t!==void 0;)switch(t._tag){case ga:{if(n.length===0)return[r,s];t=n.pop();break}case Oa:{if(r=vc(r,K_(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case Su:{if(r=vc(r,K_(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case vu:{if(r=vc(r,K_(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Bc:{switch(t.left._tag){case ga:{t=t.right;break}case Bc:{t=Yt(t.left.left,Yt(t.left.right,t.right));break}case zc:{t=So(Yt(t.left.left,t.right),Yt(t.left.right,t.right));break}default:{s=wn(s,t.right),t=t.left;break}}break}case zc:{n.push(t.right),t=t.left;break}}throw new Error(yp("Cause.evaluateCauseLoop"))},DH={emptyCase:J0,failCase:Jn,dieCase:Jn,interruptCase:J0,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},Ek="SequentialCase",kk="ParallelCase",eg=y(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:a})=>tg(e,void 0,{emptyCase:()=>n,failCase:(u,f)=>r(f),dieCase:(u,f)=>t(f),interruptCase:(u,f)=>s(f),sequentialCase:(u,f,h)=>a(f,h),parallelCase:(u,f,h)=>o(f,h)})),Hc=y(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const a=n(r,s);switch(r=lt(a)?a.value:r,s._tag){case Bc:{o.push(s.right),s=s.left;break}case zc:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),tg=y(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const a=r.pop();switch(a._tag){case ga:{s.push(ce(n.emptyCase(t)));break}case Oa:{s.push(ce(n.failCase(t,a.error)));break}case Su:{s.push(ce(n.dieCase(t,a.defect)));break}case vu:{s.push(ce(n.interruptCase(t,a.fiberId)));break}case Bc:{r.push(a.right),r.push(a.left),s.push(oe({_tag:Ek}));break}case zc:{r.push(a.right),r.push(a.left),s.push(oe({_tag:kk}));break}}}const o=[];for(;s.length>0;){const a=s.pop();switch(a._tag){case"Left":{switch(a.left._tag){case Ek:{const u=o.pop(),f=o.pop(),h=n.sequentialCase(t,u,f);o.push(h);break}case kk:{const u=o.pop(),f=o.pop(),h=n.parallelCase(t,u,f);o.push(h);break}}break}case"Right":{o.push(a.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),_i=(e,t)=>Yp(e)?"All fibers interrupted without errors.":Cv(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${qO(n.cause,"  ")}
}`}).join(`
`),qO=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${qO(e.cause,`${t}  `)}
${t}}`),r};class um extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(AO(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new um(n.cause)}:void 0);d(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(Vc in n&&(this.span=n[Vc]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=LH(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const AO=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(ne(e,"toString")&&fu(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return m1(e)},MH=/\((.*)\)/g,lm=Ee("effect/Tracer/spanToTrace",()=>new WeakMap),LH=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,a=0;for(;o&&o._tag==="Span"&&a<10;){const u=lm.get(o);if(typeof u=="function"){const f=u();if(typeof f=="string"){const h=f.matchAll(MH);let p=!1;for(const[,g]of h)p=!0,r.push(`    at ${o.name} (${g})`);p||r.push(`    at ${o.name} (${f.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=lr(o.parent),a++}}return r.join(`
`)},Vc=Symbol.for("effect/SpanAnnotation"),Cv=e=>tg(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new um(n)],failCase:(t,n)=>[new um(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),rd="Pending",ng="Done",jH="effect/Deferred",UH=Symbol.for(jH),zH={_E:e=>e,_A:e=>e},BH=e=>({_tag:rd,joiners:e}),PO=e=>({_tag:ng,effect:e});class Eu{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new Eu(this.self)}}const FO=(e,t)=>{const n=new en("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},HH=e=>{const t=new en("RunBlocked");return t.effect_instruction_i0=e,t},ya=Symbol.for("effect/Effect");class VH{constructor(t,n){d(this,"patch");d(this,"op");d(this,"_op",jS);this.patch=t,this.op=n}}var _T;class en{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,_T,oa);this._op=t}[(_T=ya,ge)](t){return this===t}[pe](){return at(this,bp(this))}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:Ot(this.effect_instruction_i0),effect_instruction_i1:Ot(this.effect_instruction_i1),effect_instruction_i2:Ot(this.effect_instruction_i2)}}toString(){return dt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new Eu(new du(this))}}var yT;class NO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,yT,oa);this._op=t,this._tag=t}[(yT=ya,ge)](t){return pg(t)&&t._op==="Failure"&&de(this.effect_instruction_i0,t.effect_instruction_i0)}[pe](){return w(Tt(this._tag),ue(Q(this.effect_instruction_i0)),at(this))}get cause(){return this.effect_instruction_i0}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return dt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new Eu(new du(this))}}var bT;class xO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,bT,oa);this._op=t,this._tag=t}[(bT=ya,ge)](t){return pg(t)&&t._op==="Success"&&de(this.effect_instruction_i0,t.effect_instruction_i0)}[pe](){return w(Tt(this._tag),ue(Q(this.effect_instruction_i0)),at(this))}get value(){return this.effect_instruction_i0}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:Ot(this.value)}}toString(){return dt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new Eu(new du(this))}}const yr=e=>ne(e,ya),qe=e=>{const t=new en(_1);return t.effect_instruction_i0=e,t},DO=y(3,(e,t,n)=>_r(r=>U(e,s=>U(Es(he(()=>r(t(s)))),o=>he(()=>n(s,o)).pipe(Bn({onFailure:a=>{switch(o._tag){case cn:return $t(Yt(o.effect_instruction_i0,a));case un:return $t(a)}},onSuccess:()=>o})))))),Xt=y(2,(e,t)=>U(e,()=>J(t))),nr=e=>Xt(e,void 0),MO=function(){const e=new en(Hf);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(yp("you're not supposed to end up here"))}return e},Ql=(e,t=jn)=>{const n=new en(El);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,Aa(n,s=>yr(r)?r:Je)},Go=(e,t=jn)=>he(()=>Ql(e,t)),ts=(e,t=jn)=>MO(e,function(){let n,r;function s(f){n?n(f):r===void 0&&(r=f)}const o=new en(El);o.effect_instruction_i0=f=>{n=f,r&&f(r)},o.effect_instruction_i1=t;let a,u;return this.effect_instruction_i0.length!==1?(u=new AbortController,a=gt(()=>this.effect_instruction_i0(s,u.signal))):a=gt(()=>this.effect_instruction_i0(s)),a||u?Aa(o,f=>(u&&u.abort(),a??Je)):o}),rg=y(2,(e,t)=>{const n=new en(_h);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),Wc=y(2,(e,t)=>vo(e,{onFailure:t,onSuccess:J})),LO=y(3,(e,t,n)=>rg(e,r=>{const s=Xp(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):$t(r);case"Right":return $t(s.right)}})),$k=Symbol.for("effect/OriginalAnnotation"),Tv=(e,t)=>lt(t)?new Proxy(e,{has(n,r){return r===Vc||r===$k||r in n},get(n,r){return r===Vc?t.value:r===$k?e:n[r]}}):e,Yl=e=>Ms(e)&&!(Vc in e)?qe(t=>$t(Un(Tv(e,Lv(t))))):$t(Un(e)),tb=e=>jO(()=>Un(new $4(e))),Kc=e=>vo(e,{onFailure:t=>J(oe(t)),onSuccess:t=>J(ce(t))}),Es=e=>UO(e,{onFailure:rt,onSuccess:Ke}),St=e=>Ms(e)&&!(Vc in e)?qe(t=>$t(_a(Tv(e,Lv(t))))):$t(_a(e)),sd=e=>U(K(e),St),$t=e=>{const t=new NO(cn);return t.effect_instruction_i0=e,t},jO=e=>U(K(e),$t),sg=qe(e=>J(e.id())),qa=e=>qe(t=>e(t.id())),U=y(2,(e,t)=>{const n=new en(Jh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),WH=y(2,(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return yr(r)?r:c1(r)?Ql(s=>{r.then(o=>s(J(o)),o=>s(St(new mg(o,"An unknown error occurred in Effect.andThen"))))}):J(r)})),KH=e=>{const t=new en("OnStep");return t.effect_instruction_i0=e,t},ku=e=>U(e,ie),UO=y(2,(e,t)=>Bn(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),Bn=y(2,(e,t)=>{const n=new en(Gh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),vo=y(2,(e,t)=>Bn(e,{onFailure:n=>{if(IO(n).length>0)return $t(AH(n));const s=RH(n);return s.length>0?t.onFailure(Fp(s)):$t(n)},onSuccess:t.onSuccess})),Zs=y(2,(e,t)=>he(()=>{const n=je(e),r=Ep(n.length);let s=0;return Xt(Ov({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Jc=y(2,(e,t)=>he(()=>{const n=je(e);let r=0;return Ov({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),dn=U(sg,e=>zO(e)),zO=e=>$t($r(e)),og=e=>{const t=new en(hu);return t.effect_instruction_i0=lH(bu),t.effect_instruction_i1=()=>e,t},BO=y(2,(e,t)=>_r(n=>U(Es(n(e)),r=>rq(t,r)))),_e=y(2,(e,t)=>U(e,n=>K(()=>t(n)))),Iv=y(2,(e,t)=>vo(e,{onFailure:n=>sd(()=>t.onFailure(n)),onSuccess:n=>K(()=>t.onSuccess(n))})),ig=y(2,(e,t)=>Bn(e,{onFailure:n=>{const r=Xp(n);switch(r._tag){case"Left":return sd(()=>t(r.left));case"Right":return $t(r.right)}},onSuccess:J})),JH=y(2,(e,t)=>Is(e,n=>tq(n)?Je:t(n.effect_instruction_i0))),Is=y(2,(e,t)=>_r(n=>Bn(n(e),{onFailure:r=>{const s=rt(r);return Bn(t(s),{onFailure:o=>rt(Yt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=Ke(r);return It(t(s),s)}}))),Aa=y(2,(e,t)=>Is(e,gg({onFailure:n=>Yp(n)?nr(t($v(n))):Je,onSuccess:()=>Je}))),Rv=e=>GH(e,ie),GH=y(2,(e,t)=>vo(e,{onFailure:n=>Yl(t(n)),onSuccess:J})),QH=qe((e,t)=>J(t.runtimeFlags)),J=e=>{const t=new xO(un);return t.effect_instruction_i0=e,t},he=e=>{const t=new en(Hf);return t.commit=e,t},K=e=>{const t=new en(g1);return t.effect_instruction_i0=e,t},ag=y(e=>e.length===3||e.length===2&&!(Ms(e[1])&&"onlyEffect"in e[1]),(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return yr(r)?Xt(r,n):c1(r)?Ql(s=>{r.then(o=>s(J(n)),o=>s(St(new mg(o,"An unknown error occurred in Effect.tap"))))}):J(n)})),YH=e=>qe(t=>{const n=t.getFiberRef(rb),r=w(n,Et(()=>t.scope()));return e(Ao(rb,W(r)))}),yi=e=>{const t=new en(hu);return t.effect_instruction_i0=wO(bu),t.effect_instruction_i1=()=>e,t},_r=e=>MO(e,function(){const t=new en(hu);return t.effect_instruction_i0=wO(bu),t.effect_instruction_i1=n=>SO(n)?gt(()=>this.effect_instruction_i0(og)):gt(()=>this.effect_instruction_i0(yi)),t}),Je=J(void 0),HO=e=>{const t=new en(hu);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},od=y(2,(e,t)=>U(t,n=>n?w(e,_e(W)):J(V()))),Ov=e=>{const t=new en(Qh);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},fm=e=>he(()=>{const t=new en(kl);return t.effect_instruction_i0=e(),t}),XH=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return fm(()=>e(w))},ZH=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return fm(()=>e.apply(this,n))}:function(...n){let r=fm(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),e4=y(2,(e,t)=>{const n=new en(hu);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),cg=e=>{const t=new en(yh);return typeof(e==null?void 0:e.priority)<"u"?_4(t,e.priority):t},ug=y(2,(e,t)=>U(e,n=>_e(t,r=>[n,r]))),qv=y(2,(e,t)=>U(e,n=>Xt(t,n))),It=y(2,(e,t)=>U(e,()=>t)),VO=y(3,(e,t,n)=>U(e,r=>_e(t,s=>n(r,s)))),t4=Go(()=>{const e=setInterval(()=>{},2147483647);return K(()=>clearInterval(e))}),Av=e=>U(sg,t=>w(e,eo(t))),eo=y(2,(e,t)=>U(e.interruptAsFork(t),()=>e.await)),n4={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return ee(this,arguments)}},r4={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return ee(this,arguments)}},s4={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return ee(this,arguments)}},o4={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return ee(this,arguments)}},WO={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return ee(this,arguments)}},KO={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return ee(this,arguments)}},i4={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return ee(this,arguments)}},a4={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return ee(this,arguments)}},c4="effect/FiberRef",u4=Symbol.for(c4),l4={_A:e=>e},id=e=>qe(t=>Ke(t.getFiberRef(e))),$u=y(2,(e,t)=>U(id(e),t)),dm=y(2,(e,t)=>f4(e,()=>[void 0,t])),f4=y(2,(e,t)=>qe(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),J(r)})),Ao=y(3,(e,t,n)=>DO(qv(id(t),dm(t,n)),()=>e,r=>dm(t,r))),lg=y(3,(e,t,n)=>$u(t,r=>Ao(e,t,n(r)))),gn=(e,t)=>Cu(e,{differ:gO(),fork:(t==null?void 0:t.fork)??ie,join:t==null?void 0:t.join}),d4=e=>{const t=GB();return Cu(e,{differ:t,fork:t.empty})},h4=e=>{const t=QB(gO());return Cu(e,{differ:t,fork:t.empty})},JO=e=>{const t=JB();return Cu(e,{differ:t,fork:t.empty})},Cu=(e,t)=>({...Wf,[u4]:l4,initial:e,commit(){return id(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),m4=e=>Cu(e,{differ:Sk,fork:Sk.empty}),ss=Ee(Symbol.for("effect/FiberRef/currentContext"),()=>JO(po())),bi=Ee(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>gn(0)),fg=Ee(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>gn(2048)),GO=Ee(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>gn(Kp())),p4=Ee(Symbol.for("effect/FiberRef/currentLogLevel"),()=>gn(WO)),g4=Ee(Symbol.for("effect/FiberRef/currentLogSpan"),()=>gn(Uc())),_4=y(2,(e,t)=>Ao(e,bi,t)),y4=y(2,(e,t)=>Ao(e,fg,t)),b4=Ee(Symbol.for("effect/FiberRef/currentConcurrency"),()=>gn("unbounded")),S4=Ee(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>gn(!0)),QO=Ee(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>gn(W(KO))),v4=y(2,(e,t)=>Ao(e,QO,t)),nb=Ee(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>h4(oi())),rb=Ee(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>gn(V(),{fork:()=>V(),join:(e,t)=>e})),Xd=Ee(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>gn(bo,{fork:()=>bo,join:(e,t)=>e})),YO=Ee(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>gn(!0)),dg=Ee(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>gn(!0)),XO=Ee(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>gn(Kp())),w4=Ee(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>gn(yt())),Ck=Symbol.for("effect/Scope"),Tk=Symbol.for("effect/CloseableScope"),ZO=(e,t)=>e.addFinalizer(()=>nr(t)),Xl=(e,t)=>e.addFinalizer(t),sb=(e,t)=>e.close(t),hg=(e,t)=>e.fork(t),E4=e=>k4(ie)(e),k4=y(2,(e,t)=>{const n=w(e,RO,Zo(t));switch(n._tag){case"None":return w(IO(e),Pp,st({onNone:()=>{const r=je($v(e)).flatMap(s=>je(Wp(s)).map(o=>`#${o}`));return new C4(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:ie}));case"Some":return n.value}}),Pv=function(){class e extends globalThis.Error{commit(){return St(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[Ue](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?_i(_a(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,oL),e}(),ad=(e,t)=>{class n extends Pv{constructor(){super(...arguments);d(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},Ik=Symbol.for("effect/Cause/errors/RuntimeException"),$4=ad({[Ik]:Ik},"RuntimeException"),ob=Symbol.for("effect/Cause/errors/InterruptedException"),C4=ad({[ob]:ob},"InterruptedException"),T4=e=>ne(e,ob),Rk=Symbol.for("effect/Cause/errors/IllegalArgument"),I4=ad({[Rk]:Rk},"IllegalArgumentException"),Ok=Symbol.for("effect/Cause/errors/NoSuchElement"),cd=ad({[Ok]:Ok},"NoSuchElementException"),qk=Symbol.for("effect/Cause/errors/Timeout"),R4=ad({[qk]:qk},"TimeoutException"),O4=e=>new R4(`Operation timed out after '${HR(e)}'`),Ak=Symbol.for("effect/Cause/errors/UnknownException"),mg=function(){class e extends Pv{constructor(r,s){super(s??"An unknown error occurred",{cause:r});d(this,"_tag","UnknownException");d(this,"error");this.error=r}}return Object.assign(e.prototype,{[Ak]:Ak,name:"UnknownException"}),e}(),pg=e=>yr(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),eq=e=>e._tag==="Failure",tq=e=>e._tag==="Success",q4=e=>{switch(e._tag){case cn:return kv(e.effect_instruction_i0);case un:return!1}},Th=y(2,(e,t)=>{switch(e._tag){case cn:return rt(e.effect_instruction_i0);case un:return Ke(t)}}),Q_=e=>Th(e,void 0),Ec=(e,t)=>F4(e,t!=null&&t.parallel?So:Yt),fc=e=>rt(Un(e)),Zl=e=>rt(_a(e)),rt=e=>{const t=new NO(cn);return t.effect_instruction_i0=e,t},Fv=e=>rt($r(e)),Ih=y(2,(e,t)=>{switch(e._tag){case cn:return rt(e.effect_instruction_i0);case un:return Ke(t(e.effect_instruction_i0))}}),A4=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case cn:return rt(w(e.effect_instruction_i0,OO(t)));case un:return Ke(n(e.effect_instruction_i0))}}),gg=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case cn:return t(e.effect_instruction_i0);case un:return n(e.effect_instruction_i0)}}),ib=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case cn:return t(e.effect_instruction_i0);case un:return n(e.effect_instruction_i0)}}),Ke=e=>{const t=new xO(un);return t.effect_instruction_i0=e,t},Tn=Ke(void 0),P4=y(2,(e,t)=>Nv(e,t,{onSuccess:(n,r)=>[n,r],onFailure:Yt})),nq=y(2,(e,t)=>Nv(e,t,{onSuccess:(n,r)=>r,onFailure:Yt})),Nv=y(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case cn:switch(t._tag){case un:return rt(e.effect_instruction_i0);case cn:return rt(n(e.effect_instruction_i0,t.effect_instruction_i0))}case un:switch(t._tag){case un:return Ke(r(e.effect_instruction_i0,t.effect_instruction_i0));case cn:return rt(t.effect_instruction_i0)}}}),F4=(e,t)=>{const n=go(e);return yo(n)?w(Xs(n),KS(w(bs(n),Ih(ft)),(r,s)=>w(r,Nv(s,{onSuccess:(o,a)=>w(o,wn(a)),onFailure:t}))),Ih(_o),Ih(r=>dr(r)),W):V()},Tu=e=>({...Wf,[UH]:zH,state:Ia(BH([])),commit(){return ns(this)},blockingOn:e}),Iu=()=>U(sg,e=>N4(e)),N4=e=>K(()=>Tu(e)),ns=e=>Go(t=>{const n=ze(e.state);switch(n._tag){case ng:return t(n.effect);case rd:return n.joiners.push(t),M4(e,t)}},e.blockingOn),ud=y(2,(e,t)=>K(()=>{const n=ze(e.state);switch(n._tag){case ng:return!1;case rd:{Ra(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),rq=y(2,(e,t)=>ud(e,t)),x4=y(2,(e,t)=>ud(e,St(t))),sq=y(2,(e,t)=>ud(e,$t(t))),xv=y(2,(e,t)=>ud(e,zO(t))),D4=e=>K(()=>ze(e.state)._tag===ng),ld=y(2,(e,t)=>ud(e,J(t))),fd=(e,t)=>{const n=ze(e.state);if(n._tag===rd){Ra(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},M4=(e,t)=>K(()=>{const n=ze(e.state);if(n._tag===rd){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),L4=qe(e=>Ke(e.currentContext)),dd=()=>L4,Ru=e=>U(dd(),e),Dv=y(2,(e,t)=>Ao(ss,t)(e)),Mv=y(2,(e,t)=>lg(ss,n=>qo(n,t))(e)),oq=y(2,(e,t)=>Ru(n=>Dv(e,t(n)))),Lv=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?W(t):V()},j4={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:Tn},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},U4=e=>Object.assign(Object.create(j4),e),Me=Iu,Ht=ns,Pa=rq,jv=x4,iq=sq,ab=D4,ut=ld,z4=Tu,Di=fd,B4=pg,Fa=eq,Gc=tq,H4=q4,V4=Ec,ef=fc,hd=Zl,on=rt,W4=Fv,K4=Ih,J4=A4,Yr=gg,Wt=Ke,Xn=Tn,Pk=P4,tf=nq,Fk=Symbol.for("effect/MutableHashMap"),G4={[Fk]:Fk,[Symbol.iterator](){return new Uv(this)},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(Ot)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}};class Uv{constructor(t){d(this,"self");d(this,"referentialIterator");d(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new Q4(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new Uv(this.self)}}class Q4{constructor(t){d(this,"backing");d(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const aq=()=>{const e=Object.create(G4);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},ds=y(2,(e,t)=>{if(jl(t)===!1)return e.referential.has(t)?W(e.referential.get(t)):V();const n=t[pe](),r=e.buckets.get(n);return r===void 0?V():Y4(e,r,t)}),Y4=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[ge](t[s][0])){const a=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),W(a)}return V()},nc=y(2,(e,t)=>lt(ds(e,t))),rc=y(3,(e,t,n)=>{if(jl(t)===!1)return e.referential.set(t,n),e;const r=t[pe](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(cq(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),cq=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[ge](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},X4=y(2,(e,t)=>{if(jl(t)===!1)return e.referential.delete(t),e;const n=t[pe](),r=e.buckets.get(n);return r===void 0||(cq(e,r,t),r.length===0&&e.buckets.delete(n)),e}),Nk=Symbol.for("effect/MutableList"),Z4={[Nk]:Nk,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(Ot)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},e6=e=>({value:e,removed:!1,prev:void 0,next:void 0}),t6=()=>{const e=Object.create(Z4);return e.head=void 0,e.tail=void 0,e._length=0,e},uq=e=>zv(e)===0,zv=e=>e._length,n6=y(2,(e,t)=>{const n=e6(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),r6=e=>{const t=e.head;if(t!==void 0)return s6(e,t),t.value},s6=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},xk=Symbol.for("effect/MutableQueue"),Vt=Symbol.for("effect/mutable/MutableQueue/Empty"),o6={[xk]:xk,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(Ot)}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},lq=e=>{const t=Object.create(o6);return t.queue=t6(),t.capacity=e,t},Bv=e=>lq(e),_g=()=>lq(void 0),Hv=e=>zv(e.queue),Ji=e=>uq(e.queue),i6=e=>e.capacity===void 0?1/0:e.capacity,Qc=y(2,(e,t)=>{const n=zv(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(n6(t)(e.queue),!0)}),Vv=y(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=yt(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Qc(r.value)(e);for(;r!=null&&!r.done;)s=wn(r.value)(s),r=n.next();return _o(s)}),ao=y(2,(e,t)=>uq(e.queue)?t:r6(e.queue)),yg=y(2,(e,t)=>{let n=yt(),r=0;for(;r<t;){const s=ao(Vt)(e);if(s===Vt)break;n=wn(s)(n),r+=1}return _o(n)}),a6="effect/Clock",Dk=Symbol.for(a6),Na=tr("effect/Clock"),c6=2**31-1,Mk={unsafeSchedule(e,t){const n=xc(t);if(n>c6)return Jn;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},Lk=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))}(),u6=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return Lk;const t=Lk()-e.bigint();return()=>t+e.bigint()}();var ST;ST=Dk;class l6{constructor(){d(this,ST,Dk);d(this,"currentTimeMillis",K(()=>this.unsafeCurrentTimeMillis()));d(this,"currentTimeNanos",K(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return u6()}scheduler(){return J(Mk)}sleep(t){return ts(n=>{const r=Mk.unsafeSchedule(()=>n(Je),t);return nr(K(r))})}}const f6=()=>new l6,fq="And",dq="Or",hq="InvalidData",mq="MissingData",pq="SourceUnavailable",gq="Unsupported",d6="effect/ConfigError",jk=Symbol.for(d6),Ou={_tag:"ConfigError",[jk]:jk},_q=(e,t)=>{const n=Object.create(Ou);return n._op=fq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},yq=(e,t)=>{const n=Object.create(Ou);return n._op=dq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},h6=(e,t,n={pathDelim:"."})=>{const r=Object.create(Ou);return r._op=hq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${w(this.path,Ta(n.pathDelim))}: "${this.message}")`}}),r},ba=(e,t,n={pathDelim:"."})=>{const r=Object.create(Ou);return r._op=mq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${w(this.path,Ta(n.pathDelim))}: "${this.message}")`}}),r},m6=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(Ou);return s._op=pq,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${w(this.path,Ta(r.pathDelim))}: "${this.message}")`}}),s},p6=(e,t,n={pathDelim:"."})=>{const r=Object.create(Ou);return r._op=gq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${w(this.path,Ta(n.pathDelim))}: "${this.message}")`}}),r},Mi=y(2,(e,t)=>{switch(e._op){case fq:return _q(Mi(e.left,t),Mi(e.right,t));case dq:return yq(Mi(e.left,t),Mi(e.right,t));case hq:return h6([...t,...e.path],e.message);case mq:return ba([...t,...e.path],e.message);case pq:return m6([...t,...e.path],e.message,e.cause);case gq:return p6([...t,...e.path],e.message)}}),g6={_tag:"Empty"},Y_=y(2,(e,t)=>{let n=bv(t),r=e;for(;yv(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=pa(s.first,pa(s.second,n.tail));break}case"MapName":{r=so(r,s.f),n=n.tail;break}case"Nested":{r=Yh(r,s.name),n=n.tail;break}case"Unnested":{if(w(_c(r),IL(s.name)))r=aa(r),n=n.tail;else return oe(ba(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return ce(r)}),_6="Constant",y6="Fail",b6="Fallback",S6="Described",v6="Lazy",w6="MapOrFail",E6="Nested",k6="Primitive",$6="Sequence",C6="HashMap",T6="ZipWith";var Uk={};const hm=(e,t)=>[...e,...t],I6="effect/ConfigProvider",zk=Symbol.for(I6),R6=tr("effect/ConfigProvider"),O6="effect/ConfigProviderFlat",Bk=Symbol.for(O6),q6=e=>({[zk]:zk,pipe(){return ee(this,arguments)},...e}),A6=e=>({[Bk]:Bk,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),P6=e=>q6({load:t=>U(Er(e,oi(),t,!1),n=>st(_c(n),{onNone:()=>St(ba(oi(),`Expected a single value having structure: ${t}`)),onSome:J})),flattened:e}),F6=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=f=>w(f,Ta(t)),s=f=>f.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof Uk=="object"?Uk:{};return P6(A6({load:(f,h,p=!0)=>{const g=r(f),k=o(),T=g in k?W(k[g]):V();return w(T,ig(()=>ba(f,`Expected ${g} to exist in the process context`)),U(O=>L6(O,f,h,n,p)))},enumerateChildren:f=>K(()=>{const h=o(),k=Object.keys(h).map(T=>s(T.toUpperCase())).filter(T=>{for(let O=0;O<f.length;O++){const M=w(f,P1(O)),E=T[O];if(E===void 0||M!==E)return!1}return!0}).flatMap(T=>T.slice(f.length,f.length+1));return Pz(k)}),patch:g6}))},N6=(e,t,n,r)=>{const s=Z0(n.length,f=>f>=r.length?V():W([e(f),f+1])),o=Z0(r.length,f=>f>=n.length?V():W([t(f),f+1])),a=hm(n,s),u=hm(r,o);return[a,u]},x6=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Er=(e,t,n,r)=>{const s=n;switch(s._tag){case _6:return J(cr(s.value));case S6:return he(()=>Er(e,t,s.config,r));case y6:return St(ba(t,s.message));case b6:return w(he(()=>Er(e,t,s.first,r)),Wc(o=>s.condition(o)?w(Er(e,t,s.second,r),Wc(a=>St(yq(o,a)))):St(o)));case v6:return he(()=>Er(e,t,s.config(),r));case w6:return he(()=>w(Er(e,t,s.original,r),U(Zs(o=>w(s.mapOrFail(o),ig(Mi(x6(t,s.original))))))));case E6:return he(()=>Er(e,hm(t,cr(s.name)),s.config,r));case k6:return w(Y_(t,e.patch),U(o=>w(e.load(o,s,r),U(a=>{if(a.length===0){const u=w(KL(o),Et(()=>"<n/a>"));return St(ba([],`Expected ${s.description} with name ${u}`))}return J(a)}))));case $6:return w(Y_(t,e.patch),U(o=>w(e.enumerateChildren(o),U(U6),U(a=>a.length===0?he(()=>_e(Er(e,t,s.config,!0),cr)):w(Zs(a,u=>Er(e,UL(t,`[${u}]`),s.config,!0)),_e(u=>{const f=oj(u);return f.length===0?cr(oi()):cr(f)}))))));case C6:return he(()=>w(Y_(t,e.patch),U(o=>w(e.enumerateChildren(o),U(a=>w(a,Zs(u=>Er(e,hm(o,cr(u)),s.valueConfig,r)),_e(u=>u.length===0?cr(Kp()):w(j6(u),so(f=>Kz(X0(je(a),f)))))))))));case T6:return he(()=>w(Er(e,t,s.left,r),Kc,U(o=>w(Er(e,t,s.right,r),Kc,U(a=>{if(tn(o)&&tn(a))return St(_q(o.left,a.left));if(tn(o)&&ys(a))return St(o.left);if(ys(o)&&tn(a))return St(a.left);if(ys(o)&&ys(a)){const u=w(t,Ta(".")),f=D6(t,u),[h,p]=N6(f,f,w(o.right,so(ce)),w(a.right,so(ce)));return w(h,X0(p),Zs(([g,k])=>w(ug(g,k),_e(([T,O])=>s.zip(T,O)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},D6=(e,t)=>n=>oe(ba(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),M6=(e,t)=>e.split(new RegExp(`\\s*${Zh(t)}\\s*`)),L6=(e,t,n,r,s)=>s?w(M6(e,r),Zs(o=>n.parse(o.trim())),ig(Mi(t))):w(n.parse(e),Iv({onFailure:Mi(t),onSuccess:cr})),j6=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),U6=e=>w(Zs(e,B6),Iv({onFailure:()=>oi(),onSuccess:Ul(Pc)}),Kc,_e(gL)),z6=/^(\[(\d+)\])$/,B6=e=>{const t=e.match(z6);if(t!==null){const n=t[2];return w(n!==void 0&&n.length>0?W(n):V(),mu(H6))}return V()},H6=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?V():W(t)},Hk=Symbol.for("effect/Console"),bg=tr("effect/Console"),V6={[Hk]:Hk,assert(e,...t){return K(()=>{console.assert(e,...t)})},clear:K(()=>{console.clear()}),count(e){return K(()=>{console.count(e)})},countReset(e){return K(()=>{console.countReset(e)})},debug(...e){return K(()=>{console.debug(...e)})},dir(e,t){return K(()=>{console.dir(e,t)})},dirxml(...e){return K(()=>{console.dirxml(...e)})},error(...e){return K(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?K(()=>console.groupCollapsed(e==null?void 0:e.label)):K(()=>console.group(e==null?void 0:e.label))},groupEnd:K(()=>{console.groupEnd()}),info(...e){return K(()=>{console.info(...e)})},log(...e){return K(()=>{console.log(...e)})},table(e,t){return K(()=>{console.table(e,t)})},time(e){return K(()=>console.time(e))},timeEnd(e){return K(()=>console.timeEnd(e))},timeLog(e,...t){return K(()=>{console.timeLog(e,...t)})},trace(...e){return K(()=>{console.trace(...e)})},warn(...e){return K(()=>{console.warn(...e)})},unsafe:console},W6="effect/Random",Vk=Symbol.for(W6),K6=tr("effect/Random");var vT;vT=Vk;class J6{constructor(t){d(this,"seed");d(this,vT,Vk);d(this,"PRNG");this.seed=t,this.PRNG=new BM(t)}get next(){return K(()=>this.PRNG.number())}get nextBoolean(){return _e(this.next,t=>t>.5)}get nextInt(){return K(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return _e(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return K(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return G6(t,n=>this.nextIntBetween(0,n))}}const G6=(e,t)=>he(()=>w(K(()=>Array.from(e)),U(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return w(r,Jc(s=>w(t(s),_e(o=>Q6(n,s-1,o)))),Xt(go(n)))}))),Q6=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},Y6=e=>new J6(Q(e)),Wk=Symbol.for("effect/Tracer"),bq=e=>({[Wk]:Wk,...e}),md=tr("effect/Tracer"),Rs=tr("effect/ParentSpan"),Kk=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class X6{constructor(t,n,r,s,o,a){d(this,"name");d(this,"parent");d(this,"context");d(this,"startTime");d(this,"kind");d(this,"_tag","Span");d(this,"spanId");d(this,"traceId","native");d(this,"sampled",!0);d(this,"status");d(this,"attributes");d(this,"events",[]);d(this,"links");this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=a,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Kk(32),this.spanId=Kk(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const Z6=bq({span:(e,t,n,r,s,o)=>new X6(e,t,n,r,s,o),context:e=>e()}),co=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},mm=_u()("effect/Tracer/DisablePropagation",{defaultValue:Jn}),e5=w(po(),gs(Na,f6()),gs(bg,V6),gs(K6,Y6(Math.random())),gs(R6,F6()),gs(md,Z6)),Os=Ee(Symbol.for("effect/DefaultServices/currentServices"),()=>JO(e5)),t5=e=>{const t=gr(e);return Wv(n=>n.sleep(t))},Sq=e=>qe(t=>e(t.currentDefaultServices)),Wv=e=>Sq(t=>e(t.unsafeMap.get(Na.key))),n5=Wv(e=>e.currentTimeMillis),r5=e=>Sq(t=>e(t.unsafeMap.get(md.key))),vq=t5,s5=n5,o5=Wv,i5=Na;function a5(e){return new ai(e)}function c5(){return a5(new Map)}const Jk=Symbol.for("effect/FiberRefs");var wT;wT=Jk;class ai{constructor(t){d(this,"locals");d(this,wT,Jk);this.locals=t}pipe(){return ee(this,arguments)}}const u5=(e,t,n,r=!1)=>{const s=e;let o=t,a=n,u=r,f;for(;f===void 0;)if(bt(o)&&bt(a)){const h=Ln(o)[0],p=aa(o),g=Ln(a)[0],k=Ln(a)[1],T=aa(a);h.startTimeMillis<g.startTimeMillis?(a=T,u=!0):h.startTimeMillis>g.startTimeMillis?o=p:h.id<g.id?(a=T,u=!0):h.id>g.id?o=p:f=[k,u]}else f=[s.initial,!0];return f},l5=y(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const a=s[0][1];if(!s[0][0][ge](t)){if(!r.has(o)){if(de(a,o.initial))return;r.set(o,[[t,o.join(o.initial,a)]]);return}const u=r.get(o),[f,h]=u5(o,u,s);if(h){const p=o.diff(f,a),g=u[0][1],k=o.join(g,o.patch(p)(g));if(!de(g,k)){let T;const O=u[0][0];O[ge](t)?T=[[O,k],...u.slice(1)]:T=[[t,k],...u],r.set(o,T)}}}}),new ai(r)}),f5=y(2,(e,t)=>{const n=new Map;return wq(e,n,t),new ai(n)}),wq=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],a=s.patch(s.fork)(o);de(o,a)?t.set(s,r):t.set(s,[[n,a],...r])})},Eq=y(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new ai(n)}),kq=y(2,(e,t)=>e.locals.has(t)?W(Ln(e.locals.get(t))[1]):V()),nf=y(2,(e,t)=>w(kq(e,t),Et(()=>t.initial))),cb=y(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new ai(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return ub(s,t,n,r),new ai(s)}),ub=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(bt(s)){const[a,u]=Ln(s);if(a[ge](t)){if(de(u,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},d5=y(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new ai(new Map(t));const r=new Map(e.locals);return n!==void 0&&wq(e,r,n),t.forEach(([s,o])=>{o.length===1?ub(r,o[0][0],s,o[0][1]):o.forEach(([a,u])=>{ub(r,a,s,u)})}),new ai(r)}),Gk=kq,Sg=nf,h5=d5,m5=c5,p5=n4,g5=r4,$q=s4,Cq=o4,_5=WO,Kv=KO,y5=i4,b5=a4,S5=w(Pc,O1(e=>e.ordinal)),v5=bL(S5),w5=e=>{switch(e){case"All":return p5;case"Debug":return Kv;case"Error":return $q;case"Fatal":return g5;case"Info":return _5;case"Trace":return y5;case"None":return b5;case"Warning":return Cq}},Tq=e=>e.replace(/[\s="]/g,"_"),Jv=e=>t=>`${Tq(t.label)}=${e-t.startTime}ms`,E5=Vf,k5=iL;let Po=class extends k5{};const ci=Symbol.for("effect/Readable"),Gv=Symbol.for("effect/Ref"),Qv={_A:e=>e};var ET,kT,$T;class $5 extends($T=Po,kT=Gv,ET=ci,$T){constructor(n){super();d(this,"ref");d(this,kT,Qv);d(this,ET,ci);d(this,"get");this.ref=n,this.get=K(()=>ze(this.ref))}commit(){return this.get}modify(n){return K(()=>{const r=ze(this.ref),[s,o]=n(r);return r!==o&&Ra(o)(this.ref),s})}}const Iq=e=>new $5(Ia(e)),pm=e=>K(()=>Iq(e)),ti=e=>e.get,rf=y(2,(e,t)=>e.modify(()=>[void 0,t])),C5=y(2,(e,t)=>e.modify(n=>[n,t])),Rq=y(2,(e,t)=>e.modify(t)),lb=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),T5=Gv,Si=pm,Gi=ti,I5=C5,qi=Rq,Yc=rf,R5=lb,O5=Rs,Oq=bq,q5=r5,qq="Empty",Aq="Add",Pq="Remove",Fq="Update",Nq="AndThen",A5={_tag:qq},Yv=(e,t)=>{const n=new Map(e.locals);let r=A5;for(const[s,o]of t.locals.entries()){const a=Ln(o)[1],u=n.get(s);if(u!==void 0){const f=Ln(u)[1];de(f,a)||(r=X_({_tag:Fq,fiberRef:s,patch:s.diff(f,a)})(r))}else r=X_({_tag:Aq,fiberRef:s,value:a})(r);n.delete(s)}for(const[s]of n.entries())r=X_({_tag:Pq,fiberRef:s})(r);return r},X_=y(2,(e,t)=>({_tag:Nq,first:e,second:t})),xq=y(3,(e,t,n)=>{let r=n,s=cr(e);for(;bt(s);){const o=Ln(s),a=aa(s);switch(o._tag){case qq:{s=a;break}case Aq:{r=cb(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=a;break}case Pq:{r=Eq(r,o.fiberRef),s=a;break}case Fq:{const u=nf(r,o.fiberRef);r=cb(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(u)}),s=a;break}case Nq:{s=Yh(o.first)(Yh(o.second)(a));break}}}return r}),Dq="effect/MetricLabel",fb=Symbol.for(Dq);var CT;class P5{constructor(t,n){d(this,"key");d(this,"value");d(this,CT,fb);d(this,"_hash");this.key=t,this.value=n,this._hash=Tt(Dq+this.key+this.value)}[(CT=fb,pe)](){return this._hash}[ge](t){return N5(t)&&this.key===t.key&&this.value===t.value}pipe(){return ee(this,arguments)}}const F5=(e,t)=>new P5(e,t),N5=e=>ne(e,fb),x5=y(e=>yr(e[0]),function(){const e=arguments;return lg(e[0],GO,typeof e[1]=="string"?jc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>jc(n,r,s),t))}),D5=e=>_e(e,W),Mq=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),he(()=>{try{return J(gt(t))}catch(r){return St(n?gt(()=>n(r)):new mg(r,"An unknown error occurred in Effect.try"))}})},M5=y(2,(e,t)=>rg(e,n=>{const r=Zp(n,s=>wv(s)?W(s):V());switch(r._tag){case"None":return $t(n);case"Some":return t(r.value.defect)}})),L5=y(2,(e,t)=>Bn(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return $t(n);case"Some":return r.value}},onSuccess:J})),j5=y(e=>yr(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=_p(t[0]):r=s=>{const o=ne(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let a=0;a<t.length-1;a++)if(t[a]===o)return!0;return!1},LO(e,r,n)}),U5=o5,z5=U5(J),B5=y(2,(e,t)=>It(vq(t),e)),H5=e=>Hq(e,jq,Yv),V5=e=>Hq(e,ug(jq,QH),([t,n],[r,s])=>[Yv(t,r),ei(n,s)]),Lq=y(2,(e,t)=>vo(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),W5=e=>{const t=U(U(e,()=>cg()),()=>t);return t},jq=qe(e=>J(e.getFiberRefs())),Uq=e=>Lq(e,{onFailure:Ll,onSuccess:Ll}),K5=e=>Bn(e,{onFailure:t=>zq(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>Je}),vg=e=>(...t)=>{const n=Ca(e);let r;for(let s=0,o=t.length;s<o;s++){const a=t[s];vv(a)&&(r!==void 0?r=Yt(r,a):r=a,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=bo),qe(s=>(s.log(t,r,n),Je))},J5=vg(),zq=vg(Kv),G5=vg(Cq),Q5=vg($q),Qk=y(2,(e,t)=>Bn(e,{onFailure:n=>jO(()=>t(n)),onSuccess:J})),Y5=e=>w(Iu(),U(t=>w(V5(e),BO(t),Z5,_e(n=>It(n,w(ns(t),U(([r,s])=>Xt(ug(Bq(r[0]),HO(r[1])),s)))))))),X5=e=>_e(e,t=>!t),Z5=e=>_e(Si(!0),t=>nr(od(e,I5(t,!1)))),Bq=e=>uV((t,n)=>w(e,xq(t,n))),eV=e=>e.length>=1?ts((t,n)=>{try{e(n).then(r=>t(Ke(r)),r=>t(fc(r)))}catch(r){t(fc(r))}}):ts(t=>{try{e().then(n=>t(Ke(n)),n=>t(fc(n)))}catch(n){t(fc(n))}}),sf=y(3,(e,t,n)=>Ru(r=>Dv(e,gs(r,t,n)))),Xv=vq,tV=J(V()),Hq=y(3,(e,t,n)=>U(t,r=>U(e,s=>_e(t,o=>[n(r,o),s])))),nV=y(2,(e,t)=>Bn(e,{onFailure:n=>{const r=Xp(n);switch(r._tag){case"Left":return It(t(r.left),$t(n));case"Right":return $t(n)}},onSuccess:J})),rV=y(3,(e,t,n)=>nV(e,r=>_p(r,t)?n(r):Je)),sV=y(2,(e,t)=>Bn(e,{onFailure:n=>It(t(n),$t(n)),onSuccess:J})),oV=q5,iV=oV(J),aV=e=>{let t,n;typeof e=="function"?t=e:(t=e.try,n=e.catch);const r=s=>n?sd(()=>n(s)):St(new mg(s,"An unknown error occurred in Effect.tryPromise"));return t.length>=1?ts((s,o)=>{try{t(o).then(a=>s(Ke(a)),a=>s(r(a)))}catch(a){s(r(a))}}):ts(s=>{try{t().then(o=>s(Ke(o)),o=>s(r(o)))}catch(o){s(r(o))}})},cV=y(2,(e,t)=>U(e,n=>Mq({try:()=>t.try(n),catch:t.catch}))),uV=e=>qe(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),Je)),lV=y(2,(e,t)=>he(()=>t()?_e(e,W):J(V()))),fV=e=>new Proxy({},{get(t,n,r){return(...s)=>U(e,o=>o[n](...s))}}),dV=e=>_e(dd(),Dr(e)),hV=function(){const e=arguments;return Uq(U(Vq,t=>K(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},mV=y(e=>yr(e[0]),function(){const e=arguments;return lg(e[0],XO,typeof e[1]=="string"?jc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>jc(n,r,s),t))}),Vq=U(dd(),e=>{const t=e.unsafeMap.get(Rs.key);return t!==void 0&&t._tag==="Span"?J(t):St(new cd)}),Wq=BigInt(0),Kq=mu(e=>Gn(e.context,mm)?e._tag==="Span"?Kq(e.parent):V():W(e)),Zv=(e,t,n)=>{const r=!e.getFiberRef(YO)||n.context&&Gn(n.context,mm),s=e.getFiberRef(ss),o=n.parent?W(n.parent):n.root?V():Kq(Dr(s,Rs));let a;if(r)a=U4({name:t,parent:o,context:gs(n.context??po(),mm,!0)});else{const u=e.getFiberRef(Os),f=Gn(u,md),h=Gn(u,i5),p=e.getFiberRef(dg),g=e.getFiberRefs(),k=Gk(g,XO),T=Gk(g,w4),O=T._tag==="Some"?n.links!==void 0?[...dr(T.value),...n.links??[]]:dr(T.value):n.links??oi();a=f.span(t,o,n.context??po(),O,p?h.unsafeCurrentTimeNanos():Wq,n.kind??"internal"),k._tag==="Some"&&Yz(k.value,(M,E)=>a.attribute(E,M)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([M,E])=>a.attribute(M,E))}return typeof n.captureStackTrace=="function"&&lm.set(a,n.captureStackTrace),a},pV=(e,t)=>(t=co(t),qe(n=>J(Zv(n,e,t)))),gm=(e,t,n,r)=>K(()=>{e.status._tag!=="Ended"&&(eq(t)&&lm.has(e)&&e.attribute("code.stacktrace",lm.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():Wq,t))}),db=(e,...t)=>{const n=co(t.length===1?void 0:t[0]),r=t[t.length-1];return qe(s=>{const o=Zv(s,e,n),a=s.getFiberRef(dg),u=Gn(s.getFiberRef(Os),Na);return Is(r(o),f=>gm(o,f,u,a))})},hb=y(2,(e,t)=>sf(e,Rs,t)),gV=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return db(t,n,s=>hb(r,s))}return r=>db(t,n,s=>hb(r,s))},Jq="Sequential",Gq="Parallel",_V="ParallelN",pd={_tag:Jq},yV={_tag:Gq},bV=e=>({_tag:_V,parallelism:e}),SV=e=>e._tag===Jq,vV=e=>e._tag===Gq,of=pd,mb=yV,pb=bV,af=Yv,cf=xq,wg="effect/FiberStatus",Sa=Symbol.for(wg),_m="Done",Yk="Running",Xk="Suspended",wV=Tt(`${wg}-${_m}`);var TT;let EV=class{constructor(){d(this,TT,Sa);d(this,"_tag",_m)}[(TT=Sa,pe)](){return wV}[ge](t){return ew(t)&&t._tag===_m}};var IT;class kV{constructor(t){d(this,"runtimeFlags");d(this,IT,Sa);d(this,"_tag",Yk);this.runtimeFlags=t}[(IT=Sa,pe)](){return w(Q(wg),ue(Q(this._tag)),ue(Q(this.runtimeFlags)),at(this))}[ge](t){return ew(t)&&t._tag===Yk&&this.runtimeFlags===t.runtimeFlags}}var RT;class $V{constructor(t,n){d(this,"runtimeFlags");d(this,"blockingOn");d(this,RT,Sa);d(this,"_tag",Xk);this.runtimeFlags=t,this.blockingOn=n}[(RT=Sa,pe)](){return w(Q(wg),ue(Q(this._tag)),ue(Q(this.runtimeFlags)),ue(Q(this.blockingOn)),at(this))}[ge](t){return ew(t)&&t._tag===Xk&&this.runtimeFlags===t.runtimeFlags&&de(this.blockingOn,t.blockingOn)}}const CV=new EV,TV=e=>new kV(e),IV=(e,t)=>new $V(e,t),ew=e=>ne(e,Sa),RV=e=>e._tag===_m,OV=CV,Qq=TV,qV=IV,AV=RV,PV=Symbol.for("effect/Micro"),ym=Symbol.for("effect/Micro/MicroExit"),Zk=Symbol.for("effect/Micro/MicroCause"),FV={_E:ie};var OT;class Yq extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let a,u,f;if(r instanceof globalThis.Error){a=`(${o}) ${r.name}`,u=r.message;const h=u.split(`
`).length;f=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,h+3).join(`
`)}`:`${a}: ${u}`}else a=o,u=ra(r,0),f=`${a}: ${u}`;s.length>0&&(f+=`
    ${s.join(`
    `)}`);super(u);d(this,"_tag");d(this,"traces");d(this,OT);this._tag=n,this.traces=s,this[Zk]=FV,this.name=a,this.stack=f}pipe(){return ee(this,arguments)}toString(){return this.stack}[(OT=Zk,Ue)](){return this.stack}}class NV extends Yq{constructor(n,r=[]){super("Die",n,r);d(this,"defect");this.defect=n}}const xV=(e,t=[])=>new NV(e,t);class DV extends Yq{constructor(t=[]){super("Interrupt","interrupted",t)}}const MV=(e=[])=>new DV(e),LV=e=>e._tag==="Interrupt",e$=Symbol.for("effect/Micro/MicroFiber"),jV={_A:ie,_E:ie};var qT;qT=e$;class UV{constructor(t,n=!0){d(this,"context");d(this,"interruptible");d(this,qT);d(this,"_stack",[]);d(this,"_observers",[]);d(this,"_exit");d(this,"_children");d(this,"currentOpCount",0);d(this,"_interrupted",!1);d(this,"_yielded");this.context=t,this.interruptible=n,this[e$]=jV}getRef(t){return vU(this.context,t)}addObserver(t){return this._exit?(t(this._exit),Ll):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(ow))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===Zd)return;const r=t$.interruptChildren&&t$.interruptChildren(this);if(r!==void 0)return this.evaluate(Sm(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(iw).shouldYield(this)){n=!0;const s=r;r=Sm(WV,()=>s)}if(r=r[gb](this),r===Zd){const s=this._yielded;return ym in s?(this._yielded=void 0,s):Zd}}}catch(s){return ne(r,gb)?_b(s):_b(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[bm]&&n[bm](this);if(r)return{[t]:r};if(n[t])return n}}yieldWith(t){return this._yielded=t,Zd}children(){return this._children??(this._children=new Set)}}const t$=Ee("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Xq=Symbol.for("effect/Micro/identifier"),rn=Symbol.for("effect/Micro/args"),gb=Symbol.for("effect/Micro/evaluate"),Xc=Symbol.for("effect/Micro/successCont"),kc=Symbol.for("effect/Micro/failureCont"),bm=Symbol.for("effect/Micro/ensureCont"),Zd=Symbol.for("effect/Micro/Yield"),zV={_A:ie,_E:ie,_R:ie},BV={...E5,_op:"Micro",[PV]:zV,pipe(){return ee(this,arguments)},[Symbol.iterator](){return new u1(new du(this))},toJSON(){return{_id:"Micro",op:this[Xq],...rn in this?{args:this[rn]}:void 0}},toString(){return dt(this)},[Ue](){return dt(this)}};function HV(e){return _b("Micro.evaluate: Not implemented")}const Eg=e=>({...BV,[Xq]:e.op,[gb]:e.eval??HV,[Xc]:e.contA,[kc]:e.contE,[bm]:e.ensure}),tw=e=>{const t=Eg(e);return function(){const n=Object.create(t);return n[rn]=e.single===!1?arguments:arguments[0],n}},Zq=e=>{const t={...Eg(e),[ym]:ym,_tag:e.op,get[e.prop](){return this[rn]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[rn]}},[ge](n){return GV(n)&&n._tag===e.op&&de(this[rn],n[rn])},[pe](){return at(this,ue(Tt(e.op))(Q(this[rn])))}};return function(n){const r=Object.create(t);return r[rn]=n,r[Xc]=void 0,r[kc]=void 0,r[bm]=void 0,r}},nw=Zq({op:"Success",prop:"value",eval(e){const t=e.getCont(Xc);return t?t[Xc](this[rn],e):e.yieldWith(this)}}),eA=Zq({op:"Failure",prop:"cause",eval(e){let t=e.getCont(kc);for(;LV(this[rn])&&t&&e.interruptible;)t=e.getCont(kc);return t?t[kc](this[rn],e):e.yieldWith(this)}}),VV=tw({op:"Yield",eval(e){let t=!1;return e.getRef(iw).scheduleTask(()=>{t||e.evaluate(QV)},this[rn]??0),e.yieldWith(()=>{t=!0})}}),WV=VV(0),KV=nw(void 0),rw=tw({op:"WithMicroFiber",eval(e){return this[rn](e)}}),Sm=y(2,(e,t)=>{const n=Object.create(JV);return n[rn]=e,n[Xc]=t,n}),JV=Eg({op:"OnSuccess",eval(e){return e._stack.push(this),this[rn]}}),GV=e=>ne(e,ym),tA=nw,sw=eA,ow=sw(MV()),_b=e=>sw(xV(e)),QV=tA(void 0),YV="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class nA{constructor(){d(this,"tasks",[]);d(this,"running",!1);d(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,YV(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(eW)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const XV=y(2,(e,t)=>rw(n=>{const r=n.context;return n.context=t(r),rW(e,()=>(n.context=r,KV))})),ZV=y(2,(e,t)=>XV(e,qo(t)));class eW extends _u()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class iw extends _u()("effect/Micro/currentScheduler",{defaultValue:()=>new nA}){}const tW=y(2,(e,t)=>{const n=Object.create(nW);return n[rn]=e,n[Xc]=t.onSuccess,n[kc]=t.onFailure,n}),nW=Eg({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[rn]}}),rW=y(2,(e,t)=>oW(n=>tW(n(e),{onFailure:r=>Sm(t(sw(r)),()=>eA(r)),onSuccess:r=>Sm(t(tA(r)),()=>nw(r))}))),rA=tw({op:"SetInterruptible",ensure(e){if(e.interruptible=this[rn],e._interrupted&&e.interruptible)return()=>ow}}),sW=e=>rw(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(rA(!1)),t._interrupted?ow:e)),oW=e=>rw(t=>t.interruptible?(t.interruptible=!1,t._stack.push(rA(!0)),e(sW)):e(ie)),iW=(e,t)=>{const n=new UV(iw.context(new nA));return n.evaluate(e),n};class aw{constructor(){d(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class aW{constructor(t){d(this,"maxNextTickBeforeTimer");d(this,"running",!1);d(this,"tasks",new aw);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(fg)?t.getFiberRef(bi):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const sA=Ee(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new aW(2048));class oA{constructor(){d(this,"tasks",new aw);d(this,"deferred",!1)}scheduleTask(t,n){this.deferred?sA.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(fg)?t.getFiberRef(bi):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const cw=e=>e.currentOpCount>e.getFiberRef(fg)?e.getFiberRef(bi):!1,cW=(e,t=cw)=>({scheduleTask:e,shouldYield:t}),uW=(e,t=cw)=>{let n=!1;const r=new aw,s=()=>{const a=r.buckets;r.buckets=[];for(const[u,f]of a)for(let h=0;h<f.length;h++)f[h]();r.buckets.length===0?n=!1:o()},o=()=>e(s);return cW((a,u)=>{r.scheduleTask(a,u),n||(n=!0,o())},t)},gd=Ee(Symbol.for("effect/FiberRef/currentScheduler"),()=>gn(sA)),lW=y(2,(e,t)=>Ao(e,gd,t)),iA=Ee(Symbol.for("effect/FiberRef/currentRequestMap"),()=>gn(new Map)),n$=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return $u(b4,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},uw="InterruptSignal",lw="Stateful",fw="Resume",dw="YieldNow",Z_=e=>({_tag:uw,cause:e}),Rh=e=>({_tag:lw,onFiber:e}),Ya=e=>({_tag:fw,effect:e}),fW=()=>({_tag:dw}),dW="effect/FiberScope",vm=Symbol.for(dW);var AT;AT=vm;class hW{constructor(){d(this,AT,vm);d(this,"fiberId",jn);d(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var PT;PT=vm;class mW{constructor(t,n){d(this,"fiberId");d(this,"parent");d(this,PT,vm);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(Rh(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const pW=e=>new mW(e.id(),e),_d=Ee(Symbol.for("effect/FiberScope/Global"),()=>new hW),gW="effect/Fiber",_W=Symbol.for(gW),yW={_E:e=>e,_A:e=>e},bW="effect/Fiber",SW=Symbol.for(bW),aA=e=>e.await,vW=e=>e.inheritAll,wW=y(2,(e,t)=>w(Jc(e,cA(t)),It(w(e,Jc(aA))))),cA=y(2,(e,t)=>e.interruptAsFork(t)),Zc=e=>qv(ku(e.await),e.inheritAll);({...Wf});const Vo="effect/FiberCurrent",EW=()=>Ca(globalThis[Vo]),kW="effect/Logger",$W=Symbol.for(kW),CW={_Message:e=>e,_Output:e=>e},yd=e=>({[$W]:CW,log:e,pipe(){return ee(this,arguments)}}),TW=/^[^\s"=]*$/,IW=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:a,message:u,spans:f})=>{const h=O=>O.match(TW)?O:e(O),p=(O,M)=>`${Tq(O)}=${h(M)}`,g=(O,M)=>" "+p(O,M);let k=p("timestamp",s.toISOString());k+=g("level",a.label),k+=g("fiber",Vp(o));const T=WS(u);for(let O=0;O<T.length;O++)k+=g("message",ra(T[O],t));TH(r)||(k+=g("cause",_i(r,{renderErrorCause:!0})));for(const O of f)k+=" "+Jv(s.getTime())(O);for(const[O,M]of n)k+=g(O,ra(M,t));return k},RW=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,OW=yd(IW(RW)),uA=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return Ot(e)}},qW=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},AW=(e,...t)=>e,kr={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},PW={None:[],All:[],Trace:[kr.gray],Debug:[kr.blue],Info:[kr.green],Warning:[kr.yellow],Error:[kr.red],Fatal:[kr.bgBrightRed,kr.black]},FW={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},NW=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,lA=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,xW=lA&&process.stdout.isTTY===!0,DW=lA||"Deno"in globalThis,MW=e=>{const t=(e==null?void 0:e.mode)??"auto",r=(t==="auto"?DW?"tty":"browser":t)==="browser",s=typeof(e==null?void 0:e.colors)=="boolean"?e.colors:xW||r,o=(e==null?void 0:e.formatDate)??NW;return r?jW({colors:s,formatDate:o}):LW({colors:s,formatDate:o,stderr:(e==null?void 0:e.stderr)===!0})},LW=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?qW:AW;return yd(({annotations:r,cause:s,context:o,date:a,fiberId:u,logLevel:f,message:h,spans:p})=>{const g=Sg(o,Os),k=Gn(g,bg).unsafe,T=e.stderr===!0?k.error:k.log,O=WS(h);let M=n(`[${e.formatDate(a)}]`,kr.white)+` ${n(f.label,...PW[f._tag])} (${Vp(u)})`;if(yv(p)){const S=a.getTime(),_=Jv(S);for(const C of p)M+=" "+_(C)}M+=":";let E=0;if(O.length>0){const S=uA(O[0]);typeof S=="string"&&(M+=" "+n(S,kr.bold,kr.cyan),E++)}if(T(M),t||k.group(),Ev(s)||T(_i(s,{renderErrorCause:!0})),E<O.length)for(;E<O.length;E++)T(sa(O[E]));if(uO(r)>0)for(const[S,_]of r)T(n(`${S}:`,kr.bold,kr.white),sa(_));t||k.groupEnd()})},jW=e=>{const t=e.colors?"%c":"";return yd(({annotations:n,cause:r,context:s,date:o,fiberId:a,logLevel:u,message:f,spans:h})=>{const p=Sg(s,Os),g=Gn(p,bg).unsafe,k=WS(f);let T=`${t}[${e.formatDate(o)}]`;const O=[];if(e.colors&&O.push("color:gray"),T+=` ${t}${u.label}${t} (${Vp(a)})`,e.colors&&O.push(FW[u._tag],""),yv(h)){const E=o.getTime(),S=Jv(E);for(const _ of h)T+=" "+S(_)}T+=":";let M=0;if(k.length>0){const E=uA(k[0]);typeof E=="string"&&(T+=` ${t}${E}`,e.colors&&O.push("color:deepskyblue"),M++)}if(g.groupCollapsed(T,...O),Ev(r)||g.error(_i(r,{renderErrorCause:!0})),M<k.length)for(;M<k.length;M++)g.log(sa(k[M]));if(uO(n)>0)for(const[E,S]of n){const _=sa(S);e.colors?g.log(`%c${E}:`,"color:gray",_):g.log(`${E}:`,_)}g.groupEnd()})},fA="effect/MetricBoundaries",yb=Symbol.for(fA);var FT;class UW{constructor(t){d(this,"values");d(this,FT,yb);d(this,"_hash");this.values=t,this._hash=w(Tt(fA),ue(Bf(this.values)))}[(FT=yb,pe)](){return this._hash}[ge](t){return zW(t)&&de(this.values,t.values)}pipe(){return ee(this,arguments)}}const zW=e=>ne(e,yb),BW=e=>{const t=w(e,kp(ft(Number.POSITIVE_INFINITY)),ij);return new UW(t)},HW=e=>w(ML(e.count-1,t=>e.start*Math.pow(e.factor,t)),zt,BW),VW="effect/MetricKeyType",dA=Symbol.for(VW),hA="effect/MetricKeyType/Counter",bb=Symbol.for(hA),WW="effect/MetricKeyType/Frequency",KW=Symbol.for(WW),JW="effect/MetricKeyType/Gauge",GW=Symbol.for(JW),mA="effect/MetricKeyType/Histogram",Sb=Symbol.for(mA),QW="effect/MetricKeyType/Summary",YW=Symbol.for(QW),pA={_In:e=>e,_Out:e=>e};var NT,xT;class XW{constructor(t,n){d(this,"incremental");d(this,"bigint");d(this,xT,pA);d(this,NT,bb);d(this,"_hash");this.incremental=t,this.bigint=n,this._hash=Tt(hA)}[(xT=dA,NT=bb,pe)](){return this._hash}[ge](t){return gA(t)}pipe(){return ee(this,arguments)}}var DT,MT;class ZW{constructor(t){d(this,"boundaries");d(this,MT,pA);d(this,DT,Sb);d(this,"_hash");this.boundaries=t,this._hash=w(Tt(mA),ue(Q(this.boundaries)))}[(MT=dA,DT=Sb,pe)](){return this._hash}[ge](t){return _A(t)&&de(this.boundaries,t.boundaries)}pipe(){return ee(this,arguments)}}const eK=e=>new XW((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),tK=e=>new ZW(e),gA=e=>ne(e,bb),nK=e=>ne(e,KW),rK=e=>ne(e,GW),_A=e=>ne(e,Sb),sK=e=>ne(e,YW),oK="effect/MetricKey",yA=Symbol.for(oK),iK={_Type:e=>e},aK=Kf(de);var LT;class hw{constructor(t,n,r,s=[]){d(this,"name");d(this,"keyType");d(this,"description");d(this,"tags");d(this,LT,iK);d(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=w(Tt(this.name+this.description),ue(Q(this.keyType)),ue(Bf(this.tags)))}[(LT=yA,pe)](){return this._hash}[ge](t){return cK(t)&&this.name===t.name&&de(this.keyType,t.keyType)&&de(this.description,t.description)&&aK(this.tags,t.tags)}pipe(){return ee(this,arguments)}}const cK=e=>ne(e,yA),uK=(e,t)=>new hw(e,eK(t),Ca(t==null?void 0:t.description)),lK=(e,t,n)=>new hw(e,tK(t),Ca(n)),fK=y(2,(e,t)=>t.length===0?e:new hw(e.name,e.keyType,e.description,Sh(e.tags,t))),dK="effect/MetricState",bd=Symbol.for(dK),bA="effect/MetricState/Counter",vb=Symbol.for(bA),SA="effect/MetricState/Frequency",wb=Symbol.for(SA),vA="effect/MetricState/Gauge",Eb=Symbol.for(vA),wA="effect/MetricState/Histogram",kb=Symbol.for(wA),EA="effect/MetricState/Summary",$b=Symbol.for(EA),Sd={_A:e=>e};var jT,UT;class hK{constructor(t){d(this,"count");d(this,UT,Sd);d(this,jT,vb);this.count=t}[(UT=bd,jT=vb,pe)](){return w(Q(bA),ue(Q(this.count)),at(this))}[ge](t){return kK(t)&&this.count===t.count}pipe(){return ee(this,arguments)}}const mK=Kf(de);var zT,BT;class pK{constructor(t){d(this,"occurrences");d(this,BT,Sd);d(this,zT,wb);d(this,"_hash");this.occurrences=t}[(BT=bd,zT=wb,pe)](){return w(Tt(SA),ue(Bf(je(this.occurrences.entries()))),at(this))}[ge](t){return $K(t)&&mK(je(this.occurrences.entries()),je(t.occurrences.entries()))}pipe(){return ee(this,arguments)}}var HT,VT;class gK{constructor(t){d(this,"value");d(this,VT,Sd);d(this,HT,Eb);this.value=t}[(VT=bd,HT=Eb,pe)](){return w(Q(vA),ue(Q(this.value)),at(this))}[ge](t){return CK(t)&&this.value===t.value}pipe(){return ee(this,arguments)}}var WT,KT;class _K{constructor(t,n,r,s,o){d(this,"buckets");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,KT,Sd);d(this,WT,kb);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(KT=bd,WT=kb,pe)](){return w(Q(wA),ue(Q(this.buckets)),ue(Q(this.count)),ue(Q(this.min)),ue(Q(this.max)),ue(Q(this.sum)),at(this))}[ge](t){return TK(t)&&de(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return ee(this,arguments)}}var JT,GT;class yK{constructor(t,n,r,s,o,a){d(this,"error");d(this,"quantiles");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,GT,Sd);d(this,JT,$b);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=a}[(GT=bd,JT=$b,pe)](){return w(Q(EA),ue(Q(this.error)),ue(Q(this.quantiles)),ue(Q(this.count)),ue(Q(this.min)),ue(Q(this.max)),ue(Q(this.sum)),at(this))}[ge](t){return IK(t)&&this.error===t.error&&de(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return ee(this,arguments)}}const bK=e=>new hK(e),SK=e=>new pK(e),vK=e=>new gK(e),wK=e=>new _K(e.buckets,e.count,e.min,e.max,e.sum),EK=e=>new yK(e.error,e.quantiles,e.count,e.min,e.max,e.sum),kK=e=>ne(e,vb),$K=e=>ne(e,wb),CK=e=>ne(e,Eb),TK=e=>ne(e,kb),IK=e=>ne(e,$b),RK="effect/MetricHook",OK=Symbol.for(RK),qK={_In:e=>e,_Out:e=>e},vd=e=>({[OK]:qK,pipe(){return ee(this,arguments)},...e}),r$=BigInt(0),AK=e=>{let t=e.keyType.bigint?r$:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=r$:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return vd({get:()=>bK(t),update:r,modify:r})},PK=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return vd({get:()=>SK(t),update:n,modify:n})},FK=(e,t)=>{let n=t;return vd({get:()=>vK(n),update:r=>{n=r},modify:r=>{n=n+r}})},NK=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,a=0,u=Number.MAX_VALUE,f=Number.MIN_VALUE;w(t,Ul(Pc),so((g,k)=>{s[k]=g}));const h=g=>{let k=0,T=n;for(;k!==T;){const O=Math.floor(k+(T-k)/2),M=s[O];g<=M?T=O:k=O,T===k+1&&(g<=s[k]?T=k:k=T)}r[k]=r[k]+1,o=o+1,a=a+g,g<u&&(u=g),g>f&&(f=g)},p=()=>{const g=Ep(n);let k=0;for(let T=0;T<n;T++){const O=s[T],M=r[T];k=k+M,g[T]=[O,k]}return g};return vd({get:()=>wK({buckets:p(),count:o,min:u,max:f,sum:a}),update:h,modify:h})},xK=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=w(s,Ul(Pc)),a=Ep(r);let u=0,f=0,h=0,p=0,g=0;const k=O=>{const M=[];let E=0;for(;E!==r-1;){const S=a[E];if(S!=null){const[_,C]=S,$=fa(O-_);XU($,LR)&&YU($,n)&&M.push(C)}E=E+1}return DK(t,o,Ul(M,Pc))},T=(O,M)=>{if(r>0){u=u+1;const E=u%r;a[E]=[M,O]}p=f===0?O:Math.min(p,O),g=f===0?O:Math.max(g,O),f=f+1,h=h+O};return vd({get:()=>EK({error:t,quantiles:k(Date.now()),count:f,min:p,max:g,sum:h}),update:([O,M])=>T(O,M),modify:([O,M])=>T(O,M)})},DK=(e,t,n)=>{const r=n.length;if(!bt(t))return oi();const s=t[0],o=t.slice(1),a=s$(e,r,V(),0,s,n),u=cr(a);return o.forEach(f=>{u.push(s$(e,r,a.value,a.consumed,f,a.rest))}),so(u,f=>[f.quantile,f.value])},s$=(e,t,n,r,s,o)=>{let a=e,u=t,f=n,h=r,p=s,g=o,k=e,T=t,O=n,M=r,E=s,S=o;for(;;){if(!bt(g))return{quantile:p,value:V(),consumed:h,rest:[]};if(p===1)return{quantile:p,value:W(F1(g)),consumed:h+g.length,rest:[]};const _=Ln(g),C=x1(g,L=>L===_),$=p*u,q=a/2*$,P=h+C[0].length,x=Math.abs(P-$);if(P<$-q){k=a,T=u,O=_c(g),M=P,E=p,S=C[1],a=k,u=T,f=O,h=M,p=E,g=S;continue}if(P>$+q){const L=Ft(f)?W(_):f;return{quantile:p,value:L,consumed:h,rest:g}}switch(f._tag){case"None":{k=a,T=u,O=_c(g),M=P,E=p,S=C[1],a=k,u=T,f=O,h=M,p=E,g=S;continue}case"Some":{const L=Math.abs($-f.value);if(x<L){k=a,T=u,O=_c(g),M=P,E=p,S=C[1],a=k,u=T,f=O,h=M,p=E,g=S;continue}return{quantile:p,value:W(f.value),consumed:h,rest:g}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},MK="effect/MetricPair",LK=Symbol.for(MK),jK={_Type:e=>e},UK=(e,t)=>({[LK]:jK,metricKey:e,metricState:t,pipe(){return ee(this,arguments)}}),zK="effect/MetricRegistry",o$=Symbol.for(zK);var QT;QT=o$;class BK{constructor(){d(this,QT,o$);d(this,"map",aq())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(UK(n,r.get()));return t}get(t){const n=w(this.map,ds(t),lr);if(n==null){if(gA(t.keyType))return this.getCounter(t);if(rK(t.keyType))return this.getGauge(t);if(nK(t.keyType))return this.getFrequency(t);if(_A(t.keyType))return this.getHistogram(t);if(sK(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=w(this.map,ds(t),lr);if(n==null){const r=AK(t);w(this.map,nc(t))||w(this.map,rc(t,r)),n=r}return n}getFrequency(t){let n=w(this.map,ds(t),lr);if(n==null){const r=PK(t);w(this.map,nc(t))||w(this.map,rc(t,r)),n=r}return n}getGauge(t){let n=w(this.map,ds(t),lr);if(n==null){const r=FK(t,t.keyType.bigint?BigInt(0):0);w(this.map,nc(t))||w(this.map,rc(t,r)),n=r}return n}getHistogram(t){let n=w(this.map,ds(t),lr);if(n==null){const r=NK(t);w(this.map,nc(t))||w(this.map,rc(t,r)),n=r}return n}getSummary(t){let n=w(this.map,ds(t),lr);if(n==null){const r=xK(t);w(this.map,nc(t))||w(this.map,rc(t,r)),n=r}return n}}const HK=()=>new BK,VK="effect/Metric",WK=Symbol.for(VK),KK={_Type:e=>e,_In:e=>e,_Out:e=>e},i$=Ee(Symbol.for("effect/Metric/globalMetricRegistry"),()=>HK()),kA=function(e,t,n,r){const s=Object.assign(o=>ag(o,a=>YK(s,a)),{[WK]:KK,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return ee(this,arguments)}});return s},kg=(e,t)=>$A(uK(e,t)),$A=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=i$.get(e)),t;let o=n.get(s);return o!==void 0||(o=i$.get(fK(e,s)),n.set(s,o)),o};return kA(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},JK=(e,t,n)=>$A(lK(e,t,n)),GK=y(3,(e,t,n)=>QK(e,[F5(t,n)])),QK=y(2,(e,t)=>kA(e.keyType,(n,r)=>e.unsafeUpdate(n,Sh(t,r)),n=>e.unsafeValue(Sh(t,n)),(n,r)=>e.unsafeModify(n,Sh(t,r)))),YK=y(2,(e,t)=>$u(nb,n=>K(()=>e.unsafeUpdate(t,n)))),XK="effect/Request",ZK=Symbol.for(XK),e8={_E:e=>e,_A:e=>e},t8={...US,[ZK]:e8},n8=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=t8,e}(),r8=y(2,(e,t)=>$u(iA,n=>K(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,fd(r.result,t))}}))),s8="effect/Supervisor",$g=Symbol.for(s8),mw={_T:e=>e};var YT;YT=$g;const y0=class y0{constructor(t,n){d(this,"underlying");d(this,"value0");d(this,YT,mw);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new y0(this,w(this.value,_e(t)))}zip(t){return new Em(this,t)}};let wm=y0;var XT;XT=$g;const b0=class b0{constructor(t,n){d(this,"left");d(this,"right");d(this,"_tag","Zip");d(this,XT,mw);this.left=t,this.right=n}get value(){return ug(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new wm(this,w(this.value,_e(t)))}zip(t){return new b0(this,t)}};let Em=b0;const CA=e=>ne(e,$g)&&_p(e,"Zip");var ZT;ZT=$g;class o8{constructor(t){d(this,"effect");d(this,ZT,mw);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new wm(this,w(this.value,_e(t)))}zip(t){return new Em(this,t)}onRun(t,n){return t()}}const i8=e=>new o8(e),Cg=Ee("effect/Supervisor/none",()=>i8(Je)),a8=yu,TA="Empty",IA="AddSupervisor",RA="RemoveSupervisor",OA="AndThen",Cl={_tag:TA},Oh=(e,t)=>({_tag:OA,first:e,second:t}),c8=(e,t)=>u8(t,ft(e)),u8=(e,t)=>{let n=e,r=t;for(;yo(r);){const s=bs(r);switch(s._tag){case TA:{r=Xs(r);break}case IA:{n=n.zip(s.supervisor),r=Xs(r);break}case RA:{n=Cb(n,s.supervisor),r=Xs(r);break}case OA:{r=wn(s.first)(wn(s.second)(Xs(r)));break}}}return n},Cb=(e,t)=>de(e,t)?Cg:CA(e)?Cb(e.left,t).zip(Cb(e.right,t)):e,km=e=>de(e,Cg)?ha():CA(e)?w(km(e.left),Wl(km(e.right))):zp(e),l8=(e,t)=>{if(de(e,t))return Cl;const n=km(e),r=km(t),s=w(r,mk(n),Kl(Cl,(a,u)=>Oh(a,{_tag:IA,supervisor:u}))),o=w(n,mk(r),Kl(Cl,(a,u)=>Oh(a,{_tag:RA,supervisor:u})));return Oh(s,o)},f8=a8({empty:Cl,patch:c8,combine:Oh,diff:l8}),d8=kg("effect_fiber_started",{incremental:!0}),a$=kg("effect_fiber_active"),h8=kg("effect_fiber_successes",{incremental:!0}),m8=kg("effect_fiber_failures",{incremental:!0}),p8=GK(JK("effect_fiber_lifetimes",HW({start:.5,factor:2,count:35})),"time_unit","milliseconds"),tl="Continue",g8="Done",c$="Yield",_8={_E:e=>e,_A:e=>e},eh=e=>{throw new Error(`BUG: FiberRuntime - ${ra(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Us=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),zs=Ee("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),nl={[Jh]:(e,t,n)=>gt(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>Ke(Ke(n)),[Gh]:(e,t,n)=>gt(()=>t.effect_instruction_i2(n)),[jS]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),Wo(e.currentRuntimeFlags)&&e.isInterrupted()?rt(e.getInterruptedCause()):Ke(n)),[Qh]:(e,t,n)=>(gt(()=>t.effect_instruction_i2(n)),gt(()=>t.effect_instruction_i0())?(e.pushStack(t),gt(()=>t.effect_instruction_i1())):Je),[kl]:(e,t,n)=>{const r=gt(()=>t.effect_instruction_i0.next(n));return r.done?Ke(r.value):(e.pushStack(t),f1(r.value))}},y8={[uw]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),Wo(t)?rt(r.cause):n),[fw]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[lw]:(e,t,n,r)=>(r.onFiber(e,Qq(t)),n),[dw]:(e,t,n,r)=>U(cg(),()=>n)},b8=e=>Jc(fH(e),t=>uo($H(t),([n,r])=>{const s=new Map,o=[];for(const u of r){o.push(dr(u));for(const f of u)s.set(f.request,f)}const a=o.flat();return Ao(L8(n.runAll(o),a,()=>a.forEach(u=>{u.listeners.interrupted=!0})),iA,s)},!1,!1)),S8=pp();var eI,tI;class qA extends Po{constructor(n,r,s){super();d(this,tI,yW);d(this,eI,_8);d(this,"_fiberRefs");d(this,"_fiberId");d(this,"_queue",new Array);d(this,"_children",null);d(this,"_observers",new Array);d(this,"_running",!1);d(this,"_stack",[]);d(this,"_asyncInterruptor",null);d(this,"_asyncBlockingOn",null);d(this,"_exitValue",null);d(this,"_steps",[]);d(this,"_isYielding",!1);d(this,"currentRuntimeFlags");d(this,"currentOpCount",0);d(this,"currentSupervisor");d(this,"currentScheduler");d(this,"currentTracer");d(this,"currentSpan");d(this,"currentContext");d(this,"currentDefaultServices");d(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,bk(s)){const o=this.getFiberRef(nb);d8.unsafeUpdate(1,o),a$.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return Zc(this)}id(){return this._fiberId}resume(n){this.tell(Ya(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>AV(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return pW(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Xd)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return he(()=>{const r=Tu(this._fiberId);return this.tell(Rh((s,o)=>{fd(r,K(()=>n(s,o)))})),ns(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ts(n=>{const r=s=>n(J(s));return this.tell(Rh((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),K(()=>this.tell(Rh((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return qe((n,r)=>{const s=n.id(),o=n.getFiberRefs(),a=r.runtimeFlags,u=this.getFiberRefs(),f=l5(o,s,u);n.setFiberRefs(f);const h=n.getFiberRef(d$),p=w(ei(a,h),vk(bu),vk(Zy));return HO(p)})}get poll(){return K(()=>Ca(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return K(()=>this.tell(Z_($r(n))))}unsafeInterruptAsFork(n){this.tell(Z_($r(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(d$,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Eq(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=cb(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(Os),this.currentTracer=this.currentDefaultServices.unsafeMap.get(md.key),this.currentSupervisor=this.getFiberRef(D8),this.currentScheduler=this.getFiberRef(gd),this.currentContext=this.getFiberRef(ss),this.currentSpan=this.currentContext.unsafeMap.get(Rs.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=tl;const s=globalThis[Vo];globalThis[Vo]=this;try{for(;r===tl;)r=this._queue.length===0?g8:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Vo]=s}this._queue.length>0&&!this._running?(this._running=!0,r===c$?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(bi))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=y8[o._tag](this,n,s,o)}return s}isInterrupted(){return!Ev(this.getFiberRef(Xd))}addInterruptedCause(n){const r=this.getFiberRef(Xd);this.setFiberRef(Xd,Yt(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(Z_($r(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Ov({while:()=>!r,body:()=>{const o=n.next();return o.done?K(()=>{r=!0}):nr(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(bk(this.currentRuntimeFlags)){const r=this.getFiberRef(nb),s=this.id().startTimeMillis,o=Date.now();switch(p8.unsafeUpdate(o-s,r),a$.unsafeUpdate(-1,r),n._tag){case un:{h8.unsafeUpdate(1,r);break}case cn:{m8.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(QO);!Yp(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(Tg)}log(n,r,s){const o=lt(s)?s.value:this.getFiberRef(p4),a=this.getFiberRef(AA);if(v5(a,o))return;const u=this.getFiberRef(g4),f=this.getFiberRef(GO),h=this.getLoggers(),p=this.getFiberRefs();if(hv(h)>0){const g=Gn(this.getFiberRef(Os),Na),k=new Date(g.unsafeCurrentTimeMillis());XM(p,()=>{for(const T of h)T.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:p,spans:u,annotations:f,date:k})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case dw:return c$;case uw:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(rt(n.cause)),this._asyncInterruptor=null),tl;case fw:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),tl;case lw:return n.onFiber(this,this._exitValue!==null?OV:qV(this.currentRuntimeFlags,this._asyncBlockingOn)),tl;default:return eh(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=Wo(this.currentRuntimeFlags)&&this.isInterrupted()?rt(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===Us){const a=zs.currentOp;zs.currentOp=null,a._op===yh?iH(this.currentRuntimeFlags)?(this.tell(fW()),this.tell(Ya(Tn)),r=null):r=Tn:a._op===El&&(r=null)}else{this.currentRuntimeFlags=w(this.currentRuntimeFlags,aH(Zy));const a=this.interruptAllChildren();a!==null?r=U(a,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(Ya(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Ya(n));else{this._running=!0;const r=globalThis[Vo];globalThis[Vo]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[Vo]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Ya(n))}patchRuntimeFlags(n,r){const s=wc(n,r);return globalThis[Vo]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=a=>{s||(s=!0,this.tell(Ya(a)))};Wo(n)&&(this._asyncInterruptor=o);try{r(o)}catch(a){o($t(Un(a)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==_h)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==Jh&&n._op!==Qh&&n._op!==kl)return n;n=this.popStack()}}[(tI=_W,eI=SW,ZM)](n){return K(()=>qp(this.currentContext,n))}Left(n){return St(n.left)}None(n){return St(new cd)}Right(n){return Ke(n.right)}Some(n){return Ke(n.value)}Micro(n){return Ql(r=>{let s=r;const o=iW(ZV(n,this.currentContext));return o.addObserver(a=>{if(a._tag==="Success")return s(Ke(a.value));switch(a.cause._tag){case"Interrupt":return s(rt($r(jn)));case"Fail":return s(St(a.cause.error));case"Die":return s(Yl(a.cause.defect))}}),Ql(a=>{s=u=>{a(Je)},o.unsafeInterrupt()})})}[g1](n){const r=gt(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in nl||eh(s),nl[s._op](this,s,r)):(zs.currentOp=Ke(r),Us)}[un](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in nl||eh(s),nl[s._op](this,s,r.effect_instruction_i0)):(zs.currentOp=r,Us)}[cn](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case _h:case Gh:return Wo(this.currentRuntimeFlags)&&this.isInterrupted()?rt(wk(r)):gt(()=>s.effect_instruction_i1(r));case"OnStep":return Wo(this.currentRuntimeFlags)&&this.isInterrupted()?rt(wk(r)):Ke(rt(r));case jS:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),Wo(this.currentRuntimeFlags)&&this.isInterrupted()?rt(Yt(r,this.getInterruptedCause())):rt(r);default:eh(s)}else return zs.currentOp=rt(r),Us}[_1](n){return gt(()=>n.effect_instruction_i0(this,Qq(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],a=this._steps[this._steps.length-1];let u=this.popStack();for(;u&&u._op!=="OnStep";)o.push(u),u=this.popStack();this.setFiberRefs(a.refs),this.currentRuntimeFlags=a.flags;const f=af(a.refs,r),h=ei(a.flags,s);return Ke(FO(n.effect_instruction_i0,qe(p=>{for(;o.length>0;)p.pushStack(o.pop());return p.setFiberRefs(cf(p.id(),p.getFiberRefs())(f)),p.currentRuntimeFlags=wc(h)(p.currentRuntimeFlags),n.effect_instruction_i1})))}return _r(o=>U(Ig(HH(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return b8(n.effect_instruction_i0)}[hu](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=wc(s,r);if(Wo(o)&&this.isInterrupted())return rt(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const a=ei(o,s);return this.pushStack(new VH(a,n)),gt(()=>n.effect_instruction_i1(s))}else return Tn}[Jh](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[_h](n){return this.pushStack(n),n.effect_instruction_i0}[Gh](n){return this.pushStack(n),n.effect_instruction_i0}[El](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),zs.currentOp=n,Us}[yh](n){return this._isYielding=!1,zs.currentOp=n,Us}[Qh](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):Tn}[kl](n){return nl[kl](this,n,void 0)}[Hf](n){return gt(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&oH)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=U(cg({priority:s}),()=>o)}}try{if(r=this.currentTracer.context(()=>S8!==r[ya]._V?tb(`Cannot execute an Effect versioned ${r[ya]._V} with a Runtime of version ${pp()}`):this[r._op](r),this),r===Us){const s=zs.currentOp;return s._op===yh||s._op===El?Us:(zs.currentOp=null,s._op===un||s._op===cn?s:rt(Un(s)))}}catch(s){r!==Us&&!ne(r,"_op")||!(r._op in this)?r=tb(`Not a valid effect: ${ra(r)}`):T4(s)?r=rt(Yt(Un(s),$r(jn))):r=Yl(s)}}}}const AA=Ee("effect/FiberRef/currentMinimumLogLevel",()=>gn(w5("Info"))),v8=e=>yd(t=>{const n=Sg(t.context,Os);Gn(n,bg).unsafe.log(e.log(t))}),PA=Ee(Symbol.for("effect/Logger/defaultLogger"),()=>v8(OW)),FA=Ee(Symbol.for("effect/Logger/tracerLogger"),()=>yd(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const a=Dr(nf(n,ss),Rs);if(a._tag==="None"||a.value._tag==="ExternalSpan")return;const u=qp(nf(n,Os),Na),f={};for(const[h,p]of e)f[h]=p;f["effect.fiberId"]=Wz(r),f["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(f["effect.cause"]=_i(t,{renderErrorCause:!0})),a.value.event(ra(Array.isArray(o)?o[0]:o),u.unsafeCurrentTimeNanos(),f)})),Tg=Ee(Symbol.for("effect/FiberRef/currentLoggers"),()=>d4(zp(PA,FA))),pw=y(e=>yr(e[0]),(e,t)=>yi(ag(e,n=>NA(r=>t(n,r))))),NA=e=>qe(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return U(DA,s=>Xl(s,o=>qe(a=>{const u=a.getFiberRefs(),f=a.currentRuntimeFlags,h=af(u,n),p=ei(f,r),g=af(n,u);return a.setFiberRefs(cf(h,a.id(),n)),uf(e4(e(o),p),K(()=>{a.setFiberRefs(cf(g,a.id(),a.getFiberRefs()))}))})))}),w8=e=>{if(Array.isArray(e)||DS(e))return[e,V()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),W(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},E8=(e,t,n)=>{const r=[];for(const s of e)r.push(Kc(s));return U(eu(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>{const o=V(),a=s.length,u=new Array(a),f=new Array(a);let h=!1;for(let p=0;p<a;p++){const g=s[p];g._tag==="Left"?(u[p]=W(g.left),h=!0):(f[p]=g.right,u[p]=o)}return h?t._tag==="Some"?St(t.value(u)):St(u):n!=null&&n.discard?Je:t._tag==="Some"?J(t.value(f)):J(f)})},k8=(e,t,n)=>{const r=[];for(const s of e)r.push(Kc(s));return n!=null&&n.discard?eu(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}):_e(eu(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},gw=(e,t)=>{const[n,r]=w8(e);return(t==null?void 0:t.mode)==="validate"?E8(n,r,t):(t==null?void 0:t.mode)==="either"?k8(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?_e(eu(n,ie,t),r.value):eu(n,ie,t)},eu=y(e=>DS(e[0]),(e,t,n)=>qe(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(S4);return n!=null&&n.discard?n$(n.concurrency,()=>Xa(of,n==null?void 0:n.concurrentFinalizers)(o=>s?uo(e,(a,u)=>o(t(a,u)),!0,!1,1):Jc(e,(a,u)=>o(t(a,u)))),()=>Xa(mb,n==null?void 0:n.concurrentFinalizers)(o=>uo(e,(a,u)=>o(t(a,u)),s,!1)),o=>Xa(pb(o),n==null?void 0:n.concurrentFinalizers)(a=>uo(e,(u,f)=>a(t(u,f)),s,!1,o))):n$(n==null?void 0:n.concurrency,()=>Xa(of,n==null?void 0:n.concurrentFinalizers)(o=>s?Tb(e,1,(a,u)=>o(t(a,u)),!0):Zs(e,(a,u)=>o(t(a,u)))),()=>Xa(mb,n==null?void 0:n.concurrentFinalizers)(o=>_w(e,(a,u)=>o(t(a,u)),s)),o=>Xa(pb(o),n==null?void 0:n.concurrentFinalizers)(a=>Tb(e,o,(u,f)=>a(t(u,f)),s)))})),_w=(e,t,n)=>he(()=>{const r=je(e),s=new Array(r.length);return It(uo(r,(a,u)=>U(t(a,u),f=>K(()=>s[u]=f)),n,!1),J(s))}),uo=(e,t,n,r,s)=>_r(o=>YH(a=>qe(u=>{let f=Array.from(e).reverse(),h=f.length;if(h===0)return Je;let p=0,g=!1;const k=s?Math.min(f.length,s):f.length,T=new Set,O=new Array,M=()=>T.forEach(L=>{L.currentScheduler.scheduleTask(()=>{L.unsafeInterruptAsFork(u.id())},0)}),E=new Array,S=new Array,_=new Array,C=()=>{const L=O.filter(({exit:B})=>B._tag==="Failure").sort((B,F)=>B.index<F.index?-1:B.index===F.index?0:1).map(({exit:B})=>B);return L.length===0&&L.push(Tn),L},$=(L,B=!1)=>{const F=yi(a(L)),j=C8(F,u,u.currentRuntimeFlags,_d);return u.currentScheduler.scheduleTask(()=>{B&&j.unsafeInterruptAsFork(u.id()),j.resume(F)},0),j},q=()=>{r||(h-=f.length,f=[]),g=!0,M()},P=n?KH:Es,x=$(ts(L=>{const B=(j,Z)=>{j._op==="Blocked"?_.push(j):(O.push({index:Z,exit:j}),j._op==="Failure"&&!g&&q())},F=()=>{if(f.length>0){const j=f.pop();let Z=p++;const ye=()=>{const Be=f.pop();return Z=p++,U(cg(),()=>U(P(o(t(Be,Z))),G))},G=Be=>f.length>0&&(B(Be,Z),f.length>0)?ye():J(Be),we=U(P(o(t(j,Z))),G),Re=$(we);E.push(Re),T.add(Re),g&&Re.currentScheduler.scheduleTask(()=>{Re.unsafeInterruptAsFork(u.id())},0),Re.addObserver(Be=>{let Ze;if(Be._op==="Failure"?Ze=Be:Ze=Be.effect_instruction_i0,S.push(Re),T.delete(Re),B(Ze,Z),O.length===h)L(J(Et(Ec(C(),{parallel:!0}),()=>Tn)));else if(_.length+O.length===h){const He=C(),Lt=_.map(An=>An.effect_instruction_i0).reduce(EO);L(J(FO(Lt,uo([Et(Ec(He,{parallel:!0}),()=>Tn),..._.map(An=>An.effect_instruction_i1)],An=>An,n,!0,s))))}else F()})}};for(let j=0;j<k;j++)F()}));return nr(Is(ku(o(Zc(x))),gg({onFailure:L=>{q();const B=_.length+1,F=Math.min(typeof s=="number"?s:_.length,_.length),j=Array.from(_);return ts(Z=>{let ye=0,G=0;const we=(Be,Ze)=>He=>{ye++,ye===B&&Z(Ke(rt(L))),j.length>0&&Ze&&Re()},Re=()=>{$(j.pop(),!0).addObserver(we(G,!0)),G++};x.addObserver(we(G,!1)),G++;for(let Be=0;Be<F;Be++)Re()})},onSuccess:()=>Zs(S,L=>L.inheritAll)})))}))),Tb=(e,t,n,r)=>he(()=>{const s=je(e),o=new Array(s.length);return It(uo(s,(u,f)=>_e(n(u,f),h=>o[f]=h),r,!1,t),J(o))}),$8=e=>qe((t,n)=>J(yw(e,t,n.runtimeFlags))),Ig=e=>T8(e,_d),yw=(e,t,n,r=null)=>{const s=$m(e,t,n,r);return s.resume(e),s},C8=(e,t,n,r=null)=>$m(e,t,n,r),$m=(e,t,n,r=null)=>{const s=iO(),o=t.getFiberRefs(),a=f5(o,s),u=new qA(s,a,n),f=nf(a,ss),h=u.currentSupervisor;return h.onStart(f,e,W(t),u),u.addObserver(g=>h.onEnd(g,u)),(r!==null?r:w(t.getFiberRef(rb),Et(()=>t.scope()))).add(n,u),u},T8=(e,t)=>qe((n,r)=>J(yw(e,n,r.runtimeFlags,t))),u$=e=>Ru(t=>st(Dr(t,Fo),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return U(hg(n,mb),r=>qu(e,r))}}})),l$=e=>t=>Ru(n=>st(Dr(n,Fo),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:U(hg(r,pb(e)),s=>qu(t,s))})),Xa=(e,t)=>n=>Ru(r=>st(Dr(r,Fo),{onNone:()=>n(ie),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?u$:e._tag==="Sequential"?f$:l$(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(u$));case"Sequential":return o(n(f$));case"ParallelN":return o(n(l$(s.strategy.parallelism)))}}else return n(ie)}})),bw=e=>U(Fo,e),xA=e=>U(Ed(),t=>Is(e(t),n=>t.close(n))),I8=e=>U(Ed(),t=>F8(e,t)),f$=e=>Ru(t=>st(Dr(t,Fo),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return U(hg(n,of),r=>qu(e,r))}}})),R8=y(e=>yr(e[1]),(e,t,n)=>wd(e,t,(r,s)=>[r,s],n)),O8=y(e=>yr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?qv(e,t):wd(e,t,(r,s)=>r,n)),q8=y(e=>yr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?It(e,t):wd(e,t,(r,s)=>s,n)),wd=y(e=>yr(e[1]),(e,t,n,r)=>_e(gw([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),Fo=tr("effect/Scope"),DA=Fo,A8=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},P8={[Ck]:Ck,[Tk]:Tk,pipe(){return ee(this,arguments)},fork(e){return K(()=>{const t=MA(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),A8(t,s=>K(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return he(()=>{if(this.state._tag==="Closed")return Je;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?Je:SV(this.strategy)?w(Zs(t,n=>Es(n(e))),U(n=>w(Ec(n),Zo(Q_),Et(()=>Tn)))):vV(this.strategy)?w(_w(t,n=>Es(n(e)),!1),U(n=>w(Ec(n,{parallel:!0}),Zo(Q_),Et(()=>Tn)))):w(Tb(t,this.strategy.parallelism,n=>Es(n(e)),!1),U(n=>w(Ec(n,{parallel:!0}),Zo(Q_),Et(()=>Tn))))})},addFinalizer(e){return he(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),Je))}},MA=(e=pd)=>{const t=Object.create(P8);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},Ed=(e=pd)=>K(()=>MA(e)),qu=y(2,(e,t)=>oq(e,qo(Xf(Fo,t)))),F8=y(2,(e,t)=>w(e,qu(t),Is(n=>t.close(n)))),N8=e=>Cu(e,{differ:f8,fork:Cl}),x8=y(2,(e,t)=>nr(pw(U(id(e),n=>Xt(dm(e,t),n)),n=>dm(e,n)))),Sw=y(2,(e,t)=>$u(e,n=>x8(e,t(n)))),d$=m4(cH),D8=N8(Cg),LA=y(3,(e,t,n)=>UA(e,t,{onSelfWin:(r,s)=>U(r.await,o=>{switch(o._tag){case un:return U(r.inheritAll,()=>n.onSelfDone(o,s));case cn:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>U(r.await,o=>{switch(o._tag){case un:return U(r.inheritAll,()=>n.onOtherDone(o,s));case cn:return n.onOtherDone(o,s)}})})),M8=e=>_r(t=>qa(n=>U(Ig(t(e)),r=>w(t(Zc(r)),Aa(()=>w(r,cA(n))))))),jA=y(2,(e,t)=>qa(n=>LA(e,t,{onSelfDone:(r,s)=>ib(r,{onFailure:o=>w(Zc(s),Qk(a=>So(o,a))),onSuccess:o=>w(s,eo(n),Xt(o))}),onOtherDone:(r,s)=>ib(r,{onFailure:o=>w(Zc(s),Qk(a=>So(a,o))),onSuccess:o=>w(s,eo(n),Xt(o))})}))),UA=y(3,(e,t,n)=>qe((r,s)=>{const o=s.runtimeFlags,a=Ia(!0),u=$m(e,r,o,n.selfScope),f=$m(t,r,o,n.otherScope);return ts(h=>{u.addObserver(()=>h$(u,f,n.onSelfWin,a,h)),f.addObserver(()=>h$(f,u,n.onOtherWin,a,h)),u.startFork(e),f.startFork(t)},hr(u.id(),f.id()))})),h$=(e,t,n,r,s)=>{Nz(!0,!1)(r)&&s(n(e,t))},uf=y(2,(e,t)=>_r(n=>Bn(n(e),{onFailure:r=>Bn(t,{onFailure:s=>$t(Yt(r,s)),onSuccess:()=>$t(r)}),onSuccess:r=>Xt(t,r)}))),L8=(e,t,n)=>qa(r=>U(U(Ig(og(e)),s=>ts(o=>{const a=t.map(h=>h.listeners.count),u=()=>{a.every(h=>h===0)&&t.every(h=>h.result.state.current._tag==="Pending"?!0:!!(h.result.state.current._tag==="Done"&&pg(h.result.state.current.effect)&&h.result.state.current.effect._tag==="Failure"&&kv(h.result.state.current.effect.cause)))&&(f.forEach(h=>h()),n==null||n(),o(Av(s)))};s.addObserver(h=>{f.forEach(p=>p()),o(h)});const f=t.map((h,p)=>{const g=k=>{a[p]=k,u()};return h.listeners.addObserver(g),()=>h.listeners.removeObserver(g)});return u(),K(()=>{f.forEach(h=>h())})})),()=>he(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Jc(s,o=>r8(o.request,Fv(r)))}))),m$=(e,t)=>(t=co(t),yi(qe(n=>{const r=qp(n.getFiberRef(ss),Fo),s=Zv(n,e,t),o=n.getFiberRef(dg),a=Gn(n.getFiberRef(Os),Na);return Xt(Xl(r,u=>gm(s,u,a,o)),s)}))),j8=e=>Sw(Os,gs(md,e)),U8=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return U(m$(t,co(n)),s=>sf(r,Rs,s))}return r=>U(m$(t,co(n)),s=>sf(r,Rs,s))},z8=bo,Au=_a,va=Un,Rg=$r,B8=So,H8=Yt,V8=vv,zA=IH,W8=wv,lf=kv,lo=Yp,K8=$v,Og=Xp,vw=OH,qg=OO,ww=E4,Ew=tg,J8=I4,Ag=cd,Cm=_i,G8=Cv,Q8="effect/ScheduleInterval",Tm=Symbol.for(Q8),BA={[Tm]:Tm,startMillis:0,endMillis:0},kw=(e,t)=>e>t?BA:{[Tm]:Tm,startMillis:e,endMillis:t},Y8=y(2,(e,t)=>X8(e,t)===e),X8=y(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),Z8=e=>e.startMillis>=e.endMillis,eJ=y(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return kw(n,r)}),tJ=e=>fa(e.endMillis-e.startMillis),nJ=e=>kw(e,Number.POSITIVE_INFINITY),p$=kw,HA=BA,rJ=Y8,sJ=Z8,oJ=eJ,iJ=tJ,aJ=nJ,cJ="effect/ScheduleIntervals",g$=Symbol.for(cJ),VA=e=>({[g$]:g$,intervals:e}),uJ=y(2,(e,t)=>lJ(e.intervals,t.intervals,yt())),lJ=(e,t,n)=>{let r=e,s=t,o=n;for(;yo(r)&&yo(s);){const a=w(bs(r),oJ(bs(s))),u=sJ(a)?o:w(o,wn(a));w(bs(r),rJ(bs(s)))?r=Xs(r):s=Xs(s),o=u}return VA(_o(o))},Ib=e=>w(e.intervals,Pp,Et(()=>HA)).startMillis,fJ=e=>w(e.intervals,Pp,Et(()=>HA)).endMillis,dJ=y(2,(e,t)=>Ib(e)<Ib(t)),hJ=e=>yo(e.intervals),mJ=VA,pJ=uJ,Rb=Ib,Ob=fJ,gJ=dJ,_J=hJ,$w="Continue",WA="Done",yJ=e=>({_tag:$w,intervals:e}),bJ=e=>({_tag:$w,intervals:mJ(ft(e))}),SJ={_tag:WA},vJ=e=>e._tag===$w,wJ=e=>e._tag===WA,EJ=yJ,KA=bJ,ff=SJ,_$=vJ,df=wJ,kJ=Fo,ni=ZO,$J=Xl,bn=sb,Cw=qu,Tw=hg,Iw=Ed,CJ=Jp,Rw=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends Pv{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError}(),TJ=e=>{const t={BaseEffectError:class extends Rw{constructor(){super(...arguments);d(this,"_tag",e)}}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},IJ="effect/Schedule",JA=Symbol.for(IJ),GA=e=>ne(e,JA),RJ="effect/ScheduleDriver",OJ=Symbol.for(RJ),qJ={_Out:e=>e,_In:e=>e,_R:e=>e},AJ={_Out:e=>e,_In:e=>e,_R:e=>e};var nI;nI=JA;class PJ{constructor(t,n){d(this,"initial");d(this,"step");d(this,nI,qJ);this.initial=t,this.step=n}pipe(){return ee(this,arguments)}}var rI;rI=OJ;class FJ{constructor(t,n){d(this,"schedule");d(this,"ref");d(this,rI,AJ);this.schedule=t,this.ref=n}get state(){return _e(ti(this.ref),t=>t[1])}get last(){return U(ti(this.ref),([t,n])=>{switch(t._tag){case"None":return sd(()=>new cd);case"Some":return J(t.value)}})}get reset(){return rf(this.ref,[V(),this.schedule.initial])}next(t){return w(_e(ti(this.ref),n=>n[1]),U(n=>w(s5,U(r=>w(he(()=>this.schedule.step(r,t,n)),U(([s,o,a])=>{const u=rf(this.ref,[W(o),s]);if(df(a))return It(u,St(V()));const f=Rb(a.intervals)-r;return f<=0?Xt(u,o):w(u,It(Xv(fa(f))),Xt(o))}))))))}}const Pu=(e,t)=>new PJ(e,t),NJ=y(2,(e,t)=>xJ(e,n=>K(()=>t(n)))),xJ=y(2,(e,t)=>zJ(e,(n,r)=>_e(t(n),s=>QU(r,gr(s))))),DJ=y(2,(e,t)=>Ow(e,(n,r)=>K(()=>t(n,r)))),Ow=y(2,(e,t)=>Pu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>df(u)?J([o,a,ff]):_e(t(r,a),f=>f?[o,a,u]:[o,a,ff])))),MJ=e=>NJ(e,t=>t),QA=e=>w(pm([V(),e.initial]),_e(t=>new FJ(e,t))),LJ=(e,t=2)=>{const n=gr(e);return MJ(XA(Pg,r=>GU(n,Math.pow(t,r))))},YA=y(2,(e,t)=>jJ(e,t,pJ)),jJ=y(3,(e,t,n)=>Pu([e.initial,t.initial],(r,s,o)=>w(VO(e.step(r,s,o[0]),t.step(r,s,o[1]),(a,u)=>[a,u]),U(([[a,u,f],[h,p,g]])=>_$(f)&&_$(g)?qb(e,t,s,a,u,f.intervals,h,p,g.intervals,n):J([[a,h],[u,p],ff]))))),qb=(e,t,n,r,s,o,a,u,f,h)=>{const p=h(o,f);return _J(p)?J([[r,a],[s,u],EJ(p)]):w(o,gJ(f))?U(e.step(Ob(o),n,r),([g,k,T])=>df(T)?J([[g,a],[k,u],ff]):qb(e,t,n,g,k,T.intervals,a,u,f,h)):U(t.step(Ob(f),n,a),([g,k,T])=>df(T)?J([[r,g],[s,k],ff]):qb(e,t,n,r,s,o,g,k,T.intervals,h))},XA=y(2,(e,t)=>UJ(e,n=>K(()=>t(n)))),UJ=y(2,(e,t)=>Pu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>_e(t(a),f=>[o,f,u])))),zJ=y(2,(e,t)=>Pu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>{if(df(u))return J([o,a,u]);const f=u.intervals,h=iJ(p$(n,Rb(f)));return _e(t(a,h),p=>{const g=gr(p),k=Rb(f),T=n+xc(g),O=T-k,M=Math.max(0,Ob(f)+O),E=p$(T,M);return[o,a,KA(E)]})}))),BJ=e=>Pu(e.initial,(t,n,r)=>w(e.step(t,n,r),_e(([s,o,a])=>[s,n,a]))),ZA=e=>VJ(Pg,t=>t<e),HJ=(e,t)=>Pu(e,(n,r,s)=>K(()=>[t(s),s,KA(aJ(n))])),eP=y(2,(e,t)=>Ow(e,(n,r)=>X5(t(n)))),tP=y(2,(e,t)=>Ow(e,(n,r)=>t(n))),VJ=y(2,(e,t)=>DJ(e,(n,r)=>t(r))),qh=Symbol.for("effect/Schedule/ScheduleDefect");var sI;sI=qh;class WJ{constructor(t){d(this,"error");d(this,sI);this.error=t,this[qh]=qh}}const KJ=e=>ne(e,qh),Im=e=>Wc(e,t=>Yl(new WJ(t))),nP=e=>rg(e,t=>st(Zp(t,n=>wv(n)&&KJ(n.defect)?W(n.defect):V()),{onNone:()=>$t(t),onSome:n=>St(n.error)})),y$=y(2,(e,t)=>GJ(e,t,(n,r)=>St(n))),JJ=y(2,(e,t)=>{if(GA(t))return y$(e,t);const n=t.schedule??BJ(Pg),r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):Im(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):Im(u)}):r,o=t.times?YA(s,ZA(t.times)).pipe(XA(a=>a[0])):s;return nP(y$(e,o))}),GJ=y(3,(e,t,n)=>U(QA(t),r=>vo(e,{onFailure:s=>n(s,V()),onSuccess:s=>rP(e,r,n,s)}))),rP=(e,t,n,r)=>vo(t.next(r),{onFailure:()=>Rv(t.last),onSuccess:s=>vo(e,{onFailure:o=>n(o,W(s)),onSuccess:o=>rP(e,t,n,o)})}),b$=y(2,(e,t)=>YJ(e,t,(n,r)=>St(n))),QJ=y(2,(e,t)=>{if(GA(t))return b$(e,t);const n=t.schedule??Pg,r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):Im(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):Im(u)}):r,o=t.times?YA(s,ZA(t.times)):s;return nP(b$(e,o))}),YJ=y(3,(e,t,n)=>U(QA(t),r=>sP(e,r,n))),sP=(e,t,n)=>Wc(e,r=>vo(t.next(r),{onFailure:()=>w(t.last,Rv,U(s=>n(r,s))),onSuccess:()=>sP(e,t,n)})),Pg=HJ(0,e=>e+1);class XJ{constructor(t){d(this,"permits");d(this,"waiters",new Set);d(this,"taken",0);d(this,"take",t=>Go(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(J(t)))};return this.waiters.add(r),K(()=>{this.waiters.delete(r)})}return this.taken+=t,n(J(t))}));d(this,"updateTaken",t=>qe(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(gd).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(bi)),J(this.free))));d(this,"release",t=>this.updateTaken(n=>n-t));d(this,"releaseAll",this.updateTaken(t=>0));d(this,"withPermits",t=>n=>_r(r=>U(r(this.take(t)),s=>uf(r(n),this.release(s)))));d(this,"withPermitsIfAvailable",t=>n=>_r(r=>he(()=>this.free<t?tV:(this.taken+=t,uf(r(D5(n)),this.release(t))))));this.permits=t}get free(){return this.permits-this.taken}}const oP=e=>new XJ(e),ZJ=e=>K(()=>oP(e));class eG extends Po{constructor(n){super();d(this,"isOpen");d(this,"waiters",[]);d(this,"scheduled",!1);d(this,"flushWaiters",()=>{this.scheduled=!1;const n=this.waiters;this.waiters=[];for(let r=0;r<n.length;r++)n[r](Tn)});d(this,"open",qe(n=>this.isOpen?Je:(this.isOpen=!0,this.unsafeSchedule(n))));d(this,"release",qe(n=>this.isOpen?Je:this.unsafeSchedule(n)));d(this,"await",Go(n=>this.isOpen?n(Je):(this.waiters.push(n),K(()=>{const r=this.waiters.indexOf(n);r!==-1&&this.waiters.splice(r,1)}))));d(this,"close",K(()=>{this.isOpen=!1}));d(this,"whenOpen",n=>It(this.await,n));this.isOpen=n}commit(){return this.await}unsafeSchedule(n){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,n.currentScheduler.scheduleTask(this.flushWaiters,n.getFiberRef(bi))),Je}unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}unsafeClose(){this.isOpen=!1}}const iP=e=>new eG(e??!1),tG=e=>K(()=>iP(e)),aP=y(2,(e,t)=>qe((n,r)=>{const s=t,o=yw(e,n,r.runtimeFlags,_d);if(s.state._tag==="Open"){const a=()=>qa(f=>de(f,o.id())?Je:nr(Av(o))),u={};s.state.finalizers.set(u,a),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(u)})}else o.unsafeInterruptAsFork(n.id());return J(o)})),nG=e=>bw(t=>aP(e,t)),rG=y(2,(e,t)=>w(Es(e),jA(Es(t)),n=>ku(n))),sG=y(2,(e,t)=>oG(e,{onTimeout:()=>O4(t),duration:t})),oG=y(2,(e,{duration:t,onTimeout:n})=>ku(iG(e,{onTimeout:()=>sd(n),onSuccess:J,duration:t}))),iG=y(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>qa(s=>_r(o=>UA(o(e),og(Xv(t)),{onSelfWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>Xt(eo(u,s),n(f.value))):U(eo(u,s),()=>rt(f.cause))),onOtherWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>Xt(eo(u,s),r())):U(eo(u,s),()=>rt(f.cause))),otherScope:_d})))),aG="effect/Ref/SynchronizedRef",cP=Symbol.for(aG),uP={_A:e=>e};var oI,iI,aI,cI;class cG extends(cI=Po,aI=cP,iI=Gv,oI=ci,cI){constructor(n,r){super();d(this,"ref");d(this,"withLock");d(this,aI,uP);d(this,iI,Qv);d(this,oI,ci);d(this,"get");this.ref=n,this.withLock=r,this.get=ti(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>J(n(r)))}modifyEffect(n){return this.withLock(w(U(ti(this.ref),n),U(([r,s])=>Xt(rf(this.ref,s),r))))}}const uG=e=>K(()=>lP(e)),lP=e=>{const t=Iq(e),n=oP(1);return new cG(t,n.withPermits(1))},lG=Symbol.for("effect/ManagedRuntime"),fG="Fold",dG="Fresh",hG="FromEffect",mG="Scoped",pG="Suspend",gG="Provide",fP="ProvideMerge",_G="ZipWith",dP=aA,yG=EW,S$=vW,Nr=Av,Fg=eo,hP=wW,Rm=Zc,kd=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},Ng=kd((e,t,n)=>{const r=iO(),s=[[ss,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([gd,[[r,n.scheduler]]]);let o=h5(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const a=new qA(r,o,e.runtimeFlags);let u=t;n!=null&&n.scope&&(u=U(Tw(n.scope,pd),h=>It(ZO(h,qa(p=>de(p,a.id())?Je:eo(a,p))),Is(t,p=>bn(h,p)))));const f=a.currentSupervisor;return f!==Cg&&(f.onStart(e.context,u,V(),a),a.addObserver(h=>f.onEnd(h,a))),_d.add(e.runtimeFlags,a),(n==null?void 0:n.immediate)===!1?a.resume(u):a.start(u),a}),bG=kd((e,t)=>{const n=EG(e)(t);if(n._tag==="Failure")throw mP(n.effect_instruction_i0);return n.effect_instruction_i0});class SG extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);d(this,"fiber");d(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const vG=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new SG(e);return Error.stackTraceLimit=t,n},ey=Symbol.for("effect/Runtime/FiberFailure"),th=Symbol.for("effect/Runtime/FiberFailure/Cause");var uI,lI;class wG extends Error{constructor(n){const r=Cv(n)[0];super((r==null?void 0:r.message)||"An error has occurred");d(this,lI);d(this,uI);this[ey]=ey,this[th]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[th].toJSON()}}toString(){return"(FiberFailure) "+_i(this[th],{renderErrorCause:!0})}[(lI=ey,uI=th,Ue)](){return this.toString()}}const mP=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new wG(e);return Error.stackTraceLimit=t,n},pP=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return Zl(t.left);case"Right":return Ke(t.right);case"Some":return Ke(t.value);case"None":return Zl(cd())}},EG=kd((e,t)=>{const n=pP(t);if(n)return n;const r=new oA,s=Ng(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||fc(Tv(vG(s),Lv(s)))}),kG=kd((e,t,n)=>gP(e,t,n).then(r=>{switch(r._tag){case un:return r.effect_instruction_i0;case cn:throw mP(r.effect_instruction_i0)}})),gP=kd((e,t,n)=>new Promise(r=>{const s=pP(t);s&&r(s);const o=Ng(e)(t);o.addObserver(a=>{r(a)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class _P{constructor(t,n,r){d(this,"context");d(this,"runtimeFlags");d(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return ee(this,arguments)}}const yP=e=>new _P(e.context,e.runtimeFlags,e.fiberRefs),$G=()=>qe((e,t)=>J(new _P(e.getFiberRef(ss),t.runtimeFlags,e.getFiberRefs()))),CG=vO(bu,bO,yO),hf=yP({context:po(),runtimeFlags:CG,fiberRefs:m5()}),TG=y(2,(e,t)=>yP({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),IG=Ng(hf),RG=kG(hf),OG=bG(hf),qG=y(2,(e,t)=>e.modifyEffect(t)),AG="effect/Layer",bP=Symbol.for(AG),PG={_RIn:e=>e,_E:e=>e,_ROut:e=>e},ui={[bP]:PG,pipe(){return ee(this,arguments)}},FG="effect/Layer/MemoMap",ty=Symbol.for(FG),NG=_u()("effect/Layer/CurrentMemoMap",{defaultValue:()=>MG()}),SP=e=>ne(e,bP),xG=e=>e._op_layer===dG;var fI;fI=ty;class vP{constructor(t){d(this,"ref");d(this,fI);this.ref=t,this[ty]=ty}getOrElseMemoize(t,n){return w(qG(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,a]=s,u=w(o,U(([f,h])=>w(Bq(f),Xt(h))),Is(gg({onFailure:()=>Je,onSuccess:()=>Xl(n,a)})));return J([u,r])}return w(pm(0),U(o=>w(Iu(),U(a=>w(pm(()=>Je),_e(u=>{const f=_r(p=>w(Ed(),U(g=>w(p(U(wP(t,g,!0),k=>H5(k(this)))),Es,U(k=>{switch(k._tag){case cn:return w(sq(a,k.effect_instruction_i0),It(sb(g,k)),It($t(k.effect_instruction_i0)));case un:return w(rf(u,T=>w(sb(g,T),od(Rq(o,O=>[O===1,O-1])),nr)),It(lb(o,T=>T+1)),It(Xl(n,T=>w(K(()=>r.delete(t)),It(ti(u)),U(O=>O(T))))),It(ld(a,k.effect_instruction_i0)),Xt(k.effect_instruction_i0[1]))}}))))),h=[w(ns(a),Is(ib({onFailure:()=>Je,onSuccess:()=>lb(o,p=>p+1)}))),p=>w(ti(u),U(g=>g(p)))];return[f,xG(t)?r:r.set(t,h)]}))))))}),ku)}}const DG=he(()=>_e(uG(new Map),e=>new vP(e))),MG=()=>new vP(lP(new Map)),qw=y(2,(e,t)=>U(DG,n=>LG(e,n,t))),LG=y(3,(e,t,n)=>U(wP(e,n),r=>sf(r(t),NG,t))),wP=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return K(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return K(()=>s=>bw(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return K(()=>s=>w(s.getOrElseMemoize(r.layer,t),Bn({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return K(()=>s=>w(r.layer,qw(t)));case"FromEffect":return K(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return K(()=>s=>w(s.getOrElseMemoize(r.first,t),U(o=>w(s.getOrElseMemoize(r.second,t),Dv(o)))));case"Scoped":return K(n?()=>s=>qu(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return K(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return K(()=>s=>w(s.getOrElseMemoize(r.first,t),VO(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return K(()=>s=>w(s.getOrElseMemoize(r.first,t),wd(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},jG=()=>Fu(dd()),UG=e=>EP(Au(e)),EP=e=>Fu($t(e)),Aw=y(2,(e,t)=>BG(e,{onFailure:UG,onSuccess:t})),kP=y(2,(e,t)=>{const n=Op(e),r=n?e:t;return Fu(_e(n?t:e,o=>Xf(r,o)))});function Fu(e){const t=Object.create(ui);return t._op_layer=hG,t.effect=e,t}const zG=y(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(ui);return r._op_layer=fG,r.layer=e,r.failureK=t,r.successK=n,r}),BG=y(2,(e,{onFailure:t,onSuccess:n})=>zG(e,{onFailure:r=>{const s=Og(r);switch(s._tag){case"Left":return t(s.left);case"Right":return EP(s.right)}},onSuccess:n})),HG=y(2,(e,t)=>QG(e,t,(n,r)=>qo(n,r))),$P=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=HG(t,e[n]);return t},CP=y(2,(e,t)=>{const n=Op(e),r=n?e:t;return TP(_e(n?t:e,o=>Xf(r,o)))}),xg=e=>TP(w(e,Xt(po()))),TP=e=>{const t=Object.create(ui);return t._op_layer=mG,t.effect=e,t},VG=y(2,(e,t)=>{const n=Op(e);return Fu(J(Xf(n?e:t,n?t:e)))}),WG=e=>Fu(J(e)),KG=WG(po()),IP=e=>{const t=Object.create(ui);return t._op_layer=pG,t.evaluate=e,t},JG=y(2,(e,t)=>{const n=Op(e),r=n?e:t,s=n?t:e;return Fu(K(()=>Xf(r,s())))}),RP=y(2,(e,t)=>IP(()=>{const n=Object.create(ui);return n._op_layer=gG,n.first=Object.create(ui,{_op_layer:{value:fP,enumerable:!0},first:{value:jG(),enumerable:!0},second:{value:Array.isArray(t)?$P(...t):t},zipK:{value:(r,s)=>w(r,qo(s))}}),n.second=e,n})),GG=y(2,(e,t)=>{const n=Object.create(ui);return n._op_layer=fP,n.first=t,n.second=RP(e,t),n.zipK=(r,s)=>w(r,qo(s)),n}),QG=y(3,(e,t,n)=>IP(()=>{const r=Object.create(ui);return r._op_layer=_G,r.first=e,r.second=t,r.zipK=n,r})),YG=e=>{const t=tr("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return Aw(kP(t,e),n=>Gn(n,t))},XG=e=>{const t=tr("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return Aw(CP(t,e),n=>Gn(n,t))},v$=y(2,(e,t)=>xA(n=>U(qw(t,n),r=>Mv(e,r)))),w$=y(2,(e,t)=>{const n=af(hf.fiberRefs,t.fiberRefs),r=ei(hf.runtimeFlags,t.runtimeFlags);return _r(s=>qe(o=>{const a=o.getFiberRef(ss),u=o.getFiberRefs(),f=cf(o.id(),u)(n),h=o.currentRuntimeFlags,p=wc(r)(h),g=af(f,u),k=ei(p,h);return o.setFiberRefs(f),o.currentRuntimeFlags=p,uf(Mv(s(e),qo(a,t.context)),qe(T=>(T.setFiberRefs(cf(T.id(),T.getFiberRefs())(g)),T.currentRuntimeFlags=wc(k)(T.currentRuntimeFlags),Je)))}))}),ZG=y(2,(e,t)=>Array.isArray(t)?v$(e,$P(...t)):SP(t)?v$(e,t):CU(t)?Mv(e,t):lG in t?U(t.runtimeEffect,n=>w$(e,n)):w$(e,t)),e9=n8,E$=ya,Mr=yr,ny=Y5,$d=gw,Sn=eu,OP=ts,qs=qe,zn=St,Qn=$t,li=Yl,qP=tb,z=XH,Pw=t4,Dg=eV,Le=J,_t=he,Te=K,fe=Je,Mg=Wc,ks=rg,t9=M5,n9=LO,ry=L5,Fw=j5,Nw=Uq,Cd=K5,xw=QJ,No=Mq,r9=cV,Tl=aV,s9=M8,hs=dn,Pt=og,o9=Aa,Qo=yi,fi=_r,fo=Xt,As=nr,Se=_e,AP=Iv,wo=ig,it=pw,PP=DO,Zn=NA,Li=uf,i9=JH,a9=Is,Lg=DA,c9=bw,Om=xA,di=I8,Dw=qa,jg=$8,Mw=Ig,mr=aP,Kt=nG,u9=lW,l9=y4,f9=z5,d9=B5,tu=Xv,Ug=sG,FP=dd,h9=oq,In=ZG,Ah=sf,m9=fV,p9=dV,Oi=Kc,Jt=Es,Td=BO,NP=lV,X=U,Jr=WH,Ai=ku,sy=jA,xP=rG,Lw=LA,Eo=ag,g9=rV,Nu=sV,mf=W5,k$=JJ,_9=lg,y9=Lq,pf=UO,Cr=Bn,b9=J5,ms=zq,to=G5,nu=Q5,$c=x5,S9=v4,Tr=Rv,xo=$G,zg=ZJ,v9=iP,Ab=tG,Do=IG,DP=RG,$s=OG,qm=R8,jw=O8,pt=q8,ru=wd,w9=iV,E9=mV,Pb=hV,Bg=Vq,k9=pV,$9=db,Ie=gV,Id=U8,ji=hb,Hg=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return $$(e.length,function(...a){const u=Error.stackTraceLimit;Error.stackTraceLimit=2;const f=new Error;return Error.stackTraceLimit=u,C$({self:this,body:e,args:a,pipeables:t,spanName:"<anonymous>",spanOptions:{context:mm.context(!0)},errorDef:r,errorCall:f})});const s=e,o=t[0];return(a,...u)=>$$(a.length,{[s](...f){const h=Error.stackTraceLimit;Error.stackTraceLimit=2;const p=new Error;return Error.stackTraceLimit=h,C$({self:this,body:a,args:f,pipeables:u,spanName:s,spanOptions:o,errorDef:r,errorCall:p})}}[s])};function $$(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function C$(e){let t,n;if(JM(e.body))t=fm(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(a){n=a,t=li(a)}if(e.pipeables.length>0)try{for(const a of e.pipeables)t=a(t,...e.args)}catch(a){t=n?Qn(Yt(Un(n),Un(a))):li(a)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const a=e.errorDef.stack.trim().split(`
`),u=e.errorCall.stack.trim().split(`
`);let f=a.slice(2).join(`
`).trim();f.includes("(")||(f=f.replace(/at (.*)/,"at ($1)"));let h=u.slice(2).join(`
`).trim();return h.includes("(")||(h=h.replace(/at (.*)/,"at ($1)")),r=`${f}
${h}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return Ie(t,e.spanName,o)}const Am=ZH,Uw=gn,C9=id,T9=$u,MP=ss,I9=bi,R9=Tg,LP=gd,O9=YO,q9=dg,A9=y(2,(e,t)=>Ao(AA,t)(e)),P9=e=>xg(Sw(Tg,vc(e))),F9=e=>xg(Sw(Tg,mv(e))),N9=y(2,(e,t)=>Aw(F9(e),()=>P9(t))),x9=e=>xg(j8(e)),D9=SP,jP=qw,UP=kP,M9=KG,L9=CP,j9=xg,zw=VG,U9=JG,Bw=RP,zP=GG,BP=YG,Hw=XG,HP=x9,z9="effect/QueueEnqueue",VP=Symbol.for(z9),B9="effect/QueueDequeue",Vw=Symbol.for(B9),H9="effect/QueueStrategy",Ww=Symbol.for(H9),V9="effect/BackingQueue",W9=Symbol.for(V9),Kw={_A:e=>e},K9={_A:e=>e},WP={_In:e=>e},Jw={_Out:e=>e};var dI,hI,mI;class J9 extends(mI=Po,hI=VP,dI=Vw,mI){constructor(n,r,s,o,a){super();d(this,"queue");d(this,"takers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,hI,WP);d(this,dI,Jw);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}pipe(){return ee(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return he(()=>Wc(this.unsafeSize(),()=>dn))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.queue.length()-Hv(this.takers)+this.strategy.surplusSize())}get isEmpty(){return _e(this.size,n=>n<=0)}get isFull(){return _e(this.size,n=>n>=this.capacity())}get shutdown(){return yi(qe(n=>(w(this.shutdownFlag,Ra(!0)),w(uo(Cc(this.takers),r=>xv(r,n.id()),!1,!1),It(this.strategy.shutdown),od(ld(this.shutdownHook,void 0)),nr))))}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get awaitShutdown(){return ns(this.shutdownHook)}isActive(){return!ze(this.shutdownFlag)}unsafeOffer(n){if(ze(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const o=w(this.takers,ao(Vt));o!==Vt?(Qi(o,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return Ui(this.strategy,this.queue,this.takers),s}offer(n){return he(()=>{if(ze(this.shutdownFlag))return dn;let r;if(this.queue.length()===0){const o=w(this.takers,ao(Vt));o!==Vt?(Qi(o,n),r=!0):r=!1}else r=!1;if(r)return J(!0);const s=this.queue.offer(n);return Ui(this.strategy,this.queue,this.takers),s?J(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return he(()=>{if(ze(this.shutdownFlag))return dn;const r=je(n),s=this.queue.length()===0?je(mQ(this.takers,r.length)):oi,[o,a]=w(r,M1(s.length));for(let f=0;f<s.length;f++){const h=s[f],p=o[f];Qi(h,p)}if(a.length===0)return J(!0);const u=this.queue.offerAll(a);return Ui(this.strategy,this.queue,this.takers),Zf(u)?J(!0):this.strategy.handleSurplus(u,this.queue,this.takers,this.shutdownFlag)})}get take(){return qe(n=>{if(ze(this.shutdownFlag))return dn;const r=this.queue.poll(Vt);if(r!==Vt)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),J(r);{const s=Tu(n.id());return w(he(()=>(w(this.takers,Qc(s)),Ui(this.strategy,this.queue,this.takers),ze(this.shutdownFlag)?dn:ns(s))),Aa(()=>K(()=>pQ(this.takers,s))))}})}get takeAll(){return he(()=>ze(this.shutdownFlag)?dn:K(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),go(n)}))}takeUpTo(n){return he(()=>ze(this.shutdownFlag)?dn:K(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),go(r)}))}takeBetween(n,r){return he(()=>KP(this,n,r,yt()))}}const KP=(e,t,n,r)=>n<t?J(r):w(aQ(e,n),U(s=>{const o=t-s.length;return o===1?w(Fb(e),_e(a=>w(r,Rt(s),Bl(a)))):o>1?w(Fb(e),U(a=>KP(e,o-1,n-s.length-1,w(r,Rt(s),Bl(a))))):J(w(r,Rt(s)))})),G9=e=>w(K(()=>Bv(e)),U(t=>Vg(Wg(t),uQ()))),Q9=e=>w(K(()=>Bv(e)),U(t=>Vg(Wg(t),JP()))),Y9=e=>w(K(()=>Bv(e)),U(t=>Vg(Wg(t),lQ()))),X9=()=>w(K(()=>_g()),U(e=>Vg(Wg(e),JP()))),Z9=(e,t,n,r,s)=>new J9(e,t,n,r,s),Vg=(e,t)=>w(Iu(),_e(n=>Z9(e,_g(),n,Ia(!1),t)));var pI;pI=W9;class eQ{constructor(t){d(this,"mutable");d(this,pI,K9);this.mutable=t}poll(t){return ao(this.mutable,t)}pollUpTo(t){return yg(this.mutable,t)}offerAll(t){return Vv(this.mutable,t)}offer(t){return Qc(this.mutable,t)}capacity(){return i6(this.mutable)}length(){return Hv(this.mutable)}}const Wg=e=>new eQ(e),tQ=e=>e.size,nQ=e=>e.isShutdown,rQ=e=>e.shutdown,sQ=y(2,(e,t)=>e.offer(t)),oQ=y(2,(e,t)=>e.offerAll(t)),Fb=e=>e.take,iQ=e=>e.takeAll,aQ=y(2,(e,t)=>e.takeUpTo(t)),cQ=y(3,(e,t,n)=>e.takeBetween(t,n)),uQ=()=>new fQ,JP=()=>new dQ,lQ=()=>new hQ;var gI;gI=Ww;class fQ{constructor(){d(this,gI,Kw);d(this,"putters",_g())}surplusSize(){return Hv(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!Ji(this.putters)&&!Ji(t);){const n=ao(t,void 0),r=ao(this.putters,void 0);r[2]&&Qi(r[1],!0),Qi(n,r[0])}}get shutdown(){return w(sg,U(t=>w(K(()=>Cc(this.putters)),U(n=>uo(n,([r,s,o])=>o?w(xv(s,t),nr):Je,!1,!1)))))}handleSurplus(t,n,r,s){return qe(o=>{const a=Tu(o.id());return w(he(()=>(this.unsafeOffer(t,a),this.unsafeOnQueueEmptySpace(n,r),Ui(this,n,r),ze(s)?dn:ns(a))),Aa(()=>K(()=>this.unsafeRemove(a))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=w(this.putters,ao(Vt));if(s===Vt)r=!1;else{const o=t.offer(s[0]);o&&s[2]?Qi(s[1],!0):o||Pm(this.putters,w(Cc(this.putters),wn(s))),Ui(this,t,n)}}}unsafeOffer(t,n){const r=je(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?w(this.putters,Qc([o,n,!0])):w(this.putters,Qc([o,n,!1]))}}unsafeRemove(t){Pm(this.putters,w(Cc(this.putters),Ap(([,n])=>n!==t)))}}var _I;let dQ=(_I=Ww,class{constructor(){d(this,_I,Kw)}surplusSize(){return 0}get shutdown(){return Je}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return J(!1)}unsafeOnQueueEmptySpace(t,n){}});var yI;yI=Ww;class hQ{constructor(){d(this,yI,Kw)}surplusSize(){return 0}get shutdown(){return Je}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return K(()=>(this.unsafeOffer(n,t),Ui(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Vt),o=t.offer(s.value)}}}const Qi=(e,t)=>fd(e,J(t)),Pm=(e,t)=>w(e,Vv(t)),Cc=e=>w(e,yg(Number.POSITIVE_INFINITY)),mQ=(e,t)=>w(e,yg(t)),pQ=(e,t)=>{Pm(e,w(Cc(e),Ap(n=>t!==n)))},Ui=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=w(n,ao(Vt));if(s!==Vt){const o=t.poll(Vt);o!==Vt?(Qi(s,o),e.unsafeOnQueueEmptySpace(t,n)):Pm(n,w(Cc(n),wn(s))),r=!0}else r=!1}r&&t.length()===0&&!Ji(n)&&e.onCompleteTakersWithEmptyQueue(n)},ps=Symbol.for("effect/PubSub/AbsentValue"),GP=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},gQ=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},_Q=e=>he(()=>{const t=vQ(e);return IQ(t,new NQ)}),yQ=e=>e.shutdown,bQ=y(2,(e,t)=>e.publish(t)),SQ=e=>e.subscribe,vQ=e=>new kQ(e!=null&&e.replay?new MQ(e.replay):void 0),wQ=(e,t,n)=>_e(Iu(),r=>EQ(e,t,e.subscribe(),_g(),r,Ia(!1),n)),EQ=(e,t,n,r,s,o,a)=>new CQ(e,t,n,r,s,o,a,e.replayWindow());class kQ{constructor(t){d(this,"replayBuffer");d(this,"publisherHead",{value:ps,subscribers:0,next:null});d(this,"publisherTail",this.publisherHead);d(this,"publisherIndex",0);d(this,"subscribersIndex",0);d(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new LQ(this.replayBuffer):jQ}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return yt()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=ps,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new $Q(this,this.publisherTail,this.publisherIndex,!1)}}class $Q{constructor(t,n,r,s){d(this,"self");d(this,"subscriberHead");d(this,"subscriberIndex");d(this,"unsubscribed");this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==ps?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==ps&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=ps,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=ps;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return go(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==ps&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=ps,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}var bI,SI;class CQ extends(SI=Po,bI=Vw,SI){constructor(n,r,s,o,a,u,f,h){super();d(this,"pubsub");d(this,"subscribers");d(this,"subscription");d(this,"pollers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,"replayWindow");d(this,bI,Jw);this.pubsub=n,this.subscribers=r,this.subscription=s,this.pollers=o,this.shutdownHook=a,this.shutdownFlag=u,this.strategy=f,this.replayWindow=h}commit(){return this.take}pipe(){return ee(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!ze(this.shutdownFlag)}get size(){return he(()=>ze(this.shutdownFlag)?dn:J(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return he(()=>ze(this.shutdownFlag)?dn:J(this.subscription.size()===this.capacity()))}get isEmpty(){return _e(this.size,n=>n===0)}get shutdown(){return yi(qe(n=>(Ra(this.shutdownFlag,!0),w(_w(Gw(this.pollers),r=>xv(r,n.id()),!1),It(K(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),od(ld(this.shutdownHook,void 0)),nr))))}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get awaitShutdown(){return ns(this.shutdownHook)}get take(){return qe(n=>{if(ze(this.shutdownFlag))return dn;if(this.replayWindow.remaining>0){const s=this.replayWindow.take();return J(s)}const r=Ji(this.pollers)?this.subscription.poll(Vt):Vt;if(r===Vt){const s=Tu(n.id());return w(he(()=>(w(this.pollers,Qc(s)),w(this.subscribers,GP(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),ze(this.shutdownFlag)?dn:ns(s))),Aa(()=>K(()=>FQ(this.pollers,s))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r)})}get takeAll(){return he(()=>{if(ze(this.shutdownFlag))return dn;const n=Ji(this.pollers)?qQ(this.subscription):yt();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?J(Rt(this.replayWindow.takeAll(),n)):J(n)})}takeUpTo(n){return he(()=>{if(ze(this.shutdownFlag))return dn;let r;if(this.replayWindow.remaining>=n){const o=this.replayWindow.takeN(n);return J(o)}else this.replayWindow.remaining>0&&(r=this.replayWindow.takeAll(),n=n-r.length);const s=Ji(this.pollers)?AQ(this.subscription,n):yt();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r?Rt(r,s):s)})}takeBetween(n,r){return he(()=>QP(this,n,r,yt()))}}const QP=(e,t,n,r)=>n<t?J(r):w(e.takeUpTo(n),U(s=>{const o=t-s.length;return o===1?w(e.take,_e(a=>w(r,Rt(s),Bl(a)))):o>1?w(e.take,U(a=>QP(e,o-1,n-s.length-1,w(r,Rt(s),Bl(a))))):J(w(r,Rt(s)))}));var vI,wI;wI=VP,vI=Vw;class TQ{constructor(t,n,r,s,o,a){d(this,"pubsub");d(this,"subscribers");d(this,"scope");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,wI,WP);d(this,vI,Jw);this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}capacity(){return this.pubsub.capacity}get size(){return he(()=>ze(this.shutdownFlag)?dn:K(()=>this.pubsub.size()))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.pubsub.size())}get isFull(){return _e(this.size,t=>t===this.capacity())}get isEmpty(){return _e(this.size,t=>t===0)}get awaitShutdown(){return ns(this.shutdownHook)}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get shutdown(){return yi(qe(t=>(w(this.shutdownFlag,Ra(!0)),w(this.scope.close(Fv(t.id())),It(this.strategy.shutdown),od(ld(this.shutdownHook,void 0)),nr))))}publish(t){return he(()=>ze(this.shutdownFlag)?dn:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),J(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ft(t),this.shutdownFlag))}isActive(){return!ze(this.shutdownFlag)}unsafeOffer(t){return ze(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return he(()=>{if(ze(this.shutdownFlag))return dn;const n=PQ(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Zf(n)?J(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=ag(gw([this.scope.fork(pd),wQ(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return _e(pw(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return ee(this,arguments)}}const IQ=(e,t)=>U(Ed(),n=>_e(Iu(),r=>RQ(e,new Map,n,r,Ia(!1),t))),RQ=(e,t,n,r,s,o)=>new TQ(e,t,n,r,s,o),OQ=(e,t)=>{fd(e,J(t))},YP=(e,t)=>w(e,Vv(t)),Gw=e=>w(e,yg(Number.POSITIVE_INFINITY)),qQ=e=>e.pollUpTo(Number.POSITIVE_INFINITY),AQ=(e,t)=>e.pollUpTo(t),PQ=(e,t)=>e.publishAll(t),FQ=(e,t)=>{YP(e,w(Gw(e),Ap(n=>n!==t)))};class NQ{get shutdown(){return Je}handleSurplus(t,n,r,s){return J(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return xQ(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return DQ(this,t,n)}}const xQ=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const a=w(s,ao(Vt));if(a===Vt)w(n,gQ(r,s)),Ji(s)?o=!1:w(n,GP(r,s));else{const u=r.poll(Vt);u===Vt?YP(s,w(Gw(s),wn(a))):(OQ(a,u),e.unsafeOnPubSubEmptySpace(t,n))}}},DQ=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class MQ{constructor(t){d(this,"capacity");d(this,"head",{value:ps,next:null});d(this,"tail",this.head);d(this,"size",0);d(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:ps,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class LQ{constructor(t){d(this,"buffer");d(this,"head");d(this,"index");d(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return yt();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,zt(r)}takeAll(){return this.takeN(this.remaining)}}const jQ={remaining:0,take:()=>{},takeN:()=>yt(),takeAll:()=>yt()},Qw=_Q,Fm=yQ,Kg=bQ,T$=SQ,su=G9,Jg=Q9,Gg=Y9,hn=X9,UQ=tQ,zQ=nQ,Dt=rQ,Ye=sQ,Yw=oQ,ko=Fb,BQ=iQ,XP=cQ,ZP="Continue",HQ="Close",VQ="Yield",WQ="effect/ChannelChildExecutorDecision",I$=Symbol.for(WQ),KQ={[I$]:I$},eF=e=>{const t=Object.create(KQ);return t._tag=ZP,t},Ph="ContinuationK",JQ="ContinuationFinalizer",tF=Symbol.for("effect/ChannelContinuation"),nF={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};var EI;EI=tF;class Xw{constructor(t,n){d(this,"onSuccess");d(this,"onHalt");d(this,"_tag",Ph);d(this,EI,nF);this.onSuccess=t,this.onHalt=n}onExit(t){return Fa(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}var kI;kI=tF;class GQ{constructor(t){d(this,"finalizer");d(this,"_tag",JQ);d(this,kI,nF);this.finalizer=t}}const rF="PullAfterNext",QQ="PullAfterAllEnqueued",YQ="effect/ChannelUpstreamPullStrategy",XQ=Symbol.for(YQ),ZQ={_A:e=>e},e7={[XQ]:ZQ},sF=e=>{const t=Object.create(e7);return t._tag=rF,t.emitSeparator=e,t},oF="BracketOut",iF="Bridge",Zw="ConcatAll",aF="Emit",cF="Ensuring",uF="Fail",eE="Fold",lF="FromEffect",fF="PipeTo",dF="Provide",hF="Read",mF="Succeed",pF="SucceedNow",gF="Suspend",t7="effect/Channel",Nm=Symbol.for(t7),n7={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},qn={[Nm]:n7,pipe(){return ee(this,arguments)}},_F=e=>ne(e,Nm)||Mr(e),r7=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=oF,n.acquire=()=>e,n.finalizer=t,n}),yF=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=eE,n.channel=e,n.k=new Xw(xa,t),n}),bF=(e,t,n)=>{const r=Object.create(qn);return r._tag=Zw,r.combineInners=t,r.combineAll=n,r.onPull=()=>sF(V()),r.onEmit=()=>eF,r.value=()=>e,r.k=ie,r},s7=y(4,(e,t,n,r)=>{const s=Object.create(qn);return s._tag=Zw,s.combineInners=n,s.combineAll=r,s.onPull=()=>sF(V()),s.onEmit=()=>eF,s.value=()=>e,s.k=t,s}),tE=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=iF,n.input=t,n.channel=e,n}),nE=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=cF,n.channel=e,n.finalizer=t,n}),Rd=e=>qt(Au(e)),qt=e=>SF(()=>e),SF=e=>{const t=Object.create(qn);return t._tag=uF,t.error=e,t},Pe=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=eE,n.channel=e,n.k=new Xw(t,qt),n}),Ct=e=>{const t=Object.create(qn);return t._tag=lF,t.effect=()=>e,t},ln=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=fF,n.left=()=>e,n.right=()=>t,n}),Nb=y(2,(e,t)=>{const n=Object.create(qn);return n._tag=dF,n.context=()=>t,n.inner=e,n}),Qg=e=>br({onInput:e.onInput,onFailure:t=>sn(Og(t),{onLeft:e.onFailure,onRight:qt}),onDone:e.onDone}),br=e=>{const t=Object.create(qn);return t._tag=hF,t.more=e.onInput,t.done=new Xw(e.onDone,e.onFailure),t},xa=e=>vF(()=>e),hi=e=>{const t=Object.create(qn);return t._tag=pF,t.terminal=e,t},Od=e=>{const t=Object.create(qn);return t._tag=gF,t.channel=e,t},vF=e=>{const t=Object.create(qn);return t._tag=mF,t.evaluate=e,t},mn=hi(void 0),tt=e=>{const t=Object.create(qn);return t._tag=aF,t.out=e,t},qd="Done",Ad="Emit",xu="FromEffect",Pd="Read",o7=Symbol.for("effect/ChannelState"),i7={_E:e=>e,_R:e=>e},Yg={[o7]:i7},Za=()=>{const e=Object.create(Yg);return e._tag=qd,e},oy=()=>{const e=Object.create(Yg);return e._tag=Ad,e},rl=e=>{const t=Object.create(Yg);return t._tag=xu,t.effect=e,t},iy=(e,t,n,r)=>{const s=Object.create(Yg);return s._tag=Pd,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},xm=e=>e._tag===xu,a7=e=>xm(e)?e.effect:fe,R$=e=>xm(e)?Nw(e.effect):void 0,wF="PullFromChild",xb="PullFromUpstream",Db="DrainChildExecutors",EF="Emit";class nh{constructor(t,n,r){d(this,"childExecutor");d(this,"parentSubexecutor");d(this,"onEmit");d(this,"_tag",wF);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?ru(Jt(n),Jt(r),(s,o)=>w(s,tf(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Pi{constructor(t,n,r,s,o,a,u,f){d(this,"upstreamExecutor");d(this,"createChild");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"onEmit");d(this,"_tag",xb);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u,this.onEmit=f}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?ru(o,Jt(a),(u,f)=>tf(u,f)):o!==void 0?o:a!==void 0?Jt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new Pi(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class dc{constructor(t,n,r,s,o,a,u){d(this,"upstreamExecutor");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"upstreamDone");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"_tag",Db);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?ru(o,Jt(a),(u,f)=>tf(u,f)):o!==void 0?o:a!==void 0?Jt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new dc(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class ay{constructor(t,n){d(this,"value");d(this,"next");d(this,"_tag",EF);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const c7="Pulled",u7="NoUpstream",l7="effect/ChannelUpstreamPullRequest",f7=Symbol.for(l7),d7={_A:e=>e},kF={[f7]:d7},O$=e=>{const t=Object.create(kF);return t._tag=c7,t.value=e,t},h7=e=>{const t=Object.create(kF);return t._tag=u7,t.activeDownstreamCount=e,t};class zi{constructor(t,n,r){d(this,"_activeSubexecutor");d(this,"_cancelled");d(this,"_closeLastSubstream");d(this,"_currentChannel");d(this,"_done");d(this,"_doneStack",[]);d(this,"_emitted");d(this,"_executeCloseLastSubstream");d(this,"_input");d(this,"_inProgressFinalizer");d(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=Za();else switch(Mr(this._currentChannel)&&(this._currentChannel=Ct(this._currentChannel)),this._currentChannel._tag){case oF:{t=this.runBracketOut(this._currentChannel);break}case iF:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>X(n.awaitRead(),()=>_t(()=>{const o=r.run();switch(o._tag){case qd:return Yr(r.getDone(),{onFailure:a=>n.error(a),onSuccess:a=>n.done(a)});case Ad:return X(n.emit(r.getEmit()),()=>s());case xu:return Cr(o.effect,{onFailure:a=>n.error(a),onSuccess:()=>s()});case Pd:return rE(o,()=>s(),a=>n.error(a))}}));t=rl(X(Mw(Pt(s())),o=>Te(()=>this.addFinalizer(a=>X(Nr(o),()=>_t(()=>{const u=this.restorePipe(a,r);return u!==void 0?u:fe}))))))}break}case Zw:{const n=new zi(this._currentChannel.value(),this._providedEnv,s=>Te(()=>{const o=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;this._closeLastSubstream=w(o,pt(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Pi(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case aF:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:mn,t=oy();break}case cF:{this.runEnsuring(this._currentChannel);break}case uF:{t=this.doneHalt(this._currentChannel.error());break}case eE:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case lF:{const n=this._providedEnv===void 0?this._currentChannel.effect():w(this._currentChannel.effect(),In(this._providedEnv));t=rl(Cr(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&xm(s)?s.effect:fe},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&xm(s)?s.effect:fe}}));break}case fF:{const n=this._input,r=new zi(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:fe}),this._currentChannel=this._currentChannel.right();break}case dF:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Te(()=>{this._providedEnv=n}));break}case hF:{const n=this._currentChannel;t=iy(this._input,ie,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(ef(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case mF:{t=this.doneSucceed(this._currentChannel.evaluate());break}case pF:{t=this.doneSucceed(this._currentChannel.terminal);break}case gF:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=qt(va(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?fe:uy(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ph)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):fe}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=w(r,Li(Te(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=w(o,Li(Te(()=>this.clearInProgressFinalizer()))));const a=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(a===void 0&&n===void 0&&s===void 0))return w(Jt(cy(a)),qm(Jt(cy(n))),qm(Jt(cy(s))),Se(([[u,f],h])=>w(u,tf(f),tf(h))),Qo,X(u=>_t(()=>u)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Wt(t),this._currentChannel=void 0,Za();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ph){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Wt(t),this._currentChannel=void 0,Za();const s=uy(r.map(a=>a.finalizer),Wt(t));this.storeInProgressFinalizer(s);const o=w(s,Li(Te(()=>this.clearInProgressFinalizer())),Qo,X(()=>Te(()=>this.doneSucceed(t))));return rl(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=on(t),this._currentChannel=void 0,Za();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Ph){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(a){this._currentChannel=qt(va(a))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=on(t),this._currentChannel=void 0,Za();const s=uy(r.map(a=>a.finalizer),on(t));this.storeInProgressFinalizer(s);const o=w(s,Li(Te(()=>this.clearInProgressFinalizer())),Qo,X(()=>Te(()=>this.doneHalt(t))));return rl(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Za()}runBracketOut(t){const n=Qo(Cr(this.provide(t.acquire()),{onFailure:r=>Te(()=>{this._currentChannel=qt(r)}),onSuccess:r=>Te(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=tt(r)})}));return rl(n)}provide(t){return this._providedEnv===void 0?t:w(t,In(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new GQ(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case wF:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case xb:return this.pullFromUpstream(t);case Db:return this.drainChildExecutors(t);case EF:return this._emitted=t.value,this._activeSubexecutor=t.next,oy()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=Yr(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?fe:a7(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>w(n,Sn(s=>w(Te(()=>s(t)),X(o=>o!==void 0?o:fe)),{discard:!0})));const r=w(t,Yr({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case rF:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case QQ:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return iy(t,ie,o=>{const a=r(o);switch(a._tag){case ZP:break;case HQ:{this.finishWithDoneValue(t,n,a.value);break}case VQ:{const u=n.enqueuePullFromChild(s);this.replaceSubexecutor(u);break}}this._activeSubexecutor=new ay(o,this._activeSubexecutor)},Yr({onFailure:o=>{const a=this.handleSubexecutorFailure(t,n,o);return a===void 0?void 0:R$(a)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case xb:{const o=new Pi(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Wt(r)),this.replaceSubexecutor(o);break}case Db:{const o=new dc(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Wt(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(on(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Pi(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new nh(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return iy(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;return this._closeLastSubstream=void 0,w(this._executeCloseLastSubstream(r),pt(n))},n=>{if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,w(this._executeCloseLastSubstream(a),Se(()=>{const u=new zi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);u._input=this._input;const[f,h]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(O$(n)));this._activeSubexecutor=new nh(u,new Pi(t.upstreamExecutor,t.createChild,t.lastDone,h,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),lt(f)&&(this._activeSubexecutor=new ay(f.value,this._activeSubexecutor))}))}const r=new zi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(O$(n)));this._activeSubexecutor=new nh(r,new Pi(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),lt(s)&&(this._activeSubexecutor=new ay(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new dc(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,w(this._executeCloseLastSubstream(a),Se(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(w(n,K4(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:R$(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>Le(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,a=>t.upstreamExecutor.close(a))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,a]=this.applyUpstreamPullStrategy(!0,r,t.onPull(h7(r.reduce((u,f)=>f!==void 0?u+1:u,0))));return this.replaceSubexecutor(new dc(t.upstreamExecutor,t.lastDone,a,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),lt(o)?(this._emitted=o.value,oy()):void 0}const s=new dc(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new nh(n.childExecutor,s,n.onEmit))}}const cy=e=>e!==void 0?e:fe,uy=(e,t)=>w(Sn(e,n=>Jt(n(t))),Se(n=>w(V4(n),Et(()=>Xn))),X(n=>_t(()=>n))),rE=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return qP("Unexpected end of input for channel execution");const a=o.upstream.run();switch(a._tag){case Ad:{const u=o.onEmit(o.upstream.getEmit());return r.length===0?u===void 0?_t(t):w(u,Cr({onFailure:n,onSuccess:t})):u===void 0?_t(()=>s()):w(u,Cr({onFailure:n,onSuccess:()=>s()}))}case qd:{const u=o.onDone(o.upstream.getDone());return r.length===0?u===void 0?_t(t):w(u,Cr({onFailure:n,onSuccess:t})):u===void 0?_t(()=>s()):w(u,Cr({onFailure:n,onSuccess:()=>s()}))}case xu:return r.push(o),w(o.onEffect(a.effect),ks(u=>_t(()=>{const f=o.onDone(on(u));return f===void 0?fe:f})),Cr({onFailure:n,onSuccess:()=>s()}));case Pd:return r.push(o),r.push(a),_t(()=>s())}};return s()},sE=y(2,(e,t)=>{const n=(r,s,o)=>PP(Te(()=>new zi(e,void 0,ie)),a=>_t(()=>Fh(a.run(),a).pipe(Td(r),pt(Ht(r)),jw(Ht(s)))),(a,u)=>{const f=a.close(u);return f===void 0?fe:Nu(f,h=>ni(o,Qn(h)))});return fi(r=>$d([Tw(t,of),Me(),Me()]).pipe(X(([s,o,a])=>r(n(o,a,s)).pipe(mr(t),X(u=>t.addFinalizer(f=>{const h=Fa(f)?K8(f.cause):void 0;return ab(o).pipe(X(p=>p?ut(a,void 0).pipe(pt(dP(u)),pt(S$(u))):ut(a,void 0).pipe(pt(h&&hv(h)>0?Fg(u,Vz(h)):Nr(u)),pt(S$(u)))))}).pipe(pt(r(Ht(o)))))))))}),Fh=(e,t)=>{const n=e;switch(n._tag){case xu:return w(n.effect,X(()=>Fh(t.run(),t)));case Ad:return Fh(t.run(),t);case qd:return _t(()=>t.getDone());case Pd:return rE(n,()=>Fh(t.run(),t),Qn)}},$F="Done",m7="Await",p7="effect/ChannelMergeDecision",g7=Symbol.for(p7),CF={[g7]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},_7=e=>{const t=Object.create(CF);return t._tag=$F,t.effect=e,t},Mb=e=>{const t=Object.create(CF);return t._tag=m7,t.f=e,t},TF="BothRunning",IF="LeftDone",RF="RightDone",y7="effect/ChannelMergeState",q$=Symbol.for(y7),oE={[q$]:q$},ly=(e,t)=>{const n=Object.create(oE);return n._tag=TF,n.left=e,n.right=t,n},A$=e=>{const t=Object.create(oE);return t._tag=IF,t.f=e,t},P$=e=>{const t=Object.create(oE);return t._tag=RF,t.f=e,t},OF="BackPressure",qF="BufferSliding",b7="effect/ChannelMergeStrategy",F$=Symbol.for(b7),AF={[F$]:F$},S7=e=>{const t=Object.create(AF);return t._tag=OF,t},v7=e=>{const t=Object.create(AF);return t._tag=qF,t},w7=y(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case OF:return t();case qF:return n()}}),sc="Empty",dl="Emit",hl="Error",ml="Done",PF=e=>({_tag:sc,notifyProducer:e}),fy=e=>({_tag:dl,notifyConsumers:e}),E7=e=>({_tag:hl,cause:e}),k7=e=>({_tag:ml,done:e});class $7{constructor(t){d(this,"ref");this.ref=t}awaitRead(){return Ai(qi(this.ref,t=>t._tag===sc?[Ht(t.notifyProducer),t]:[fe,t]))}get close(){return Dw(t=>this.error(Rg(t)))}done(t){return Ai(qi(this.ref,n=>{switch(n._tag){case sc:return[Ht(n.notifyProducer),n];case dl:return[Sn(n.notifyConsumers,r=>ut(r,oe(t)),{discard:!0}),k7(t)];case hl:return[hs,n];case ml:return[hs,n]}}))}emit(t){return X(Me(),n=>Ai(qi(this.ref,r=>{switch(r._tag){case sc:return[Ht(r.notifyProducer),r];case dl:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[ut(s,ce(t)),o.length===0?PF(n):fy(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case hl:return[hs,r];case ml:return[hs,r]}})))}error(t){return Ai(qi(this.ref,n=>{switch(n._tag){case sc:return[Ht(n.notifyProducer),n];case dl:return[Sn(n.notifyConsumers,r=>iq(r,t),{discard:!0}),E7(t)];case hl:return[hs,n];case ml:return[hs,n]}}))}get take(){return this.takeWith(t=>on(qg(t,oe)),t=>Wt(t),t=>hd(ce(t)))}takeWith(t,n,r){return X(Me(),s=>Ai(qi(this.ref,o=>{switch(o._tag){case sc:return[pt(ut(o.notifyProducer,void 0),pf(Ht(s),{onFailure:t,onSuccess:sn({onLeft:r,onRight:n})})),fy([s])];case dl:return[pf(Ht(s),{onFailure:t,onSuccess:sn({onLeft:r,onRight:n})}),fy([...o.notifyConsumers,s])];case hl:return[Le(t(o.cause)),o];case ml:return[Le(r(o.done)),o]}})))}}const iE=()=>w(Me(),X(e=>Si(PF(e))),Se(e=>new $7(e))),N$=(e,t,n)=>Pe(Ct(Si(()=>fe)),r=>w(Ct(Qo(Eo(e,s=>Yc(r,o=>n(s,o))))),Pe(t),nE(s=>X(Gi(r),o=>o(s))))),C7=y(2,(e,t)=>yF(e,n=>sn(Og(n),{onLeft:t,onRight:qt}))),Dm=y(2,(e,t)=>s7(e,t,()=>{},()=>{})),Xg=e=>{const t=br({onInput:()=>t,onFailure:qt,onDone:xa});return ln(e,t)},FF=y(2,(e,t)=>nE(e,()=>t)),T7=e=>Pe(e,ie),Zg=e=>xr(e.takeWith(qt,t=>Pe(tt(t),()=>Zg(e)),xa)),NF=()=>Qg({onInput:e=>Pe(tt(e),()=>NF()),onFailure:Rd,onDone:hi}),xF=y(2,(e,t)=>Pe(e,n=>vF(()=>t(n)))),I7=y(2,(e,t)=>R7(e,qg(t))),R7=y(2,(e,t)=>yF(e,n=>qt(t(n)))),e_=y(2,(e,t)=>{const n=Qg({onInput:r=>Pe(tt(t(r)),()=>n),onFailure:Rd,onDone:hi});return ln(e,n)}),DF=y(2,(e,t)=>{const n=br({onInput:r=>w(Ct(t(r)),Pe(tt),Pe(()=>n)),onFailure:qt,onDone:hi});return ln(e,n)}),O7=y(3,(e,t,n)=>aE(r=>z(function*(){const s=yield*iE(),o=Zg(s),a=yield*su(n);yield*ni(r,Dt(a));const u=yield*Me(),f=n===Number.POSITIVE_INFINITY?g=>ie:(yield*zg(n)).withPermits;yield*(yield*o.pipe(ln(e),Yi(r))).pipe(Cr({onFailure:g=>Ye(a,Qn(g)),onSuccess:sn({onLeft:g=>pt(Pt(f(n)(fe)),As(Ye(a,Le(oe(g))))),onRight:g=>z(function*(){const k=yield*Me(),T=yield*Me();yield*Ye(a,Se(Ht(k),ce)),yield*ut(T,void 0).pipe(pt(fi(O=>Jt(O(Ht(u))).pipe(xP(Jt(O(t(g)))),X(ie))).pipe(Nu(O=>iq(u,O)),Td(k))),f(1),mr(r)),yield*Ht(T)})})}),mf,Pt,mr(r));const p=xr(pf(Ai(ko(a)),{onFailure:qt,onSuccess:sn({onLeft:hi,onRight:g=>Pe(tt(g),()=>p)})}));return tE(p,s)}))),q7=e=>t=>A7(e)(t,Ll),A7=({bufferSize:e=16,concurrency:t,mergeStrategy:n=S7()})=>(r,s)=>aE(o=>z(function*(){const a=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,u=yield*iE(),f=Zg(u),h=yield*su(e);yield*ni(o,Dt(h));const p=yield*hn();yield*ni(o,Dt(p));const g=yield*Si(V()),k=yield*Me(),T=(yield*zg(a)).withPermits,O=yield*Yi(ln(f,r),o);function M(S){return S.pipe(X(sn({onLeft:_=>Le(W(_)),onRight:_=>fo(Ye(h,Le(ce(_))),V())})),k$({until:_=>lt(_)}),X(_=>R5(g,st({onNone:()=>W(_.value),onSome:C=>W(s(C,_.value))}))),ks(_=>lf(_)?Qn(_):Ye(h,Qn(_)).pipe(pt(ut(k,void 0)),As)))}yield*O.pipe(Cr({onFailure:S=>Ye(h,Qn(S)).pipe(pt(Le(!1))),onSuccess:sn({onLeft:S=>Lw(Pt(Ht(k)),Pt(T(a)(fe)),{onSelfDone:(_,C)=>fo(Nr(C),!1),onOtherDone:(_,C)=>pt(Nr(C),Gi(g).pipe(X(st({onNone:()=>Ye(h,Le(oe(S))),onSome:$=>Ye(h,Le(oe(s($,S))))})),fo(!1)))}),onRight:S=>w7(n,{onBackPressure:()=>z(function*(){const _=yield*Me(),C=Om(q=>Yi(ln(f,S),q).pipe(X(P=>sy(Jt(M(P)),Jt(Pt(Ht(k))))),X(ie)));return yield*ut(_,void 0).pipe(pt(C),T(1),mr(o)),yield*Ht(_),!(yield*ab(k))}),onBufferSliding:()=>z(function*(){const _=yield*Me(),C=yield*Me(),$=yield*UQ(p);yield*ko(p).pipe(X(x=>ut(x,void 0)),NP(()=>$>=a)),yield*Ye(p,_);const q=Om(x=>Yi(ln(f,S),x).pipe(X(L=>Jt(M(L)).pipe(sy(Jt(Pt(Ht(k)))),sy(Jt(Pt(Ht(_)))))),X(ie)));return yield*ut(C,void 0).pipe(pt(q),T(1),mr(o)),yield*Ht(C),!(yield*ab(k))})})})}),k$({while:S=>S}),mr(o));const E=w(ko(h),Ai,pf({onFailure:qt,onSuccess:sn({onLeft:hi,onRight:S=>Pe(tt(S),()=>E)})}),xr);return tE(E,u)})),MF=y(3,(e,t,n)=>q7(n)(e_(e,t))),LF=y(2,(e,t)=>{function n(r){return z(function*(){const s=yield*iE(),o=Zg(s),a=yield*Yi(ln(o,e),r),u=yield*Yi(ln(o,t.other),r);function f(p,g,k){return(T,O,M)=>{function E(S){const _=S;return _._tag===$F?Le(Ct(pt(Nr(g),_.effect))):Se(dP(g),Yr({onFailure:C=>Ct(_.f(on(C))),onSuccess:sn({onLeft:C=>Ct(_.f(Wt(C))),onRight:C=>Fd(tt(C),h(M(_.f)))})}))}return Yr(p,{onFailure:S=>E(T(on(S))),onSuccess:sn({onLeft:S=>E(T(Wt(S))),onRight:S=>Le(Pe(tt(S),()=>Pe(Ct(mr(Pt(k),r)),_=>h(O(_,g)))))})})}}function h(p){switch(p._tag){case TF:{const g=Pt(Rm(p.left)),k=Pt(Rm(p.right));return xr(Lw(g,k,{onSelfDone:(T,O)=>pt(Nr(O),f(T,p.right,a)(t.onSelfDone,ly,M=>A$(M))),onOtherDone:(T,O)=>pt(Nr(O),f(T,p.left,u)(t.onOtherDone,(M,E)=>ly(E,M),M=>P$(M)))}))}case IF:return xr(Se(Jt(u),Yr({onFailure:g=>Ct(p.f(on(g))),onSuccess:sn({onLeft:g=>Ct(p.f(Wt(g))),onRight:g=>Pe(tt(g),()=>h(A$(p.f)))})})));case RF:return xr(Se(Jt(a),Yr({onFailure:g=>Ct(p.f(on(g))),onSuccess:sn({onLeft:g=>Ct(p.f(Wt(g))),onRight:g=>Pe(tt(g),()=>h(P$(p.f)))})})))}}return Ct(qs(p=>{const g=qs(O=>(O.transferChildren(p.scope()),fe)),k=Pt(a).pipe(Li(g),mr(r)),T=Pt(u).pipe(Li(g),mr(r));return ru(k,T,(O,M)=>ly(O,M))})).pipe(Pe(h),tE(s))})}return aE(n)}),P7=y(2,(e,t)=>C7(e,n=>SF(()=>va(t(n))))),jF=y(2,(e,t)=>Od(()=>{let n;const r=Qg({onInput:o=>Pe(tt(o),()=>r),onFailure:o=>(n=M7(o),qt(va(n))),onDone:hi}),s=br({onInput:o=>w(tt(o),Pe(()=>s)),onFailure:o=>W8(o)&&L7(o.defect)&&de(o.defect,n)?Rd(o.defect.error):qt(o),onDone:hi});return ln(ln(ln(e,r),t),s)})),F7=e=>Om(t=>sE(e,t)),N7=e=>F7(Xg(e)),UF=e=>c9(t=>sE(e,t)),zF=e=>xr(fi(t=>Se(Iw(),n=>r7(Nu(t(Cw(e,n)),r=>bn(n,on(r))),(r,s)=>bn(n,s))))),BF=e=>t_(Se(Lg,t=>Pe(Ct(e(t)),tt))),x7=e=>X(Lg,t=>Yi(e,t)),Yi=y(2,(e,t)=>qm(Te(()=>new zi(e,void 0,ie)),xo()).pipe(Eo(([n,r])=>$J(t,s=>{const o=n.close(s);return o!==void 0?In(o,r):fe})),Qo,Se(([n])=>_t(()=>Lb(n.run(),n))))),Lb=(e,t)=>{const n=e;switch(n._tag){case qd:return Yr(t.getDone(),{onFailure:Qn,onSuccess:r=>Le(oe(r))});case Ad:return Le(ce(t.getEmit()));case xu:return w(n.effect,X(()=>Lb(t.run(),t)));case Pd:return rE(n,()=>Lb(t.run(),t),r=>Qn(r))}},xr=e=>T7(Ct(e)),t_=e=>bF(zF(e),(t,n)=>t,(t,n)=>t),aE=e=>bF(BF(e),(t,n)=>t,(t,n)=>t),x$=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]),r=$d([k9(t,n),FP(),f9,C9(q9)]);if(e){const s=arguments[0];return N$(r,([o,a])=>Nb(s,gs(a,Rs,o)),([o,,a,u],f)=>gm(o,f,a,u))}return s=>N$(r,([o,a])=>Nb(s,gs(a,Rs,o)),([o,,a,u],f)=>gm(o,f,a,u))},n_=e=>HF(0,e.length,e),HF=(e,t,n)=>e===t?mn:w(tt(w(n,oo(e))),Pe(()=>HF(e+1,t,n))),D7=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?LF(e,{other:t,onSelfDone:r=>Mb(s=>_t(()=>Pk(r,s))),onOtherDone:r=>Mb(s=>_t(()=>Pk(s,r)))}):Pe(e,r=>xF(t,s=>[r,s]))),Fd=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?xF(D7(e,t,{concurrent:!0}),r=>r[1]):Pe(e,()=>t)),jb=Symbol.for("effect/Channel/ChannelException"),M7=e=>({_tag:"ChannelException",[jb]:jb,error:e}),L7=e=>ne(e,jb),Ub=Symbol.for("effect/Sink"),j7={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};var $I;$I=Ub;class r_{constructor(t){d(this,"channel");d(this,$I,j7);this.channel=t}pipe(){return ee(this,arguments)}}const U7=()=>new r_(VF(yt())),VF=e=>br({onInput:t=>VF(w(e,Rt(t))),onFailure:qt,onDone:()=>xa(e)}),z7=new r_(Xg(NF())),B7=e=>{const t=br({onInput:n=>w(Ct(e(n)),Pe(()=>t)),onFailure:qt,onDone:()=>mn});return new r_(t)},H7=e=>new r_(Ct(e)),WF=e=>Mr(e)?WF(H7(e)):e.channel,V7=_7,W7=Mb,KF=Ng,K7=gP,J7=TG,JF=LJ,G7="Left",Q7="Right",Y7="Both",X7="Either",Z7={_tag:G7},eY={_tag:Q7},GF={_tag:Y7},tY={_tag:X7},nY=e=>{switch(e){case"left":return Z7;case"right":return eY;case"both":return GF;case"either":return tY;default:return e}},rY=GF;class QF{constructor(t){d(this,"value");this.value=t}}const YF=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),XF=e=>e.newValue,ZF=(e,t)=>{e.isChanged=!0,e.newValue=t},sY=e=>{e.ref.versioned=new QF(e.newValue)},oY=e=>e.ref.versioned!==e.expected,iY=e=>e.isChanged,Mm="Invalid",cE="ReadWrite",aY="ReadOnly",eN=e=>{for(const t of e)sY(t[1])},tN=e=>{let t=aY;for(const[,n]of e)if(t=oY(n)?Mm:iY(n)?cE:t,t===Mm)return t;return t},cY=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},uY=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},lY=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},nN="WithSTMRuntime",zb="OnFailure",D$="OnRetry",Bb="OnSuccess",fY="Provide",rN="Sync",sN="Succeed",oN="Retry",iN="Fail",aN="Die",cN="Interrupt",Tc="Fail",Ic="Die",Rc="Interrupt",Xi="Succeed",Du="Retry",uE="Done",lE="Suspend",Nh="Done",Hb="Interrupted",Lm="Running",s_="effect/STM/State",wa=Symbol.for(s_),fE=e=>ne(e,wa),uN=e=>e._tag===Lm,dY=e=>e._tag===Nh,rh=e=>({[wa]:wa,_tag:Nh,exit:e,[pe](){return w(Q(s_),ue(Q(Nh)),ue(Q(e)),at(this))},[ge](t){return fE(t)&&t._tag===Nh&&de(e,t.exit)}}),hY=w(Q(s_),ue(Q(Hb)),ue(Q("interrupted"))),mY={[wa]:wa,_tag:Hb,[pe](){return hY},[ge](e){return fE(e)&&e._tag===Hb}},pY=w(Q(s_),ue(Q(Lm)),ue(Q("running"))),gY={[wa]:wa,_tag:Lm,[pe](){return pY},[ge](e){return fE(e)&&e._tag===Lm}},sh=e=>{switch(e._tag){case Tc:return rh(hd(e.error));case Ic:return rh(ef(e.defect));case Rc:return rh(W4(e.fiberId));case Xi:return rh(Wt(e.value));case Du:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},Mu="effect/TExit",Lu=Symbol.for(Mu),Nd={_A:e=>e,_E:e=>e},xd=e=>ne(e,Lu),_Y=e=>e._tag===Xi,yY=e=>e._tag===Du,bY=e=>({[Lu]:Nd,_tag:Tc,error:e,[pe](){return w(Q(Mu),ue(Q(Tc)),ue(Q(e)),at(this))},[ge](t){return xd(t)&&t._tag===Tc&&de(e,t.error)}}),SY=e=>({[Lu]:Nd,_tag:Ic,defect:e,[pe](){return w(Q(Mu),ue(Q(Ic)),ue(Q(e)),at(this))},[ge](t){return xd(t)&&t._tag===Ic&&de(e,t.defect)}}),vY=e=>({[Lu]:Nd,_tag:Rc,fiberId:e,[pe](){return w(Q(Mu),ue(Q(Rc)),ue(Q(e)),at(this))},[ge](t){return xd(t)&&t._tag===Rc&&de(e,t.fiberId)}}),M$=e=>({[Lu]:Nd,_tag:Xi,value:e,[pe](){return w(Q(Mu),ue(Q(Xi)),ue(Q(e)),at(this))},[ge](t){return xd(t)&&t._tag===Xi&&de(e,t.value)}}),wY=w(Q(Mu),ue(Q(Du)),ue(Q("retry"))),EY={[Lu]:Nd,_tag:Du,[pe](){return wY},[ge](e){return xd(e)&&yY(e)}},kY=e=>({_tag:uE,exit:e}),lN=e=>({_tag:lE,journal:e}),L$={ref:0},$Y=()=>{const e=L$.ref+1;return L$.ref=e,e},CY="effect/STM",TY=Symbol.for(CY),oh={_R:e=>e,_E:e=>e,_A:e=>e};var CI,TI,II,RI;class Mo{constructor(t){d(this,"effect_instruction_i0");d(this,"_op",Hf);d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,RI);d(this,II);d(this,TI);d(this,CI);this.effect_instruction_i0=t,this[E$]=oa,this[Fy]=oh,this[Ub]=oh,this[Nm]=oh}get[(RI=E$,II=Fy,TI=Ub,CI=Nm,TY)](){return oh}[ge](t){return this===t}[pe](){return at(this,bp(this))}[Symbol.iterator](){return new Eu(new du(this))}commit(){return IY(this,Ll)}pipe(){return ee(this,arguments)}}const IY=(e,t,n)=>qe(r=>{const s=r.id(),o=r.getFiberRef(MP),a=r.getFiberRef(LP),u=r.getFiberRef(I9),f=OY(s,e,o,a,u);switch(f._tag){case uE:return t(f.exit),f.exit;case lE:{const h=$Y(),p={value:gY},g=OP(k=>fN(s,e,h,p,o,a,u,k));return fi(k=>w(k(g),ks(T=>{let O=p.value;return uN(O)&&(p.value=mY),O=p.value,dY(O)?(t(O.exit),O.exit):Qn(T)})))}}}),RY=(e,t,n,r,s,o)=>{const a=new Map,u=new dN(t,a,e,r).run(),f=tN(a);if(f===cE)eN(a);else if(f===Mm)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(u._tag){case Xi:return n.value=sh(u),Yo(Wt(u.value),a,s,o);case Tc:{n.value=sh(u);const h=Au(u.error);return Yo(on(h),a,s,o)}case Ic:{n.value=sh(u);const h=va(u.defect);return Yo(on(h),a,s,o)}case Rc:{n.value=sh(u);const h=Rg(e);return Yo(on(h),a,s,o)}case Du:return lN(a)}},OY=(e,t,n,r,s)=>{const o=new Map,a=new dN(t,o,e,n).run(),u=tN(o);if(u===cE&&_Y(a))eN(o);else if(u===Mm)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case Xi:return Yo(Wt(a.value),o,r,s);case Tc:{const f=Au(a.error);return Yo(on(f),o,r,s)}case Ic:{const f=va(a.defect);return Yo(on(f),o,r,s)}case Rc:{const f=Rg(e);return Yo(on(f),o,r,s)}case Du:return lN(o)}},fN=(e,t,n,r,s,o,a,u)=>{if(uN(r.value)){const f=RY(e,t,r,s,o,a);switch(f._tag){case uE:{qY(f.exit,u);break}case lE:{lY(n,f.journal,()=>fN(e,t,n,r,s,o,a,u));break}}}},Yo=(e,t,n,r)=>{const s=cY(t);return s.size>0&&n.scheduleTask(()=>uY(s),r),kY(e)},qY=(e,t)=>{t(e)};class dN{constructor(t,n,r,s){d(this,"self");d(this,"journal");d(this,"fiberId");d(this,"contStack",[]);d(this,"env");this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Bb;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==zb;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==D$;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=o_((s,o,a)=>qp(a,r));break}case"Left":{t=Vb(r.left);break}case"None":{t=Vb(new Ag);break}case"Right":{t=Qt(r.right);break}case"Some":{t=Qt(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case aN:{n=SY(gt(()=>r.effect_instruction_i1()));break}case iN:{const s=this.nextFailure();s===void 0?n=bY(gt(()=>r.effect_instruction_i1())):t=gt(()=>s.effect_instruction_i2(gt(()=>r.effect_instruction_i1())));break}case oN:{const s=this.nextRetry();s===void 0?n=EY:t=gt(()=>s.effect_instruction_i2());break}case cN:{n=vY(this.fiberId);break}case nN:{t=gt(()=>r.effect_instruction_i1(this));break}case Bb:case zb:case D$:{this.pushStack(r),t=r.effect_instruction_i1;break}case fY:{const s=this.env;this.env=gt(()=>r.effect_instruction_i2(s)),t=w(r.effect_instruction_i1,NY(dE(()=>this.env=s)));break}case sN:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=M$(s):t=gt(()=>o.effect_instruction_i2(s));break}case rN:{const s=gt(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=M$(s):t=gt(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=PY(r)}return n}}const AY=y(2,(e,t)=>{const n=new Mo(zb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),PY=e=>FY(()=>e),FY=e=>{const t=new Mo(aN);return t.effect_instruction_i1=e,t},o_=e=>ls(t=>Qt(e(t.journal,t.fiberId,t.getEnv()))),NY=y(2,(e,t)=>DY(e,{onFailure:n=>j$(t,Vb(n)),onSuccess:n=>j$(t,Qt(n))})),Vb=e=>xY(()=>e),xY=e=>{const t=new Mo(iN);return t.effect_instruction_i1=e,t},ju=y(2,(e,t)=>{const n=new Mo(Bb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),DY=y(2,(e,{onFailure:t,onSuccess:n})=>w(e,gf(ce),AY(r=>w(t(r),gf(oe))),ju(r=>{switch(r._tag){case"Left":return Qt(r.left);case"Right":return n(r.right)}}))),ls=e=>{const t=new Mo(nN);return t.effect_instruction_i1=e,t},Bo=e=>{const t=new Mo(cN);return t.effect_instruction_i1=e,t},gf=y(2,(e,t)=>w(e,ju(n=>dE(()=>t(n))))),oc=new Mo(oN),Qt=e=>{const t=new Mo(sN);return t.effect_instruction_i1=e,t},dE=e=>{const t=new Mo(rN);return t.effect_instruction_i1=e,t},j$=y(2,(e,t)=>w(e,ju(()=>t))),U$="BackPressure",Wb="Dropping",z$="Sliding",MY=e=>ju(e,ie),LY=(...e)=>jY(()=>{const n=(e.length===1?e[0]:e[1].bind(e[0]))(w),r=n.next(),s=o=>o.done?Qt(o.value):ju(f1(o.value),a=>s(n.next(a)));return s(r)}),jY=e=>MY(dE(e)),B$=Qt(void 0),UY="effect/TRef",zY=Symbol.for(UY),BY={_A:e=>e};var OI;OI=zY;class HY{constructor(t){d(this,OI,BY);d(this,"todos");d(this,"versioned");this.versioned=new QF(t),this.todos=new Map}modify(t){return o_(n=>{const r=hE(this,n),[s,o]=t(XF(r));return ZF(r,o),s})}pipe(){return ee(this,arguments)}}const hN=e=>o_(t=>{const n=new HY(e);return t.set(n,YF(n,!0)),n}),VY=e=>e.modify(t=>[t,t]),WY=y(2,(e,t)=>e.modify(()=>[void 0,t])),KY=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),hE=(e,t)=>{if(t.has(e))return t.get(e);const n=YF(e,!1);return t.set(e,n),n},Bs=y(2,(e,t)=>XF(hE(e,t))),Hs=y(3,(e,t,n)=>{const r=hE(e,n);ZF(r,t)}),JY="effect/TQueue/TEnqueue",GY=Symbol.for(JY),QY="effect/TQueue/TDequeue",YY=Symbol.for(QY),XY={_tag:Wb},ZY={_Out:e=>e},eX={_In:e=>e};var qI,AI;AI=YY,qI=GY;class tX{constructor(t,n,r){d(this,"ref");d(this,"requestedCapacity");d(this,"strategy");d(this,AI,ZY);d(this,qI,eX);d(this,"size",ls(t=>{const n=Bs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):Qt(n.length)}));d(this,"isFull",gf(this.size,t=>t===this.requestedCapacity));d(this,"isEmpty",gf(this.size,t=>t===0));d(this,"shutdown",ls(t=>(Hs(this.ref,void 0,t.journal),B$)));d(this,"isShutdown",o_(t=>Bs(this.ref,t)===void 0));d(this,"awaitShutdown",ju(this.isShutdown,t=>t?B$:oc));d(this,"peek",ls(t=>{const n=Bs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):n.length===0?oc:Qt(n[0])}));d(this,"peekOption",ls(t=>{const n=Bs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):Qt(Ca(n[0]))}));d(this,"take",ls(t=>{const n=Bs(this.ref,t.journal);if(n===void 0)return Bo(t.fiberId);if(n.length===0)return oc;const r=n.shift();return Hs(this.ref,n,t.journal),Qt(r)}));d(this,"takeAll",ls(t=>{const n=Bs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):(Hs(this.ref,[],t.journal),Qt(n))}));this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}offer(t){return ls(n=>{const r=w(this.ref,Bs(n.journal));if(r===void 0)return Bo(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),Hs(this.ref,r,n.journal),Qt(!0);switch(this.strategy._tag){case U$:return oc;case Wb:return Qt(!1);case z$:return r.length===0||(r.shift(),r.push(t),Hs(this.ref,r,n.journal)),Qt(!0)}})}offerAll(t){return ls(n=>{const r=Array.from(t),s=Bs(this.ref,n.journal);if(s===void 0)return Bo(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return Hs(this.ref,[...s,...r],n.journal),Qt(!0);switch(this.strategy._tag){case U$:return oc;case Wb:{const o=r.slice(0,this.requestedCapacity-s.length);return Hs(this.ref,[...s,...o],n.journal),Qt(!1)}case z$:{const o=r.slice(0,this.requestedCapacity-s.length),a=s.length+o.length-this.requestedCapacity,u=s.slice(a);return Hs(this.ref,[...u,...o],n.journal),Qt(!0)}}})}takeUpTo(t){return ls(n=>{const r=Bs(this.ref,n.journal);if(r===void 0)return Bo(n.fiberId);const[s,o]=DR(zt(r),t);return Hs(this.ref,Array.from(o),n.journal),Qt(Array.from(s))})}}const nX=y(2,(e,t)=>e.offer(t)),rX=e=>e.peek,sX=e=>e.take,oX=()=>iX(Number.MAX_SAFE_INTEGER,XY),iX=(e,t)=>gf(hN([]),n=>new tX(n,e,t)),aX=nX,cX=rX,uX=sX,lX=oX,fX=e=>Object.assign(e,{chunk(n){return this(Le(n))},die(n){return this(li(n))},dieMessage(n){return this(qP(n))},done(n){return this(_t(()=>J4(n,{onFailure:W,onSuccess:ft})))},end(){return this(zn(V()))},fail(n){return this(zn(W(n)))},fromEffect(n){return this(AP(n,{onFailure:W,onSuccess:ft}))},fromEffectChunk(n){return this(w(n,wo(W)))},halt(n){return this(Qn(w(n,qg(W))))},single(n){return this(Le(ft(n)))}}),dX=(e,t)=>{let n=!1,r=[],s=!1;function o(f){if(n)return!1;if(f.length<=5e4)r.push.apply(r,f);else for(let h=0;h<f.length;h++)r.push(f[0]);return s||(s=!0,t.scheduleTask(a,0)),!0}function a(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function u(f){n||(n=!0,f._tag==="Success"&&r.push(f.value),a(),e.unsafeOffer(f._tag==="Success"?Xn:f))}return{single(f){return n?!1:(r.push(f),s||(s=!0,t.scheduleTask(a,0)),!0)},array:o,chunk(f){return o(dr(f))},done:u,end(){n||(n=!0,a(),e.unsafeOffer(Xn))},halt(f){return u(on(f))},fail(f){return u(hd(f))},die(f){return u(ef(f))},dieMessage(f){return u(ef(new Error(f)))}}},hX="effect/Take",mX=Symbol.for(hX),pX={_A:e=>e,_E:e=>e};var PI;PI=mX;class i_{constructor(t){d(this,"exit");d(this,PI,pX);this.exit=t}pipe(){return ee(this,arguments)}}const _f=e=>new i_(Wt(e)),gX=e=>_t(()=>e.exit),yf=new i_(hd(V())),a_=e=>new i_(on(w(e,qg(W)))),_X=e=>pf(e,{onFailure:t=>st(vw(t),{onNone:()=>yf,onSome:a_}),onSuccess:_f}),mN=y(2,(e,{onEnd:t,onFailure:n,onSuccess:r})=>Yr(e.exit,{onFailure:s=>st(vw(s),{onNone:t,onSome:n}),onSuccess:r})),yX=e=>new i_(Wt(ft(e))),pN=()=>zn(V()),bX=e=>wo(Qn(e),W),SX="effect/Stream",gN=Symbol.for(SX),vX={_R:e=>e,_E:e=>e,_A:e=>e};var FI;FI=gN;class Xe{constructor(t){d(this,"channel");d(this,FI,vX);this.channel=t}pipe(){return ee(this,arguments)}}const Dd=e=>ne(e,gN)||Mr(e),mE=4096,wX=e=>{if(e==="unbounded")return hn();if(typeof e=="number"||e===void 0)return su(e??16);switch(e.strategy){case"dropping":return Jg(e.bufferSize??16);case"sliding":return Gg(e.bufferSize??16);default:return su(e.bufferSize??16)}},EX=e=>{if((e==null?void 0:e.bufferSize)==="unbounded"||(e==null?void 0:e.bufferSize)===void 0&&(e==null?void 0:e.strategy)===void 0)return hn();switch(e==null?void 0:e.strategy){case"sliding":return Gg(e.bufferSize??16);default:return Jg((e==null?void 0:e.bufferSize)??16)}},kX=(e,t)=>it(EX(t),Dt).pipe(Eo(n=>T9(LP,r=>e(dX(n,r)))),Se(n=>{const r=Pe(ko(n),s=>B4(s)?Gc(s)?mn:qt(s.cause):Fd(tt(zt(s)),r));return r}),t_,DX),$X=(e,t)=>w(it(wX(t),n=>Dt(n)),X(n=>w(xo(),X(r=>w(e(fX(s=>w(_X(s),X(o=>Ye(n,o)),As,K7(r)).then(o=>{if(Fa(o)&&!lf(o.cause))throw ww(o.cause)}))),pt(Si(!1)),X(s=>w(Gi(s),Se(o=>o?pN():w(ko(n),X(gX),i9(()=>w(Yc(s,!0),pt(Dt(n)))))))))))),_E,ri(u_)),CX=y(2,(e,t)=>{if(t.strategy==="dropping")return TX(e,t.capacity);if(t.strategy==="sliding")return IX(e,t.capacity);const n=rZ(e,t);return new Xe(t_(Se(n,r=>{const s=w(Ct(ko(r)),Pe(mN({onEnd:()=>mn,onFailure:qt,onSuccess:o=>w(tt(o),Pe(()=>s))})));return s})))}),TX=y(2,(e,t)=>{const n=it(Jg(t),r=>Dt(r));return new Xe(_N(n,Ge(e)))}),IX=y(2,(e,t)=>{const n=it(Gg(t),r=>Dt(r));return new Xe(_N(n,Ge(e)))}),_N=(e,t)=>{const n=(s,o)=>{const a=u=>w(Gi(o),Eo(Ht),pt(Me()),X(f=>w(Ye(s,[u,f]),pt(Yc(o,f)),pt(Ht(f)))),As,Ct);return br({onInput:u=>w(Me(),X(f=>w(Ye(s,[_f(u),f]),X(h=>w(Yc(o,f),NP(()=>h))))),As,Ct,Pe(()=>n(s,o))),onFailure:u=>a(a_(u)),onDone:()=>a(yf)})},r=s=>{const o=w(Ct(ko(s)),Pe(([a,u])=>Fd(Ct(ut(u,void 0)),mN(a,{onEnd:()=>mn,onFailure:qt,onSuccess:f=>w(tt(f),Pe(()=>o))}))));return o};return t_(w(e,X(s=>w(Me(),Eo(o=>ut(o,void 0)),X(o=>w(Si(o),X(a=>w(t,ln(n(s,a)),UF,Kt)),fo(r(s))))))))},yN=y(2,(e,t)=>new Xe(w(Ge(e),Fd(Ge(t))))),RX=e=>Uu(li(e)),Kb=y(2,(e,t)=>new Xe(w(Ge(e),FF(t)))),OX=y(2,(e,t)=>new Xe(nE(Ge(e),t))),qX=e=>pE(zn(W(e))),AX=y(2,(e,t)=>EN(e,Ap(t))),PX=y(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?br({onInput:o=>n(o[Symbol.iterator]()),onFailure:qt,onDone:xa}):w(t(s.value),Se(o=>o?w(tt(ft(s.value)),Pe(()=>n(r))):n(r)),xr)};return new Xe(Od(()=>w(Ge(e),ln(n(yt()[Symbol.iterator]())))))}),FX=y(2,(e,t)=>EN(e,xR(t))),ri=y(e=>Dd(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?Jb(n==null?void 0:n.concurrency,()=>H$(e,1,r,t),s=>H$(e,s,r,t)):Jb(n==null?void 0:n.concurrency,()=>new Xe(Dm(Ge(e),s=>w(s,uc(o=>Ge(t(o))),MU(mn,(o,a)=>w(o,Fd(a)))))),s=>new Xe(w(Ge(e),Dm(n_),MF(o=>Ge(t(o)),n))))}),Jb=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},H$=y(4,(e,t,n,r)=>new Xe(w(Ge(e),Dm(n_),MF(s=>Ge(r(s)),{concurrency:t,mergeStrategy:v7(),bufferSize:n})))),c_=y(e=>Dd(e[0]),(e,t)=>ri(e,ie,t)),bN=e=>{const t=br({onInput:n=>Pe(n_(n),()=>t),onFailure:qt,onDone:()=>mn});return new Xe(w(Ge(e),ln(t)))},NX=e=>{const t=(r,s)=>{const[o,a]=w(r,xU(f=>!Gc(f))),u=w(Pp(a),st({onNone:()=>s,onSome:Yr({onFailure:f=>st(vw(f),{onNone:()=>mn,onSome:qt}),onSuccess:()=>mn})}));return w(tt(w(o,xR(f=>Gc(f)?W(f.value):V()))),Pe(()=>u))},n=br({onInput:r=>t(r,n),onFailure:r=>qt(r),onDone:()=>mn});return new Xe(w(Ge(e),ln(n)))},xX=e=>w(e,Sf(go),bN),SN=e=>bN(NX(w(e,Sf(t=>t.exit)))),DX=e=>new Xe(e),Ge=e=>{if("channel"in e)return e.channel;if(Mr(e))return Ge(Uu(e));throw new TypeError("Expected a Stream.")},Gb=e=>new Xe(Zf(e)?mn:tt(e)),Uu=e=>w(e,wo(W),pE),pE=e=>new Xe(xr(y9(e,{onFailure:st({onNone:()=>mn,onSome:Rd}),onSuccess:t=>tt(ft(t))}))),vN=(e,t)=>{const n=(t==null?void 0:t.maxChunkSize)??mE;if(t!=null&&t.scoped){const s=Se(T$(e),o=>bf(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?Se(s,Kb(Fm(e))):s}const r=ri(_E(T$(e)),s=>bf(s,{maxChunkSize:n}));return t!=null&&t.shutdown?Kb(r,Fm(e)):r},MX=e=>yE(()=>Wi(e)?Gb(e):LX(e[Symbol.iterator]())),LX=(e,t=mE)=>w(Te(()=>{let n=[];const r=s=>w(Te(()=>{let o=s.next();if(t===1)return o.done?mn:w(tt(ft(o.value)),Pe(()=>r(s)));n=[];let a=0;for(;o.done===!1&&(n.push(o.value),a=a+1,!(a>=t));)o=s.next();return a>0?w(tt(zt(n)),Pe(()=>r(s))):mn}),xr);return new Xe(r(e))}),$N),jX=e=>w(e,Se(u_),l_),bf=(e,t)=>w(XP(e,1,(t==null?void 0:t.maxChunkSize)??mE),ks(n=>w(zQ(e),X(r=>r&&lf(n)?pN():bX(n)))),u_,t!=null&&t.shutdown?Kb(Dt(e)):ie),UX=(...e)=>{const t=e.length===1?e[0].evaluate:e[0],n=e.length===1?e[0].onError:e[1],r=e.length===1?e[0].releaseLockOnEnd===!0:!1;return l_(Se(it(Te(()=>t().getReader()),s=>r?Te(()=>s.releaseLock()):Dg(()=>s.cancel())),s=>Qb(X(Tl({try:()=>s.read(),catch:o=>W(n(o))}),({done:o,value:a})=>o?zn(V()):Le(a)))))},wN=(...e)=>MX(e),Sf=y(2,(e,t)=>new Xe(w(Ge(e),e_(uc(t))))),EN=y(2,(e,t)=>new Xe(w(Ge(e),e_(t)))),zX=y(2,(e,t)=>new Xe(w(Ge(e),DF(t)))),jm=y(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return br({onInput:o=>n(o[Symbol.iterator]()),onFailure:qt,onDone:xa});{const o=s.value;return xr(Se(t(o),a=>Pe(tt(ft(a)),()=>n(r))))}};return new Xe(w(Ge(e),ln(Od(()=>n(yt()[Symbol.iterator]())))))}),BX=y(3,(e,t,n)=>new Xe(w(Ge(e),Dm(n_),O7(n,t),e_(ft)))),HX=y(2,(e,t)=>new Xe(w(Ge(e),I7(t)))),VX=y(2,(e,t)=>WX(e,t,{onSelf:oe,onOther:ce})),WX=y(3,(e,t,n)=>{const r=n.haltStrategy?nY(n.haltStrategy):rY,s=o=>a=>o||!Gc(a)?V7(_t(()=>a)):W7(u=>_t(()=>u));return new Xe(LF(Ge(Sf(e,n.onSelf)),{other:Ge(Sf(t,n.onOther)),onSelfDone:s(r._tag==="Either"||r._tag==="Left"),onOtherDone:s(r._tag==="Either"||r._tag==="Right")}))}),KX=Uu(Pw),JX=e=>w(e,GX(ie)),GX=y(2,(e,t)=>new Xe(w(Ge(e),P7(t)))),QX=y(2,(e,t)=>new Xe(w(Ge(e),Nb(t)))),u_=e=>aZ(e,t=>w(Se(t,n=>W([n,t])),Mg(st({onNone:()=>Le(V()),onSome:zn})))),Qb=e=>u_(w(e,Se(ft))),gE=y(2,(e,t)=>Ge(e).pipe(jF(WF(t)),N7)),YX=e=>gE(e,U7()),XX=e=>gE(e,z7),kN=y(2,(e,t)=>gE(e,B7(t))),ZX=y(2,(e,t)=>{const n=br({onInput:r=>Pe(tt(_f(r)),()=>n),onFailure:r=>tt(a_(r)),onDone:()=>tt(yf)});return w(ln(Ge(e),n),DF(r=>Ye(t,r)),Xg,UF,As)}),_E=e=>new Xe(FF(zF(w(e,Se(ft))),fe)),eZ=e=>new Xe(BF(t=>e(t).pipe(Se(ft)))),yE=e=>new Xe(Od(()=>Ge(e()))),tZ=y(2,(e,t)=>{if(!Number.isInteger(t))return RX(new J8(`${t} must be an integer`));const n=r=>Qg({onInput:s=>{const o=w(s,Nc(Math.min(r,Number.POSITIVE_INFINITY))),a=Math.max(0,r-o.length);return a>0?w(tt(o),Pe(()=>n(a))):tt(o)},onFailure:Rd,onDone:xa});return new Xe(w(Ge(e),jF(0<t?n(t):mn)))}),nZ=y(2,(e,t)=>jm(e,n=>fo(t(n),n))),dy=e=>Se(x7(Ge(e)),t=>w(t,wo(W),X(sn({onLeft:()=>zn(V()),onRight:Le})))),rZ=y(e=>Dd(e[0]),(e,t)=>Eo(it((t==null?void 0:t.strategy)==="unbounded"?hn():(t==null?void 0:t.strategy)==="dropping"?Jg(t.capacity??2):(t==null?void 0:t.strategy)==="sliding"?Gg(t.capacity??2):su((t==null?void 0:t.capacity)??2),n=>Dt(n)),n=>Kt(ZX(e,n)))),sZ=y(e=>Dd(e[0]),(e,t)=>Se(xo(),n=>oZ(e,n,t))),oZ=y(e=>Dd(e[0]),(e,t,n)=>{const r=KF(t);let s,o;const a=v9(!1);return new ReadableStream({start(u){o=r(kN(e,f=>a.whenOpen(Te(()=>{a.unsafeClose();for(const h of f)u.enqueue(h);s(),s=void 0})))),o.addObserver(f=>{f._tag==="Failure"?u.error(ww(f.cause)):u.close()})},pull(){return new Promise(u=>{s=u,$s(a.open)})},cancel(){if(o)return DP(As(Nr(o)))}},n==null?void 0:n.strategy)}),iZ=(e,t)=>{const n=r=>st(t(r),{onNone:()=>mn,onSome:([s,o])=>Pe(tt(s),()=>n(o))});return new Xe(Od(()=>n(e)))},aZ=(e,t)=>yE(()=>{const n=r=>xr(Se(t(r),st({onNone:()=>mn,onSome:([s,o])=>Pe(tt(s),()=>n(o))})));return new Xe(n(e))}),$N=e=>c_(Uu(e)),l_=e=>c_(_E(e)),cZ=e=>c_(eZ(t=>e(t))),uZ=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new Xe(x$(Ge(r),t,n))}return r=>new Xe(x$(Ge(r),t,n))},lZ=y(2,(e,t)=>w(e,fZ(t,(n,r)=>[n,r]))),fZ=y(3,(e,t,n)=>{const r=s=>w(s,X(o=>Zf(o)?r(s):Le(o)));return w(dy(e),Se(r),qm(w(dy(t),Se(r))),X(([s,o])=>w(pE(Lw(s,o,{onSelfDone:(a,u)=>w(_t(()=>a),ru(Rm(u),(f,h)=>[f,h,!0])),onOtherDone:(a,u)=>w(_t(()=>a),ru(Rm(u),(f,h)=>[h,f,!1]))})),ri(([a,u,f])=>w(Uu(Si([Qa(a),Qa(u)])),ri(h=>w(Gb(f?w(u,uc(p=>n(Qa(a),p))):w(a,uc(p=>n(p,Qa(u))))),yN(w(Qb(s),VX(Qb(o)),jm(sn({onLeft:p=>w(qi(h,([g,k])=>[w(p,uc(T=>n(T,k))),[Qa(p),k]])),onRight:p=>w(qi(h,([g,k])=>[w(p,uc(T=>n(g,T))),[g,Qa(p)]]))})),ri(Gb))))))),dy)),jX)}),dZ=(e,t,n)=>kX(r=>it(Te(()=>e.addEventListener(t,r.single,n)),()=>Te(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),CN="effect/Redacted",xh=Ee("effect/Redacted/redactedRegistry",()=>new WeakMap),TN=Symbol.for(CN),hZ={[TN]:{_A:e=>e},pipe(){return ee(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[Ue](){return"<redacted>"},[pe](){return w(Q(CN),ue(Q(xh.get(this))),at(this))},[ge](e){return mZ(e)&&de(xh.get(this),xh.get(e))}},mZ=e=>ne(e,TN),pZ=e=>{const t=Object.create(hZ);return xh.set(t,e),t},V$=Symbol.for("effect/Encoding/errors/Decode"),Dh=(e,t)=>{const n={_tag:"DecodeException",[V$]:V$,input:e};return Rn(t)&&(n.message=t),n},W$=Symbol.for("effect/Encoding/errors/Encode"),gZ=(e,t)=>{const n={_tag:"EncodeException",[W$]:W$,input:e};return Rn(t)&&(n.message=t),n},_Z=new TextEncoder,K$=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=Vs[e[r-2]>>2],n+=Vs[(e[r-2]&3)<<4|e[r-1]>>4],n+=Vs[(e[r-1]&15)<<2|e[r]>>6],n+=Vs[e[r]&63];return r===t+1&&(n+=Vs[e[r-2]>>2],n+=Vs[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=Vs[e[r-2]>>2],n+=Vs[(e[r-2]&3)<<4|e[r-1]>>4],n+=Vs[(e[r-1]&15)<<2],n+="="),n},yZ=e=>{const t=bZ(e),n=t.length;if(n%4!==0)return oe(Dh(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return oe(Dh(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let a=0,u=0;a<n;a+=4,u+=3){const f=ih(t.charCodeAt(a))<<18|ih(t.charCodeAt(a+1))<<12|ih(t.charCodeAt(a+2))<<6|ih(t.charCodeAt(a+3));o[u]=f>>16,o[u+1]=f>>8&255,o[u+2]=f&255}return ce(o)}catch(s){return oe(Dh(t,s instanceof Error?s.message:"Invalid input"))}},bZ=e=>e.replace(/[\n\r]/g,"");function ih(e){if(e>=J$.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=J$[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const Vs=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],J$=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],SZ=e=>K$(typeof e=="string"?_Z.encode(e):e),vZ=e=>yZ(e),wZ=e=>HS({try:()=>encodeURIComponent(e),catch:t=>$Z(e,t instanceof Error?t.message:"Invalid input")}),EZ=e=>HS({try:()=>decodeURIComponent(e),catch:t=>kZ(e,t instanceof Error?t.message:"Invalid input")}),kZ=Dh,$Z=gZ,Yb=Symbol.for("effect/FiberHandle"),CZ=e=>ne(e,Yb),TZ={[Yb]:Yb,toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},IZ=e=>{const t=Object.create(TZ);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},IN=()=>it(Se(Me(),e=>IZ(e)),e=>qs(t=>{const n=e.state;return n._tag==="Closed"?fe:(e.state={_tag:"Closed"},n.fiber?Td(As(Fg(n.fiber,hr(t.id(),Il))),e.deferred):Pa(e.deferred,Xn))})),RN=-1,Il=_v(RN,0),RZ=Ew(void 0,{emptyCase:Jn,failCase:Jn,dieCase:Jn,interruptCase:(e,t)=>Bp(Wp(t),RN),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),OZ=y(e=>CZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(hr((n==null?void 0:n.interruptAs)??jn,Il));return}else if(e.state.fiber!==void 0){if((n==null?void 0:n.onlyIfMissing)===!0){t.unsafeInterruptAsFork(hr((n==null?void 0:n.interruptAs)??jn,Il));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(hr((n==null?void 0:n.interruptAs)??jn,Il)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),Fa(r)&&((n==null?void 0:n.propagateInterruption)===!0?!RZ(r.cause):!lo(r.cause))&&Di(e.deferred,r)})}),qZ=e=>fi(t=>qs(n=>e.state._tag==="Closed"||e.state.fiber===void 0?fe:pt(t(Fg(e.state.fiber,hr(n.id(),Il))),Te(()=>{e.state._tag==="Open"&&(e.state.fiber=void 0)})))),AZ=function(){let e;return()=>(e===void 0&&(e=Do(hs)),e)}(),Um=function(){const e=arguments[0];if(Mr(arguments[1]))return G$(e,arguments[1],arguments[2]);const t=arguments[1];return n=>G$(e,n,t)},G$=(e,t,n)=>Dw(r=>e.state._tag==="Closed"?hs:e.state.fiber!==void 0&&(n==null?void 0:n.onlyIfMissing)===!0?Te(AZ):Eo(Mw(t),s=>OZ(e,s,{...n,interruptAs:r}))),Xb=Symbol.for("effect/FiberMap"),PZ=e=>ne(e,Xb),FZ={[Xb]:Xb,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},NZ=(e,t)=>{const n=Object.create(FZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},xZ=()=>it(Se(Me(),e=>NZ(aq(),e)),e=>qs(t=>{const n=e.state;return n._tag==="Closed"?fe:(e.state={_tag:"Closed"},hP(NL(n.backing,([,r])=>r),hr(t.id(),Rl)).pipe(Td(e.deferred)))})),ON=-1,Rl=_v(ON,0),DZ=Ew(void 0,{emptyCase:Jn,failCase:Jn,dieCase:Jn,interruptCase:(e,t)=>Bp(Wp(t),ON),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),MZ=y(e=>PZ(e[0]),(e,t,n,r)=>{if(e.state._tag==="Closed"){n.unsafeInterruptAsFork(hr((r==null?void 0:r.interruptAs)??jn,Rl));return}const s=ds(e.state.backing,t);if(s._tag==="Some"){if((r==null?void 0:r.onlyIfMissing)===!0){n.unsafeInterruptAsFork(hr((r==null?void 0:r.interruptAs)??jn,Rl));return}else if(s.value===n)return;s.value.unsafeInterruptAsFork(hr((r==null?void 0:r.interruptAs)??jn,Rl))}rc(e.state.backing,t,n),n.addObserver(o=>{if(e.state._tag==="Closed")return;const a=ds(e.state.backing,t);lt(a)&&n===a.value&&X4(e.state.backing,t),Fa(o)&&((r==null?void 0:r.propagateInterruption)===!0?!DZ(o.cause):!lo(o.cause))&&Di(e.deferred,o)})}),LZ=y(2,(e,t)=>e.state._tag==="Closed"?!1:nc(e.state.backing,t)),hy=y(2,(e,t)=>qs(n=>{if(e.state._tag==="Closed")return fe;const r=ds(e.state.backing,t);return r._tag==="None"?fe:Fg(r.value,hr(n.id(),Rl))})),jZ=function(){let e;return()=>(e===void 0&&(e=Do(hs)),e)}(),my=function(){const e=arguments[0];if(Mr(arguments[2]))return Q$(e,arguments[1],arguments[2],arguments[3]);const t=arguments[1],n=arguments[2];return r=>Q$(e,t,r,n)},Q$=(e,t,n,r)=>Dw(s=>e.state._tag==="Closed"?hs:(r==null?void 0:r.onlyIfMissing)===!0&&LZ(e,t)?Te(jZ):Eo(Mw(n),o=>MZ(e,t,o,{...r,interruptAs:s}))),Zb=Symbol.for("effect/FiberSet"),UZ=e=>ne(e,Zb),zZ={[Zb]:Zb,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Ue](){return this.toJSON()},pipe(){return ee(this,arguments)}},BZ=(e,t)=>{const n=Object.create(zZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},HZ=()=>it(Se(Me(),e=>BZ(new Set,e)),e=>qs(t=>{const n=e.state;if(n._tag==="Closed")return fe;e.state={_tag:"Closed"};const r=n.backing;return hP(r,hr(t.id(),AN)).pipe(Td(e.deferred))})),qN=-1,AN=_v(qN,0),VZ=Ew(void 0,{emptyCase:Jn,failCase:Jn,dieCase:Jn,interruptCase:(e,t)=>Bp(Wp(t),qN),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),Y$=y(e=>UZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(hr((n==null?void 0:n.interruptAs)??jn,AN));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),Fa(r)&&((n==null?void 0:n.propagateInterruption)===!0?!VZ(r.cause):!lo(r.cause))&&Di(e.deferred,r))})}),WZ="effect/GroupBy",PN=Symbol.for(WZ),KZ={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},JZ=e=>ne(e,PN),GZ=y(e=>JZ(e[0]),(e,t,n)=>ri(e.grouped,([r,s])=>t(r,SN(bf(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:(n==null?void 0:n.bufferSize)??16})),QZ=e=>({[PN]:KZ,pipe(){return ee(this,arguments)},grouped:e}),YZ=y(e=>typeof e[0]!="function",(e,t,n)=>n!=null&&n.key?GZ(XZ(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>jm(s,t)):Jb(n==null?void 0:n.concurrency,()=>jm(e,t),r=>n!=null&&n.unordered?ri(e,s=>Uu(t(s)),{concurrency:r}):BX(e,r,t))),XZ=y(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>br({onInput:a=>Pe(Ct(Sn(ZZ(a,t),([u,f])=>{const h=s.get(u);return h===void 0?w(su((n==null?void 0:n.bufferSize)??16),X(p=>w(Te(()=>{s.set(u,p)}),pt(Ye(o,yX([u,p]))),pt(w(Ye(p,_f(f)),ry(g=>lo(g)?W(fe):V())))))):ry(Ye(h,_f(f)),p=>lo(p)?W(fe):V())},{discard:!0})),()=>r(s,o)),onFailure:a=>Ct(Ye(o,a_(a))),onDone:()=>w(Ct(w(Sn(s.entries(),([a,u])=>w(Ye(u,yf),ry(f=>lo(f)?W(fe):V())),{discard:!0}),pt(Ye(o,yf)))))});return QZ(cZ(s=>z(function*(){const o=new Map,a=yield*hn();return yield*ni(s,Dt(a)),yield*Ge(e).pipe(ln(r(o,a)),Xg,sE(s),mr(s),fo(SN(bf(a,{shutdown:!0}))))})))}),ZZ=y(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const a=o.value,u=t(a);if(s.has(u))s.get(u).push(a);else{const f=[a];n.push([u,f]),s.set(u,f)}}return zt(n.map(a=>[a[0],zt(a[1])]))});class yn{constructor(t,n,r){d(this,"path");d(this,"actual");d(this,"issue");d(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class X${constructor(t,n){d(this,"actual");d(this,"message");d(this,"_tag","Unexpected");this.actual=t,this.message=n}}class sl{constructor(t,n){d(this,"ast");d(this,"message");d(this,"_tag","Missing");d(this,"actual");this.ast=t,this.message=n}}class jt{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"issues");d(this,"output");d(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class py{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class gy{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Gt{constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class Z${constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const eC=Symbol.for("effect/Schema/ParseErrorTypeId");var NI;class eee extends TJ("ParseError"){constructor(){super(...arguments);d(this,NI,eC)}get message(){return this.toString()}toString(){return ql.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(NI=eC,Ue)](){return this.toJSON()}}const zu=e=>new eee({issue:e}),Xr=ce,Bu=oe,tC=HS,Dn=T1,Xo=y(2,(e,t)=>Dn(e)?sn(e,{onLeft:oe,onRight:t}):X(e,t)),ur=y(2,(e,t)=>Dn(e)?pL(e,t):Se(e,t)),Ol=y(2,(e,t)=>Dn(e)?ia(e,t):wo(e,t)),tee=y(2,(e,t)=>Dn(e)?mL(e,{onLeft:t.onFailure,onRight:t.onSuccess}):AP(e,t)),FN=y(2,(e,t)=>Dn(e)?sn(e,{onLeft:t,onRight:ce}):Mg(e,t)),f_=(e,t)=>t===void 0||mo(t)?e:e===void 0?t:{...e,...t},d_=(e,t,n)=>{const r=fn(e,t);return(s,o)=>r(s,f_(n,o))},bE=(e,t,n)=>{const r=d_(e,t,n);return(s,o)=>I1(r(s,o),zu)},NN=(e,t,n)=>{const r=fn(e,t);return(s,o)=>r(s,{...f_(n,o),isEffectAllowed:!0})},zm=(e,t)=>bE(e.ast,!0,t),nee=(e,t)=>d_(e.ast,!0,t),Md=(e,t)=>NN(e.ast,!0,t),xN=(e,t)=>bE(e.ast,!1,t),ree=(e,t)=>d_(e.ast,!1,t),Hu=(e,t)=>NN(e.ast,!1,t),SE=zm,see=Md,h_=(e,t)=>bE(xt(e.ast),!0,t),oee=(e,t)=>d_(xt(e.ast),!0,t),Cn=(e,t)=>{const n=fn(xt(e.ast),!0);return(r,s)=>ys(n(r,{exact:!0,...f_(t,s)}))},Ss=xN,iee=Hu,aee=Ee(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),cee=Ee(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),fn=(e,t)=>{const n=t?aee:cee,r=n.get(e);if(r)return r;const s=uee(e,t),o=$j(e),a=lt(o)?(h,p)=>s(h,f_(p,o.value)):s,u=Cj(e),f=t&&lt(u)?(h,p)=>gl(FN(a(h,p),u.value),e,h,p):a;return n.set(e,f),f},_y=e=>lr(wj(e)),yy=e=>lr(Ej(e)),uee=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=fn(e.from,!0);return(r,s)=>{s=s??V_;const o=(s==null?void 0:s.errors)==="all",a=Xo(FN(n(r,s),u=>{const f=new py(e,r,"From",u);return o&&Ij(e)&&jN(u)?st(e.filter(r,s,e),{onNone:()=>oe(f),onSome:h=>oe(new jt(e,r,[f,new py(e,r,"Predicate",h)]))}):oe(f)}),u=>st(e.filter(u,s,e),{onNone:()=>ce(u),onSome:f=>oe(new py(e,r,"Predicate",f))}));return gl(a,e,r,s)}}else{const n=fn(xt(e),!0),r=fn(DN(e.from),!1);return(s,o)=>gl(Xo(n(s,o),a=>r(a,o)),e,s,o)}case"Transformation":{const n=dee(e.transformation,t),r=t?fn(e.from,!0):fn(e.to,!1),s=t?fn(e.to,!0):fn(e.from,!1);return(o,a)=>gl(Xo(Ol(r(o,a),u=>new gy(e,o,t?"Encoded":"Type",u)),u=>Xo(Ol(n(u,a??V_,e,o),f=>new gy(e,o,"Transformation",f)),f=>Ol(s(f,a),h=>new gy(e,o,t?"Type":"Encoded",h)))),e,o,a)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>gl(n(r,s??V_,e),e,r,s)}case"Literal":return sr(e,n=>n===e.literal);case"UniqueSymbol":return sr(e,n=>n===e.symbol);case"UndefinedKeyword":return sr(e,AM);case"NeverKeyword":return sr(e,PM);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return ce;case"StringKeyword":return sr(e,Rn);case"NumberKeyword":return sr(e,mo);case"BooleanKeyword":return sr(e,na);case"BigIntKeyword":return sr(e,gp);case"SymbolKeyword":return sr(e,Wh);case"ObjectKeyword":return sr(e,Ms);case"Enums":return sr(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=ER(e);return sr(e,r=>Rn(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(h=>fn(h.type,t)),r=e.rest.map(h=>fn(h.type,t));let s=e.elements.filter(h=>!h.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,a=e.elements.length>0?e.elements.map((h,p)=>p).join(" | "):"never",u=_y(e),f=yy(e);return(h,p)=>{if(!zL(h))return oe(new Gt(e,h));const g=(p==null?void 0:p.errors)==="all",k=[];let T=0;const O=[],M=h.length;for(let C=M;C<=o-1;C++){const $=new yn(C,h,new sl(s[C-M]));if(g){k.push([T++,$]);continue}else return oe(new jt(e,h,$,O))}if(e.rest.length===0)for(let C=e.elements.length;C<=M-1;C++){const $=new yn(C,h,new X$(h[C],`is unexpected, expected: ${a}`));if(g){k.push([T++,$]);continue}else return oe(new jt(e,h,$,O))}let E=0,S;for(;E<n.length;E++)if(M<E+1){if(e.elements[E].isOptional)continue}else{const C=n[E],$=C(h[E],p);if(Dn($)){if(tn($)){const q=new yn(E,h,$.left);if(g){k.push([T++,q]);continue}else return oe(new jt(e,h,q,Hr(O)))}O.push([T++,$.right])}else{const q=T++,P=E;S||(S=[]),S.push(({es:x,output:L})=>X(Oi($),B=>{if(tn(B)){const F=new yn(P,h,B.left);return g?(x.push([q,F]),fe):oe(new jt(e,h,F,Hr(L)))}return L.push([q,B.right]),fe}))}}if(bt(r)){const[C,...$]=r;for(;E<M-$.length;E++){const q=C(h[E],p);if(Dn(q))if(tn(q)){const P=new yn(E,h,q.left);if(g){k.push([T++,P]);continue}else return oe(new jt(e,h,P,Hr(O)))}else O.push([T++,q.right]);else{const P=T++,x=E;S||(S=[]),S.push(({es:L,output:B})=>X(Oi(q),F=>{if(tn(F)){const j=new yn(x,h,F.left);return g?(L.push([P,j]),fe):oe(new jt(e,h,j,Hr(B)))}else return B.push([P,F.right]),fe}))}}for(let q=0;q<$.length;q++)if(E+=q,!(M<E+1)){const P=$[q](h[E],p);if(Dn(P)){if(tn(P)){const x=new yn(E,h,P.left);if(g){k.push([T++,x]);continue}else return oe(new jt(e,h,x,Hr(O)))}O.push([T++,P.right])}else{const x=T++,L=E;S||(S=[]),S.push(({es:B,output:F})=>X(Oi(P),j=>{if(tn(j)){const Z=new yn(L,h,j.left);return g?(B.push([x,Z]),fe):oe(new jt(e,h,Z,Hr(F)))}return F.push([x,j.right]),fe}))}}}const _=({es:C,output:$})=>bh(C)?oe(new jt(e,h,Hr(C),Hr($))):ce(Hr($));if(S&&S.length>0){const C=S;return _t(()=>{const $={es:ll(k),output:ll(O)};return X(Sn(C,q=>q($),{concurrency:u,batching:f,discard:!0}),()=>_($))})}return _({output:O,es:k})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return sr(e,FM);const n=[],r={},s=[];for(const p of e.propertySignatures)n.push([fn(p.type,t),p]),r[p.name]=null,s.push(p.name);const o=e.indexSignatures.map(p=>[fn(p.parameter,t),fn(p.type,t),p.parameter]),a=nn.make(e.indexSignatures.map(p=>p.parameter).concat(s.map(p=>Wh(p)?new mR(p):new tm(p)))),u=fn(a,t),f=_y(e),h=yy(e);return(p,g)=>{if(!xM(p))return oe(new Gt(e,p));const k=(g==null?void 0:g.errors)==="all",T=[];let O=0;const M=(g==null?void 0:g.onExcessProperty)==="error",E=(g==null?void 0:g.onExcessProperty)==="preserve",S={};let _;if(M||E){_=ws(p);for(const P of _){const x=u(P,g);if(Dn(x)&&tn(x))if(M){const L=new yn(P,p,new X$(p[P],`is unexpected, expected: ${String(a)}`));if(k){T.push([O++,L]);continue}else return oe(new jt(e,p,L,S))}else S[P]=p[P]}}let C;const $=(g==null?void 0:g.exact)===!0;for(let P=0;P<n.length;P++){const x=n[P][1],L=x.name,B=Object.prototype.hasOwnProperty.call(p,L);if(!B){if(x.isOptional)continue;if($){const Z=new yn(L,p,new sl(x));if(k){T.push([O++,Z]);continue}else return oe(new jt(e,p,Z,S))}}const F=n[P][0],j=F(p[L],g);if(Dn(j)){if(tn(j)){const Z=new yn(L,p,B?j.left:new sl(x));if(k){T.push([O++,Z]);continue}else return oe(new jt(e,p,Z,S))}S[L]=j.right}else{const Z=O++,ye=L;C||(C=[]),C.push(({es:G,output:we})=>X(Oi(j),Re=>{if(tn(Re)){const Be=new yn(ye,p,B?Re.left:new sl(x));return k?(G.push([Z,Be]),fe):oe(new jt(e,p,Be,we))}return we[ye]=Re.right,fe}))}}for(let P=0;P<o.length;P++){const x=o[P],L=x[0],B=x[1],F=H1(p,x[2]);for(const j of F){const Z=L(j,g);if(Dn(Z)&&ys(Z)){const ye=B(p[j],g);if(Dn(ye))if(tn(ye)){const G=new yn(j,p,ye.left);if(k){T.push([O++,G]);continue}else return oe(new jt(e,p,G,S))}else Object.prototype.hasOwnProperty.call(r,j)||(S[j]=ye.right);else{const G=O++,we=j;C||(C=[]),C.push(({es:Re,output:Be})=>X(Oi(ye),Ze=>{if(tn(Ze)){const He=new yn(we,p,Ze.left);return k?(Re.push([G,He]),fe):oe(new jt(e,p,He,Be))}else return Object.prototype.hasOwnProperty.call(r,j)||(Be[j]=Ze.right),fe}))}}}}const q=({es:P,output:x})=>{if(bh(P))return oe(new jt(e,p,Hr(P),x));if((g==null?void 0:g.propertyOrder)==="original"){const L=_||ws(p);for(const F of s)L.indexOf(F)===-1&&L.push(F);const B={};for(const F of L)Object.prototype.hasOwnProperty.call(x,F)&&(B[F]=x[F]);return ce(B)}return ce(x)};if(C&&C.length>0){const P=C;return _t(()=>{const x={es:ll(T),output:Object.assign({},S)};return X(Sn(P,L=>L(x),{concurrency:f,batching:h,discard:!0}),()=>q(x))})}return q({es:T,output:S})}}case"Union":{const n=lee(e.types,t),r=ws(n.keys),s=r.length,o=e.types.length,a=new Map;for(let h=0;h<o;h++)a.set(e.types[h],fn(e.types[h],t));const u=_y(e)??1,f=yy(e);return(h,p)=>{const g=[];let k=0,T=[];if(s>0)if(xS(h))for(let E=0;E<s;E++){const S=r[E],_=n.keys[S].buckets;if(Object.prototype.hasOwnProperty.call(h,S)){const C=String(h[S]);if(Object.prototype.hasOwnProperty.call(_,C))T=T.concat(_[C]);else{const{candidates:$,literals:q}=n.keys[S],P=nn.make(q),x=$.length===o?new Fr([new Nt(S,P,!1,!0)],[]):nn.make($);g.push([k++,new jt(x,h,new yn(S,h,new Gt(P,h[S])))])}}else{const{candidates:C,literals:$}=n.keys[S],q=new Nt(S,nn.make($),!1,!0),P=C.length===o?new Fr([q],[]):nn.make(C);g.push([k++,new jt(P,h,new yn(S,h,new sl(q)))])}}else{const E=n.candidates.length===o?e:nn.make(n.candidates);g.push([k++,new Gt(E,h)])}n.otherwise.length>0&&(T=T.concat(n.otherwise));let O;for(let E=0;E<T.length;E++){const S=T[E],_=a.get(S)(h,p);if(Dn(_)&&(!O||O.length===0)){if(ys(_))return _;g.push([k++,_.left])}else{const C=k++;O||(O=[]),O.push($=>_t(()=>"finalResult"in $?fe:X(Oi(_),q=>(ys(q)?$.finalResult=q:$.es.push([C,q.left]),fe))))}}const M=E=>bh(E)?E.length===1&&E[0][1]._tag==="Type"?oe(E[0][1]):oe(new jt(e,h,Hr(E))):oe(new Gt(e,h));if(O&&O.length>0){const E=O;return _t(()=>{const S={es:ll(g)};return X(Sn(E,_=>_(S),{concurrency:u,batching:f,discard:!0}),()=>"finalResult"in S?S.finalResult:M(S.es))})}return M(g)}}case"Suspend":{const n=V1(()=>fn(ua(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},sr=(e,t)=>n=>t(n)?ce(n):oe(new Gt(e,n)),pl=(e,t)=>{switch(e._tag){case"Declaration":{const n=pu(e);if(lt(n))return pl(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?Uy(s.type):xt(s.type);$l(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?Uy(s.type):xt(s.type);$l(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return pl(e.from,t);case"Suspend":return pl(e.f(),t);case"Transformation":return pl(t?e.from:e.to,t)}return[]},lee=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const a=e[o],u=pl(a,t);if(u.length>0){s.push(a);for(let f=0;f<u.length;f++){const[h,p]=u[f],g=String(p.literal);n[h]=n[h]||{buckets:{},literals:[],candidates:[]};const k=n[h].buckets;if(Object.prototype.hasOwnProperty.call(k,g)){if(f<u.length-1)continue;k[g].push(a),n[h].literals.push(p),n[h].candidates.push(a)}else{k[g]=[a],n[h].literals.push(p),n[h].candidates.push(a);break}}}else r.push(a)}return{keys:n,otherwise:r,candidates:s}},DN=e=>bc(e)?DN(e.from):e,gl=(e,t,n,r)=>{if((r==null?void 0:r.isEffectAllowed)===!0||Dn(e))return e;const s=new oA,o=Do(e,{scheduler:s});s.flush();const a=o.unsafePoll();if(a){if(Gc(a))return ce(a.value);const u=a.cause;return zA(u)?oe(u.error):oe(new Z$(t,n,Cm(u)))}return oe(new Z$(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},fee=([e],[t])=>e>t?1:e<t?-1:0;function Hr(e){return e.sort(fee).map(t=>t[1])}const dee=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return ce;case"TypeLiteralTransformation":return n=>{let r=ce(n);for(const s of e.propertySignatureTransformations){const[o,a]=t?[s.from,s.to]:[s.to,s.from],u=t?s.decode:s.encode;r=ur(r,h=>{const p=u(Object.prototype.hasOwnProperty.call(h,o)?W(h[o]):V());return delete h[o],lt(p)&&(h[a]=p.value),h})}return r}}},Pn=(e,t=[])=>({value:e,forest:t}),ql={formatIssue:e=>ur(ic(e),hee),formatIssueSync:e=>{const t=ql.formatIssue(e);return Dn(t)?_L(t):$s(t)},formatError:e=>ql.formatIssue(e.issue),formatErrorSync:e=>ql.formatIssueSync(e.issue)},hee=e=>e.value+MN(`
`,e.forest),MN=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const a=o===r-1;n+=e+(a?"└":"├")+"─ "+s.value,n+=MN(e+(r>1&&!a?"│  ":"   "),s.forest)}return n},mee=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},pee=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},LN=e=>"ast"in e?W(e.ast):V(),eS=ce(void 0),gee=e=>LN(e).pipe(mu(Sj),st({onNone:()=>eS,onSome:t=>{const n=t(e);return Rn(n)?ce({message:n,override:!1}):Mr(n)?Se(n,r=>({message:r,override:!1})):Rn(n.message)?ce({message:n.message,override:n.override}):Se(n.message,r=>({message:r,override:n.override}))}})),vE=e=>t=>t._tag===e,jN=vE("Composite"),nC=vE("Refinement"),rC=vE("Transformation"),Al=e=>Xo(gee(e),t=>t!==void 0?!t.override&&(jN(e)||nC(e)&&e.kind==="From"||rC(e)&&e.kind!=="Transformation")?rC(e)||nC(e)?Al(e.issue):eS:ce(t.message):eS),UN=e=>LN(e).pipe(mu(kj),EL(t=>t(e)),lr);function _ee(e){return hR(e).pipe(ro(()=>fR(e)),ro(()=>dR(e)),ro(()=>$p(e)),Et(()=>`{ ${e.from} | filter }`))}function yee(e){return e.message!==void 0?e.message:`Expected ${bc(e.ast)?_ee(e.ast):String(e.ast)}, actual ${Pr(e.actual)}`}const bee=e=>ur(Al(e),t=>t??UN(e)??yee(e)),ah=e=>UN(e)??String(e.ast),See=e=>e.message??"is forbidden",vee=e=>e.message??"is unexpected",wee=e=>{const t=vj(e.ast);if(lt(t)){const n=t.value();return Rn(n)?ce(n):n}return ce(e.message??"is missing")},ic=e=>{switch(e._tag){case"Type":return ur(bee(e),Pn);case"Forbidden":return ce(Pn(ah(e),[Pn(See(e))]));case"Unexpected":return ce(Pn(vee(e)));case"Missing":return ur(wee(e),Pn);case"Transformation":return Xo(Al(e),t=>t!==void 0?ce(Pn(t)):ur(ic(e.issue),n=>Pn(ah(e),[Pn(mee(e.kind),[n])])));case"Refinement":return Xo(Al(e),t=>t!==void 0?ce(Pn(t)):ur(ic(e.issue),n=>Pn(ah(e),[Pn(pee(e.kind),[n])])));case"Pointer":return ur(ic(e.issue),t=>Pn(J1(e.path),[t]));case"Composite":return Xo(Al(e),t=>{if(t!==void 0)return ce(Pn(t));const n=ah(e);return K1(e.issues)?ur(Sn(e.issues,ic),r=>Pn(n,r)):ur(ic(e.issues),r=>Pn(n,[r]))})}},Eee=N9,kee=A9,$ee=PA,Cee=MW,Tee=FA,sC=Symbol.for("effect/Mailbox"),oC=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Fi=yt(),iC=Ke(Fi),ch=Ke(!1),uh=Ke(!0),aC=[Fi,!0];var xI,DI;class Iee extends Po{constructor(n,r,s){super();d(this,"scheduler");d(this,"capacity");d(this,"strategy");d(this,DI,sC);d(this,xI,oC);d(this,"state",{_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set});d(this,"messages",[]);d(this,"messagesChunk",yt());d(this,"shutdown",K(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Fi;const n=this.state.offers;if(this.finalize(this.state._tag==="Open"?Tn:this.state.exit),n.size>0){for(const r of n)r._tag==="Single"?r.resume(ch):r.resume(Ke(zt(r.remaining.slice(r.offset))));n.clear()}return!0}));d(this,"end",this.done(Tn));d(this,"clear",he(()=>{if(this.state._tag==="Done")return Th(this.state.exit,Fi);const n=this.unsafeTakeAll();return this.releaseCapacity(),J(n)}));d(this,"takeAll",he(()=>{if(this.state._tag==="Done")return Th(this.state.exit,aC);const n=this.unsafeTakeAll();return n.length===0?It(this.awaitTake,this.takeAll):J([n,this.releaseCapacity()])}));d(this,"take",he(()=>this.unsafeTake()??It(this.awaitTake,this.take)));d(this,"await",Go(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.awaiters.add(n),K(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(n)}))));d(this,"size",K(()=>this.unsafeSize()));d(this,"awaitTake",Go(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.takers.add(n),K(()=>{this.state._tag!=="Done"&&this.state.takers.delete(n)}))));d(this,"scheduleRunning",!1);d(this,"releaseTaker",()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const n=qL(this.state.takers);this.state.takers.delete(n),n(Tn)});this.scheduler=n,this.capacity=r,this.strategy=s}offer(n){return he(()=>{if(this.state._tag!=="Open")return ch;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return ch;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),uh):this.offerRemainingSingle(n);case"sliding":return this.unsafeTake(),this.messages.push(n),uh}return this.messages.push(n),this.scheduleReleaseTaker(),uh})}unsafeOffer(n){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(n),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),!0):!1:(this.messages.push(n),this.scheduleReleaseTaker(),!0)}offerAll(n){return he(()=>{if(this.state._tag!=="Open")return J(go(n));const r=this.unsafeOfferAllArray(n);return r.length===0?iC:this.strategy==="dropping"?J(zt(r)):this.offerRemainingArray(r)})}unsafeOfferAll(n){return zt(this.unsafeOfferAllArray(n))}unsafeOfferAllArray(n){if(this.state._tag!=="Open")return je(n);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=Rt(this.messagesChunk,zt(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(Rt(go(n)),DU(this.capacity)):Wi(n)?this.messagesChunk=Rt(this.messagesChunk,n):this.messages=je(n),this.scheduleReleaseTaker(),[];const r=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(r===0)return je(n);const s=[];let o=0;for(const a of n)o<r?this.messages.push(a):s.push(a),o++;return this.scheduleReleaseTaker(),s}fail(n){return this.done(Zl(n))}failCause(n){return this.done(rt(n))}unsafeDone(n){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(n),!0):(this.state={...this.state,_tag:"Closing",exit:n},!0)}done(n){return K(()=>this.unsafeDone(n))}takeN(n){return he(()=>{if(this.state._tag==="Done")return Th(this.state.exit,aC);if(n<=0)return J([Fi,!1]);n=Math.min(n,this.capacity);let r;if(n<=this.messagesChunk.length)r=Nc(this.messagesChunk,n),this.messagesChunk=Ys(this.messagesChunk,n);else if(n<=this.messages.length+this.messagesChunk.length)this.messagesChunk=Rt(this.messagesChunk,zt(this.messages)),this.messages=[],r=Nc(this.messagesChunk,n),this.messagesChunk=Ys(this.messagesChunk,n);else return It(this.awaitTake,this.takeN(n));return J([r,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return nq(this.state.exit,Zl(new Ag));let n;if(this.messagesChunk.length>0)n=Fp(this.messagesChunk),this.messagesChunk=Ys(this.messagesChunk,1);else if(this.messages.length>0)n=this.messages[0],this.messagesChunk=Ys(zt(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?Ke(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),Ke(n)}unsafeSize(){const n=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?V():W(n)}commit(){return this.takeAll}pipe(){return ee(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return dt(this)}[(DI=sC,xI=oC,Ue)](){return dt(this)}offerRemainingSingle(n){return Go(r=>{if(this.state._tag!=="Open")return r(ch);const s={_tag:"Single",message:n,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}offerRemainingArray(n){return Go(r=>{if(this.state._tag!=="Open")return r(Ke(zt(n)));const s={_tag:"Array",remaining:n,offset:0,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let n=this.capacity-this.messages.length-this.messagesChunk.length;for(const r of this.state.offers){if(n===0)return!1;if(r._tag==="Single")this.messages.push(r.message),n--,r.resume(uh),this.state.offers.delete(r);else{for(;r.offset<r.remaining.length;r.offset++){if(n===0)return!1;this.messages.push(r.remaining[r.offset]),n--}r.resume(iC),this.state.offers.delete(r)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){const n=this.messages.length>0?Rt(this.messagesChunk,zt(this.messages)):this.messagesChunk;return this.messagesChunk=Fi,this.messages=[],n}else if(this.messages.length>0){const n=zt(this.messages);return this.messages=[],n}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,ft(this.messages.pop());return Fi}finalize(n){if(this.state._tag==="Done")return;const r=this.state;this.state={_tag:"Done",exit:n};for(const s of r.takers)s(n);r.takers.clear();for(const s of r.awaiters)s(n);r.awaiters.clear()}}const Ree=e=>qe(t=>J(new Iee(t.currentScheduler,typeof e=="number"?e:(e==null?void 0:e.capacity)??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":(e==null?void 0:e.strategy)??"suspend"))),Oee=Ree,qee=Symbol.for("@effect/matcher/Matcher"),Aee={[qee]:{_input:ie,_filters:ie,_result:ie,_return:ie},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?tS(this.provided,ce(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?tS(this.provided,ce(e.evaluate(this.provided))):this},pipe(){return ee(this,arguments)}};function tS(e,t){const n=Object.create(Aee);return n.provided=e,n.value=t,n}const zN=(e,t)=>({_tag:"When",guard:e,evaluate:t}),nS=e=>{if(typeof e=="function")return e;if(Array.isArray(e)){const t=e.map(nS),n=t.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(t[s](r[s])===!1)return!1;return!0}}else if(e!==null&&typeof e=="object"){const t=Object.entries(e).map(([r,s])=>[r,nS(s)]),n=t.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[o,a]=t[s];if(!(o in r)||a(r[o])===!1)return!1}return!0}}return t=>t===e},Pee=e=>tS(e,oe(e)),Fee=(e,t)=>n=>n.add(zN(nS(e),t)),Nee=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(zN(s,n))},xee=Nee("_tag"),Dee=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?ce(n.evaluate(r)):oe(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return ce(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return ce(s.evaluate(n))}return oe(n)}},cC="effect/Match/exhaustive: absurd",Mee=e=>{const t=Dee(e);if(T1(t)){if(t._tag==="Right")return t.right;throw new Error(cC)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(cC)}},BN=Pee,by=Fee,Sy=xee,HN=Mee,uC=pZ,VN=LY,Lee=oc,jee=y(e=>Ms(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),Uee=y(e=>Ms(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),ou=Symbol.for("effect/Schema");function ot(e){var t,n,r;return n=ou,t=ou,r=class{constructor(){d(this,n,rS)}static annotations(o){return ot(os(this.ast,o))}static pipe(){return ee(this,arguments)}static toString(){return String(e)}},d(r,"ast",e),d(r,"Type"),d(r,"Encoded"),d(r,"Context"),d(r,t,rS),r}const rS={_A:e=>e,_I:e=>e,_R:e=>e},lC={schemaId:_j,message:X1,missingMessage:GS,identifier:QS,title:Ls,description:Jf,examples:Z1,default:eR,documentation:yj,jsonSchema:tR,arbitrary:nR,pretty:rR,equivalence:sR,concurrency:oR,batching:iR,parseIssueTitle:aR,parseOptions:cR,decodingFallback:uR},vi=e=>{if(!e)return{};const t={...e};for(const n in lC)if(n in e){const r=lC[n];t[r]=e[n],delete t[n]}return t},os=(e,t)=>ua(e,vi(t));const Ld=e=>String(e.ast),wE=e=>ot(Uy(e.ast)),Ps=e=>ot(xt(e.ast)),WN=(e,t)=>{const n=Hu(e,t);return(r,s)=>Ol(n(r,s),zu)},zee=(e,t)=>{const n=ree(e,t);return(r,s)=>ia(n(r,s),zu)},Vu=WN,KN=zee,iu=(e,t)=>{const n=Md(e,t);return(r,s)=>Ol(n(r,s),zu)},JN=(e,t)=>{const n=nee(e,t);return(r,s)=>ia(n(r,s),zu)},Bee=iu,m_=JN,Hee=(e,t)=>{const n=oee(e,t);return(r,s)=>ia(n(r,s),zu)},rs=e=>ne(e,ou)&&Ms(e[ou]);function Vee(e){return YS(e)?nn.make(Jj(e,t=>new tm(t))):new tm(e[0])}function GN(e,t=Vee(e)){var n;return n=class extends ot(t){static annotations(s){return GN(this.literals,os(this.ast,s))}},d(n,"literals",[...e]),n}function Fe(...e){return bt(e)?GN(e):p_}const Wee=e=>ot(new mR(e)),Kee=(e,t,n)=>EE(e,new Tp(e.map(r=>r.ast),(...r)=>t.decode(...r.map(ot)),(...r)=>t.encode(...r.map(ot)),vi(n))),Jee=(e,t)=>{const n=()=>(s,o,a)=>e(s)?Xr(s):Bu(new Gt(a,s)),r=n;return EE([],new Tp([],n,r,vi(t)))};function EE(e,t){var n;return n=class extends ot(t){static annotations(s){return EE(this.typeParameters,os(this.ast,s))}},d(n,"typeParameters",[...e]),n}const Da=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return Kee(n,r,s)}const e=arguments[0],t=arguments[1];return Jee(e,t)},fC=Symbol.for("effect/SchemaId/Brand"),QN=(e,t)=>n=>IE(n,new Yf(n.ast,function(o,a,u){const f=e.either(o);return tn(f)?W(new Gt(u,o,f.left.map(h=>h.message).join(", "))):V()},vi({schemaId:fC,[fC]:{constructor:e},...t})));class YN extends ot(Fc){}class vs extends ot(Nj){}class kE extends ot(Aj){}class p_ extends ot(Ip){}class sS extends ot(pR){}class pn extends ot(gR){}class D extends ot(xy){}class nt extends ot(My){}class Zr extends ot(Ly){}const Gee=e=>nn.make(e.map(t=>t.ast));function XN(e,t=Gee(e)){var n;return n=class extends ot(t){static annotations(s){return XN(this.members,os(this.ast,s))}},d(n,"members",[...e]),n}function ve(...e){return YS(e)?XN(e):bt(e)?e[0]:p_}const ZN=e=>ve(e,kE),g_=e=>ve(e,YN),Qee=(e,t)=>new Qf(e.map(n=>rs(n)?new pi(n.ast,!1):n.ast),t.map(n=>rs(n)?new Gf(n.ast):n.ast),!0);function Bm(e,t,n=Qee(e,t)){var r;return r=class extends ot(n){static annotations(o){return Bm(this.elements,this.rest,os(this.ast,o))}},d(r,"elements",[...e]),d(r,"rest",[...t]),r}function Yee(...e){return Array.isArray(e[0])?Bm(e[0],e.slice(1)):Bm(e,[])}function ex(e,t){var n;return n=class extends Bm([],[e],t){static annotations(s){return ex(this.value,os(this.ast,s))}},d(n,"value",e),n}const xe=e=>ex(e),oS=e=>e?'"?:"':'":"';class __ extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");d(this,"_tag","PropertySignatureDeclaration");this.isReadonly=s,this.defaultValue=a}toString(){const n=oS(this.isOptional),r=String(this.type);return`PropertySignature<${n}, ${r}, never, ${n}, ${r}>`}}class Xee extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"fromKey");this.isReadonly=s,this.fromKey=a}}class Hm extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");this.isReadonly=s,this.defaultValue=a}}const Zee=e=>e===void 0?"never":Rn(e)?JSON.stringify(e):String(e);class Vm{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");d(this,"_tag","PropertySignatureTransformation");this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${oS(this.to.isOptional)}, ${this.to.type}, ${Zee(this.from.fromKey)}, ${oS(this.from.isOptional)}, ${this.from.type}>`}}const tx=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new __(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Vm(e.from,new Hm(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},nx=Symbol.for("effect/PropertySignature"),$E=e=>ne(e,nx);var MI,LI;LI=ou,MI=nx;const S0=class S0{constructor(t){d(this,"ast");d(this,LI);d(this,MI,null);d(this,"_TypeToken");d(this,"_Key");d(this,"_EncodedToken");d(this,"_HasDefault");this.ast=t}pipe(){return ee(this,arguments)}annotations(t){return new S0(tx(this.ast,vi(t)))}toString(){return String(this.ast)}};let Wm=S0;const Km=e=>new Wm(e);class y_ extends Wm{constructor(n,r){super(n);d(this,"from");this.from=r}annotations(n){return new y_(tx(this.ast,vi(n)),this.from)}}const rx=e=>new y_(new __(e.ast,!1,!0,{},void 0),e),CE=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Km(new __(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Km(new Vm(n.from,new Hm(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),dC=(e,t)=>st(e,{onNone:()=>W(t()),onSome:n=>W(n===void 0?t():n)}),Jm=e=>aU(e,Jm,t=>{const n=Jm(t.to);if(n)return new Rr(t.from,n,t.transformation)}),ete=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=xt(n.type);return Km(new Vm(new Xee(n.type,n.isOptional,n.isReadonly,n.annotations),new Hm(Jm(r)??r,!1,!0,{},n.defaultValue),s=>dC(s,t),ie))}case"PropertySignatureTransformation":{const r=n.to.type;return Km(new Vm(n.from,new Hm(Jm(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>dC(n.decode(s),t),n.encode))}}}),sx=y(2,(e,t)=>e.pipe(ete(t.decoding),CE(t.constructor))),We=e=>{const t=e.ast===Fc||e.ast===Ip?Fc:g_(e).ast;return new y_(new __(t,!0,!0,{},void 0),e)},tte=$R([GS]),nte=(e,t)=>{const n=ws(e),r=[];if(n.length>0){const o=[],a=[],u=[];for(let f=0;f<n.length;f++){const h=n[f],p=e[h];if($E(p)){const g=p.ast;switch(g._tag){case"PropertySignatureDeclaration":{const k=g.type,T=g.isOptional,O=g.annotations;o.push(new Nt(h,k,T,!0,tte(g))),a.push(new Nt(h,xt(k),T,!0,O)),r.push(new Nt(h,k,T,!0,O));break}case"PropertySignatureTransformation":{const k=g.from.fromKey??h;o.push(new Nt(k,g.from.type,g.from.isOptional,!0,g.from.annotations)),a.push(new Nt(h,g.to.type,g.to.isOptional,!0,g.to.annotations)),u.push(new Xj(k,h,g.decode,g.encode));break}}}else o.push(new Nt(h,p.ast,!1,!0)),a.push(new Nt(h,xt(p.ast),!1,!0)),r.push(new Nt(h,p.ast,!1,!0))}if(bt(u)){const f=[],h=[];for(const p of t){const{indexSignatures:g,propertySignatures:k}=ak(p.key.ast,p.value.ast);k.forEach(T=>{o.push(T),a.push(new Nt(T.name,xt(T.type),T.isOptional,T.isReadonly,T.annotations))}),g.forEach(T=>{f.push(T),h.push(new gu(T.parameter,xt(T.type),T.isReadonly))})}return new Rr(new Fr(o,f,{[yc]:"Struct (Encoded side)"}),new Fr(a,h,{[yc]:"Struct (Type side)"}),new nm(u))}}const s=[];for(const o of t){const{indexSignatures:a,propertySignatures:u}=ak(o.key.ast,o.value.ast);u.forEach(f=>r.push(f)),a.forEach(f=>s.push(f))}return new Fr(r,s)},ox=(e,t)=>{const n=ws(e);for(const r of n){const s=e[r];if(t[r]===void 0&&$E(s)){const o=s.ast,a=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;a!==void 0&&(t[r]=a())}}return t};function TE(e,t,n=nte(e,t)){var r;return r=class extends ot(n){static annotations(o){return TE(this.fields,this.records,os(this.ast,o))}static pick(...o){return Y(jee(e,...o))}static omit(...o){return Y(Uee(e,...o))}},d(r,"fields",{...e}),d(r,"records",[...t]),d(r,"make",(o,a)=>{const u=ox(e,{...o});return v_(a)?u:h_(r)(u)}),r}function Y(e,...t){return TE(e,t)}const rte=e=>Fe(e).pipe(rx,CE(()=>e)),me=(e,t)=>Y({_tag:rte(e),...t});function ix(e,t,n){var r;return r=class extends TE({},[{key:e,value:t}],n){static annotations(o){return ix(e,t,os(this.ast,o))}},d(r,"key",e),d(r,"value",t),r}const Wu=e=>ix(e.key,e.value),vf=(...e)=>t=>ot(Ws(t.ast,e)),au=y(2,(e,t)=>{const n=xi(xt(e.ast),t),r=ot(n.isOptional?Eh(n.type):n.type);return Sr(e.pipe(vf(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function IE(e,t){var n;return n=class extends ot(t){static annotations(s){return IE(this.from,os(this.ast,s))}},d(n,"make",(s,o)=>v_(o)?s:h_(n)(s)),d(n,"from",e),n}const ste=(e,t)=>n=>{const r=st(lR(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=ua(n.ast,vi({[Y1]:r,...t}));return IE(n,s)},Gm=e=>ot(fl(e.ast)),ote=e=>ot(tc(e.ast)),ol=(e,t,n)=>{if(ik(e)&&ik(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,a=r.findIndex(u=>u.name===o);if(a===-1)r.push(s);else{const{isOptional:u,type:f}=r[a];r[a]=new Nt(o,Qm(f,s.type,n.concat(o)),u,!0)}}return new Fr(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(G1(e,t,n))},ite=rU([QS]),il=(e,t)=>t.map(n=>new Yf(n,e.filter,ite(e))),Qm=(e,t,n)=>nn.make(Ks([e],[t],n)),$i=e=>XS(e)?e.types:[e],Ks=(e,t,n)=>Xh(e,r=>Xh(t,s=>{switch(s._tag){case"Literal":{if(Rn(s.literal)&&Dy(r)||mo(s.literal)&&rk(r)||na(s.literal)&&sk(r))return[s];break}case"StringKeyword":{if(s===xy){if(Dy(r)||$l(r)&&Rn(r.literal))return[r];if(bc(r))return il(r,Ks($i(r.from),[s],n))}else if(r===xy)return[s];break}case"NumberKeyword":{if(s===My){if(rk(r)||$l(r)&&mo(r.literal))return[r];if(bc(r))return il(r,Ks($i(r.from),[s],n))}else if(r===My)return[s];break}case"BooleanKeyword":{if(s===Ly){if(sk(r)||$l(r)&&na(r.literal))return[r];if(bc(r))return il(r,Ks($i(r.from),[s],n))}else if(r===Ly)return[s];break}case"Union":return Ks($i(r),s.types,n);case"Suspend":return[new ca(()=>Qm(r,s.f(),n))];case"Refinement":return il(s,Ks($i(r),$i(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return Ks(r.types,[s],n);case"Suspend":return[new ca(()=>Qm(r.f(),s,n))];case"Refinement":return il(r,Ks($i(r.from),[s],n));case"TypeLiteral":return[ol(r,s,n)];case"Transformation":{const o=r.transformation,a=ol(r.from,s,n),u=ol(r.to,xt(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new Rr(a,u,new nm(o.propertySignatureTransformations))];case"ComposeTransformation":return[new Rr(a,u,ZS)];case"FinalTransformation":return[new Rr(a,u,new SR((f,h,p,g)=>ur(o.decode(f,h,p,g),k=>({...f,...k})),(f,h,p,g)=>ur(o.encode(f,h,p,g),k=>({...f,...k}))))]}}}break}case"Transformation":{if(Gj(r)){if(jy(s.transformation)&&jy(r.transformation))return[new Rr(ol(r.from,s.from,n),ol(r.to,s.to,n),new nm(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return Ks([s],[r],n);break}}throw new Error(G1(r,s,n))})),ax=y(2,(e,t)=>ot(Qm(e.ast,t.ast,[]))),cx=y(e=>rs(e[1]),(e,t)=>RE(e,t,oU(e.ast,t.ast))),wf=e=>ot(new ca(()=>e().ast)),ux=Symbol.for("effect/SchemaId/Refine");function lx(e,t,n){var r,s,o;return o=class extends(s=ot(n),r=ux,s){static annotations(u){return lx(this.from,this.filter,os(this.ast,u))}},d(o,r,e),d(o,"from",e),d(o,"filter",t),d(o,"make",(u,f)=>v_(f)?u:h_(o)(u)),o}const hC=(e,t,n)=>{if(na(e))return e?V():W(new Gt(t,n));if(Rn(e))return W(new Gt(t,n,e));if(e!==void 0){if("_tag"in e)return W(e);const r=new Gt(t,n,e.message);return W(bt(e.path)?new yn(e.path,n,r):r)}return V()},ate=(e,t,n)=>{if(aj(e))return hC(e,t,n);if(bt(e)){const r=U1(e,s=>hC(s,t,n));if(bt(r))return W(r.length===1?r[0]:new jt(t,n,r))}return V()};function b_(e,t){return n=>{function r(o,a,u){return ate(e(o,a,u),u,o)}const s=new Yf(n.ast,r,vi(t));return lx(n,r,s)}}function RE(e,t,n){var r;return r=class extends ot(n){static annotations(o){return RE(this.from,this.to,os(this.ast,o))}},d(r,"from",e),d(r,"to",t),r}const $o=y(e=>rs(e[0])&&rs(e[1]),(e,t,n)=>RE(e,t,new Rr(e.ast,t.ast,new SR(n.decode,n.encode)))),Sr=y(e=>rs(e[0])&&rs(e[1]),(e,t,n)=>$o(e,t,{strict:!0,decode:(r,s,o,a)=>Xr(n.decode(r,a)),encode:(r,s,o,a)=>Xr(n.encode(r,a))})),cte=y(2,(e,t)=>e.annotations(t)),mC=e=>e instanceof Error?e.message:String(e),ute=e=>$o(D.annotations({description:"a string to be decoded into JSON"}),sS,{strict:!0,decode:(t,n,r)=>tC({try:()=>JSON.parse(t,e==null?void 0:e.reviver),catch:s=>new Gt(r,t,mC(s))}),encode:(t,n,r)=>tC({try:()=>JSON.stringify(t,e==null?void 0:e.replacer,e==null?void 0:e.space),catch:s=>new Gt(r,t,mC(s))})}).annotations({title:"parseJson",schemaId:qj}),Fs=(e,t)=>rs(e)?cx(Fs(t),e):ute(e),lte=mj,fte=(e,t)=>n=>n.pipe(b_(r=>r>=e,{schemaId:lte,title:`greaterThanOrEqualTo(${e})`,description:"a non-negative number",jsonSchema:{minimum:e},...t})),dte=pj,hte=e=>t=>t.pipe(b_(n=>Number.isSafeInteger(n),{schemaId:dte,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),mte=gj,pte=(e,t,n)=>r=>r.pipe(b_(s=>s>=e&&s<=t,{schemaId:mte,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n})),gte=e=>fte(0,{title:"nonNegative",...e});class Ym extends nt.pipe(hte({identifier:"Int"})){}class _te extends nt.pipe(gte({identifier:"NonNegative"})){}const OE=(e,t,n,r)=>tee(e,{onFailure:s=>new jt(n,r,s),onSuccess:t});class yte extends Da(rv,{identifier:"DurationFromSelf",pretty:()=>String,arbitrary:()=>t=>t.oneof(t.constant(jR),t.bigInt({min:0n}).map(n=>kh(n)),t.maxSafeNat().map(n=>fa(n))),equivalence:()=>BR}){}class bte extends Sr(_te.annotations({description:"a non-negative number to be decoded into a Duration"}),yte,{strict:!0,decode:t=>fa(t),encode:t=>xc(t)}).annotations({identifier:"DurationFromMillis"}){}class S_ extends Da(NM,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>Kf(de)}){}class Ste extends nt.pipe(pte(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class fx extends Sr(xe(Ste).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),S_,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const vte=(e,t,n)=>$o(D.annotations({description:"a string to be decoded into a Uint8Array"}),S_,{strict:!0,decode:(r,s,o)=>ia(t(r),a=>new Gt(o,r,a.message)),encode:r=>Xr(n(r))}).annotations({identifier:e}),wte=vte("Uint8ArrayFromBase64",vZ,SZ),Ete=$o(D.annotations({description:"A string that is interpreted as being UriComponent-encoded and will be decoded into a UTF-8 string"}),D,{strict:!0,decode:(e,t,n)=>ia(EZ(e),r=>new Gt(n,e,r.message)),encode:(e,t,n)=>ia(wZ(e),r=>new Gt(n,e,r.message))}).annotations({identifier:"StringFromUriComponent"}),dx=e=>ot(wh(e.ast));function kte(e){return Sr(e,mx(dx(Ps(e))),{strict:!1,decode:t=>_c(t),encode:t=>st(t,{onNone:()=>[],onSome:cr})})}const _l=y(e=>rs(e[0]),(e,t)=>$o(e,dx(Ps(e)),{strict:!0,decode:(n,r,s)=>n.length>0?Xr(n[0]):t?Xr(t()):Bu(new Gt(s,n,"Unable to retrieve the first element of an empty array")),encode:n=>Xr(cr(n))})),pC=Symbol.for("effect/SchemaId/ValidDate"),$te=e=>t=>t.pipe(b_(n=>!Number.isNaN(n.getTime()),{schemaId:pC,[pC]:{noInvalidDate:!0},title:"validDate",description:"a valid Date",...e})),gC=hj;class qE extends Da(a1,{identifier:"DateFromSelf",schemaId:gC,[gC]:{noInvalidDate:!1},description:"a potentially invalid Date instance",pretty:()=>t=>`new Date(${JSON.stringify(t)})`,arbitrary:()=>t=>t.date({noInvalidDate:!1}),equivalence:()=>IM}){}class Cte extends Sr(D.annotations({description:"a string to be decoded into a Date"}),qE,{strict:!0,decode:t=>new Date(t),encode:t=>W1(t)}).annotations({identifier:"DateFromString"}){}class Js extends Cte.pipe($te({identifier:"Date"})){}class Fn extends Sr(nt.annotations({description:"a number to be decoded into a Date"}),qE,{strict:!0,decode:t=>new Date(t),encode:t=>t.getTime()}).annotations({identifier:"DateFromNumber"}){}const Tte=Y({_tag:Fe("None")}).annotations({description:"NoneEncoded"}),Ite=e=>Y({_tag:Fe("Some"),value:e}).annotations({description:`SomeEncoded<${Ld(e)}>`}),Rte=e=>ve(Tte,Ite(e)).annotations({description:`OptionEncoded<${Ld(e)}>`}),hx=e=>e._tag==="None"?V():W(e.value),Ote=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(hx),qte=e=>st({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),_C=e=>(t,n,r)=>SL(t)?Ft(t)?Xr(V()):OE(e(t.value,n),W,r,t):Bu(new Gt(r,t)),mx=e=>Da([e],{decode:t=>_C(Md(t)),encode:t=>_C(Hu(t))},{description:`Option<${Ld(e)}>`,pretty:qte,arbitrary:Ote,equivalence:$L}),Ate={_tag:"None"},Pte=e=>({_tag:"Some",value:e});function Zi(e){const t=e;return Sr(Rte(t),mx(Ps(t)),{strict:!0,decode:r=>hx(r),encode:r=>st(r,{onNone:()=>Ate,onSome:Pte})})}const Fte=(e,t)=>n=>{const r=n.array(e(n));return(t.depthIdentifier!==void 0?n.oneof(t,n.constant([]),r):r).map(s=>new Set(s))},Nte=e=>t=>`new Set([${Array.from(t.values()).map(n=>e(n)).join(", ")}])`,xte=e=>{const t=Kf(e);return zf((n,r)=>t(Array.from(n.values()),Array.from(r.values())))},yC=e=>(t,n,r)=>qM(t)?OE(e(Array.from(t.values()),n),s=>new Set(s),r,t):Bu(new Gt(r,t)),Dte=(e,t)=>Da([e],{decode:n=>yC(Md(xe(n))),encode:n=>yC(Hu(xe(n)))},{description:t,pretty:Nte,arbitrary:Fte,equivalence:xte}),Mte=e=>Dte(e,`ReadonlySet<${Ld(e)}>`);function Lte(e){return Sr(xe(e),Mte(Ps(e)),{strict:!0,decode:t=>new Set(t),encode:t=>Array.from(t)})}const jte=e=>rs(e)||$E(e),px=e=>ws(e).every(t=>jte(e[t])),AE=e=>"fields"in e?e.fields:AE(e[ux]),PE=e=>px(e)?Y(e):rs(e)?e:Y(AE(e)),FE=e=>px(e)?e:AE(e),Ma=e=>(t,n)=>Oc({kind:"Class",identifier:e,schema:PE(t),fields:FE(t),Base:CJ,annotations:n}),gx=e=>CE(rx(Fe(e)),()=>e),Lr=e=>(t,n,r)=>{class s extends Rw{}s.prototype.name=t;const o=FE(n),a=PE(n),u={_tag:gx(t)},f=Pl(u,o),h="message"in f;class p extends Oc({kind:"TaggedError",identifier:t,schema:ax(a,Y(u)),fields:f,Base:s,annotations:r,disableToString:!0}){}return d(p,"_tag",t),h||Object.defineProperty(p.prototype,"message",{get(){return`{ ${ws(o).map(g=>`${JS(g)}: ${Pr(this[g])}`).join(", ")} }`},enumerable:!1,configurable:!0}),p},Pl=(e,t)=>{const n={...e};for(const r of ws(t)){if(r in e)throw new Error(Q1(r));n[r]=t[r]}return n};function v_(e){return na(e)?e:(e==null?void 0:e.disableValidation)??!1}const bC=Ee("effect/Schema/astCache",()=>new WeakMap),Ute=e=>e===void 0?[]:Array.isArray(e)?e:[e],Oc=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:a})=>{var C,$;const u=Symbol.for(`effect/Schema/${o}/${s}`),[f,h,p]=Ute(t),g=Ps(a),k=g.annotations({identifier:s,...f}),T=g.annotations({[yc]:`${s} (Type side)`,...f}),O=a.annotations({[yc]:`${s} (Constructor)`,...f}),M=a.annotations({[yc]:`${s} (Encoded side)`,...p}),E=a.annotations({[Cp]:s,...p,...f,...h}),S=q=>ne(q,u)&&Cn(T)(q),_=($=class extends e{constructor(q={},P=!1){q={...q},o!=="Class"&&delete q._tag,q=ox(r,q),v_(P)||(q=h_(O)(q)),super(q,!0)}static get ast(){let q=bC.get(this);if(q)return q;const P=Da([a],{decode:()=>(x,L,B)=>x instanceof this||S(x)?Xr(x):Bu(new Gt(B,x)),encode:()=>(x,L)=>x instanceof this?Xr(x):ur(Hu(T)(x,L),B=>new this(B,!0))},{identifier:s,pretty:x=>L=>`${s}(${x(L)})`,arbitrary:x=>L=>x(L).map(B=>new this(B)),equivalence:ie,[em]:k.ast,...f});return q=Sr(M,P,{strict:!0,decode:x=>new this(x,!0),encode:ie}).annotations({[em]:E.ast,...h}).ast,bC.set(this,q),q}static pipe(){return ee(this,arguments)}static annotations(q){return ot(this.ast).annotations(q)}static toString(){return`(${String(M)} <-> ${s})`}static make(...q){return new this(...q)}static extend(q){return(P,x)=>{const L=FE(P),B=PE(P),F=Pl(r,L);return Oc({kind:o,identifier:q,schema:ax(a,B),fields:F,Base:this,annotations:x})}}static transformOrFail(q){return(P,x,L)=>{const B=Pl(r,P);return Oc({kind:o,identifier:q,schema:$o(a,Ps(Y(B)),x),fields:B,Base:this,annotations:L})}}static transformOrFailFrom(q){return(P,x,L)=>{const B=Pl(r,P);return Oc({kind:o,identifier:q,schema:$o(wE(a),Y(B),x),fields:B,Base:this,annotations:L})}}get[(C=ou,u)](){return u}},d($,C,rS),d($,"fields",{...r}),d($,"identifier",s),$);return n!==!0&&Object.defineProperty(_.prototype,"toString",{value(){return`${s}({ ${ws(r).map(q=>`${JS(q)}: ${Pr(this[q])}`).join(", ")} })`},configurable:!0,writable:!0}),_},zte=Y({_tag:Fe("None")}).annotations({identifier:"FiberIdNoneEncoded"}),Bte=Y({_tag:Fe("Runtime"),id:Ym,startTimeMillis:Ym}).annotations({identifier:"FiberIdRuntimeEncoded"}),Hte=Y({_tag:Fe("Composite"),left:wf(()=>iS),right:wf(()=>iS)}).annotations({identifier:"FiberIdCompositeEncoded"}),iS=ve(zte,Bte,Hte).annotations({identifier:"FiberIdEncoded"}),Vte=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Xm),aS=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${aS(e.right)}, ${aS(e.left)})`}},Xm=e=>{switch(e._tag){case"None":return jn;case"Runtime":return Bz(e.id,e.startTimeMillis);case"Composite":return Hz(Xm(e.left),Xm(e.right))}},Wte=e=>Y({_tag:Fe("Die"),defect:e}),Kte=Y({_tag:Fe("Empty")}),Jte=e=>Y({_tag:Fe("Fail"),error:e}),Gte=Y({_tag:Fe("Interrupt"),fiberId:iS});let Qte=0;const cS=(e,t)=>{const n=e,r=t,s=wf(()=>o),o=ve(Kte,Jte(n),Wte(r),Gte,Y({_tag:Fe("Sequential"),left:s,right:s}),Y({_tag:Fe("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${Ld(e)}>`,[Cp]:`CauseEncoded${Qte++}`});return o},Yte=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:Vte(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(Bi),Xte=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${Cm(r)})`;case"Interrupt":return`Cause.interrupt(${aS(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},SC=e=>(t,n,r)=>V8(t)?OE(e(hc(t),n),Bi,r,t):Bu(new Gt(r,t)),Zte=({defect:e,error:t})=>Da([t,e],{decode:(n,r)=>SC(Md(cS(n,r))),encode:(n,r)=>SC(Hu(cS(n,r)))},{title:`Cause<${t.ast}>`,pretty:Xte,arbitrary:Yte});function Bi(e){switch(e._tag){case"Empty":return z8;case"Fail":return Au(e.error);case"Die":return va(e.defect);case"Interrupt":return Rg(Xm(e.fiberId));case"Sequential":return H8(Bi(e.left),Bi(e.right));case"Parallel":return B8(Bi(e.left),Bi(e.right))}}function hc(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:hc(e.left),right:hc(e.right)};case"Parallel":return{_tag:"Parallel",left:hc(e.left),right:hc(e.right)}}}const ene=({defect:e,error:t})=>{const n=t,r=e;return Sr(cS(n,r),Zte({error:Ps(n),defect:Ps(r)}),{strict:!1,decode:o=>Bi(o),encode:o=>hc(o)})};class Ea extends Sr(sS,sS,{strict:!0,decode:t=>{if(Ms(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:AO(t)}).annotations({identifier:"Defect"}){}const tne=Symbol.for("effect/Schema/Serializable/symbol"),NE=Symbol.for("effect/Schema/Serializable/symbolResult"),nne=y(2,(e,t)=>Vu(e[NE].failure)(t)),rne=y(2,(e,t)=>Vu(e[NE].success)(t)),xn=e=>(t,n,r)=>{var o;const s=Pl({_tag:gx(t)},n.payload);return o=class extends Oc({kind:"TaggedRequest",identifier:t,schema:Y(s),fields:s,Base:e9,annotations:r}){get[tne](){return this.constructor}get[NE](){return{failure:n.failure,success:n.success}}},d(o,"_tag",t),d(o,"success",n.success),d(o,"failure",n.failure),o},sne=$X,one=CX,ine=OX,ane=qX,Ns=AX,_x=PX,yx=FX,Ef=c_,cne=xX,Zm=vN,Co=bf,une=UX,lne=wN,wi=Sf,fne=zX,dne=YZ,hne=HX,mne=KX,pne=JX,gne=QX,_ne=YX,an=XX,yne=kN,bx=yE,cu=tZ,vn=nZ,bne=sZ,Sne=iZ,Sx=$N,vx=l_,vne=uZ,wne=lZ,xE=dZ,vC=Symbol.for("effect/Subscribable"),Ene=cP,kne="effect/SubscriptionRef",$ne=Symbol.for(kne),Cne={_A:e=>e};var jI,UI,zI,BI,HI,VI;class Tne extends(VI=Po,HI=ci,BI=vC,zI=T5,UI=Ene,jI=$ne,VI){constructor(n,r,s){super();d(this,"ref");d(this,"pubsub");d(this,"semaphore");d(this,HI,ci);d(this,BI,vC);d(this,zI,Qv);d(this,UI,uP);d(this,jI,Cne);d(this,"get");this.ref=n,this.pubsub=r,this.semaphore=s,this.get=Gi(this.ref)}commit(){return this.get}get changes(){return w(Gi(this.ref),X(n=>Se(vN(this.pubsub,{scoped:!0}),r=>yN(wN(n),r))),this.semaphore.withPermits(1),l_)}modify(n){return this.modifyEffect(r=>Le(n(r)))}modifyEffect(n){return w(Gi(this.ref),X(n),X(([r,s])=>w(Yc(this.ref,s),fo(r),jw(Kg(this.pubsub,s)))),this.semaphore.withPermits(1))}}const Ine=e=>w($d([Qw(),Si(e),zg(1)]),Se(([t,n,r])=>new Tne(n,t,r))),Rne=y(2,(e,t)=>w(Yc(e.ref,t),jw(Kg(e.pubsub,t)),e.semaphore.withPermits(1))),kf=Ine,Or=Rne,DE=VY,One=hN,ME=WY,qne=KY,wx=e=>t=>fne(t,n=>w(e(n),Se(()=>n))),wC=()=>One([]),yl=(e,t)=>qne(e,n=>kp(n,t)),Ane=e=>ME(e,[]),Ex=(e,t,n)=>VN(function*(){const r=yield*DE(e);if(r.length<t)return yield*Lee;{const s=r.splice(0,Math.min(n,r.length));return yield*ME(e,r),s}}),Pne=(e,t)=>VN(function*(){const n=yield*DE(e),[r,s]=j1(n,t);return yield*ME(e,s),r}),EC=e=>DE(e).pipe(Se(t=>t.length)),$f=y(2,(e,t)=>w(e.changes,Ns(t),cu(1),_ne,Se(Fp))),kC=Symbol.for("effect/Subscribable");var WI,KI,JI;class Fne extends(JI=Po,KI=kC,WI=ci,JI){constructor(n,r){super();d(this,"get");d(this,"changes");d(this,KI,kC);d(this,WI,ci);this.get=n,this.changes=r}commit(){return this.get}}const w_=e=>new Fne(e.get,e.changes);y(2,(e,t)=>w_({get:Se(e.get,t),changes:wi(e.changes,t)}));y(2,(e,t)=>w_({get:X(e.get,t),changes:dne(e.changes,t)}));w_({get:Pw,changes:mne});const Nne=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,xne=e=>Eee($ee,Cee({formatDate:t=>`${Nne(t)} ${e}`})),Dne={};var Mne={};const E_=()=>typeof process<"u"&&Mne!==void 0||Dne!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),Lne=e=>{const t=e==null?void 0:e.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},uS=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",$e=(e,...t)=>{if(console.error(e,...t),E_())debugger;throw new Error(`This should never happen: ${e}`)};var jne=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof globalThis=="object"?globalThis:{},Hi="1.9.0",$C=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Une(e){var t=new Set([e]),n=new Set,r=e.match($C);if(!r)return function(){return!1};var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(s.prerelease!=null)return function(f){return f===e};function o(u){return n.add(u),!1}function a(u){return t.add(u),!0}return function(f){if(t.has(f))return!0;if(n.has(f))return!1;var h=f.match($C);if(!h)return o(f);var p={major:+h[1],minor:+h[2],patch:+h[3],prerelease:h[4]};return p.prerelease!=null||s.major!==p.major?o(f):s.major===0?s.minor===p.minor&&s.patch<=p.patch?a(f):o(f):s.minor<=p.minor?a(f):o(f)}}var zne=Une(Hi),Bne=Hi.split(".")[0],Cf=Symbol.for("opentelemetry.js.api."+Bne),Tf=jne;function LE(e,t,n,r){var s;r===void 0&&(r=!1);var o=Tf[Cf]=(s=Tf[Cf])!==null&&s!==void 0?s:{version:Hi};if(!r&&o[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(o.version!==Hi){var a=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+Hi);return n.error(a.stack||a.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+Hi+"."),!0}function If(e){var t,n,r=(t=Tf[Cf])===null||t===void 0?void 0:t.version;if(!(!r||!zne(r)))return(n=Tf[Cf])===null||n===void 0?void 0:n[e]}function jE(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Hi+".");var n=Tf[Cf];n&&delete n[e]}var Hne=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Vne=function(e,t,n){if(arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Wne=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return al("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return al("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return al("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return al("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return al("verbose",this._namespace,t)},e}();function al(e,t,n){var r=If("diag");if(r)return n.unshift(t),r[e].apply(r,Vne([],Hne(n),!1))}var ar;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(ar||(ar={}));function Kne(e,t){e<ar.NONE?e=ar.NONE:e>ar.ALL&&(e=ar.ALL),t=t||{};function n(r,s){var o=t[r];return typeof o=="function"&&e>=s?o.bind(t):function(){}}return{error:n("error",ar.ERROR),warn:n("warn",ar.WARN),info:n("info",ar.INFO),debug:n("debug",ar.DEBUG),verbose:n("verbose",ar.VERBOSE)}}var Jne=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Gne=function(e,t,n){if(arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Qne="diag",ep=function(){function e(){function t(s){return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=If("diag");if(u)return u[s].apply(u,Gne([],Jne(o),!1))}}var n=this,r=function(s,o){var a,u,f;if(o===void 0&&(o={logLevel:ar.INFO}),s===n){var h=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((a=h.stack)!==null&&a!==void 0?a:h.message),!1}typeof o=="number"&&(o={logLevel:o});var p=If("diag"),g=Kne((u=o.logLevel)!==null&&u!==void 0?u:ar.INFO,s);if(p&&!o.suppressOverrideMessage){var k=(f=new Error().stack)!==null&&f!==void 0?f:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+k),g.warn("Current logger will overwrite one already registered from "+k)}return LE("diag",g,n,!0)};n.setLogger=r,n.disable=function(){jE(Qne,n)},n.createComponentLogger=function(s){return new Wne(s)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function Yne(e){return Symbol.for(e)}var Xne=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,s){var o=new e(n._currentContext);return o._currentContext.set(r,s),o},n.deleteValue=function(r){var s=new e(n._currentContext);return s._currentContext.delete(r),s}}return e}(),Zne=new Xne,ere=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},tre=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},nre=function(){function e(){}return e.prototype.active=function(){return Zne},e.prototype.with=function(t,n,r){for(var s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return n.call.apply(n,tre([r],ere(s),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),rre=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},sre=function(e,t,n){if(arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},vy="context",ore=new nre,UE=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return LE(vy,t,ep.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var s,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(s=this._getContextManager()).with.apply(s,sre([t,n,r],rre(o),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return If(vy)||ore},e.prototype.disable=function(){this._getContextManager().disable(),jE(vy,ep.instance())},e}(),uu;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(uu||(uu={}));var kx="0000000000000000",$x="00000000000000000000000000000000",ire={traceId:$x,spanId:kx,traceFlags:uu.NONE},Fl=function(){function e(t){t===void 0&&(t=ire),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),zE=Yne("OpenTelemetry Context Key SPAN");function BE(e){return e.getValue(zE)||void 0}function are(){return BE(UE.getInstance().active())}function HE(e,t){return e.setValue(zE,t)}function cre(e){return e.deleteValue(zE)}function ure(e,t){return HE(e,new Fl(t))}function Cx(e){var t;return(t=BE(e))===null||t===void 0?void 0:t.spanContext()}var lre=/^([0-9a-f]{32})$/i,fre=/^[0-9a-f]{16}$/i;function dre(e){return lre.test(e)&&e!==$x}function hre(e){return fre.test(e)&&e!==kx}function Tx(e){return dre(e.traceId)&&hre(e.spanId)}function mre(e){return new Fl(e)}var wy=UE.getInstance(),Ix=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=wy.active());var s=!!(n!=null&&n.root);if(s)return new Fl;var o=r&&Cx(r);return pre(o)&&Tx(o)?new Fl(o):new Fl},e.prototype.startActiveSpan=function(t,n,r,s){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=s);var f=a??wy.active(),h=this.startSpan(t,o,f),p=HE(f,h);return wy.with(p,u,void 0,h)}},e}();function pre(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var gre=new Ix,_re=function(){function e(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,s){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):gre},e}(),yre=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new Ix},e}(),bre=new yre,CC=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var s;return(s=this.getDelegateTracer(t,n,r))!==null&&s!==void 0?s:new _re(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:bre},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,n,r)},e}(),Ni;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(Ni||(Ni={}));var mc;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(mc||(mc={}));var Ey=UE.getInstance(),ky="trace",Sre=function(){function e(){this._proxyTracerProvider=new CC,this.wrapSpanContext=mre,this.isSpanContextValid=Tx,this.deleteSpan=cre,this.getSpan=BE,this.getActiveSpan=are,this.getSpanContext=Cx,this.setSpan=HE,this.setSpanContext=ure}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=LE(ky,this._proxyTracerProvider,ep.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return If(ky)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){jE(ky,ep.instance()),this._proxyTracerProvider=new CC},e}(),lS=Sre.getInstance();const TC=1000000000n,$y=e=>[Number(e/TC),Number(e%TC)],Cy=e=>Object.entries(e).reduce((t,[n,r])=>(t[n]=Rx(r),t),{}),Rx=e=>typeof e=="string"||typeof e=="number"||typeof e=="boolean"?e:typeof e=="bigint"?Number(e):ra(e),Mh=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan"),vre={internal:Ni.INTERNAL,client:Ni.CLIENT,server:Ni.SERVER,producer:Ni.PRODUCER,consumer:Ni.CONSUMER};var GI;GI=Mh;class Ox{constructor(t,n,r,s,o,a,u,f){d(this,"name");d(this,"parent");d(this,"context");d(this,"links");d(this,"kind");d(this,GI);d(this,"_tag","Span");d(this,"span");d(this,"spanId");d(this,"traceId");d(this,"attributes",new Map);d(this,"sampled");d(this,"status");this.name=r,this.parent=s,this.context=o,this.links=a,this.kind=f,this[Mh]=Mh;const h=t.active();this.span=n.startSpan(r,{startTime:$y(u),links:a.length>0?a.map(g=>({context:fS(g.span),attributes:Cy(g.attributes)})):void 0,kind:vre[this.kind]},s._tag==="Some"?Ax(h,s.value,o):lS.deleteSpan(h));const p=this.span.spanContext();this.spanId=p.spanId,this.traceId=p.traceId,this.status={_tag:"Started",startTime:u},this.sampled=(p.traceFlags&uu.SAMPLED)===uu.SAMPLED}attribute(t,n){this.span.setAttribute(t,Rx(n)),this.attributes.set(t,n)}addLinks(t){this.links.push(...t),this.span.addLinks(t.map(n=>({context:fS(n.span),attributes:Cy(n.attributes)})))}end(t,n){const r=$y(t);if(this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime},n._tag==="Success")this.span.setStatus({code:mc.OK});else if(lo(n.cause))this.span.setStatus({code:mc.OK,message:Cm(n.cause)}),this.span.setAttribute("span.label","⚠︎ Interrupted"),this.span.setAttribute("status.interrupted",!0);else{const s=G8(n.cause)[0];s?(s.stack=Cm(n.cause,{renderErrorCause:!0}),this.span.recordException(s,r),this.span.setStatus({code:mc.ERROR,message:s.message})):this.span.setStatus({code:mc.OK})}this.span.end(r)}event(t,n,r){this.span.addEvent(t,r?Cy(r):void 0,$y(n))}}const qx=tr("@effect/opentelemetry/Tracer/OtelTracer"),wre=Se(qx,e=>Oq({span(t,n,r,s,o,a){return new Ox(Ey,e,t,n,r,s.slice(),o,a)},context(t,n){const r=n.currentSpan;return r===void 0?t():Ey.with(Ax(Ey.active(),r),t)}})),IC=tr("@effect/opentelemetry/Tracer/OtelTraceFlags"),RC=tr("@effect/opentelemetry/Tracer/OtelTraceState"),Ere=X(Bg,e=>Mh in e?Le(e.span):zn(new Ag)),Ax=(e,t,n)=>t instanceof Ox?lS.setSpan(e,t.span):lS.setSpanContext(e,fS(t,n)),fS=(e,t)=>({spanId:e.spanId,traceId:e.traceId,isRemote:e._tag==="ExternalSpan",traceFlags:Et(t?OC(e,t,IC):Dr(e.context,IC),()=>uu.SAMPLED),traceState:lr(t?OC(e,t,RC):Dr(e.context,RC))}),OC=(e,t,n)=>ro(Dr(t,n),()=>Dr(e.context,n)),kre=wre,VE=Ere,$re=qx,lh=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),Px=e=>e!==void 0,Cre=e=>e==null,qC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var AC={};const Rf=e=>{if(typeof process<"u"&&AC!==void 0)return AC[e];if(qC!==void 0)return qC[e]},no=Rf("LS_TRACE_VERBOSE")!==void 0||Rf("VITE_LS_TRACE_VERBOSE")!==void 0,xs=uS(Rf("LS_DEV"))||uS(Rf("VITE_LS_DEV"));uS(Rf("CI"));const Tre=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Ire=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Rre=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ore=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],PC=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function qre(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?Ore:Rre:t.binary?Ire:Tre,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const s=e<0,o=s?"-":t.signed?"+":"";s&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const p=PC(e,t.locale,a);return o+p+r+n[0]}const u=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**u,a||(e=e.toPrecision(3));const f=PC(Number(e),t.locale,a),h=n[u];return o+f+r+h}const Fx=e=>Array.isArray(e);function To(e){debugger;throw new Error(`A case was not handled for value: ${Are(Lne(e),1e3)}`)}const Are=(e,t)=>e.length>t?e.slice(0,t)+"...":e,Pre=e=>{const t=new Map;return(...n)=>{const r=JSON.stringify(n);if(t.has(r))return t.get(r);const s=e(...n);return t.set(r,s),s}},Fre=e=>{const t=new Map;return n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r}},Nre=e=>typeof(e==null?void 0:e.then)=="function",Ku=e=>z(function*(){const t=yield*Iw();return yield*Zn(n=>bn(t,n)),yield*e(t).pipe(Cw(t))}),fh=e=>No(()=>e()).pipe(Jr(t=>Mr(t)?t:Nre(t)?Dg(()=>t):Le(t))),wt=e=>Nu(e,t=>z(function*(){if(lo(t))return;const n=yield*VE.pipe(Fw("NoSuchElementException",s=>Le(void 0))),r=t.toString().split(`
`)[0];yield*nu(r,t).pipe(s=>n===void 0?s:$c({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),dh=(e,t,n,r)=>z(function*(){const s=yield*xo(),o=a=>n(a).pipe(In(s),Do);e.addEventListener(t,o,{once:!1}),yield*Zn(()=>Te(()=>e.removeEventListener(t,o)))}),Kn=(e,t)=>_9(b9(e).pipe($c(t??{})),R9,()=>zp(Tee)),WE=e=>t=>PP(Te(()=>performance.mark(`${e}:start`)),()=>t,()=>Te(()=>{performance.mark(`${e}:end`),performance.measure(e,`${e}:start`,`${e}:end`)})),Nx=()=>{const e=yG();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},xre=()=>console.log(Nx());globalThis.getSpanTrace=Nx;globalThis.logSpanTrace=xre;const xx=(e,t)=>{class n extends Rw{constructor(){super(...arguments);d(this,"_tag",t)}}return n.prototype[e]=e,n.prototype.name=t,n},FC=Symbol.for("@effect/platform/Cookies"),NC=Symbol.for("@effect/platform/Cookies/Cookie"),Dre={[FC]:FC,...vp,toJSON(){return{_id:"@effect/platform/Cookies",cookies:xL(this.cookies,e=>e.toJSON())}},pipe(){return ee(this,arguments)}},Mre=e=>{const t=Object.create(Dre);return t.cookies=e,t},Lre=e=>{const t={};for(const n of e)t[n.name]=n;return Mre(t)},jre=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=Ure(r.trim());lt(s)&&n.push(s.value)}return Lre(n)};function Ure(e){const t=e.split(";").map(u=>u.trim()).filter(u=>u!=="");if(t.length===0)return V();const n=t[0].indexOf("=");if(n===-1)return V();const r=t[0].slice(0,n);if(!zre.test(r))return V();const s=t[0].slice(n+1),o=Bre(s);if(t.length===1)return W(Object.assign(Object.create(xC),{name:r,value:o,valueEncoded:s}));const a={};for(let u=1;u<t.length;u++){const f=t[u],h=f.indexOf("="),p=h===-1?f:f.slice(0,h).trim(),g=h===-1?void 0:f.slice(h+1).trim();switch(p.toLowerCase()){case"domain":{if(g===void 0)break;const k=g.trim().replace(/^\./,"");k&&(a.domain=k);break}case"expires":{if(g===void 0)break;const k=new Date(g);isNaN(k.getTime())||(a.expires=k);break}case"max-age":{if(g===void 0)break;const k=parseInt(g,10);isNaN(k)||(a.maxAge=sv(k));break}case"path":{if(g===void 0)break;g[0]==="/"&&(a.path=g);break}case"priority":{if(g===void 0)break;switch(g.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high";break}break}case"httponly":{a.httpOnly=!0;break}case"secure":{a.secure=!0;break}case"partitioned":{a.partitioned=!0;break}case"samesite":{if(g===void 0)break;switch(g.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none";break}break}}}return W(Object.assign(Object.create(xC),{name:r,value:o,valueEncoded:s,options:Object.keys(a).length>0?a:void 0}))}const zre=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,xC={[NC]:NC,...vp,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},Bre=e=>{try{return decodeURIComponent(e)}catch{return e}},DC=Symbol.for("@effect/platform/Headers"),Of=Object.assign(Object.create(null),{[DC]:DC,[wp](e){return hS(this,Sg(e,Mx))}}),k_=e=>Object.assign(Object.create(Of),e),Dx=Object.create(Of),KE=e=>{if(e===void 0)return Dx;if(Symbol.iterator in e){const n=Object.create(Of);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(Of);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},Hre=e=>Object.setPrototypeOf(e,Of),dS=y(3,(e,t,n)=>{const r=k_(e);return r[t.toLowerCase()]=n,r}),Vre=y(2,(e,t)=>k_({...e,...KE(t)})),Wre=y(2,(e,t)=>{const n=k_(e);return Object.assign(n,t),n}),Kre=y(2,(e,t)=>{const n=k_(e),r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&delete n[o]}else for(const o in e)s.test(o)&&delete n[o]};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),hS=y(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=uC(e[o]))}else for(const o in e)s.test(o)&&(n[o]=uC(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),Mx=Ee("@effect/platform/Headers/currentRedactedNames",()=>Uw(["authorization","cookie","set-cookie","x-api-key"])),Jre=Symbol.for("@effect/platform/HttpClientError"),Lx=Jre;class jx extends xx(Lx,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Ci extends xx(Lx,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const $_=e=>{const t=Ux(e),n=[];for(let r=0;r<t.length;r++)if(Array.isArray(t[r][0])){const[s,o]=t[r];n.push([`${s[0]}[${s.slice(1).join("][")}]`,o])}else n.push(t[r]);return n},Ux=e=>{const t=Symbol.iterator in e?je(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else if(typeof s=="object"){const o=Ux(s);for(const[a,u]of o)n.push([[r,...typeof a=="string"?[a]:a],u])}else s!==void 0&&n.push([r,String(s)]);return n},Gre=[],Qre=y(2,(e,t)=>{const n=$_(t),r=n.map(([s])=>s);return kp(z1(e,([s])=>r.includes(s)),n)}),Yre=(e,t,n)=>{try{const r=new URL(e,Zre());for(let s=0;s<t.length;s++){const[o,a]=t[s];a!==void 0&&r.searchParams.append(o,a)}return n._tag==="Some"&&(r.hash=n.value),ce(r)}catch(r){return oe(r)}},Xre=e=>new URLSearchParams(e).toString(),Zre=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},Nl=Symbol.for("@effect/platform/HttpIncomingMessage"),ese=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=$s(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=$s(e.text)}catch{}const s={...t,headers:sa(e.headers),remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},tse=e=>Hre({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),Ty=Symbol.for("@effect/platform/HttpBody");var QI;class nse{constructor(){d(this,QI);this[Ty]=Ty}[(QI=Ty,Ue)](){return this.toJSON()}toString(){return dt(this)}}class rse extends nse{constructor(){super(...arguments);d(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const sse=new rse,MC=Symbol.for("@effect/platform/HttpClientRequest"),ose={[MC]:MC,...vp,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:sa(this.headers),body:this.body.toJSON()}},pipe(){return ee(this,arguments)}};function Io(e,t,n,r,s,o){const a=Object.create(ose);return a.method=e,a.url=t,a.urlParams=n,a.hash=r,a.headers=s,a.body=o,a}const ise=Io("GET","",Gre,V(),Dx,sse),La=e=>(t,n)=>mse(ise,{method:e,url:t,...n??void 0}),ase=La("GET"),cse=La("POST"),use=La("PUT"),lse=La("PATCH"),fse=La("DELETE"),dse=La("HEAD"),hse=La("OPTIONS"),mse=y(2,(e,t)=>{let n=e;return t.method&&(n=_se(n,t.method)),t.url&&(n=yse(n,t.url)),t.headers&&(n=zx(n,t.headers)),t.urlParams&&(n=bse(n,t.urlParams)),t.hash&&(n=Sse(n,t.hash)),t.body&&(n=vse(n,t.body)),t.accept&&(n=Bx(n,t.accept)),t.acceptJson&&(n=gse(n)),n}),pse=y(3,(e,t,n)=>Io(e.method,e.url,e.urlParams,e.hash,dS(e.headers,t,n),e.body)),zx=y(2,(e,t)=>Io(e.method,e.url,e.urlParams,e.hash,Vre(e.headers,t),e.body)),Bx=y(2,(e,t)=>pse(e,"Accept",t)),gse=Bx("application/json"),_se=y(2,(e,t)=>Io(t,e.url,e.urlParams,e.hash,e.headers,e.body)),yse=y(2,(e,t)=>{if(typeof t=="string")return Io(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=$_(n.searchParams),s=n.hash?W(n.hash.slice(1)):V();return n.search="",n.hash="",Io(e.method,n.toString(),r,s,e.headers,e.body)}),bse=y(2,(e,t)=>Io(e.method,e.url,Qre(e.urlParams,t),e.hash,e.headers,e.body)),Sse=y(2,(e,t)=>Io(e.method,e.url,e.urlParams,W(t),e.headers,e.body)),vse=y(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty"||t._tag==="FormData")n=Kre(n,["Content-type","Content-length"]);else{const r=t.contentType;r&&(n=dS(n,"content-type",r));const s=t.contentLength;s&&(n=dS(n,"content-length",s.toString()))}return Io(e.method,e.url,e.urlParams,e.hash,n,t)}),xl=Symbol.for("@effect/platform/HttpClientResponse"),wse=(e,t)=>new Ese(e,t);var YI,XI,ZI;class Ese extends(ZI=YM,XI=Nl,YI=xl,ZI){constructor(n,r){super();d(this,"request");d(this,"source");d(this,XI);d(this,YI);d(this,"cachedCookies");d(this,"textBody");d(this,"formDataBody");d(this,"arrayBufferBody");this.request=n,this.source=r,this[Nl]=Nl,this[xl]=xl}toJSON(){return ese(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return KE(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=jre(this.source.headers.getSetCookie())}get remoteAddress(){return V()}get stream(){return this.source.body?une(()=>this.source.body,n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})):ane(new Ci({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return r9(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=Tl({try:()=>this.source.text(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ny,$s))}get urlParamsBody(){return X(this.text,n=>No({try:()=>$_(new URLSearchParams(n)),catch:r=>new Ci({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=Tl({try:()=>this.source.formData(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ny,$s))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=Tl({try:()=>this.source.arrayBuffer(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ny,$s))}}const LC=Symbol.for("@effect/platform/HttpClient"),JE=tr("@effect/platform/HttpClient"),kse=Ee(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>Uw(Jn)),$se=Ee(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>Uw(!0)),Cse=_u()("@effect/platform/HttpClient/SpanNameGenerator",{defaultValue:()=>e=>`http.client ${e.method}`}),Tse={[LC]:LC,pipe(){return ee(this,arguments)},...vp,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(ase(e,t))},head(e,t){return this.execute(dse(e,t))},post(e,t){return this.execute(cse(e,t))},put(e,t){return this.execute(use(e,t))},patch(e,t){return this.execute(lse(e,t))},del(e,t){return this.execute(fse(e,t))},options(e,t){return this.execute(hse(e,t))}},Hx=(e,t)=>{const n=Object.create(Tse);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},tp=Ee("@effect/platform/HttpClient/responseRegistry",()=>{if("FinalizationRegistry"in globalThis&&globalThis.FinalizationRegistry){const t=new FinalizationRegistry(n=>{n.abort()});return{register(n,r){t.register(n,r,n)},unregister(n){t.unregister(n)}}}const e=new Map;return{register(t,n){e.set(t,setTimeout(()=>n.abort(),5e3))},unregister(t){const n=e.get(t);n!==void 0&&(clearTimeout(n),e.delete(t))}}}),Ise=Ee("@effect/platform/HttpClient/scopedRequests",()=>new WeakMap),Rse=e=>Hx(t=>X(t,n=>qs(r=>{const s=Ise.get(n),o=s??new AbortController,a=Yre(n.url,n.urlParams,n.hash);if(a._tag==="Left")return zn(new jx({request:n,reason:"InvalidUrl",cause:a.left}));const u=a.right;if(!r.getFiberRef(O9)||r.getFiberRef(kse)(n)){const p=e(n,u,o.signal,r);return s?p:fi(g=>Cr(g(p),{onSuccess(k){return tp.register(k,o),Le(new jC(k,o))},onFailure(k){return lf(k)&&o.abort(),Qn(k)}}))}const h=Gn(r.currentContext,Cse);return $9(h(n),{kind:"client",captureStackTrace:!1},p=>{p.attribute("http.request.method",n.method),p.attribute("server.address",u.origin),u.port!==""&&p.attribute("server.port",+u.port),p.attribute("url.full",u.toString()),p.attribute("url.path",u.pathname),p.attribute("url.scheme",u.protocol.slice(0,-1));const g=u.search.slice(1);g!==""&&p.attribute("url.query",g);const k=r.getFiberRef(Mx),T=hS(n.headers,k);for(const O in T)p.attribute(`http.request.header.${O}`,String(T[O]));return n=r.getFiberRef($se)?zx(n,tse(p)):n,fi(O=>O(e(n,u,o.signal,r)).pipe(ji(p),Cr({onSuccess:M=>{p.attribute("http.response.status_code",M.status);const E=hS(M.headers,k);for(const S in E)p.attribute(`http.response.header.${S}`,String(E[S]));return s?Le(M):(tp.register(M,o),Le(new jC(M,o)))},onFailure(M){return!s&&lf(M)&&o.abort(),Qn(M)}})))})})),Le);var e1,t1;class jC{constructor(t,n){d(this,"original");d(this,"controller");d(this,t1,xl);d(this,e1,Nl);this.original=t,this.controller=n}applyInterrupt(t){return _t(()=>(tp.unregister(this.original),o9(t,()=>Te(()=>{this.controller.abort()}))))}get request(){return this.original.request}get status(){return this.original.status}get headers(){return this.original.headers}get cookies(){return this.original.cookies}get remoteAddress(){return this.original.remoteAddress}get formData(){return this.applyInterrupt(this.original.formData)}get text(){return this.applyInterrupt(this.original.text)}get json(){return this.applyInterrupt(this.original.json)}get urlParamsBody(){return this.applyInterrupt(this.original.urlParamsBody)}get arrayBuffer(){return this.applyInterrupt(this.original.arrayBuffer)}get stream(){return bx(()=>(tp.unregister(this.original),ine(this.original.stream,t=>(H4(t)&&this.controller.abort(),fe))))}toJSON(){return this.original.toJSON()}[(t1=xl,e1=Nl,Ue)](){return this.original[Ue]()}}const{del:$ce,execute:Cce,get:Tce,head:Ice,options:Rce,patch:Oce,post:qce,put:Ace}=m9(JE),Ose=y(2,(e,t)=>{const n=e;return Hx(r=>t(n.postprocess(r)),n.preprocess)}),qse=e=>UP(JE,X(FP(),t=>Se(e,n=>Ose(n,h9(r=>qo(t,r)))))),Ase="@effect/platform/FetchHttpClient/Fetch",Pse="@effect/platform/FetchHttpClient/FetchOptions",Fse=Rse((e,t,n,r)=>{const s=r.getFiberRef(MP),o=s.unsafeMap.get(Ase)??globalThis.fetch,a=s.unsafeMap.get(Pse)??{},u=a.headers?Wre(KE(a.headers),e.headers):e.headers,f=h=>Se(Tl({try:()=>o(t,{...a,method:e.method,headers:u,body:h,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:p=>new jx({request:e,reason:"Transport",cause:p})}),p=>wse(e,p));switch(e.body._tag){case"Raw":case"Uint8Array":return f(e.body.body);case"FormData":return f(e.body.formData);case"Stream":return X(bne(e.body.stream),f)}return f(void 0)}),Nse=qse(Le(Fse)),xse=Nse,Dse=JE;class qc extends nv("@effect/platform/Transferable/Collector")(){}const Vx=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return qc.of({unsafeAddAll:t,addAll:s=>Te(()=>t(s)),unsafeRead:n,read:Te(n),unsafeClear:r,clear:Te(r)})},Mse=Te(Vx),Lse=e=>X(p9(qc),st({onNone:()=>fe,onSome:t=>t.addAll(e)})),Wx=y(2,(e,t)=>$o(wE(e),e,{strict:!0,decode:Xr,encode:n=>fo(Lse(t(n)),n)})),C_=Wx(pn,e=>[e]),Ac=Wx(S_,e=>[e.buffer]),jse=Symbol.for("@effect/platform/WorkerError"),mS=jse,Use=e=>ne(e,mS);var n1,r1;const Ko=class Ko extends(r1=Lr()("WorkerError",{reason:Fe("spawn","decode","send","unknown","encode"),cause:Ea}),n1=mS,r1){constructor(){super(...arguments);d(this,n1,mS)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};d(Ko,"Cause",ene({error:Ko,defect:Ea})),d(Ko,"encodeCause",Ss(Ko.Cause)),d(Ko,"decodeCause",SE(Ko.Cause));let Cs=Ko;const zse=Symbol.for("@effect/platform/Runner/PlatformRunner"),Kx=tr("@effect/platform/Runner/PlatformRunner"),GE=_u()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>z4(jn)}),Jx=UP(GE,Me()),Bse=Am(function*(e,t){const n=yield*qs(Le),r=yield*Kx,s=yield*GE,o=yield*r.start(s),a=new Map;yield*Ht(s).pipe(a9(()=>(n.currentScheduler.scheduleTask(()=>{n.unsafeInterruptAsFork(n.id())},0),fe)),Kt),yield*o.run((u,[f,h,p,g])=>{if(h===1){const k=a.get(f);return k?Nr(k):fe}return qs(k=>(a.set(f,k),t!=null&&t.decode?t.decode(p):Le(p))).pipe(X(k=>{const T=Vx(),O=e(k);let M=Mr(O)?X(O,E=>w(t!=null&&t.encodeOutput?Ah(t.encodeOutput(k,E),qc,T):Le(E),X(S=>o.send(u,[f,0,[S]],T.unsafeRead())))):w(O,yne(E=>{if((t==null?void 0:t.encodeOutput)===void 0){const S=dr(E);return o.send(u,[f,0,S])}return T.unsafeClear(),w(Sn(E,S=>t.encodeOutput(k,S)),Ah(qc,T),X(S=>o.send(u,[f,0,S],T.unsafeRead())))}),Jr(o.send(u,[f,1])));return g&&(M=ji(M,{_tag:"ExternalSpan",traceId:g[0],spanId:g[1],sampled:g[2],context:po()})),fi(E=>E(M).pipe(n9(Use,S=>o.send(u,[f,3,Cs.encodeCause(Au(S))])),ks(S=>sn(Og(S),{onLeft:_=>(T.unsafeClear(),w(t!=null&&t.encodeError?Ah(t.encodeError(k,_),qc,T):Le(_),X(C=>o.send(u,[f,2,C],T.unsafeRead())),ks(C=>o.send(u,[f,3,Cs.encodeCause(C)])))),onRight:_=>o.send(u,[f,3,Cs.encodeCause(_)])}))))}),Li(Te(()=>a.delete(f))))})}),Hse=(e,t)=>z(function*(){const n=yield*Lg;let r=po();const s=iu(e);return yield*Bse(o=>{const a=t[o._tag](o);return D9(a)?X(jP(a,n),u=>Te(()=>{r=qo(r,u)})):Mr(a)?In(a,r):gne(a,r)},{decode(o){return wo(s(o),a=>new Cs({reason:"decode",cause:a}))},encodeError(o,a){return wo(nne(o,a),u=>new Cs({reason:"encode",cause:u}))},encodeOutput(o,a){return ks(rne(o,a),u=>new Cs({reason:"encode",cause:u}))}})}),Vse=(e,t)=>j9(Hse(e,t)).pipe(Bw(Jx)),Wse=e=>Om(Am(function*(t){const n=yield*jP(zP(e,Jx),t),r=Gn(n,GE);return yield*Ht(r)})),UC=zse,QE=Kx,Gx=Vse,Qx=Wse,YE=e=>{try{return Tt(JSON.stringify(e.ast,null,2))}catch{return console.warn("Schema hashing failed, falling back to hashing the shortend schema AST string. This is less reliable and may cause false positives."),Q(e.ast.toString())}},Yx=(e,t)=>(n,r)=>z(function*(){const s=yield*Mse;return[yield*Vu(e,t)(n,r).pipe(Ah(qc,s)),s.unsafeRead()]}),hh=(e,t)=>(n,r)=>{const s=KN(e,t)(n,r);return s._tag==="Left"?$e("encodeSyncDebug failed:",s.left):s.right},Kse=e=>$o(Ps(e),wE(e),{decode:iee(e),encode:see(e)});Kse(wte);const Ro=ve(D,nt,Zr,kE,xe(wf(()=>Ro)),Wu({key:D,value:wf(()=>Ro)})).annotations({title:"JsonValue"}),er=Symbol("WebChannel"),qf=me("WebChannel.DebugPing",{message:D,payload:We(D)}),np=me("WebChannel.Ping",{requestId:D}),rp=me("WebChannel.Pong",{requestId:D}),Jse=ve(np,rp),zC=e=>({send:ve(e.send,qf,np,rp),listen:ve(e.listen,qf,np,rp)}),T_=e=>ne(e,"send")&&ne(e,"listen")?zC(e):zC({send:e,listen:e}),XE=e=>t=>t.pipe(_x(Hg(function*(n){return n._tag==="Right"&&Cn(qf)(n.right)?(yield*ms(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),Gse=({channelName:e,schema:t})=>Ku(n=>z(function*(){const r=T_(t),s=new BroadcastChannel(e);yield*Zn(()=>No(()=>s.close()).pipe(Cd));const o=h=>z(function*(){const p=yield*Vu(r.send)(h);s.postMessage(p)}),a=xE(s,"message").pipe(wi(h=>m_(r.listen)(h.data)),XE(e)),u=yield*Me().pipe(it(Pa(Xn))),f=!1;return{[er]:er,send:o,listen:a,closedDeferred:u,shutdown:bn(n,Wt("shutdown")),schema:r,supportsTransferables:f}}).pipe(Ie(`WebChannel:broadcastChannel(${e})`))),Qse=({port:e,schema:t,debugId:n})=>Ku(r=>z(function*(){const s=T_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=p=>z(function*(){const[g,k]=yield*Yx(s.send)(p);e.postMessage(g,k)}),u=xE(e,"message").pipe(wi(p=>m_(s.listen)(p.data)),XE(o));e.start();const f=yield*Me().pipe(it(Pa(Xn))),h=!0;return yield*Zn(()=>No(()=>e.close()).pipe(Cd)),{[er]:er,send:a,listen:u,closedDeferred:f,shutdown:bn(r,Wt("shutdown")),schema:s,supportsTransferables:h}}).pipe(Ie("WebChannel:messagePortChannel")));Ee("livestore:sameThreadChannels",()=>new Map);const BC=({port:e,schema:t,debugId:n})=>Ku(r=>z(function*(){const s=T_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=new Map,u=me("ChannelRequest",{id:D,payload:ve(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),f=me("ChannelRequestAck",{reqId:D}).annotations({title:"webmesh.ChannelRequestAck"}),h=ve(u,f).annotations({title:"webmesh.ChannelMessage"}),p={sendTotal:0,sendPending:0,listenTotal:0,id:n},g=M=>z(function*(){p.sendTotal++,p.sendPending++;const E=crypto.randomUUID(),[S,_]=yield*Yx(h)({_tag:"ChannelRequest",id:E,payload:M}),C=yield*Me();a.set(E,C),e.postMessage(S,_),yield*C,a.delete(E),p.sendPending--}),k=xE(e,"message").pipe(wi(M=>m_(h)(M.data)),vn(M=>z(function*(){M._tag==="Right"&&(M.right._tag==="ChannelRequestAck"?yield*ut(a.get(M.right.reqId),void 0):M.right._tag==="ChannelRequest"&&(p.listenTotal++,e.postMessage(Ss(h)({_tag:"ChannelRequestAck",reqId:M.right.id}))))})),yx(M=>M._tag==="Left"?W(M):M.right._tag==="ChannelRequest"?W(ce(M.right.payload)):V()),M=>M,XE(o));e.start();const T=yield*Me().pipe(it(Pa(Xn))),O=!0;return yield*Zn(()=>No(()=>e.close()).pipe(Cd)),{[er]:er,send:g,listen:k,closedDeferred:T,shutdown:bn(r,Wt("shutdown")),schema:s,supportsTransferables:O,debugInfo:p}}).pipe(Ie("WebChannel:messagePortChannelWithAck"))),HC=(e,t)=>z(function*(){const n=yield*hn().pipe(it(Dt)),r={current:void 0};if(yield*e.listen.pipe(t!=null&&t.heartbeat?_x(Hg(function*(o){if(o._tag==="Right"&&Cn(Jse)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(rp.make({requestId:o.right.requestId}));else{const{deferred:a,requestId:u}=r.current??$e("No pending ping");u!==o.right.requestId&&$e("Received pong for unexpected requestId",u,o.right.requestId),yield*ut(a,void 0)}return!1}return!0})):ie,wx(o=>Yw(n,o)),an,Kt),t!=null&&t.heartbeat){const{interval:o,timeout:a}=t.heartbeat;yield*z(function*(){for(;;){yield*tu(o);const u=crypto.randomUUID();yield*e.send(np.make({requestId:u}));const f=yield*Me();r.current={deferred:f,requestId:u},yield*f.pipe(Ug(a),Fw("TimeoutException",()=>e.shutdown))}}).pipe(Ie("WebChannel:heartbeat"),Kt)}const s=Co(n,{maxChunkSize:1});return{[er]:er,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}});class bl extends Lr()("WebSocketError",{cause:Ea}){}const Yse=({url:e,reconnect:t})=>z(function*(){yield*Xse(e);const n=yield*OP((r,s)=>{try{const o=new globalThis.WebSocket(e);if(o.readyState===globalThis.WebSocket.OPEN){r(Le(o));return}s.addEventListener("abort",()=>{o.close(3e3,"abort signal")}),o.addEventListener("open",()=>r(Le(o)),{once:!0}),o.addEventListener("error",a=>{r(zn(new bl({cause:a})))},{once:!0}),o.addEventListener("close",a=>r(zn(new bl({cause:a}))),{once:!0})}catch(o){r(zn(new bl({cause:o})))}}).pipe(g9("WebSocketError",()=>Zse(e)),t?xw(t):ie);return yield*Zn(Hg(function*(r){try{Fa(r)?n.close(3e3):n.close(1e3)}catch(s){yield*li(new bl({cause:s}))}})),n}),Xse=e=>No({try:()=>new URL(e),catch:t=>new bl({cause:t})}),Zse=e=>z(function*(){const n=yield*(yield*Dse).get(e),r=yield*n.text;yield*nu(`Failed to connect to '${e}' (status: ${n.status}). Error:`,r)}).pipe(Nw),eoe=e=>t=>{if(ne(console,"createTask")===!1)return t;const n=z(function*(){const s=yield*w9;return Oq({span:(o,...a)=>{const u=s.span(o,...a),f=e(o);return u.runInTask=h=>f.run(h),u},context:(o,a)=>{const u=Dr(O5)(a.currentContext);if(u._tag==="None")return s.context(o,a);const f=u.value;if(f._tag==="ExternalSpan")return s.context(o,a);const h=f;return"runInTask"in h&&typeof h.runInTask=="function"?h.runInTask(()=>s.context(o,a)):s.context(o,a)}})}),r=w(n,Se(HP),BP);return In(t,r)},pS=Ee("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function toe(e){pS.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=toe);const Xx=e=>QE.of({[UC]:UC,start:Am(function*(t){const n=yield*Oee();let r=0;const s=new Map,o=(u,f,h)=>Te(()=>{var p;(((p=s.get(u))==null?void 0:p[0])??e).postMessage([1,f],{transfer:h})}),a=Am(function*(u){const f=yield*Lg,h=(yield*Pt(xo())).pipe(J7(TU(kJ))),p=yield*HZ(),g=KF(h);function k(_){_._tag==="Failure"&&!lo(_.cause)&&Di(t,ef(ww(_.cause)))}function T(_){return function(C){const $=C.data;if($[0]===0){const q=u(_,$[1]);if(Mr(q)){const P=g(q);P.addObserver(k),Y$(p,P)}}else{const q=s.get(_);if(q){if(s.size===1)return Di(t,Xn)}else return;s.delete(_),Do(bn(q[1],Xn))}}}function O(_){Di(t,new Cs({reason:"decode",cause:_.data}))}function M(_){Di(t,new Cs({reason:"unknown",cause:_.data}))}function E(_){const C=Tw(f,of).pipe(X($=>{const q=r++;s.set(q,[_,$]);const P=T(q);return _.addEventListener("message",P),_.addEventListener("messageerror",O),"start"in _&&_.start(),_.postMessage([0]),ni($,Te(()=>{_.removeEventListener("message",P),_.removeEventListener("messageerror",M),_.close()}))}),g);C.addObserver(k),Y$(p,C)}e.addEventListener("error",M);let S;if("onconnect"in e){S=e.onconnect,e.onconnect=function(_){const C=_.ports[0];E(C)};for(const _ of pS)E(_);pS.clear(),yield*ni(f,Te(()=>e.close()))}else E(e);yield*ni(f,Te(()=>{e.removeEventListener("error",M),"onconnect"in e&&(e.onconnect=S)}))});return ie({run:a,send:o,disconnects:n})})}),noe=e=>zw(QE,Xx(e)),roe=U9(QE,()=>Xx(self)),soe=roe,ooe=noe,ioe=(e=cw)=>uW(t=>{const n=new MessageChannel;n.port1.postMessage(void 0),n.port2.onmessage=t},e),aoe=TR(),sp=QN(aoe)(Ym),coe=TR(),lu=QN(coe)(Ym),mi=0,En=Y({global:lu,client:sp}).annotations({title:"LiveStore.EventSequenceNumber"}),gS=(e,t)=>e.global!==t.global?e.global-t.global:e.client-t.client,pr=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,I_=(e,t)=>e.global===t.global&&e.client===t.client,es={global:0,client:mi},Lh=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client,ka=(e,t)=>e.global>t.global||e.global===t.global&&e.client>=t.client,Zx=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client?e:t,ZE=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:mi},parentSeqNum:{global:e.global,client:mi}},e2=e=>{const t=["text","integer","real","blob"];return typeof e=="object"&&e!==null&&"columnType"in e&&t.includes(e.columnType)},e0=Symbol.for("NoDefault"),t2=e=>typeof e=="object"&&e!==null&&"sql"in e&&typeof e.sql=="string",jd=e=>t=>{const n=(t==null?void 0:t.nullable)??!1,r=(t==null?void 0:t.schema)??r2(e),s=n===!0?ZN(r):r,o=(t==null?void 0:t.default)===void 0||t.default===e0?V():W(t.default);return{columnType:e,schema:s,default:o,nullable:n,primaryKey:(t==null?void 0:t.primaryKey)??!1}},uoe=e=>jd(e),Gr=jd("text"),fr=jd("integer"),loe=jd("real"),n2=jd("blob"),R_=(e,t)=>n=>{const r=(n==null?void 0:n.nullable)??!1,s=t._tag==="baseSchemaFn"?t.baseSchemaFn(n==null?void 0:n.schema):t.baseSchema,o=r===!0?ZN(s):s,a=(n==null?void 0:n.default)===void 0||n.default===e0?V():W(n.default);return{columnType:e,schema:o,default:a,nullable:r,primaryKey:(n==null?void 0:n.primaryKey)??!1}},t0=R_("text",{_tag:"baseSchemaFn",baseSchemaFn:e=>Fs(e??pn)}),foe=R_("text",{_tag:"baseSchema",baseSchema:Js}),doe=R_("integer",{_tag:"baseSchema",baseSchema:Sr(nt,qE,{decode:e=>new Date(e),encode:e=>e.getTime()})}),hoe=R_("integer",{_tag:"baseSchema",baseSchema:Sr(nt,Zr,{decode:e=>e===1,encode:e=>e?1:0})}),r2=e=>{switch(e){case"text":return D;case"integer":return nt;case"real":return nt;case"blob":return S_;default:return To(e)}},moe=e=>Array.isArray(e)?Object.fromEntries(e.map(t=>[t.name,t])):e,s2=(e,t,n)=>{const r={_tag:"table",name:e,columns:poe(t),indexes:goe(n??[])};return{name:e,columns:t,indexes:n,ast:r}},o2=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.schema]))).annotations({title:e.name}),i2=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.nullable===!0||t.default._tag==="Some"?We(t.schema):t.schema]))).annotations({title:e.name}),poe=e=>Object.entries(e).map(([t,n])=>({_tag:"column",name:t,schema:n.schema,default:n.default,nullable:n.nullable??!1,primaryKey:n.primaryKey??!1,type:{_tag:n.columnType}})),goe=e=>e.map(t=>({_tag:"index",columns:t.columns,name:t.name,unique:t.isUnique??!1}));var _oe=Object.freeze({__proto__:null,NoDefault:e0,blob:n2,boolean:hoe,column:uoe,datetime:foe,datetimeInteger:doe,defaultSchemaForColumnType:r2,insertStructSchemaForTable:i2,integer:fr,isColumnDefinition:e2,isSqlDefaultValue:t2,json:t0,makeDbSchema:moe,real:loe,structSchemaForTable:o2,table:s2,text:Gr});const yoe=e=>{let t=0,n,r;if(e.length===0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t=Math.trunc(t);return t},n0=e=>yoe(JSON.stringify(jh(e))),jh=e=>{switch(e._tag){case"table":return{_tag:"table",name:e.name,columns:e.columns.map(t=>jh(t)),indexes:e.indexes.map(t=>jh(t))};case"column":return{_tag:"column",name:e.name,type:e.type._tag,primaryKey:e.primaryKey,nullable:e.nullable,default:e.default};case"index":return{_tag:"index",columns:e.columns,name:e.name,unique:e.unique,primaryKey:e.primaryKey};case"foreignKey":return{_tag:"foreignKey",references:e.references,key:e.key,columns:e.columns};case"dbSchema":return{_tag:"dbSchema",tables:e.tables.map(jh)};default:throw new Error(`Unreachable: ${e}`)}},Af=Symbol.for("QueryBuilderAst"),$a=Symbol.for("QueryBuilder"),O_=e=>ne(e,$a),boe=Y({mergeCounter:nt,eventNum:En});Y({fileName:D},{key:D,value:pn}).annotations({title:"LiveStore.PersistenceInfo"});const Iy=Y({done:nt,total:nt}),Soe=ve(Y({stage:Fe("loading")}),Y({stage:Fe("migrating"),progress:Iy}),Y({stage:Fe("rehydrating"),progress:Iy}),Y({stage:Fe("syncing"),progress:Iy}),Y({stage:Fe("done")})).annotations({title:"BootStatus"}),op=Symbol.for("@livestore/session-id"),Gs=class Gs extends Lr()("LiveStore.UnexpectedError",{cause:Ea,note:We(D),payload:We(pn)}){};d(Gs,"mapToUnexpectedError",t=>t.pipe(wo(n=>Cn(Gs)(n)?n:new Gs({cause:n})),t9(n=>new Gs({cause:n})))),d(Gs,"mapToUnexpectedErrorStream",t=>t.pipe(hne(n=>Cn(Gs)(n)?n:new Gs({cause:n}))));let Ne=Gs;class _S extends Lr()("LiveStore.IntentionalShutdownCause",{reason:Fe("devtools-reset","devtools-import","adapter-reset","manual")}){}class Pce extends Lr()("LiveStore.StoreInterrupted",{reason:D}){}class pc extends Lr()("LiveStore.SqliteError",{query:We(Y({sql:D,bindValues:ve(Wu({key:D,value:pn}),xe(pn))})),code:We(ve(nt,D)),cause:Ea,note:We(D)}){}const voe=Y({tableName:D,hashes:Y({expected:nt,actual:We(nt)})}),woe=Y({migrations:xe(voe)}),mh=(e,t,n)=>e.length===0?"":`WHERE ${e.map(({col:s,op:o,value:a})=>{if(a===null){if(o!=="="&&o!=="!=")throw new Error(`Unsupported operator for NULL value: ${o}`);return`${s} ${o==="="?"IS":"IS NOT"} NULL`}const u=t.sqliteDef.columns[s];if(u===void 0)throw new Error(`Column ${s} not found`);if(o==="IN"||o==="NOT IN"){if(!Array.isArray(a))return $e(`Expected array value for ${o} operator but got`,a);if(a.length===0)return o==="IN"?"0=1":"1=1";const h=a.map(g=>Ss(u.schema)(g));n.push(...h);const p=h.map(()=>"?").join(", ");return`${s} ${o} (${p})`}else{const h=Ss(u.schema)(a);return n.push(h),`${s} ${o} ?`}}).join(" AND ")}`,Ry=e=>!e||e.length===0?"":` RETURNING ${e.join(", ")}`,VC=e=>{const t=[];if(e._tag==="InsertQuery"){const p=Object.keys(e.values),g=p.map(()=>"?").join(", "),k=Ss(e.tableDef.insertSchema)(e.values);p.forEach(E=>{t.push(k[E])});let T="INSERT",O="";if(e.onConflict)if(e.onConflict.action._tag==="replace")T="INSERT OR REPLACE";else if(O=` ON CONFLICT (${e.onConflict.targets.join(", ")}) `,e.onConflict.action._tag==="ignore")O+="DO NOTHING";else{const E=e.onConflict.action.update,S=Object.keys(E);if(S.length===0)throw new Error("No update columns provided for ON CONFLICT DO UPDATE");const _=S.map(C=>E[C]===void 0?`${C} = excluded.${C}`:`${C} = ?`).join(", ");S.forEach(C=>{const $=E[C];if($!==void 0){const q=e.tableDef.sqliteDef.columns[C];if(q===void 0)throw new Error(`Column ${C} not found`);const P=Ss(q.schema)($);t.push(P)}}),O+=`DO UPDATE SET ${_}`}let M=`${T} INTO '${e.tableDef.sqliteDef.name}' (${p.join(", ")}) VALUES (${g})`;return M+=O,M+=Ry(e.returning),{query:M,bindValues:t}}if(e._tag==="UpdateQuery"){const p=Object.keys(e.values);if(p.length===0)return console.warn(`UPDATE query requires at least one column to set (for table ${e.tableDef.sqliteDef.name}). Running no-op query instead to skip this update query.`),{query:"SELECT 1",bindValues:[]};const g=Ss(Gm(e.tableDef.rowSchema))(e.values);p.forEach(O=>{t.push(g[O])});let k=`UPDATE '${e.tableDef.sqliteDef.name}' SET ${p.map(O=>`${O} = ?`).join(", ")}`;const T=mh(e.where,e.tableDef,t);return T&&(k+=` ${T}`),k+=Ry(e.returning),{query:k,bindValues:t}}if(e._tag==="DeleteQuery"){let p=`DELETE FROM '${e.tableDef.sqliteDef.name}'`;const g=mh(e.where,e.tableDef,t);return g&&(p+=` ${g}`),p+=Ry(e.returning),{query:p,bindValues:t}}if(e._tag==="CountQuery")return{query:[`SELECT COUNT(*) as count FROM '${e.tableDef.sqliteDef.name}'`,mh(e.where,e.tableDef,t)].filter(g=>g.length>0).join(" "),bindValues:t};if(e._tag==="RowQuery"){const p=e.tableDef.sqliteDef.columns.id;if(p===void 0)throw new Error("Column id not found for ROW query");const g=e.id===op?e.id:Ss(p.schema)(e.id);return{query:`SELECT * FROM '${e.tableDef.sqliteDef.name}' WHERE id = ?`,bindValues:[g]}}const r=`SELECT ${e.select.columns.length===0?"*":e.select.columns.join(", ")}`,s=`FROM '${e.tableDef.sqliteDef.name}'`,o=mh(e.where,e.tableDef,t),a=e.orderBy.length>0?`ORDER BY ${e.orderBy.map(({col:p,direction:g})=>`${p} ${g}`).join(", ")}`:"",u=e.limit._tag==="Some"?"LIMIT ?":"",f=e.offset._tag==="Some"?"OFFSET ?":"";return e.offset._tag==="Some"&&t.push(e.offset.value),e.limit._tag==="Some"&&t.push(e.limit.value),{query:[r,s,o,a,f,u].map(p=>p.trim()).filter(p=>p.length>0).join(" "),bindValues:t}},$n=(e,t=Eoe(e))=>{const n={select(){cl(t);const r=[...arguments];if(r.length===1){const[o]=r;return $n(e,{...t,resultSchemaSingle:t.resultSchemaSingle.pipe(au(o)),select:{columns:[o]}})}const s=r;return $n(e,{...t,resultSchemaSingle:s.length===0?t.resultSchemaSingle:t.resultSchemaSingle.pipe(vf(...s)),select:{columns:s}})},where:function(){if(t._tag==="InsertQuery")return ul("Cannot use where with insert");if(t._tag==="RowQuery")return ul("Cannot use where with row");if(arguments.length===1){const f=arguments[0],h=Object.entries(f).filter(([,p])=>p!==void 0).map(([p,g])=>ne(g,"op")&&ne(g,"value")?{col:p,op:g.op,value:g.value}:{col:p,op:"=",value:g});switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return $n(e,{...t,where:[...t.where,...h]});default:return To(t)}}const[r,s,o]=arguments,a=o===void 0?"=":s,u=o===void 0?s:o;switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return $n(e,{...t,where:[...t.where,{col:r,op:a,value:u}]});default:return To(t)}},orderBy(){if(cl(t),arguments.length===0||arguments.length>2)return ul();if(arguments.length===1){const o=arguments[0];return $n(e,{...t,orderBy:[...t.orderBy,...o]})}const[r,s]=arguments;return $n(e,{...t,orderBy:[...t.orderBy,{col:r,direction:s}]})},limit:r=>(cl(t),$n(e,{...t,limit:W(r)})),offset:r=>(cl(t),$n(e,{...t,offset:W(r)})),count:()=>Coe(t)||t._tag==="InsertQuery"||t._tag==="UpdateQuery"||t._tag==="DeleteQuery"?ul():$n(e,{_tag:"CountQuery",tableDef:e,where:t.where,resultSchema:Y({count:nt}).pipe(au("count"),xe,_l())}),first:r=>(cl(t),t.limit._tag==="Some"?ul(".first() can't be called after .limit()"):$n(e,{...t,limit:W(1),pickFirst:(r==null?void 0:r.fallback)!==void 0&&r.fallback!=="throws"?{fallback:r.fallback}:"throws"})),insert:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return $n(e,{_tag:"InsertQuery",tableDef:e,values:s,onConflict:void 0,returning:void 0,resultSchema:vs})},onConflict:(r,s,o)=>{const a=Array.isArray(r)?r:[r];koe(t);const u=BN(s).pipe(by("ignore",()=>({targets:a,action:{_tag:"ignore"}})),by("replace",()=>({targets:a,action:{_tag:"replace"}})),by("update",()=>({targets:a,action:{_tag:"update",update:o}})),HN);return $n(e,{...t,onConflict:u})},returning:(...r)=>($oe(t),$n(e,{...t,returning:r,resultSchema:e.rowSchema.pipe(vf(...r),xe)})),update:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return $n(e,{_tag:"UpdateQuery",tableDef:e,values:s,where:[],returning:void 0,resultSchema:vs})},delete:()=>$n(e,{_tag:"DeleteQuery",tableDef:e,where:[],returning:void 0,resultSchema:vs})};return{[$a]:$a,[Af]:t,ResultType:"only-for-type-inference",asSql:()=>VC(t),toString:()=>{try{return VC(t).query}catch(r){return console.debug("QueryBuilder.toString(): Error converting query builder to string",r,t),"Error converting query builder to string"}},...n}},Eoe=e=>({_tag:"SelectQuery",columns:[],pickFirst:!1,select:{columns:[]},orderBy:[],offset:V(),limit:V(),tableDef:e,where:[],resultSchemaSingle:e.rowSchema});function cl(e){if(e._tag!=="SelectQuery")return $e("Expected SelectQuery but got "+e._tag)}function koe(e){if(e._tag!=="InsertQuery")return $e("Expected InsertQuery but got "+e._tag)}function $oe(e){if(e._tag!=="InsertQuery"&&e._tag!=="UpdateQuery"&&e._tag!=="DeleteQuery")return $e("Expected WriteQuery but got "+e._tag)}const Coe=e=>e._tag==="RowQuery",ul=e=>$e("Invalid query builder"+(e?`: ${e}`:"")),a2=e=>{const t=e[Af];switch(t._tag){case"SelectQuery":{const n=xe(t.resultSchemaSingle);if(t.pickFirst===!1)return n;if(t.pickFirst==="throws")return n.pipe(_l());{const r=t.pickFirst.fallback();return ve(n,Yee(Fe(r))).pipe(_l(()=>r))}}case"CountQuery":return Y({count:nt}).pipe(au("count"),xe,_l());case"InsertQuery":case"UpdateQuery":case"DeleteQuery":return t.returning&&t.returning.length>0?t.tableDef.rowSchema.pipe(vf(...t.returning),xe):nt;case"RowQuery":return t.tableDef.rowSchema.pipe(au("value"),cte({title:`${t.tableDef.sqliteDef.name}.value`}),xe,_l());default:To(t)}},{integer:kn,text:ct}=_oe,Ir=e=>{const{name:t,columns:n,...r}=e,s=t,o={isClientDocumentTable:!1},a=e2(n)?{value:n}:n,u=s2(s,a,(r==null?void 0:r.indexes)??[]),f=o2(u),h=i2(u),p={sqliteDef:u,options:o,rowSchema:f,insertSchema:h},g=$n(p);for(const k of Object.keys(g))p[k]=g[k];return p[Af]=g[Af],p[$a]=g[$a],p},q_="__livestore_schema",Toe=Ir({name:q_,columns:{tableName:Gr({primaryKey:!0}),schemaHash:fr({nullable:!1}),updatedAt:Gr({nullable:!1})}}),ip="__livestore_schema_event_defs",c2=Ir({name:ip,columns:{eventName:Gr({primaryKey:!0}),schemaHash:fr({nullable:!1}),updatedAt:Gr({nullable:!1})}}),Pf="__livestore_session_changeset",ap=Ir({name:Pf,columns:{seqNumGlobal:fr({schema:lu}),seqNumClient:fr({schema:sp}),changeset:n2({nullable:!0}),debug:t0({nullable:!0})},indexes:[{columns:["seqNumGlobal","seqNumClient"],name:"idx_session_changeset_id"}]}),r0="__livestore_leader_merge_counter",Ioe=Ir({name:r0,columns:{id:fr({primaryKey:!0,schema:Fe(0)}),mergeCounter:fr({primaryKey:!0})}}),Ff=[Toe,c2,ap,Ioe],Roe=e=>Ff.some(t=>t.sqliteDef.name===e),Ds="eventlog",Nf=Ir({name:Ds,columns:{seqNumGlobal:fr({primaryKey:!0,schema:lu}),seqNumClient:fr({primaryKey:!0,schema:sp}),parentSeqNumGlobal:fr({schema:lu}),parentSeqNumClient:fr({schema:sp}),name:Gr({}),argsJson:Gr({schema:Fs(pn)}),clientId:Gr({}),sessionId:Gr({}),schemaHash:fr({}),syncMetadataJson:Gr({schema:Fs(Zi(Ro))})},indexes:[{columns:["seqNumGlobal"],name:"idx_eventlog_seqNumGlobal"},{columns:["seqNumGlobal","seqNumClient"],name:"idx_eventlog_seqNum"}]}),xf="__livestore_sync_status",Ooe=Ir({name:xf,columns:{head:fr({primaryKey:!0})}}),qoe=[Nf,Ooe],WC=ve(D,nt,fx,kE);ve(xe(WC),Wu({key:D,value:WC})).pipe(ste("PreparedBindValues"));const kt=(e,...t)=>{let n="";for(const[r,s]of t.entries())n+=e[r]+String(s);return n+e[e.length-1]},ea=(e,t)=>{if(Array.isArray(e))return e;const n={};for(const[r,s]of Object.entries(e))t.includes(r)&&(n[`$${r}`]=s);return n},Uh=(e,t,n)=>{const r=e.prepare(t),s=n?ea(n,t):void 0;r.execute(s),r.finalize()},u2=(e,t,n)=>{const r=e.prepare(t),s=r.select(void 0);return r.finalize(),s},Aoe=(e,t)=>z(function*(){const n=t.getEventDefInfos(),r=n.filter(s=>!e.eventsDefsMap.has(s.eventName));r.length>0&&(yield*new Ne({cause:`Missing mutation definitions: ${r.map(s=>s.eventName).join(", ")}`}));for(const[,s]of e.eventsDefsMap){const o=n.find(a=>a.eventName===s.name);Poe(s,t,o)}}),Poe=(e,t,n)=>{const r=YE(e.schema);if(n===void 0){t.setEventDefInfo({schemaHash:r,eventName:e.name});return}r!==n.schemaHash&&t.setEventDefInfo({schemaHash:r,eventName:e.name})},Foe=Pre(()=>new Date().toISOString()),Noe=e=>z(function*(){return yield*cp({db:e,tableAst:c2.sqliteDef.ast,behaviour:"create-if-not-exists"}),{getEventDefInfos:()=>u2(e,kt`SELECT * FROM ${ip}`),setEventDefInfo:t=>{Uh(e,kt`INSERT OR REPLACE INTO ${ip} (eventName, schemaHash, updatedAt) VALUES ($eventName, $schemaHash, $updatedAt)`,{eventName:t.eventName,schemaHash:t.schemaHash,updatedAt:new Date().toISOString()})}}}),xoe=({db:e,schema:t,onProgress:n})=>z(function*(){for(const g of Ff)yield*cp({db:e,tableAst:g.sqliteDef.ast,behaviour:"create-if-not-exists"});const r=yield*Noe(e);yield*Aoe(t,r);const s=u2(e,kt`SELECT * FROM ${q_}`),o=Object.fromEntries(s.map(({tableName:g,schemaHash:k})=>[g,k])),a=[...Ff,...Array.from(t.state.sqlite.tables.values()).filter(g=>!Roe(g.sqliteDef.name))],u=new Set,f=[];for(const g of a){const k=g.sqliteDef.ast,T=k.name,O=o[T],M=n0(k);M!==O&&(u.add({tableAst:k,schemaHash:M}),f.push({tableName:T,hashes:{expected:M,actual:O}}))}let h=0;const p=u.size;for(const{tableAst:g,schemaHash:k}of u)yield*cp({db:e,tableAst:g,schemaHash:k,behaviour:"create-if-not-exists"}),n!==void 0&&(h++,yield*n({done:h,total:p}));return{migrations:f}}),cp=({db:e,tableAst:t,schemaHash:n=n0(t),behaviour:r,skipMetaTable:s=!1})=>z(function*(){const o=t.name,a=Moe(t);Uh(e,kt`create table if not exists '${o}' (${a}) strict`);for(const u of t.indexes)Uh(e,Doe(o,u));if(s!==!0){const u=Foe();Uh(e,kt`
      INSERT INTO ${q_} (tableName, schemaHash, updatedAt) VALUES ($tableName, $schemaHash, $updatedAt)
        ON CONFLICT (tableName) DO UPDATE SET schemaHash = $schemaHash, updatedAt = $updatedAt;
    `,{tableName:o,schemaHash:n,updatedAt:u})}}).pipe(Ie("@livestore/common:migrateTable",{attributes:{"span.label":t.name,tableName:t.name}})),Doe=(e,t)=>{const n=t.unique?"UNIQUE":"";return kt`create ${n} index if not exists '${t.name}' on '${e}' (${t.columns.join(", ")})`},Moe=e=>{const t=e.columns.filter(r=>r.primaryKey).map(r=>`'${r.name}'`),n=e.columns.map(Loe);return t.length>0&&n.push(`PRIMARY KEY (${t.join(", ")})`),n.join(", ")},Loe=e=>{const t=e.type._tag,n=e.nullable===!1?"not null":"",r=(()=>{if(e.default._tag==="None")return"";if(e.default.value===null)return"default null";if(t2(e.default.value))return`default ${e.default.value.sql}`;const o=Ss(e.schema)(e.default.value);return t==="text"?`default '${o}'`:`default ${o}`})();return`'${e.name}' ${t} ${n} ${r}`},s0=e=>{const{name:t,schema:n,...r}=e,s=o=>{const a=Hee(n)(o);return a._tag==="Left"&&$e(`Invalid event args for event '${t}':`,a.left.message,`
`),{name:t,args:o}};return Object.defineProperty(s,"name",{value:t}),Object.defineProperty(s,"schema",{value:n}),Object.defineProperty(s,"encoded",{value:o=>({name:t,args:o})}),Object.defineProperty(s,"options",{value:{clientOnly:(r==null?void 0:r.clientOnly)??!1,facts:r!=null&&r.facts?(o,a)=>{var f,h;const u=r.facts(o,a);return{modify:{set:(f=u.modify)!=null&&f.set?new Set(u.modify.set):new Set,unset:(h=u.modify)!=null&&h.unset?new Set(u.modify.unset):new Set},require:u.require?new Set(u.require):new Set}}:void 0,derived:(r==null?void 0:r.derived)??!1}}),s},or=e=>s0({...e,clientOnly:!1}),l2=(e,t)=>t,joe=(e,t)=>t,up=s0({name:"livestore.RawSql",schema:Y({sql:D,bindValues:We(Wu({key:D,value:pn})),writeTables:We(Lte(D))}),clientOnly:!0,derived:!0}),Uoe=l2(up,({sql:e,bindValues:t,writeTables:n})=>({sql:e,bindValues:t??{},writeTables:n})),zoe=({name:e,schema:t,...n})=>{const r={partialSet:n.partialSet??!0,default:{id:n.default.id,value:n.default.value}},s={id:Gr({primaryKey:!0}),value:t0({schema:t})},o=Ir({name:e,columns:s});o.options.isClientDocumentTable=!0;const{eventDef:a,materializer:u}=Hoe({name:e,valueSchema:t,defaultValue:r.default.value,partialSet:r.partialSet}),f=(...g)=>{const[k,T=r.default.id]=g;return a({id:T,value:k})};Object.defineProperty(f,"name",{value:`${e}Set`}),Object.defineProperty(f,"schema",{value:Y({id:D,value:r.partialSet?Gm(t):t}).annotations({title:`${e}Set:Args`})}),Object.defineProperty(f,"options",{value:{derived:!0,clientOnly:!0,facts:void 0}});const h={get:Voe(()=>p),set:f,Value:"only-for-type-inference",default:r.default,valueSchema:t,[Df]:{derived:{setEventDef:a,setMaterializer:u},options:r}},p={...o,...h};return p},Boe=(e,t)=>typeof e!="object"||typeof t!="object"||e===null||t===null?t:Object.keys(e).reduce((n,r)=>(n[r]=t[r]??e[r],n),{}),Hoe=({name:e,valueSchema:t,defaultValue:n,partialSet:r})=>{const s=s0({name:`${e}Set`,schema:Y({id:ve(D,Wee(op)),value:r?Gm(t):t}).annotations({title:`${e}Set:Args`}),clientOnly:!0,derived:!0}),o=l2(s,({id:a,value:u})=>{if(a===op)return $e("SessionIdSymbol needs to be replaced before materializing the set event");if(vh(t.ast).length===0||r===!1){const h=Fs(t),p=hh(h)(u??n),g=hh(h)(u);return{sql:`INSERT INTO '${e}' (id, value) VALUES (?, ?) ON CONFLICT (id) DO UPDATE SET value = ?`,bindValues:[a,p,g],writeTables:new Set([e])}}else{const h=Fs(Gm(t)),p=hh(h)(Boe(n,u));let g="value";const k=[],T=Object.keys(u),O=t.pipe(vf(...T)),M=hh(O)(u);for(const _ in M){const C=M[_];C!==void 0&&(g=`json_set(${g}, ?, json(?))`,k.push(`$.${_}`,JSON.stringify(C)))}const E=k.length>0?`ON CONFLICT (id) DO UPDATE SET value = ${g}`:"ON CONFLICT (id) DO NOTHING";return{sql:`
      INSERT INTO '${e}' (id, value)
      VALUES (?, ?)
      ${E}
    `,bindValues:[a,p,...k],writeTables:new Set([e])}}});return{eventDef:s,materializer:o}},f2=e=>e.options.isClientDocumentTable===!0,Voe=e=>(...t)=>{const n=e(),[r=n[Df].options.default.id,s={}]=t,o=s.default??n[Df].options.default.value,a={_tag:"RowQuery",tableDef:n,id:r,explicitDefaultValues:o},u=kt`SELECT * FROM '${n.sqliteDef.name}' WHERE id = ?`;return{[$a]:$a,[Af]:a,ResultType:"only-for-type-inference",asSql:()=>({query:u,bindValues:[r]}),toString:()=>u.toString()}},Df=Symbol("ClientDocumentTableDef"),Woe=Symbol.for("livestore.LiveStoreSchema"),Koe=e=>{var s;const t=e.state,n=e.state.sqlite.tables;for(const o of Ff)n.set(o.sqliteDef.name,o);const r=new Map;if(Fx(e.events))for(const o of e.events)r.set(o.name,o);else for(const o of Object.values(e.events??{}))r.has(o.name)&&$e(`Duplicate event name: ${o.name}. Please use unique names for events.`),r.set(o.name,o);r.set(up.name,up);for(const o of n.values())f2(o)&&r.has(o.set.name)===!1&&r.set(o.set.name,o.set);return{LiveStoreSchemaSymbol:Woe,_DbSchemaType:Symbol.for("livestore.DbSchemaType"),_EventDefMapType:Symbol.for("livestore.EventDefMapType"),state:t,eventsDefsMap:r,devtools:{alias:((s=e.devtools)==null?void 0:s.alias)??"default"}}},si=(e,t)=>{const n=e.eventsDefsMap.get(t);if(n===void 0)return $e(`No mutation definition found for \`${t}\`.`);const r=e.state.materializers.get(t);return r===void 0?$e(`No materializer found for \`${t}\`.`):{eventDef:n,materializer:r}},d2=({eventDef:e,materializer:t,dbState:n,event:r})=>{var f;const s=r.decoded===void 0?zm(e.schema)(r.encoded.args):r.decoded.args,o=Cre((f=r.decoded)==null?void 0:f.args)?void 0:xN(e.schema)(r.decoded.args);return h2(t(s,{eventDef:e,query:h=>{if(O_(h)){const{query:p,bindValues:g}=h.asSql(),k=n.select(p,ea(g,p)),T=a2(h);return SE(T)(k)}else{const{query:p,bindValues:g}=h;return n.select(p,ea(g,p))}},currentFacts:new Map})).map(h=>{const p=h.sql,g=typeof h=="string"?o:h.bindValues,k=typeof h=="string"?void 0:h.writeTables;return{statementSql:p,bindValues:ea(g??{},p),writeTables:k}})},Joe=({schema:e,dbState:t})=>n=>{if(E_()){const{eventDef:r,materializer:s}=si(e,n.name),o=d2({eventDef:r,materializer:s,dbState:t,event:{decoded:void 0,encoded:n}});return W(Tt(JSON.stringify(o)))}return V()},Goe=e=>Tt(JSON.stringify(e)),h2=e=>{if(Fx(e))return e.flatMap(h2);if(O_(e)){const{query:t,bindValues:n}=e.asSql();return[{sql:t,bindValues:n,writeTables:void 0}]}else return typeof e=="string"?[{sql:e,bindValues:{},writeTables:void 0}]:[{sql:e.sql,bindValues:e.bindValues,writeTables:e.writeTables}]},Qoe=e=>{const t=Array.isArray(e.tables)?e.tables:Object.values(e.tables),n=new Map;for(const o of t){const a=o.sqliteDef;n.has(a.ast.name)&&$e(`Duplicate table name: ${a.ast.name}. Please use unique names for tables.`),n.set(a.ast.name,o)}for(const o of Ff)n.set(o.sqliteDef.name,o);const r=new Map;for(const[o,a]of Object.entries(e.materializers))r.set(o,a);r.set(up.name,Uoe);for(const o of t)f2(o)&&r.set(o[Df].derived.setEventDef.name,o[Df].derived.setMaterializer);const s=n0({_tag:"dbSchema",tables:[...n.values()].map(o=>o.sqliteDef.ast)});return{sqlite:{tables:n,migrations:e.migrations??{strategy:"auto"},hash:s},materializers:r}};Y({name:D,args:pn,seqNum:En,parentSeqNum:En,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyDecoded"});const Yoe=Y({name:D,args:pn,seqNum:En,parentSeqNum:En,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyEncoded"}),o0=Y({name:D,args:pn,seqNum:lu,parentSeqNum:lu,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),Xoe=Y({name:D,args:pn}),Zoe=e=>ve(...[...e.eventsDefsMap.values()].map(t=>Y({name:Fe(t.name),args:t.schema,seqNum:En,parentSeqNum:En,clientId:D,sessionId:D}))).annotations({title:"EventDef"}),Ml=class Ml extends Ma("LiveStoreEvent.EncodedWithMeta")({name:D,args:pn,seqNum:En,parentSeqNum:En,clientId:D,sessionId:D,meta:Y({sessionChangeset:ve(me("sessionChangeset",{data:fx,debug:pn.pipe(We)}),me("no-op",{}),me("unset",{})),syncMetadata:Zi(Ro),materializerHashLeader:Zi(nt),materializerHashSession:Zi(nt)}).pipe(ote,We,sx({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()})}))}){constructor(){super(...arguments);d(this,"toJSON",()=>({seqNum:`${pr(this.seqNum)} → ${pr(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args}));d(this,"rebase",(n,r)=>new Ml({...this,...ZE(n,r)}));d(this,"toGlobal",()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global}))}};d(Ml,"fromGlobal",(n,r)=>new Ml({...n,seqNum:{global:n.seqNum,client:mi},parentSeqNum:{global:n.parentSeqNum,client:mi},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:r.syncMetadata,materializerHashLeader:r.materializerHashLeader,materializerHashSession:r.materializerHashSession}}));let On=Ml;const m2=(e,t)=>e.seqNum.global===t.seqNum.global&&e.seqNum.client===t.seqNum.client&&e.name===t.name&&e.clientId===t.clientId&&e.sessionId===t.sessionId&&JSON.stringify(e.args)===JSON.stringify(t.args),eie=({dbEventlog:e,schema:t,onProgress:n,materializeEvent:r})=>z(function*(){const s=e.select(`SELECT COUNT(*) AS count FROM ${Ds}`)[0].count,o=Fre(p=>YE(p.schema)),a=p=>z(function*(){const g=si(t,p.name);o(g.eventDef)!==p.schemaHash&&(yield*to(`Schema hash mismatch for event definition ${p.name}. Trying to materialize event anyway.`));const k=JSON.parse(p.argsJson);yield*iu(g.eventDef.schema)(k).pipe(wo(O=>Ne.make({cause:O,note:`There was an error during rematerializing from the eventlog while decoding
the persisted event args for event definition "${p.name}".
This likely means the schema has changed in an incompatible way.
`})));const T=On.make({seqNum:{global:p.seqNumGlobal,client:p.seqNumClient},parentSeqNum:{global:p.parentSeqNumGlobal,client:p.parentSeqNumClient},name:p.name,args:k,clientId:p.clientId,sessionId:p.sessionId});yield*r(T,{skipEventlog:!0})}).pipe(Ie("@livestore/common:rematerializeFromEventlog:processEvent")),f=e.prepare(kt`\
SELECT * FROM ${Ds} 
WHERE seqNumGlobal > $seqNumGlobal OR (seqNumGlobal = $seqNumGlobal AND seqNumClient > $seqNumClient)
ORDER BY seqNumGlobal ASC, seqNumClient ASC
LIMIT ${100}
`);let h=0;yield*Sne({_tag:"Initial "},p=>{if(Wi(p)&&p.length===0)return V();const g=Wi(p)?NU(p).pipe(Zo(O=>({global:O.seqNumGlobal,client:O.seqNumClient})),Et(()=>es)):es,k=go(f.select({$seqNumGlobal:g==null?void 0:g.global,$seqNumClient:g==null?void 0:g.client})),T=Wi(p)?p:yt();return W([T,k])}).pipe(one({capacity:2}),vn(p=>z(function*(){yield*a(p),h++,yield*n({done:h,total:s})})),an)}).pipe(WE("@livestore/common:rematerializeFromEventlog"),Ie("@livestore/common:rematerializeFromEventlog"));class Fce extends Lr()("IsOfflineError",{}){}class tie extends Lr()("InvalidPushError",{reason:ve(me("Unexpected",{message:D}),me("ServerAhead",{minimumExpectedNum:nt,providedNum:nt}))}){}class nie extends Lr()("InvalidPullError",{message:D}){}class i0 extends Lr()("LeaderAheadError",{minimumExpectedNum:En,providedNum:En}){}class _s extends Ma("SyncState")({pending:xe(On),upstreamHead:En,localHead:En}){constructor(){super(...arguments);d(this,"toJSON",()=>({pending:this.pending.map(n=>n.toJSON()),upstreamHead:pr(this.upstreamHead),localHead:pr(this.localHead)}))}}class lp extends me("upstream-rebase",{rollbackEvents:xe(On),newEvents:xe(On)}){}class ta extends me("upstream-advance",{newEvents:xe(On)}){}class rie extends me("local-push",{newEvents:xe(On)}){}class sie extends ve(lp,ta,rie){}class p2 extends ve(lp,ta){}class A_ extends Ma("MergeContext")({payload:sie,syncState:_s}){constructor(){super(...arguments);d(this,"toJSON",()=>({payload:BN(this.payload).pipe(Sy("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),Sy("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),Sy("upstream-rebase",r=>({_tag:"upstream-rebase",newEvents:r.newEvents.map(s=>s.toJSON()),rollbackEvents:r.rollbackEvents.map(s=>s.toJSON())})),HN),syncState:this.syncState.toJSON()}))}}class Sl extends Ma("MergeResultAdvance")({_tag:Fe("advance"),newSyncState:_s,newEvents:xe(On),confirmedEvents:xe(On),mergeContext:A_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),confirmedEvents:this.confirmedEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class yS extends Ma("MergeResultRebase")({_tag:Fe("rebase"),newSyncState:_s,newEvents:xe(On),rollbackEvents:xe(On),mergeContext:A_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),rollbackEvents:this.rollbackEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class g2 extends Ma("MergeResultReject")({_tag:Fe("reject"),expectedMinimumId:En,mergeContext:A_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,expectedMinimumId:pr(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()}))}}class _2 extends Ma("MergeResultUnexpectedError")({_tag:Fe("unexpected-error"),cause:Ne}){}class Nce extends ve(Sl,yS,g2,_2){}const bS=e=>{if(xs)debugger;return _2.make({_tag:"unexpected-error",cause:new Ne({cause:e})})},y2=({syncState:e,payload:t,isClientEvent:n,isEqualEvent:r,ignoreClientEvents:s=!1})=>{var a,u,f;b2(e),oie(t);const o=A_.make({payload:t,syncState:e});switch(t._tag){case"upstream-rebase":{const h=[...t.rollbackEvents,...e.pending],p=((a=t.newEvents.at(-1))==null?void 0:a.seqNum)??e.upstreamHead,g=KC({events:e.pending,baseEventSequenceNumber:p,isClientEvent:n});return Ti(yS.make({_tag:"rebase",newSyncState:new _s({pending:g,upstreamHead:p,localHead:((u=g.at(-1))==null?void 0:u.seqNum)??p}),newEvents:[...t.newEvents,...g],rollbackEvents:h,mergeContext:o}))}case"upstream-advance":{if(t.newEvents.length===0)return Ti(Sl.make({_tag:"advance",newSyncState:new _s({pending:e.pending,upstreamHead:e.upstreamHead,localHead:e.localHead}),newEvents:[],confirmedEvents:[],mergeContext:o}));for(let g=1;g<t.newEvents.length;g++)if(Lh(t.newEvents[g-1].seqNum,t.newEvents[g].seqNum))return bS(`Events must be sorted in ascending order by event number. Received: [${t.newEvents.map(k=>pr(k.seqNum)).join(", ")}]`);if(Lh(e.upstreamHead,t.newEvents[0].seqNum)||I_(e.upstreamHead,t.newEvents[0].seqNum))return bS(`Incoming events must be greater than upstream head. Expected greater than: ${pr(e.upstreamHead)}. Received: [${t.newEvents.map(g=>pr(g.seqNum)).join(", ")}]`);const h=t.newEvents.at(-1).seqNum,p=SS({existingEvents:e.pending,incomingEvents:t.newEvents,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});if(p===-1){const g=new Set(e.pending.map(E=>`${E.seqNum.global},${E.seqNum.client}`)),k=t.newEvents.filter(E=>!g.has(`${E.seqNum.global},${E.seqNum.client}`));let T=0;const[O,M]=j1(e.pending,(E,S)=>{if(s&&n(E))return T++,!1;const _=t.newEvents.at(S-T);return _?r(E,_)===!1:!0});return Ti(Sl.make({_tag:"advance",newSyncState:new _s({pending:M,upstreamHead:h,localHead:((f=M.at(-1))==null?void 0:f.seqNum)??Zx(e.localHead,h)}),newEvents:k,confirmedEvents:O,mergeContext:o}))}else{const g=e.pending.slice(p),k=KC({events:g,baseEventSequenceNumber:h,isClientEvent:n}),T=SS({existingEvents:t.newEvents,incomingEvents:e.pending,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});return Ti(yS.make({_tag:"rebase",newSyncState:new _s({pending:k,upstreamHead:h,localHead:k.at(-1).seqNum}),newEvents:[...t.newEvents.slice(T),...k],rollbackEvents:g,mergeContext:o}))}}case"local-push":{if(t.newEvents.length===0)return Ti(Sl.make({_tag:"advance",newSyncState:e,newEvents:[],confirmedEvents:[],mergeContext:o}));const h=t.newEvents.at(0);if(Lh(h.seqNum,e.localHead)===!1){const g=ZE(e.localHead,!0).seqNum;return Ti(g2.make({_tag:"reject",expectedMinimumId:g,mergeContext:o}))}else return Ti(Sl.make({_tag:"advance",newSyncState:new _s({pending:[...e.pending,...t.newEvents],upstreamHead:e.upstreamHead,localHead:t.newEvents.at(-1).seqNum}),newEvents:t.newEvents,confirmedEvents:[],mergeContext:o}))}default:To(t)}},SS=({existingEvents:e,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:s})=>{if(s){const o=e.filter(f=>!r(f)),a=SS({existingEvents:o,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:!1});if(a===-1)return-1;const u=e[a].seqNum;return e.findIndex(f=>I_(f.seqNum,u))}return e.findIndex((o,a)=>{const u=t[a];return u&&!n(o,u)})},KC=({events:e,baseEventSequenceNumber:t,isClientEvent:n})=>{let r=t;return e.map(s=>{const o=n(s),a=s.rebase(r,o);return r=a.seqNum,a})},oie=e=>{for(let t=1;t<e.newEvents.length;t++)if(ka(e.newEvents[t-1].seqNum,e.newEvents[t].seqNum))return bS(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.newEvents.map(n=>pr(n.seqNum)).join(", ")}]`)},b2=e=>{for(let t=0;t<e.pending.length;t++){const n=e.pending[t],r=e.pending[t+1];if(r===void 0)break;ka(n.seqNum,r.seqNum)&&$e(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.pending.map(o=>pr(o.seqNum)).join(", ")}]`,{event:n,nextEvent:r}),r.seqNum.global>n.seqNum.global?r.seqNum.client!==0&&$e(`New global events must point to clientId 0 in the parentSeqNum. Received: (${pr(r.seqNum)})`,e.pending,{event:n,nextEvent:r}):I_(r.parentSeqNum,n.seqNum)===!1&&$e("Events must be linked in a continuous chain via the parentSeqNum",e.pending,{event:n,nextEvent:r})}},Ti=e=>(e._tag==="unexpected-error"||e._tag==="reject"||(b2(e.newSyncState),Lh(e.newSyncState.upstreamHead,e.newSyncState.localHead)&&$e("Local head must be greater than or equal to upstream head",{localHead:e.newSyncState.localHead,upstreamHead:e.newSyncState.upstreamHead}),ka(e.newSyncState.localHead,e.mergeContext.syncState.localHead)===!1&&$e("New local head must be greater than or equal to the previous local head",{localHead:e.newSyncState.localHead,previousLocalHead:e.mergeContext.syncState.localHead}),ka(e.newSyncState.upstreamHead,e.mergeContext.syncState.upstreamHead)===!1&&$e("New upstream head must be greater than or equal to the previous upstream head",{upstreamHead:e.newSyncState.upstreamHead,previousUpstreamHead:e.mergeContext.syncState.upstreamHead})),e),iie="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ho=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=iie[n[e]&63];return t};const P_="0.3.1",JC=4,aie=Y({isConnected:Zr,timestampMs:nt,latchClosed:Zr}),zh=D,cie=D,Bh=Fe(P_),S2=(e,t)=>me(e,{liveStoreVersion:Bh,...t}).annotations({identifier:e}),uie=(e,t)=>S2(e,{clientId:cie,...t}),Mt=(e,t)=>uie(e,{requestId:zh,...t}),a0=(e,t)=>{const n=me(`${e}.Response.Success`,{requestId:zh,liveStoreVersion:Bh,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?me(`${e}.Response.Error`,{requestId:zh,liveStoreVersion:Bh,...t.error}).annotations({identifier:`${e}.Response.Error`}):p_;return{Request:me(`${e}.Request`,{requestId:zh,liveStoreVersion:Bh,...t.payload}).annotations({identifier:`${e}.Request`}),Response:ve(n,r),Success:n,Error:r}};class xce extends Mt("LSD.Leader.ResetAllDataReq",{mode:Fe("all-data","only-app-db")}){}class lie extends Mt("LSD.Leader.DatabaseFileInfoReq",{}){}class GC extends Y({fileSize:nt,persistenceInfo:Y({fileName:D},{key:D,value:pn})}){}class v2 extends Mt("LSD.Leader.DatabaseFileInfoRes",{state:GC,eventlog:GC}){}class fie extends Mt("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:D}){}class die extends Mt("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:D}){}class w2 extends Mt("LSD.Leader.NetworkStatusRes",{networkStatus:aie,subscriptionId:D}){}class hie extends Mt("LSD.Leader.SyncingInfoReq",{}){}class E2 extends Y({enabled:Zr,metadata:Wu({key:D,value:pn})}){}class k2 extends Mt("LSD.Leader.SyncingInfoRes",{syncingInfo:E2}){}class mie extends Mt("LSD.Leader.SyncHistorySubscribe",{subscriptionId:D}){}class pie extends Mt("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:D}){}class $2 extends Mt("LSD.Leader.SyncHistoryRes",{eventEncoded:o0,metadata:Zi(Ro),subscriptionId:D}){}class gie extends Mt("LSD.Leader.SyncHeadSubscribe",{subscriptionId:D}){}class _ie extends Mt("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:D}){}class C2 extends Mt("LSD.Leader.SyncHeadRes",{local:En,upstream:En,subscriptionId:D}){}class yie extends Mt("LSD.Leader.SnapshotReq",{}){}class T2 extends Mt("LSD.Leader.SnapshotRes",{snapshot:Ac}){}const gc=a0("LSD.Leader.LoadDatabaseFile",{payload:{data:Ac},success:{},error:{cause:ve(me("unsupported-file",{}),me("unsupported-database",{}),me("unexpected-error",{cause:Ea}))}});class I2 extends S2("LSD.Leader.SyncPull",{payload:p2}){}class bie extends Mt("LSD.Leader.CommitEventReq",{eventEncoded:Xoe}){}class R2 extends Mt("LSD.Leader.CommitEventRes",{}){}class Sie extends Mt("LSD.Leader.EventlogReq",{}){}class O2 extends Mt("LSD.Leader.EventlogRes",{eventlog:Ac}){}let vie=class extends Mt("LSD.Leader.Ping",{}){},q2=class extends Mt("LSD.Leader.Pong",{}){};class A2 extends Mt("LSD.Leader.Disconnect",{}){}const c0=a0("LSD.Leader.SetSyncLatch",{payload:{closeLatch:Zr},success:{}}),u0=a0("LSD.Leader.ResetAllData",{payload:{mode:Fe("all-data","only-app-db")},success:{}}),P2=ve(yie,gc.Request,Sie,u0.Request,fie,die,A2,bie,vie,lie,mie,pie,hie,gie,_ie,c0.Request).annotations({identifier:"LSD.Leader.MessageToApp"}),wie=ve(T2,gc.Response,O2,A2,I2,w2,R2,q2,v2,$2,k2,C2,u0.Success,c0.Success).annotations({identifier:"LSD.Leader.MessageFromApp"}),Eie=ve(me("node",{url:D}),me("web",{}),me("browser-extension",{}));Eie.pipe(au("_tag"),Ps);const kie={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},$ie={sessionInfo:()=>"session-info",devtoolsClientSession:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-session-${e}-${t}-${n})`,devtoolsClientLeader:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-leader-${e}-${t}-${n})`},Cie={devtoolsClientSession:(e,{storeId:t,clientId:n,sessionId:r})=>e===$ie.devtoolsClientSession({storeId:t,clientId:n,sessionId:r}),devtoolsClientLeader:(e,{storeId:t,clientId:n})=>e.startsWith(`devtools-channel(client-leader-${t}-${n}`)},Ud=D.pipe(We,sx({constructor:()=>ho(10),decoding:()=>ho(10)})),ja={id:Ud,target:D,source:D,channelName:D,hops:xe(D)},F2=YN.pipe(We);class Hh extends me("DirectChannelRequest",{...ja,remainingHops:xe(D).pipe(We),channelVersion:nt,reqId:g_(D),sourceId:D}){}class N2 extends me("DirectChannelResponseSuccess",{...ja,reqId:D,port:C_,remainingHops:xe(D),channelVersion:nt}){}class l0 extends me("DirectChannelResponseNoTransferables",{...ja,reqId:D,remainingHops:xe(D)}){}class x2 extends me("ProxyChannelRequest",{...ja,remainingHops:F2,channelIdCandidate:D}){}class D2 extends me("ProxyChannelResponseSuccess",{...ja,reqId:D,remainingHops:xe(D),combinedChannelId:D,channelIdCandidate:D}){}class M2 extends me("ProxyChannelPayload",{...ja,remainingHops:F2,payload:pn,combinedChannelId:D}){}class L2 extends me("ProxyChannelPayloadAck",{...ja,reqId:D,remainingHops:xe(D),combinedChannelId:D}){}class vS extends me("NetworkEdgeAdded",{id:Ud,source:D,target:D}){}class wS extends me("NetworkTopologyRequest",{id:Ud,hops:xe(D),source:D,target:Fe("-")}){}class ES extends me("NetworkTopologyResponse",{id:Ud,reqId:D,remainingHops:xe(D),nodeName:D,edges:xe(D),source:D,target:Fe("-")}){}const Vh=me("BroadcastChannelPacket",{id:Ud,channelName:D,payload:pn,hops:xe(D),source:D,target:Fe("-")});class kS extends ve(Hh,N2,l0){}class j2 extends ve(x2,D2,M2,L2){}class U2 extends ve(kS,j2,vS,wS,ES,Vh){}class ph extends me("DirectChannelPing",{}){}class gh extends me("DirectChannelPong",{}){}class Tie extends Lr()("EdgeAlreadyExistsError",{target:D}){}const Dl=e=>({packetId:e.id,"span.label":e.id+(ne(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});Y({channelName:D,source:D,mode:ve(Fe("proxy"),Fe("direct"))});const Iie=Me,Rie=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:a,channelVersion:u,scope:f,sourceId:h})=>z(function*(){const p=yield*Iie(),g=yield*VE.pipe(Mg(()=>Le(void 0))),k={send:ve(o.send,ph,gh),listen:ve(o.listen,ph,gh)},T={current:{_tag:"Initial"}},O=({packet:_,respondToSender:C})=>z(function*(){const $=T.current;if(g==null||g.addEvent(`process:${_._tag}`,{channelState:$._tag,packetId:_.id,packetReqId:_.reqId,packetChannelVersion:ne("channelVersion")(_)?_.channelVersion:void 0}),$._tag==="Initial")return $e();if(_._tag==="DirectChannelResponseNoTransferables")return yield*jv(p,_),"close";if(_.channelVersion>u)return g==null||g.addEvent(`incoming packet has higher version (${_.channelVersion}), closing channel`),yield*bn(f,Wt("higher-version-expected")),"close";if(_.channelVersion<u){const q=Hh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:void 0});g==null||g.addEvent(`incoming packet has lower version (${_.channelVersion}), sending request to reconnect (${q.id})`),yield*a(q);return}if($._tag==="Established"&&_._tag==="DirectChannelRequest")return _.sourceId===$.otherSourceId?void 0:(g==null||g.addEvent("force-new-channel"),yield*bn(f,Wt("force-new-channel")),"close");switch(_._tag){case"DirectChannelRequest":{if($._tag!=="RequestSent")return;if(_.reqId!==$.reqPacketId){const P=Hh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:_.id});g==null||g.addEvent(`Re-sending new request (${P.id}) for incoming request (${_.id})`),yield*a(P)}if(e>n){g==null||g.addEvent("winner side: creating direct channel and sending response");const P=new MessageChannel,x=yield*BC({port:P.port1,schema:k,debugId:u}).pipe(Jr(HC));yield*C(N2.make({reqId:_.id,target:n,source:e,channelName:_.channelName,hops:[],remainingHops:_.hops.slice(0,-1),port:P.port2,channelVersion:u})),T.current={_tag:"winner:ResponseSent",channel:x,otherSourceId:_.sourceId},yield*x.listen.pipe(Ef(),Ns(Cn(ph)),cu(1),an),yield*x.send(gh.make({})),g==null||g.addEvent("winner side: established"),T.current={_tag:"Established",otherSourceId:_.sourceId},yield*ut(p,x)}else g==null||g.addEvent("loser side: waiting for response"),T.current={_tag:"loser:WaitingForResponse",otherSourceId:_.sourceId};break}case"DirectChannelResponseSuccess":{if($._tag!=="loser:WaitingForResponse")return $e(`Expected to find direct channel response from ${n}, but was in ${$._tag} state`);const q=yield*BC({port:_.port,schema:k,debugId:u}).pipe(Jr(HC)),P=yield*q.listen.pipe(Ef(),Ns(Cn(gh)),cu(1),an,jg);yield*q.send(ph.make({})).pipe(Ug(10),xw({times:2})),yield*P,g==null||g.addEvent("loser side: established"),T.current={_tag:"Established",otherSourceId:$.otherSourceId},yield*ut(p,q);return}default:return To(_)}}).pipe(Ie(`handleMessagePacket:${_._tag}:${_.source}→${_.target}`,{attributes:Dl(_)}));yield*z(function*(){for(;;){const _=yield*ko(t);if((yield*O(_))==="close")return}}).pipe(Pt,wt,Kt);const M=T.current;return M._tag!=="Initial"?$e(`Expected channel to be in Initial state, but was in ${M._tag} state`):(yield*z(function*(){const _=Hh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],reqId:void 0});T.current={_tag:"RequestSent",reqPacketId:_.id};const C=r(_);if(C!==void 0)return yield*Kn(`No transferable edges found for ${_.source}→${_.target}`),yield*zn(C);yield*a(_),g==null||g.addEvent(`initial edge request sent (${_.id})`)}),yield*p)}).pipe(Id(`makeDirectChannel:${u}`)),Oie=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:a,sendPacket:u})=>Ku(f=>z(function*(){const h=ho(),p=yield*hn(),g=yield*lX(),k=yield*Me(),T={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*z(function*(){const C=yield*Me();for(;;){T.connectCounter++;const x=T.connectCounter;yield*Kn(`Connecting#${x}`);const L=yield*Iw();yield*Zn(Z=>bn(L,Z));const B=yield*Zm(t).pipe(vn(Z=>Kn(`new-conn:${Z}`)),cu(1),an,fo("new-edge"),jg),F=Rie({nodeName:s,sourceId:h,incomingPacketsQueue:o,target:a,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:x,sendPacket:u,scope:L}).pipe(Cw(L),mr(L),S9(V())),j=yield*xP(F,B.pipe(s9));if(j==="new-edge")yield*bn(L,hd("new-edge"));else{const Z=yield*j.pipe(Jt);if(Z._tag==="Failure")yield*bn(L,Z),zA(Z.cause)&&Cn(l0)(Z.cause.error)&&(yield*B.pipe(Jt));else{const ye=Z.value;yield*ut(C,{channel:ye,makeDirectChannelScope:L,channelVersion:x});break}}}const{channel:$,makeDirectChannelScope:q,channelVersion:P}=yield*C;yield*Kn(`Connected#${P}`),T.isConnected=!0,T.innerChannelRef.current=$,yield*ut(k,void 0),yield*$.listen.pipe(Ef(),wx(x=>Yw(p,x)),an,wt,mr(q)),yield*z(function*(){for(;;){const[x,L]=yield*cX(g);yield*$.send(x),yield*ut(L,void 0),yield*uX(g)}}).pipe(mr(q)),yield*$.closedDeferred,yield*bn(q,Wt("channel-closed")),yield*Kn(`Disconnected#${P}`),T.isConnected=!1,T.innerChannelRef.current=void 0}).pipe(di,mf,wt,Kt);const O=yield*Bg.pipe(Tr),M=C=>z(function*(){const $=yield*Me();T.pendingSends++,T.totalSends++,yield*aX(g,[C,$]),yield*$,T.pendingSends--}).pipe(di,ji(O)),E=Co(p,{maxChunkSize:1}).pipe(wi(ce)),S=yield*Me().pipe(it(Pa(Xn)));return{webChannel:{[er]:er,send:M,listen:E,closedDeferred:S,supportsTransferables:!0,schema:e,debugInfo:T,shutdown:bn(f,Wt("shutdown"))},initialEdgeDeferred:k}})),qie=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:a})=>Ku(u=>z(function*(){const f={current:{_tag:"Initial"}},h={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},p=ho(5);yield*Pb({channelIdCandidate:p});const g=yield*Bg.pipe(Tr),k=yield*kf(!1),T=z(function*(){return yield*$f(k,j=>j!==!1)}),O=F=>z(function*(){yield*Kn(`Connected (${F})`).pipe(ji(g)),f.current={_tag:"Established",listenSchema:a.listen,listenQueue:C,ackMap:$,combinedChannelId:F},yield*Or(k,f.current),h.isConnected=!0}),M=_t(()=>r(x2.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:p}))),E=F=>[p,F].sort().join("_"),S=yield*hn().pipe(it(Dt)),_=({packet:F,respondToSender:j})=>z(function*(){const ye=`target:${F.source}, channelName:${F.channelName}`,G=f.current;switch(F._tag){case"ProxyChannelRequest":{const we=E(F.channelIdCandidate);G._tag==="Established"?G.combinedChannelId===we||(yield*to(`[${t}] Received ProxyChannelRequest with different channel ID (${we}) while established with ${G.combinedChannelId}. Re-establishing.`),yield*Or(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Kn("Reconnecting (received conflicting ProxyChannelRequest)").pipe(ji(g)),h.isConnected=!1,h.connectCounter++,yield*M):G._tag==="Initial"&&(yield*Or(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Kn("Connecting (received ProxyChannelRequest)").pipe(ji(g)),h.isConnected=!1,h.connectCounter++),yield*j(D2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:we,channelIdCandidate:p}));return}case"ProxyChannelResponseSuccess":{if(G._tag!=="Pending"){if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return $e(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(G._tag==="Established")return;yield*to(`[${t}] Ignoring ResponseSuccess ${F.id} received in unexpected state ${G._tag}`);return}const we=E(F.channelIdCandidate);if(we!==F.combinedChannelId)return yield*li(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${we} (channel) === ${F.combinedChannelId} (packet)`);yield*O(F.combinedChannelId);const Re=f.current;if(Re._tag==="Established"){const Be=yield*BQ(S);for(const Ze of Be){if(Re.combinedChannelId!==Ze.combinedChannelId){yield*to(`[${t}] Discarding buffered payload ${Ze.id}: Combined channel ID mismatch during drain. Expected ${Re.combinedChannelId}, got ${Ze.combinedChannelId}`);continue}const He=yield*iu(Re.listenSchema)(Ze.payload);yield*Re.listenQueue.pipe(Ye(He))}}else yield*nu(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${Re._tag}`);return}case"ProxyChannelPayload":{if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return yield*li(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(yield*j(L2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:G._tag==="Established"?G.combinedChannelId:F.combinedChannelId})),G._tag==="Established"){const we=yield*iu(G.listenSchema)(F.payload);yield*G.listenQueue.pipe(Ye(we))}else yield*Ye(S,F);return}case"ProxyChannelPayloadAck":{if(G._tag!=="Established"){yield*Kn(`Not yet connected to ${s}. dropping message`),yield*to(`[${t}] Received Ack but not established (State: ${G._tag}). Dropping Ack for ${F.reqId}`);return}const we=G.ackMap.get(F.reqId)??$e(`[ProxyChannel[${ye}]] Expected ack for ${F.reqId}`);yield*ut(we,void 0),G.ackMap.delete(F.reqId);return}default:return To(F)}}).pipe(Ie(`handleProxyPacket:${F._tag}:${F.source}->${F.target}`,{attributes:Dl(F)}));yield*Co(e).pipe(vn(_),an,wt,Kt);const C=yield*hn();yield*Kn("Connecting");const $=new Map;{if(f.current._tag!=="Initial")return $e("Expected proxy channel to be Initial");f.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*M;const F=yield*Zm(n).pipe(vn(()=>M),an,Kt),{combinedChannelId:j}=yield*T;yield*Nr(F),yield*O(j)}const q=F=>z(function*(){const j=yield*WN(a.send)(F),Z=yield*IN(),ye=yield*Me();h.pendingSends++,h.totalSends++;const G=z(function*(){const{combinedChannelId:Re}=yield*$f(k,Ze=>Ze!==!1);yield*z(function*(){const Ze=yield*Me(),He=M2.make({channelName:o,payload:j,hops:[],source:t,target:s,combinedChannelId:Re});$.set(He.id,Ze),yield*r(He),yield*Ze,yield*ut(ye,void 0),h.pendingSends--}).pipe(Ug(100),xw(JF(10)),Tr)}).pipe(Nu(nu)),we=yield*k.changes.pipe(Ns(Re=>Re===!1),vn(()=>Um(Z,G)),an,jg);yield*Um(Z,G),yield*ye,yield*Nr(we)}).pipe(di,Ie("sendAckWithRetry:ProxyChannelPayload"),ji(g)),P=Co(C).pipe(wi(ce)),x=yield*Me().pipe(it(Pa(Xn))),L=yield*xo();return{[er]:er,send:q,listen:P,closedDeferred:x,supportsTransferables:!1,schema:a,shutdown:bn(u,Xn),debugInfo:h,debug:{ping:(F="ping")=>q(qf.make({message:F})).pipe(In(L),wt,Do)}}}).pipe(Id("makeProxyChannel"))),dp=class dp{constructor({timeout:t}){d(this,"values",new Map);d(this,"timeoutHandle");d(this,"timeoutMs");d(this,"onShutdown",()=>clearTimeout(this.timeoutHandle));this.timeoutMs=xc(t)}add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}};d(dp,"make",t=>z(function*(){const n=new dp({timeout:t});return yield*Zn(()=>Te(()=>n.onShutdown())),n}));let $S=dp;const Aie=e=>z(function*(){const t=new Map,n=yield*$S.make(UR(1)),r=yield*Qw().pipe(it(Fm)),s=new Map,o=yield*hn().pipe(it(Dt)),a=new Map,u=new Map,f=$=>{var q;if($._tag==="DirectChannelRequest"&&(t.size===0||((q=t.get($.target))==null?void 0:q.channel.supportsTransferables)===!1)||![...t.values()].some(P=>P.channel.supportsTransferables===!0))return l0.make({reqId:$.id,channelName:$.channelName,source:$.target,target:$.source,remainingHops:$.hops,hops:[]})},h=$=>z(function*(){var q,P;if(Cn(vS)($)){yield*Kn("NetworkEdgeAdded",{packet:$,nodeName:e}),yield*Kg(r,$.target);const x=Array.from(t).filter(([L])=>L!==$.source).map(([L,B])=>B.channel);yield*Sn(x,L=>L.send($),{concurrency:"unbounded"});return}if(Cn(Vh)($)){const x=Array.from(t).filter(([F])=>!$.hops.includes(F)).map(([F,j])=>j.channel),L={...$,hops:[...$.hops,e]};if(yield*Sn(x,F=>F.send(L),{concurrency:"unbounded"}),$.source===e)return;const B=u.get($.channelName);B!==void 0&&(yield*Ye(B,$));return}if(Cn(wS)($)){if($.source!==e){const B=$.hops.at(-1)??$e(`${e}: Expected hops for packet`,$),F=t.get(B).channel,j=ES.make({reqId:$.id,source:$.source,target:$.target,remainingHops:$.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*F.send(j)}const x=Array.from(t).filter(([B])=>!$.hops.includes(B)).map(([B,F])=>F.channel),L={...$,hops:[...$.hops,e]};yield*Sn(x,B=>B.send(L),{concurrency:"unbounded"});return}if(Cn(ES)($)){if($.source===e)a.get($.reqId).set($.nodeName,new Set($.edges));else{const L=$.remainingHops.at(-1)??$e(`${e}: Expected remaining hops for packet`,$);yield*(((q=t.get(L))==null?void 0:q.channel)??$e(`${e}: Expected edge channel (${L}) for packet`,$,"Available edges:",Array.from(t.keys()))).send({...$,remainingHops:$.remainingHops.slice(0,-1)})}return}if(t.has($.target)){const x=t.get($.target).channel,L=$.source===e?[]:[...$.hops,e];yield*Pb({hasDirectEdge:!0}),yield*x.send({...$,hops:L})}else if($.remainingHops!==void 0){const x=$.remainingHops.at(-1)??$e(`${e}: Expected remaining hops for packet`,$),L=(P=t.get(x))==null?void 0:P.channel;if(L===void 0){yield*to(`${e}: Expected to find hop target ${x} in edges. Dropping packet.`,$);return}yield*L.send({...$,remainingHops:$.remainingHops.slice(0,-1),hops:[...$.hops,e]})}else{const x=$.source===e?[]:[...$.hops,e],L=Array.from(t).filter(([F])=>F!==$.source).map(([F,j])=>({name:F,channel:j.channel}));x.length===0&&L.length===0&&xs&&(yield*to(e,"no route found to",$.target,$._tag,"TODO handle better"));const B={...$,hops:x};yield*Pb({edgesToForwardTo:L.map(({name:F})=>F)}),yield*Sn(L,({channel:F})=>F.send(B),{concurrency:"unbounded"})}}).pipe(Ie(`sendPacket:${$._tag}:${$.source}→${$.target}`,{attributes:Dl($)}),Tr),p=({target:$,edgeChannel:q,replaceIfExists:P=!1})=>z(function*(){if(t.has($))if(P)yield*g($).pipe(Tr);else return yield*new Tie({target:$});const x=yield*q.listen.pipe(Ef(),vn(B=>z(function*(){const F=yield*iu(U2)(B);if(!n.has(F.id))switch(n.add(F.id),F._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*h(F);break}default:if(F.target===e){const j=`target:${F.source}, channelName:${F.channelName}`;if(!s.has(j)){const G=yield*hn().pipe(it(Dt));s.set(j,{queue:G,debugInfo:void 0})}const Z=s.get(j).queue,ye=G=>q.send(G).pipe(Ie(`respondToSender:${G._tag}:${G.source}→${G.target}`,{attributes:Dl(G)}),Tr);Cn(j2)(F)?yield*Ye(Z,{packet:F,respondToSender:ye}):Cn(kS)(F)&&(yield*Ye(Z,{packet:F,respondToSender:ye})),(F._tag==="ProxyChannelRequest"||F._tag==="DirectChannelRequest")&&(yield*Ye(o,{channelName:F.channelName,source:F.source,mode:F._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(Cn(kS)(F)){const j=f(F);if(j!==void 0)return yield*Kn(`No transferable edges found for ${F.source}→${F.target}`),yield*q.send(j).pipe(Ie(`sendNoTransferableResponse:${F.source}→${F.target}`,{attributes:Dl(j)}))}yield*h(F)}}})),an,Pt,Tr,wt,Kt);t.set($,{channel:q,listenFiber:x});const L=vS.make({source:e,target:$});yield*h(L).pipe(Tr)}).pipe($c({"addEdge:target":$,nodeName:e}),Ie(`addEdge:${e}→${$}`,{attributes:{supportsTransferables:q.supportsTransferables}})),g=$=>z(function*(){t.has($)||(yield*new Ag(`No edge found for ${$}`)),yield*Nr(t.get($).listenFiber),t.delete($)}),k=({target:$,channelName:q})=>Te(()=>s.has(`target:${$}, channelName:${q}`)),T=({target:$,channelName:q,schema:P,mode:x,timeout:L=sv(1),closeExisting:B=!1})=>z(function*(){var ye;const F=T_(P),j=`target:${$}, channelName:${q}`;if(s.has(j)){const G=(ye=s.get(j).debugInfo)==null?void 0:ye.channel;G&&(B?(yield*G.shutdown,s.delete(j)):$e(`Channel ${j} already exists`,G))}if(s.has(j)===!1){const G=yield*hn().pipe(it(Dt));s.set(j,{queue:G,debugInfo:void 0})}const Z=s.get(j).queue;if(yield*Zn(()=>Te(()=>s.delete(j))),x==="direct"){const G=yield*hn().pipe(it(Dt));yield*XP(Z,1,10).pipe(Eo(Be=>Yw(G,Be)),mf,Pt,wt,Kt);const{webChannel:we,initialEdgeDeferred:Re}=yield*Oie({nodeName:e,incomingPacketsQueue:G,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,sendPacket:h,checkTransferableEdges:f});return s.set(j,{queue:Z,debugInfo:{channel:we,target:$}}),yield*Re,we}else{const G=yield*qie({nodeName:e,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,queue:Z,sendPacket:h});return s.set(j,{queue:Z,debugInfo:{channel:G,target:$}}),G}}).pipe(Id(`makeChannel:${e}→${$}(${q})`,{attributes:{target:$,channelName:q,mode:x,timeout:L}}),$c({nodeName:e,target:$,channelName:q}));let O=!1;const M=bx(()=>{if(O)return $e("listenForChannel already started");O=!0;const $=P=>`${P.channelName}:${P.source}:${P.mode}`,q=new Set;return Co(o).pipe(Ns(P=>{const x=$(P);return q.has(x)?!1:(q.add(x),!0)}))}),E=({channelName:$,schema:q})=>Ku(P=>z(function*(){if(u.has($))return $e(`Broadcast channel ${$} already exists`,u.get($));const x={},L=yield*hn().pipe(it(Dt));u.set($,L);const B=Z=>z(function*(){const ye=yield*Vu(q)(Z),G=Vh.make({channelName:$,payload:ye,source:e,target:"-",hops:[]});yield*h(G)}),F=Co(L).pipe(Ns(Cn(Vh)),wi(Z=>m_(q)(Z.payload))),j=yield*Me().pipe(it(Pa(Xn)));return{[er]:er,send:B,listen:F,closedDeferred:j,supportsTransferables:!1,schema:{listen:q,send:q},shutdown:bn(P,Xn),debugInfo:x}})),S=Te(()=>new Set(t.keys())),_=yield*xo();return{nodeName:e,addEdge:p,removeEdge:g,hasChannel:k,makeChannel:T,listenForChannel:M,makeBroadcastChannel:E,edgeKeys:S,debug:{print:()=>{var $,q,P,x;console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[L,B]of t)console.log(`  ${L}: supportsTransferables=${B.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[L,B]of s)console.log(lh(L,2),`
`,Object.entries({target:($=B.debugInfo)==null?void 0:$.target,supportsTransferables:(q=B.debugInfo)==null?void 0:q.channel.supportsTransferables,...(P=B.debugInfo)==null?void 0:P.channel.debugInfo}).map(([F,j])=>lh(`${F}=${j}`,4)).join(`
`),"    ",(x=B.debugInfo)==null?void 0:x.channel,`
`,lh(`Queue: ${B.queue.unsafeSize().pipe(lr)}`,4),B.queue);console.log("Broadcast channels:",u.size);for(const[L,B]of u)console.log(lh(L,2))},ping:$=>{z(function*(){const q=P=>qf.make({message:`ping from ${e} via ${P}`,payload:$});for(const[P,x]of t)yield*ms(`sending ping via edge ${P}`),yield*x.channel.send(q(`edge ${P}`));for(const[P,x]of s){if(x.debugInfo===void 0){yield*ms(`channel ${P} has no debug info`);continue}yield*ms(`sending ping via channel ${P}`),yield*x.debugInfo.channel.send(q(`channel ${P}`))}}).pipe(In(_),wt,Do)},requestTopology:($=1e3)=>z(function*(){const q=wS.make({source:e,target:"-",hops:[]}),P=new Map;P.set(e,new Set(t.keys())),a.set(q.id,P),yield*h(q),yield*ms(`Waiting ${$}ms for topology response`),yield*tu($),yield*ms(`Topology response (from ${e}):`);for(const[x,L]of P)yield*ms(`  node '${x}' has edge to: ${Array.from(L.values()).join(", ")}`)}).pipe(In(_),wt,DP)}}}).pipe(Ie(`makeMeshNode:${e}`),$c({"makeMeshNode.nodeName":e})),Pie=e=>(...t)=>{const[n,r,s]=t;if(O_(n)){const{query:o,bindValues:a}=n.asSql();return e(o,a,r)}else return e(n,r,s)},Fie=e=>(...t)=>{const[n,r]=t;if(O_(n)){const{query:s,bindValues:o}=n.asSql(),a=a2(n),u=e(s,o);return SE(a)(u)}else return e(n,r)},z2=(e,{foreignKeys:t,lockingMode:n})=>zd(e,kt`
    -- disable WAL until we have it working properly
    -- PRAGMA journal_mode=WAL;
    PRAGMA page_size=8192;
    PRAGMA foreign_keys=${"ON"};
    ${n===void 0?"":kt`PRAGMA locking_mode=${n};`}
  `,{}),zd=(e,t,n)=>{const r=ea(n,t);return No({try:()=>e.execute(t,r),catch:s=>new pc({cause:s,query:{bindValues:r,sql:t},code:s.code})}).pipe(As,Ie("@livestore/common:execSql",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(r)}}))},Nie=(e,t,n)=>No({try:()=>e.execute(t,n),catch:r=>new pc({cause:r,query:{bindValues:n,sql:t},code:r.code})}).pipe(As,Ie("@livestore/common:execSqlPrepared",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(n)}})),xie=me("Skip",{}),Die=me("Blocking",{timeout:ve(bte,nt)});ve(xie,Die);class Bt extends nv("LeaderThreadCtx")(){}class Mie extends ve(_S,Ne){}const Lie=e=>z(function*(){if(e.enabled===!1)return;const{syncProcessor:t,extraIncomingMessagesQueue:n,clientId:r,storeId:s}=yield*Bt;yield*QC({incomingMessages:Co(n),sendMessage:()=>fe}).pipe(wt,Kt);const{node:o,persistenceInfo:a,mode:u}=yield*e.boot;yield*o.listenForChannel.pipe(Ns(f=>Cie.devtoolsClientLeader(f.channelName,{storeId:s,clientId:r})&&f.mode===u),vn(({channelName:f,source:h})=>z(function*(){const p=yield*o.makeChannel({target:h,channelName:f,schema:{listen:P2,send:wie},mode:u}),g=O=>p.send(O).pipe(Ie("@livestore/common:leader-thread:devtools:sendToDevtools"),Pt,Cd),k=yield*t.syncState,T=t.getMergeCounter();yield*t.pull({cursor:{mergeCounter:T,eventNum:k.localHead}}).pipe(vn(({payload:O})=>g(I2.make({payload:O,liveStoreVersion:P_}))),an,Kt),yield*QC({incomingMessages:p.listen.pipe(Ef(),pne),sendMessage:g,persistenceInfo:a})}).pipe(wt,Kt)),an)}).pipe(Ie("@livestore/common:leader-thread:devtools:boot")),QC=({incomingMessages:e,sendMessage:t,persistenceInfo:n})=>z(function*(){const{syncBackend:r,makeSqliteDb:s,dbState:o,dbEventlog:a,shutdownStateSubRef:u,shutdownChannel:f,syncProcessor:h,clientId:p,devtools:g}=yield*Bt,k=yield*xZ(),T=new Set;yield*e.pipe(vn(O=>z(function*(){const{requestId:M}=O,E={requestId:M,liveStoreVersion:P_,clientId:p};if(O._tag!=="LSD.Leader.Disconnect"&&!T.has(M))switch(T.add(M),O._tag){case"LSD.Leader.Ping":{yield*t(q2.make({...E}));return}case"LSD.Leader.SnapshotReq":{const S=o.export();yield*t(T2.make({snapshot:S,...E}));return}case"LSD.Leader.LoadDatabaseFile.Request":{const{data:S}=O;let _;try{const C=yield*s({_tag:"in-memory"});C.import(S);const $=C.select("select name from sqlite_master where type = 'table'");_=new Set($.map(q=>q.name)),C.close()}catch(C){yield*nu("Error importing database file",C),yield*t(gc.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}try{if(_.has(Ds))yield*Or(u,"shutting-down"),a.import(S),o.destroy();else if(_.has(q_)&&_.has(ip))yield*Or(u,"shutting-down"),o.import(S),a.destroy();else{yield*t(gc.Error.make({...E,cause:{_tag:"unsupported-database"}}));return}yield*t(gc.Success.make({...E})),yield*f.send(_S.make({reason:"devtools-import"}))??fe;return}catch(C){yield*nu("Error importing database file",C),yield*t(gc.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}}case"LSD.Leader.ResetAllData.Request":{const{mode:S}=O;yield*Or(u,"shutting-down"),o.destroy(),S==="all-data"&&a.destroy(),yield*t(u0.Success.make({...E})),yield*f.send(_S.make({reason:"devtools-reset"}))??fe;return}case"LSD.Leader.DatabaseFileInfoReq":{if(n===void 0){console.log("[@livestore/common:leader-thread:devtools] persistenceInfo is required for this request");return}const S="SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size();",_=o.select(S,void 0)[0].size,C=a.select(S,void 0)[0].size;yield*t(v2.make({state:{fileSize:_,persistenceInfo:n.state},eventlog:{fileSize:C,persistenceInfo:n.eventlog},...E}));return}case"LSD.Leader.EventlogReq":{const S=a.export();yield*t(O2.make({eventlog:S,...E}));return}case"LSD.Leader.CommitEventReq":{yield*h.pushPartial({event:O.eventEncoded,clientId:`devtools-${p}`,sessionId:`devtools-${p}`}),yield*t(R2.make({...E}));return}case"LSD.Leader.SyncHistorySubscribe":{const{subscriptionId:S}=O;r!==void 0&&(yield*r.pull(V()).pipe(wi(_=>_.batch),cne,vn(({eventEncoded:_,metadata:C})=>t($2.make({eventEncoded:_,metadata:C,subscriptionId:S,...E,requestId:ho(10)}))),an,Pt,wt,my(k,S)));return}case"LSD.Leader.SyncHistoryUnsubscribe":{const{requestId:S}=O;console.log("LSD.SyncHistoryUnsubscribe",S),yield*hy(k,S);return}case"LSD.Leader.SyncingInfoReq":{const S=E2.make({enabled:r!==void 0,metadata:(r==null?void 0:r.metadata)??{}});yield*t(k2.make({syncingInfo:S,...E}));return}case"LSD.Leader.NetworkStatusSubscribe":{if(r!==void 0){const{subscriptionId:S}=O;yield*tu(1e3),yield*wne(r.isConnected.changes,g.enabled?g.syncBackendLatchState.changes:lne({latchClosed:!1})).pipe(vn(([_,{latchClosed:C}])=>t(w2.make({networkStatus:{isConnected:_,timestampMs:Date.now(),latchClosed:C},subscriptionId:S,...E,requestId:ho(10)}))),an,Pt,wt,my(k,S))}return}case"LSD.Leader.NetworkStatusUnsubscribe":{const{requestId:S}=O;yield*hy(k,S);return}case"LSD.Leader.SyncHeadSubscribe":{const{subscriptionId:S}=O;yield*h.syncState.changes.pipe(vn(_=>t(C2.make({local:_.localHead,upstream:_.upstreamHead,subscriptionId:S,...E,requestId:ho(10)}))),an,Pt,wt,my(k,S));return}case"LSD.Leader.SyncHeadUnsubscribe":{const{subscriptionId:S}=O;yield*hy(k,S);return}case"LSD.Leader.SetSyncLatch.Request":{const{closeLatch:S}=O;if(g.enabled===!1)return;S===!0?yield*g.syncBackendLatch.close:yield*g.syncBackendLatch.open,yield*Or(g.syncBackendLatchState,{latchClosed:S}),yield*t(c0.Success.make({...E}));return}default:yield*to("TODO implement devtools message",O)}}).pipe(Ie(`@livestore/common:leader-thread:onDevtoolsMessage:${O._tag}`))),Ne.mapToUnexpectedErrorStream,an)}),B2=e=>Object.entries(e),jie=e=>[">","<","="].includes(e),H2=({tableName:e,columns:t,values:n,options:r={orReplace:!1}})=>[Uie({tableName:e,columns:t,options:{orReplace:r==null?void 0:r.orReplace,keys:Object.keys(n)}}),CS({columns:t,values:n})],Uie=({tableName:e,columns:t,options:n={orReplace:!1}})=>{const r=(n==null?void 0:n.keys)??Object.keys(t),s=r.join(", "),o=r.map(a=>`$${a}`).join(", ");return kt`INSERT ${n.orReplace?"OR REPLACE ":""}INTO ${e} (${s}) VALUES (${o})`},zie=({columns:e,tableName:t,updateValues:n,where:r})=>{const s=Hie(n);if(Object.keys(s).length===0)return[kt`select 1`,{}];const o=Object.keys(s).map(h=>`${h} = $update_${h}`).join(", "),a={...CS({columns:e,values:s,variablePrefix:"update_"}),...CS({columns:e,values:r,variablePrefix:"where_",skipNil:!0})},u=Bie({where:r}),f=u===""?"":`WHERE ${u}`;return[kt`UPDATE ${t} SET ${o} ${f}`,a]},CS=({columns:e,values:t,variablePrefix:n="",skipNil:r})=>{const s=w(e,B2,so(([o,a])=>[o,u=>{if(a.nullable===!0&&u==null)return null;const f=KN(a.schema)(u);if(f._tag==="Left"){const h=ql.formatErrorSync(f.left),p=String(a.schema.ast);console.error(`Error making bind values for SQL query for column "${o}".

Expected schema: ${p}

Error: ${h}

Value:`,u);debugger;throw f.left}else return f.right}]),Object.fromEntries);return w(Object.entries(t).filter(([,o])=>r!==!0||o!=null).flatMap(([o,a])=>{const u=s[o]??$e(`No codec found for column "${o}"`);if(typeof a=="object"&&a!==null&&"op"in a)switch(a.op){case"in":return a.val.map((f,h)=>[`${n}${o}_${h}`,u(f)]);case"=":case">":case"<":return[[`${n}${o}`,u(a.val)]];default:throw new Error(`Unknown op: ${a.op}`)}else return[[`${n}${o}`,u(a)]]}),Object.fromEntries)},Bie=({where:e})=>{const t=(n,r)=>r===null?"IS NULL":typeof r=="object"&&typeof r.op=="string"&&jie(r.op)?`${r.op} $where_${n}`:typeof r=="object"&&typeof r.op=="string"&&r.op==="in"?`in (${r.val.map((s,o)=>`$where_${n}_${o}`).join(", ")})`:`= $where_${n}`;return w(e,B2,so(([n,r])=>`${n} ${t(n,r)}`),Ta(" AND "))},Hie=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),Vie=e=>z(function*(){for(const t of qoe)yield*cp({db:e,behaviour:"create-if-not-exists",tableAst:t.sqliteDef.ast,skipMetaTable:!0});yield*zd(e,kt`INSERT INTO ${xf} (head)
          SELECT ${es.global}
          WHERE NOT EXISTS (SELECT 1 FROM ${xf})`,{})}),Wie=e=>z(function*(){const{dbEventlog:t,dbState:n}=yield*Bt,r=Nf.where("seqNumGlobal",">=",e.global).asSql(),s=t.select(r.query,ea(r.bindValues,r.query)),o=zm(Nf.rowSchema.pipe(xe))(s),a=ap.where("seqNumGlobal",">=",e.global).asSql(),u=n.select(a.query,ea(a.bindValues,a.query)),f=zm(ap.rowSchema.pipe(xe))(u);return o.map(h=>{const p=f.find(g=>g.seqNumGlobal===h.seqNumGlobal&&g.seqNumClient===h.seqNumClient);return On.make({name:h.name,args:h.argsJson,seqNum:{global:h.seqNumGlobal,client:h.seqNumClient},parentSeqNum:{global:h.parentSeqNumGlobal,client:h.parentSeqNumClient},clientId:h.clientId,sessionId:h.sessionId,meta:{sessionChangeset:p&&p.changeset!==null?{_tag:"sessionChangeset",data:p.changeset,debug:p.debug}:{_tag:"unset"},syncMetadata:h.syncMetadataJson,materializerHashLeader:V(),materializerHashSession:V()}})}).filter(h=>gS(h.seqNum,e)>0).sort((h,p)=>gS(h.seqNum,p.seqNum))}),V2=e=>{const t=e.select(kt`select seqNumGlobal, seqNumClient from ${Ds} order by seqNumGlobal DESC, seqNumClient DESC limit 1`)[0];return t?{global:t.seqNumGlobal,client:t.seqNumClient}:es},Kie=e=>{var t;return((t=e.select(kt`select head from ${xf}`)[0])==null?void 0:t.head)??es.global},Jie=(e,t)=>e.execute(kt`UPDATE ${xf} SET head = ${t.global}`),Gie=(e,t,n,r,s)=>z(function*(){xs&&e.parentSeqNum.global!==es.global&&t.select(`SELECT COUNT(*) as count FROM ${Ds} WHERE seqNumGlobal = ? AND seqNumClient = ?`,[e.parentSeqNum.global,e.parentSeqNum.client])[0].count===1===!1&&$e(`Parent mutation ${e.parentSeqNum.global},${e.parentSeqNum.client} does not exist`),yield*zd(t,...H2({tableName:Ds,columns:Nf.sqliteDef.columns,values:{seqNumGlobal:e.seqNum.global,seqNumClient:e.seqNum.client,parentSeqNumGlobal:e.parentSeqNum.global,parentSeqNumClient:e.parentSeqNum.client,name:e.name,argsJson:e.args??{},clientId:r,sessionId:s,schemaHash:n,syncMetadataJson:e.meta.syncMetadata}}))}),Qie=e=>z(function*(){const{dbEventlog:t}=yield*Bt;for(let n=0;n<e.length;n++){const r=e[n];yield*zd(t,...zie({tableName:Ds,columns:Nf.sqliteDef.columns,where:{seqNumGlobal:r.seqNum.global,seqNumClient:r.seqNum.client},updateValues:{syncMetadataJson:r.meta.syncMetadata}}))}}),Yie=e=>z(function*(){const{dbEventlog:t}=yield*Bt;if(e===es.global)return V();const n=Y({syncMetadataJson:Fs(Zi(Ro))}).pipe(au("syncMetadataJson"),xe,kte),r=yield*Te(()=>t.select(kt`SELECT syncMetadataJson FROM ${Ds} WHERE seqNumGlobal = ${e} ORDER BY seqNumClient ASC LIMIT 1`)).pipe(Jr(Bee(n)),Se(kL),Tr);return W({cursor:{global:e,client:mi},metadata:r})}).pipe(Ie("@livestore/common:eventlog:getSyncBackendCursorInfo",{attributes:{remoteHead:e}})),Xie=({schema:e,dbState:t,dbEventlog:n})=>z(function*(){const r=new Map([...e.eventsDefsMap.entries()].map(([s,o])=>[s,YE(o.schema)]));return(s,o)=>z(function*(){const a=(o==null?void 0:o.skipEventlog)??!1,u=s.name,{eventDef:f,materializer:h}=si(e,u),p=d2({eventDef:f,materializer:h,dbState:t,event:{decoded:void 0,encoded:s}}),g=E_()?W(Goe(p)):V();g._tag==="Some"&&s.meta.materializerHashSession._tag==="Some"&&s.meta.materializerHashSession.value!==g.value&&(yield*Ne.make({cause:`Materializer hash mismatch detected for event "${s.name}".`,note:"Please make sure your event materializer is a pure function without side effects."}));const k=t.session();for(const{statementSql:O,bindValues:M}of p)yield*Nie(t,O,M);const T=k.changeset();if(k.finish(),yield*zd(t,...H2({tableName:Pf,columns:ap.sqliteDef.columns,values:{seqNumGlobal:s.seqNum.global,seqNumClient:s.seqNum.client,changeset:T??null,debug:xs?p:null}})),a===!1){const O=s.name,M=r.get(O)??$e(`Unknown event definition: ${O}`);yield*Gie(s,n,M,s.clientId,s.sessionId)}return{sessionChangeset:T?{_tag:"sessionChangeset",data:T,debug:xs?p:null}:{_tag:"no-op"},hash:g}}).pipe(Ie("@livestore/common:leader-thread:materializeEvent",{attributes:{eventName:s.name,eventNum:s.seqNum,"span.label":`${pr(s.seqNum)} ${s.name}`}}))}),Zie=({dbState:e,dbEventlog:t,eventNumsToRollback:n})=>z(function*(){const r=e.select(kt`SELECT * FROM ${Pf} WHERE (seqNumGlobal, seqNumClient) IN (${n.map(o=>`(${o.global}, ${o.client})`).join(", ")})`).map(o=>({seqNum:{global:o.seqNumGlobal,client:o.seqNumClient},changeset:o.changeset,debug:o.debug})).toSorted((o,a)=>gS(o.seqNum,a.seqNum));for(let o=r.length-1;o>=0;o--){const{changeset:a}=r[o];a!==null&&e.makeChangeset(a).invert().apply()}const s=tj(100)(n.map(o=>`(${o.global}, ${o.client})`));for(const o of s)e.execute(kt`DELETE FROM ${Pf} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`);for(const o of s)t.execute(kt`DELETE FROM ${Ds} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`)}).pipe(Ie("@livestore/common:LeaderSyncProcessor:rollback",{attributes:{count:n.length}})),eae=({schema:e,dbEventlogMissing:t,dbEventlog:n,dbState:r,dbStateMissing:s,initialBlockingSyncContext:o,onError:a,params:u,testing:f})=>z(function*(){const h=yield*wC(),p=u.localPushBatchSize??10,g=u.backendPushBatchSize??50,k=yield*kf(void 0),T=G=>{const{eventDef:we}=si(e,G.name);return we.options.clientOnly},O=yield*oae,M={current:0},E={current:s?0:yield*iae(r)},S=new Map,_={current:void 0},C=yield*wC(),$=yield*Ab(!0),q=yield*Ab(!0),P={current:es},x=G=>{P.current=Zx(P.current,G)},L=(G,we)=>{var Re;return z(function*(){if(G.length===0)return;yield*aae(G,P.current),x(G.at(-1).seqNum);const Be=(we==null?void 0:we.waitForProcessing)??!1,Ze=M.current;if(Be){const He=yield*Sn(G,()=>Me()),Lt=G.map((An,Ju)=>[An,He[Ju],Ze]);yield*yl(C,Lt),yield*$d(He)}else{const He=G.map(Lt=>[Lt,void 0,Ze]);yield*yl(C,He)}}).pipe(Ie("@livestore/common:LeaderSyncProcessor:push",{attributes:{batchSize:G.length,batch:no?G:void 0},links:(Re=_.current)!=null&&Re.span?[{_tag:"SpanLink",span:_.current.span,attributes:{}}]:void 0}))},B=({event:{name:G,args:we},clientId:Re,sessionId:Be})=>z(function*(){const Ze=yield*k;if(Ze===void 0)return $e("Not initialized");const{eventDef:He}=si(e,G),Lt=new On({name:G,args:we,clientId:Re,sessionId:Be,...ZE(Ze.localHead,He.options.clientOnly)});yield*L([Lt])}).pipe(Fw("LeaderAheadError",Tr)),F=z(function*(){var is,Lo,N_;const G=yield*Bg.pipe(Tr),we=yield*VE.pipe(Mg(()=>Le(void 0))),{devtools:Re,shutdownChannel:Be}=yield*Bt,Ze=yield*xo();_.current={otelSpan:we,span:G,devtoolsLatch:Re.enabled?Re.syncBackendLatch:void 0,runtime:Ze};const He=t?es:V2(n),Lt=t?es.global:Kie(n);if(Lt>He.global)return $e(`During boot the backend head (${Lt}) should never be greater than the local head (${He.global})`);const An=t?[]:yield*Wie({global:Lt,client:mi}),Ju=new _s({pending:An,upstreamHead:{global:Lt,client:mi},localHead:He});if(yield*Or(k,Ju),An.length>0){const jr=An.filter(Ua=>{const{eventDef:as}=si(e,Ua.name);return as.options.clientOnly===!1});jr.length>0&&(yield*yl(h,jr))}const Gu=jr=>z(function*(){a==="shutdown"&&(yield*Be.send(Ne.make({cause:jr})),yield*li(jr))});yield*tae({localPushesLatch:$,localPushesQueue:C,pullLatch:q,syncStateSref:k,syncBackendPushQueue:h,schema:e,isClientEvent:T,otelSpan:we,currentLocalPushGenerationRef:M,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,localPushBatchSize:p,testing:{delay:(is=f==null?void 0:f.delays)==null?void 0:is.localPushProcessing}}).pipe(wt,ks(Gu),Kt);const Qu=yield*IN(),Hd=rae({syncBackendPushQueue:h,otelSpan:we,devtoolsLatch:(Lo=_.current)==null?void 0:Lo.devtoolsLatch,backendPushBatchSize:g}).pipe(wt,ks(Gu));return yield*Um(Qu,Hd),yield*nae({initialBackendHead:Lt,isClientEvent:T,restartBackendPushing:jr=>z(function*(){yield*qZ(Qu),yield*Ane(h),yield*yl(h,jr),yield*Um(Qu,Hd)}),syncStateSref:k,localPushesLatch:$,pullLatch:q,dbState:r,otelSpan:we,initialBlockingSyncContext:o,devtoolsLatch:(N_=_.current)==null?void 0:N_.devtoolsLatch,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,advancePushHead:x}).pipe(wt,ks(Gu),Kt),{initialLeaderHead:He}}).pipe(Id("@livestore/common:LeaderSyncProcessor:boot")),j=({cursor:G})=>z(function*(){const we=yield*Z({cursor:G});return Co(we)}).pipe(vx),Z=({cursor:G})=>{var Re;const we=((Re=_.current)==null?void 0:Re.runtime)??$e("Not initialized");return z(function*(){const Be=yield*O.makeQueue,Ze=Array.from(S.entries()).map(([He,Lt])=>({payload:Lt,mergeCounter:He})).filter(({mergeCounter:He})=>He>G.mergeCounter).toSorted((He,Lt)=>He.mergeCounter-Lt.mergeCounter).map(({payload:He,mergeCounter:Lt})=>He._tag==="upstream-advance"?{payload:{_tag:"upstream-advance",newEvents:GL(He.newEvents,An=>ka(G.eventNum,An.seqNum))},mergeCounter:Lt}:{payload:He,mergeCounter:Lt});return yield*Be.offerAll(Ze),Be}).pipe(In(we))},ye=w_({get:z(function*(){const G=yield*k;return G===void 0?$e("Not initialized"):G}),changes:k.changes.pipe(Ns(Px))});return{pull:j,pullQueue:Z,push:L,pushPartial:B,boot:F,syncState:ye,getMergeCounter:()=>E.current}}),tae=({localPushesLatch:e,localPushesQueue:t,pullLatch:n,syncStateSref:r,syncBackendPushQueue:s,schema:o,isClientEvent:a,otelSpan:u,currentLocalPushGenerationRef:f,connectedClientSessionPullQueues:h,mergeCounterRef:p,mergePayloads:g,localPushBatchSize:k,testing:T})=>z(function*(){for(;;){T.delay!==void 0&&(yield*T.delay.pipe(Ie("localPushProcessingDelay")));const O=yield*Ex(t,1,k);yield*e.await,yield*n.close;const M=O.filter(([P,x,L])=>L===f.current).map(([P,x])=>[P,x]);if(M.length===0){yield*n.open;continue}const[E,S]=XL(M),_=yield*r;if(_===void 0)return $e("Not initialized");const C=y2({syncState:_,payload:{_tag:"local-push",newEvents:E},isClientEvent:a,isEqualEvent:m2}),$=yield*K2(p);switch(C._tag){case"unexpected-error":return u==null||u.addEvent(`[${$}]:push:unexpected-error`,{batchSize:E.length,newEvents:no?JSON.stringify(E):void 0}),yield*zn(C.cause);case"rebase":return $e("The leader thread should never have to rebase due to a local push");case"reject":{u==null||u.addEvent(`[${$}]:push:reject`,{batchSize:E.length,mergeResult:no?JSON.stringify(C):void 0}),f.current++;const P=f.current,x=E.at(0).seqNum,L=yield*Pne(t,F=>F[2]>=P);if(xs&&(yield*EC(t))>0){console.log("localPushesQueue is not empty",yield*EC(t));debugger}const B=[...S,...L.map(([F,j])=>j)].filter(Px);yield*Sn(B,F=>jv(F,i0.make({minimumExpectedNum:C.expectedMinimumId,providedNum:x}))),yield*n.open;continue}case"advance":break;default:To(C)}yield*Or(r,C.newSyncState),yield*h.offer({payload:ta.make({newEvents:C.newEvents}),mergeCounter:$}),g.set($,ta.make({newEvents:C.newEvents})),u==null||u.addEvent(`[${$}]:push:advance`,{batchSize:E.length,mergeResult:no?JSON.stringify(C):void 0});const q=C.newEvents.filter(P=>{const{eventDef:x}=si(o,P.name);return x.options.clientOnly===!1});yield*yl(s,q),yield*W2({batchItems:C.newEvents,deferreds:S}),yield*n.open}}),W2=({batchItems:e,deferreds:t})=>z(function*(){const{dbState:n,dbEventlog:r,materializeEvent:s}=yield*Bt;n.execute("BEGIN TRANSACTION",void 0),r.execute("BEGIN TRANSACTION",void 0),yield*Zn(o=>z(function*(){Gc(o)||(n.execute("ROLLBACK",void 0),r.execute("ROLLBACK",void 0))}));for(let o=0;o<e.length;o++){const{sessionChangeset:a,hash:u}=yield*s(e[o]);e[o].meta.sessionChangeset=a,e[o].meta.materializerHashLeader=u,(t==null?void 0:t[o])!==void 0&&(yield*ut(t[o],void 0))}n.execute("COMMIT",void 0),r.execute("COMMIT",void 0)}).pipe(Qo,di,Ie("@livestore/common:LeaderSyncProcessor:materializeEventItems",{attributes:{batchSize:e.length}}),wt,Ne.mapToUnexpectedError),nae=({initialBackendHead:e,isClientEvent:t,restartBackendPushing:n,otelSpan:r,dbState:s,syncStateSref:o,localPushesLatch:a,pullLatch:u,devtoolsLatch:f,initialBlockingSyncContext:h,connectedClientSessionPullQueues:p,mergeCounterRef:g,mergePayloads:k,advancePushHead:T})=>z(function*(){const{syncBackend:O,dbState:M,dbEventlog:E,schema:S}=yield*Bt;if(O===void 0)return;const _=(q,P)=>z(function*(){if(q.length===0)return;f!==void 0&&(yield*f.await),yield*a.close,yield*u.await;const x=yield*o;if(x===void 0)return $e("Not initialized");const L=y2({syncState:x,payload:ta.make({newEvents:q}),isClientEvent:t,isEqualEvent:m2,ignoreClientEvents:!0}),B=yield*K2(g);if(L._tag==="reject")return $e("The leader thread should never reject upstream advances");if(L._tag==="unexpected-error")return r==null||r.addEvent(`[${B}]:pull:unexpected-error`,{newEventsCount:q.length,newEvents:no?JSON.stringify(q):void 0}),yield*zn(L.cause);const F=q.at(-1).seqNum;if(Jie(E,F),L._tag==="rebase"){r==null||r.addEvent(`[${B}]:pull:rebase`,{newEventsCount:q.length,newEvents:no?JSON.stringify(q):void 0,rollbackCount:L.rollbackEvents.length,mergeResult:no?JSON.stringify(L):void 0});const j=L.newSyncState.pending.filter(Z=>{const{eventDef:ye}=si(S,Z.name);return ye.options.clientOnly===!1});yield*n(j),L.rollbackEvents.length>0&&(yield*Zie({dbState:M,dbEventlog:E,eventNumsToRollback:L.rollbackEvents.map(Z=>Z.seqNum)})),yield*p.offer({payload:lp.make({newEvents:L.newEvents,rollbackEvents:L.rollbackEvents}),mergeCounter:B}),k.set(B,lp.make({newEvents:L.newEvents,rollbackEvents:L.rollbackEvents}))}else if(r==null||r.addEvent(`[${B}]:pull:advance`,{newEventsCount:q.length,mergeResult:no?JSON.stringify(L):void 0}),yield*p.offer({payload:ta.make({newEvents:L.newEvents}),mergeCounter:B}),k.set(B,ta.make({newEvents:L.newEvents})),L.confirmedEvents.length>0){const j=q.filter(Z=>L.confirmedEvents.some(ye=>I_(Z.seqNum,ye.seqNum)));yield*Qie(j)}sae(M,F),T(L.newSyncState.localHead),yield*W2({batchItems:L.newEvents,deferreds:void 0}),yield*Or(o,L.newSyncState),P===0&&(yield*a.open)}),C=yield*Yie(e),$=Joe({schema:S,dbState:s});yield*O.pull(C).pipe(vn(({batch:q,remaining:P})=>z(function*(){yield*$f(O.isConnected,x=>x===!0),yield*_(q.map(x=>On.fromGlobal(x.eventEncoded,{syncMetadata:x.metadata,materializerHashLeader:$(x.eventEncoded),materializerHashSession:V()})),P),yield*h.update({processed:q.length,remaining:P})})),an,Pt)}).pipe(Ie("@livestore/common:LeaderSyncProcessor:backend-pulling")),rae=({syncBackendPushQueue:e,otelSpan:t,devtoolsLatch:n,backendPushBatchSize:r})=>z(function*(){const{syncBackend:s}=yield*Bt;if(s!==void 0)for(;;){yield*$f(s.isConnected,u=>u===!0);const o=yield*Ex(e,1,r);yield*$f(s.isConnected,u=>u===!0),n!==void 0&&(yield*n.await),t==null||t.addEvent("backend-push",{batchSize:o.length,batch:no?JSON.stringify(o):void 0});const a=yield*s.push(o.map(u=>u.toGlobal())).pipe(Oi);if(a._tag==="Left")return xs&&(yield*ms("handled backend-push-error",{error:a.left.toString()})),t==null||t.addEvent("backend-push-error",{error:a.left.toString()}),yield*Pw}}).pipe(Pt,Ie("@livestore/common:LeaderSyncProcessor:backend-pushing")),sae=(e,t)=>{e.execute(kt`DELETE FROM ${Pf} WHERE seqNumGlobal < ${t.global}`)},oae=z(function*(){const e=new Set;return yield*Zn(()=>z(function*(){for(const r of e)yield*Dt(r);e.clear()})),{makeQueue:z(function*(){const r=yield*hn().pipe(it(Dt));return yield*Zn(()=>Te(()=>e.delete(r))),e.add(r),r}),offer:r=>z(function*(){if(!(r.payload._tag==="upstream-advance"&&r.payload.newEvents.length===0))for(const s of e)yield*Ye(s,r)})}}),K2=e=>z(function*(){const{dbState:t}=yield*Bt;return e.current++,t.execute(kt`INSERT OR REPLACE INTO ${r0} (id, mergeCounter) VALUES (0, ${e.current})`),e.current}),iae=e=>z(function*(){var n;return((n=e.select(kt`SELECT mergeCounter FROM ${r0} WHERE id = 0`)[0])==null?void 0:n.mergeCounter)??0}),aae=(e,t)=>z(function*(){if(e.length!==0){for(let n=1;n<e.length;n++)ka(e[n-1].seqNum,e[n].seqNum)&&$e(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.map(r=>pr(r.seqNum)).join(", ")}]`);if(ka(t,e[0].seqNum))return yield*i0.make({minimumExpectedNum:t,providedNum:e[0].seqNum})}}),cae=z(function*(){const{dbState:e,dbEventlog:t,schema:n,bootStatusQueue:r,materializeEvent:s}=yield*Bt,o=n.state.sqlite.migrations;let a;yield*Zn(Hg("recreateDb:finalizer")(function*(h){h._tag==="Failure"&&e.destroy()}));const u=e;yield*z2(u,{foreignKeys:!0});const f=h=>z(function*(){yield*fh(()=>{var g;return(g=h==null?void 0:h.init)==null?void 0:g.call(h,u)}).pipe(Ne.mapToUnexpectedError);const p=yield*xoe({db:u,schema:n,onProgress:({done:g,total:k})=>Ye(r,{stage:"migrating",progress:{done:g,total:k}})});return yield*fh(()=>{var g;return(g=h==null?void 0:h.pre)==null?void 0:g.call(h,u)}).pipe(Ne.mapToUnexpectedError),{migrationsReport:p,tmpDb:u}});switch(o.strategy){case"auto":{const h=o.hooks,p=yield*f(h);a=p.migrationsReport,yield*eie({dbEventlog:t,schema:n,materializeEvent:s,onProgress:({done:g,total:k})=>Ye(r,{stage:"rehydrating",progress:{done:g,total:k}})}),yield*fh(()=>{var g;return(g=h==null?void 0:h.post)==null?void 0:g.call(h,p.tmpDb)}).pipe(Ne.mapToUnexpectedError);break}case"manual":{const h=e.export();a={migrations:[]};const p=yield*fh(()=>o.migrate(h)).pipe(Ne.mapToUnexpectedError);u.import(p);break}default:To(o)}return{migrationsReport:a}}).pipe(di,Ie("@livestore/common:leader-thread:recreateDb"),WE("@livestore/common:leader-thread:recreateDb")),uae=({schema:e,storeId:t,clientId:n,syncPayload:r,makeSqliteDb:s,syncOptions:o,dbState:a,dbEventlog:u,devtoolsOptions:f,shutdownChannel:h,params:p,testing:g})=>z(function*(){var x;const k=yield*hn().pipe(it(Dt)),T=u.select(kt`select count(*) as count from sqlite_master`)[0].count===0,O=a.select(kt`select count(*) as count from sqlite_master`)[0].count===0,M=(o==null?void 0:o.backend)===void 0?void 0:yield*o.backend({storeId:t,clientId:n,payload:r});M!==void 0&&(yield*M.connect.pipe(wt,Kt));const E=yield*lae({initialSyncOptions:(o==null?void 0:o.initialSyncOptions)??{_tag:"Skip"},bootStatusQueue:k}),S=yield*eae({schema:e,dbEventlogMissing:T,dbEventlog:u,dbState:a,dbStateMissing:O,initialBlockingSyncContext:E,onError:(o==null?void 0:o.onSyncError)??"ignore",params:{localPushBatchSize:p==null?void 0:p.localPushBatchSize,backendPushBatchSize:p==null?void 0:p.backendPushBatchSize},testing:{delays:(x=g==null?void 0:g.syncProcessor)==null?void 0:x.delays}}),_=yield*hn().pipe(it(Dt)),C=f.enabled?{enabled:!0,syncBackendLatch:yield*Ab(!0),syncBackendLatchState:yield*kf({latchClosed:!1})}:{enabled:!1},$=yield*Xie({schema:e,dbState:a,dbEventlog:u}),q={schema:e,bootStatusQueue:k,storeId:t,clientId:n,dbState:a,dbEventlog:u,makeSqliteDb:s,eventSchema:Zoe(e),shutdownStateSubRef:yield*kf("running"),shutdownChannel:h,syncBackend:M,syncProcessor:S,materializeEvent:$,extraIncomingMessagesQueue:_,devtools:C,initialState:{}};globalThis.__leaderThreadCtx=q;const P=zw(Bt,q);return q.initialState=yield*fae({dbStateMissing:O,initialBlockingSyncContext:E,devtoolsOptions:f}).pipe(In(P)),P}).pipe(Ie("@livestore/common:leader-thread:boot"),Id("@livestore/common:leader-thread"),Ne.mapToUnexpectedError,wt,Hw),lae=({initialSyncOptions:e,bootStatusQueue:t})=>z(function*(){const n={isDone:!1,processedEvents:0,total:-1},r=e._tag==="Blocking"?yield*Me():void 0;return r!==void 0&&e._tag==="Blocking"&&(yield*ut(r,void 0).pipe(d9(e.timeout),Kt)),{blockingDeferred:r,update:({processed:s,remaining:o})=>z(function*(){n.isDone!==!0&&(n.total===-1&&(n.total=o+s),n.processedEvents+=s,yield*Ye(t,{stage:"syncing",progress:{done:n.processedEvents,total:n.total}}),o===0&&r!==void 0&&(yield*ut(r,void 0),n.isDone=!0))})}}),fae=({dbStateMissing:e,initialBlockingSyncContext:t,devtoolsOptions:n})=>z(function*(){const{dbEventlog:r,bootStatusQueue:s,syncProcessor:o}=yield*Bt;yield*Vie(r);const{migrationsReport:a}=e?yield*cae:{migrationsReport:{migrations:[]}},{initialLeaderHead:u}=yield*o.boot;return t.blockingDeferred!==void 0&&(yield*Ye(s,{stage:"syncing",progress:{done:0,total:-1}}),yield*t.blockingDeferred.pipe(Ie("@livestore/common:leader-thread:initial-sync-blocking"))),yield*Ye(s,{stage:"done"}),yield*Lie(n).pipe(wt,Kt),{migrationsReport:a,leaderHead:u}});let f0=class extends xn()("DevtoolsWebCommon.CreateConnection",{payload:{from:D,port:C_},success:Y({}),failure:p_}){};class jce extends ve(f0){}const hp=class hp extends nv("@livestore/devtools-web-common:CacheService")(){};d(hp,"layer",({nodeName:t})=>z(function*(){const n=yield*Aie(t);return globalThis.__debugWebmeshNode=n,{node:n}}).pipe(L9(hp)));let Mf=hp;const dae=({from:e,port:t})=>sne(n=>z(function*(){const{node:r}=yield*Mf,s=yield*Qse({port:t,schema:U2});yield*r.addEdge({target:e,edgeChannel:s,replaceIfExists:!0}),xs&&(yield*ms(`@livestore/devtools-web-common: accepted edge: ${r.nodeName} ← ${e}`)),n.single({}),yield*Kn({connectedTo:[...r.edgeKeys]})}).pipe(Tr)).pipe(vne(`@livestore/devtools-web-common:worker:create-connection:${e}`)),re=0,hae=1,Lf=10,d0=12,Bd=14,Ho=21,Oy=25,mae=27,TS=100,pae=101,F_=522,J2=778,YC=2,fp=4,IS=8,G2=64,gae=256,_ae=2048,yae=16384,bae=524288,Sae=2048,XC=1,ZC=2,eT=3,tT=4,nT=5,vae=512;class Q2{constructor(t,n){d(this,"name");d(this,"mxPathname",64);d(this,"_module");this.name=t,this._module=n}close(){}isReady(){return!0}hasAsyncMethod(t){return!1}xOpen(t,n,r,s,o){return Bd}xDelete(t,n,r){return re}xAccess(t,n,r,s){return re}xFullPathname(t,n,r,s){return re}xGetLastError(t,n,r){return re}xClose(t){return re}xRead(t,n,r,s,o){return re}xWrite(t,n,r,s,o){return re}xTruncate(t,n,r){return re}xSync(t,n){return re}xFileSize(t,n){return re}xLock(t,n){return re}xUnlock(t,n){return re}xCheckReservedLock(t,n){return re}xFileControl(t,n,r){return d0}xSectorSize(t){return vae}xDeviceCharacteristics(t){return 0}}const wae=Object.getPrototypeOf(async function(){}).constructor;var qr,vl,RS,Y2,s1;let Eae=(s1=class extends Q2{constructor(n,r){super(n,r);Br(this,qr)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof wae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return Bd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?Lf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),F_}jWrite(n,r,s){return J2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return d0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=et(this,qr,Y2).call(this,r,o),f=et(this,qr,vl).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=et(this,qr,vl).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=et(this,qr,RS).call(this,r,s),f=qy(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=et(this,qr,RS).call(this,r,s),f=qy(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=qy(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=et(this,qr,vl).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=et(this,qr,vl).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}},qr=new WeakSet,vl=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&p.match(/^(get)|(set)/))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},RS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},Y2=function(n,r){if(r&G2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:a.push(63),o=2;break;case 2:a.push(61),o=3;break;case 3:a.push(38),o=2;break}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null},s1);function qy(e,t){return t*4294967296+e+(e<0?2**32:0)}class h0 extends Eae{constructor(n,r){super(n,r);d(this,"mapNameToFile",new Map);d(this,"mapIdToFile",new Map)}static async create(n,r){const s=new h0(n,r);return await s.isReady(),s}close(){for(const n of this.mapIdToFile.keys())this.jClose(n)}jOpen(n,r,s,o){const u=new URL(n||Math.random().toString(36).slice(2),"file://").pathname;let f=this.mapNameToFile.get(u);if(!f)if(s&fp)f={pathname:u,flags:s,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(u,f);else return Bd;return this.mapIdToFile.set(r,f),o.setInt32(0,s,!0),re}jClose(n){const r=this.mapIdToFile.get(n);return this.mapIdToFile.delete(n),r.flags&IS&&this.mapNameToFile.delete(r.pathname),re}jRead(n,r,s){const o=this.mapIdToFile.get(n),a=Math.min(s,o.size),f=Math.min(s+r.byteLength,o.size)-a;return f&&r.set(new Uint8Array(o.data,a,f)),f<r.byteLength?(r.fill(0,f),F_):re}jWrite(n,r,s){const o=this.mapIdToFile.get(n);if(s+r.byteLength>o.data.byteLength){const a=Math.max(s+r.byteLength,2*o.data.byteLength),u=new ArrayBuffer(a);new Uint8Array(u).set(new Uint8Array(o.data,0,o.size)),o.data=u}return new Uint8Array(o.data,s,r.byteLength).set(r),o.size=Math.max(o.size,s+r.byteLength),re}jTruncate(n,r){const s=this.mapIdToFile.get(n);return s.size=Math.min(s.size,r),re}jFileSize(n,r){const s=this.mapIdToFile.get(n);return r.setBigInt64(0,BigInt(s.size),!0),re}jDelete(n,r){const o=new URL(n,"file://").pathname;return this.mapNameToFile.delete(o),re}jAccess(n,r,s){const a=new URL(n,"file://").pathname,u=this.mapNameToFile.get(a);return s.setInt32(0,u?1:0,!0),re}}let rT;const X2=e=>{if(e.vfs_registered.has("memory-vfs")===!1){const r=new h0("memory-vfs",e.module);e.vfs_register(r,!1),rT=r}return{dbPointer:e.open_v2Sync(":memory:",void 0,"memory-vfs"),vfs:rT}},sT=({sqlite3:e,metadata:t})=>{const n=[],{dbPointer:r}=t;let s=!1;const o={_tag:"SqliteDb",metadata:t,prepare:a=>{try{const u=e.statements(r,a.trim(),{unscoped:!0});let f=!1;const h={execute:(p,g)=>{for(const k of u){p!==void 0&&Object.keys(p).length>0&&e.bind_collection(k,p);try{e.step(k)}finally{g!=null&&g.onRowsChanged&&g.onRowsChanged(e.changes(r)),e.reset(k)}}},select:p=>{if(u.length!==1)throw new pc({query:{bindValues:p,sql:a},code:-1,cause:"Expected only one statement when using `select`"});const g=u[0];p!==void 0&&Object.keys(p).length>0&&e.bind_collection(g,p);const k=[];try{let T;try{T=e.column_names(g)}catch{}for(;e.step(g)===TS;)if(T!==void 0){const O={};for(let M=0;M<T.length;M++)O[T[M]]=e.column(g,M);k.push(O)}}catch(T){throw new pc({query:{bindValues:p,sql:a},code:T.code,cause:T})}finally{e.reset(g)}return k},finalize:()=>{if(!f){f=!0;for(const p of u)e.finalize(p)}},sql:a};return n.push(h),h}catch(u){throw new pc({query:{sql:a,bindValues:{}},code:u.code,cause:u})}},export:()=>e.serialize(r,"main"),execute:Pie((a,u,f)=>{const h=o.prepare(a);h.execute(u,f),h.finalize()}),select:Fie((a,u)=>{const f=o.prepare(a),h=f.select(u);return f.finalize(),h}),destroy:()=>{o.close(),t.deleteDb()},close:()=>{if(!s){for(const a of n)a.finalize();e.close(r),s=!0}},import:a=>{if(a instanceof Uint8Array){const h=X2(e);e.deserialize(h.dbPointer,"main",a,a.length,a.length,3),e.backup(r,"main",h.dbPointer,"main"),e.close(h.dbPointer)}else e.backup(r,"main",a.metadata.dbPointer,"main");t.configureDb(o)},session:()=>{const a=e.session_create(r,"main");return e.session_attach(a,null),{changeset:()=>e.session_changeset(a).changeset??void 0,finish:()=>{e.session_delete(a)}}},makeChangeset:a=>({invert:()=>{const f=e.changeset_invert(a);return o.makeChangeset(f)},apply:()=>{try{e.changeset_apply(r,a),a=void 0}catch(f){throw new pc({code:f.code??-1,cause:f,note:"Failed calling makeChangeset.apply"})}}})};return t.configureDb(o),o},kae=Object.getPrototypeOf(async()=>{}).constructor;var Ar,wl,OS,Z2;class $ae extends Q2{constructor(n,r){super(n,r);Br(this,Ar)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof kae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return Bd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?Lf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),F_}jWrite(n,r,s){return J2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return d0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=et(this,Ar,Z2).call(this,r,o),f=et(this,Ar,wl).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=et(this,Ar,wl).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=et(this,Ar,OS).call(this,r,s),f=Ay(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=et(this,Ar,OS).call(this,r,s),f=Ay(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=Ay(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=et(this,Ar,wl).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=et(this,Ar,wl).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}}Ar=new WeakSet,wl=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&/^(get)|(set)/.test(p))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},OS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},Z2=function(n,r){if(r&G2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:{a.push(63),o=2;break}case 2:{a.push(61),o=3;break}case 3:{a.push(38),o=2;break}}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null};function Ay(e,t){return t*4294967296+e+(e<0?2**32:0)}const e3=4096,m0=512,Cae=4,Tae=8,qS=m0+Cae,oT=m0,iT=qS,Ii=e3,Iae=gae|_ae|yae|bae,Rae=6;var Uf,Jo,Vr,ir,fs,Wr,vt,t3,n3,r3,ac,PS,cc,FS;const v0=class v0 extends $ae{constructor(n,r,s){super(n,s);Br(this,vt);d(this,"log",null);Br(this,Uf);Br(this,Jo);Br(this,Vr,new Map);Br(this,ir,new Map);Br(this,fs,new Set);Br(this,Wr,new Map);Jd(this,Uf,r)}static async create(n,r,s){const o=new v0(n,r,s);return await o.isReady(),o}getOpfsFileName(n){const r=et(this,vt,cc).call(this,n),s=Ae(this,ir).get(r);return Ae(this,Vr).get(s)}resetAccessHandle(n){const r=et(this,vt,cc).call(this,n);Ae(this,ir).get(r).truncate(Ii)}jOpen(n,r,s,o){try{const a=n?et(this,vt,cc).call(this,n):Math.random().toString(36);let u=Ae(this,ir).get(a);if(!u&&s&fp)if(this.getSize()<this.getCapacity())[u]=Ae(this,fs).keys(),et(this,vt,ac).call(this,u,a,s);else throw new Error("cannot create file");if(!u)throw new Error("file not found");const f={path:a,flags:s,accessHandle:u};return Ae(this,Wr).set(r,f),o.setInt32(0,s,!0),re}catch(a){return console.error(a.message),Bd}}jClose(n){const r=Ae(this,Wr).get(n);return r&&(r.accessHandle.flush(),Ae(this,Wr).delete(n),r.flags&IS&&et(this,vt,FS).call(this,r.path)),re}jRead(n,r,s){const a=Ae(this,Wr).get(n).accessHandle.read(r.subarray(),{at:Ii+s});return a<r.byteLength?(r.fill(0,a,r.byteLength),F_):re}jWrite(n,r,s){return Ae(this,Wr).get(n).accessHandle.write(r.subarray(),{at:Ii+s})===r.byteLength?re:Lf}jTruncate(n,r){return Ae(this,Wr).get(n).accessHandle.truncate(Ii+r),re}jSync(n,r){return Ae(this,Wr).get(n).accessHandle.flush(),re}jFileSize(n,r){const o=Ae(this,Wr).get(n).accessHandle.getSize()-Ii;return r.setBigInt64(0,BigInt(o),!0),re}jSectorSize(n){return e3}jDeviceCharacteristics(n){return Sae}jAccess(n,r,s){const o=et(this,vt,cc).call(this,n);return s.setInt32(0,Ae(this,ir).has(o)?1:0,!0),re}jDelete(n,r){const s=et(this,vt,cc).call(this,n);return et(this,vt,FS).call(this,s),re}async close(){et(this,vt,n3).call(this)}async isReady(){if(!Ae(this,Jo)){let n=await navigator.storage.getDirectory();for(const r of Ae(this,Uf).split("/"))r&&(n=await n.getDirectoryHandle(r,{create:!0}));Jd(this,Jo,n),await et(this,vt,t3).call(this),this.getCapacity()===0&&await this.addCapacity(Rae)}return!0}getSize(){return Ae(this,ir).size}getCapacity(){return Ae(this,Vr).size}async addCapacity(n){for(let r=0;r<n;++r){const s=Math.random().toString(36).replace("0.",""),a=await(await Ae(this,Jo).getFileHandle(s,{create:!0})).createSyncAccessHandle();Ae(this,Vr).set(a,s),et(this,vt,ac).call(this,a,"",0)}return n}async removeCapacity(n){let r=0;for(const s of Array.from(Ae(this,fs))){if(r==n||this.getSize()===this.getCapacity())return r;const o=Ae(this,Vr).get(s);s.close(),await Ae(this,Jo).removeEntry(o),Ae(this,Vr).delete(s),Ae(this,fs).delete(s),++r}return r}};Uf=new WeakMap,Jo=new WeakMap,Vr=new WeakMap,ir=new WeakMap,fs=new WeakMap,Wr=new WeakMap,vt=new WeakSet,t3=async function(){const n=[];for await(const[r,s]of Ae(this,Jo))s.kind==="file"&&n.push([r,s]);await Promise.all(n.map(async([r,s])=>{const o=await s.createSyncAccessHandle();Ae(this,Vr).set(o,r);const a=et(this,vt,r3).call(this,o);a?Ae(this,ir).set(a,o):Ae(this,fs).add(o)}))},n3=function(){for(const n of Ae(this,Vr).keys())n.close();Ae(this,Vr).clear(),Ae(this,ir).clear(),Ae(this,fs).clear()},r3=function(n){const r=new Uint8Array(qS);n.read(r,{at:0});const o=new DataView(r.buffer,r.byteOffset).getUint32(oT);if(r[0]&&(o&IS||(o&Iae)===0))return console.warn(`Remove file with unexpected flags ${o.toString(16)}`),et(this,vt,ac).call(this,n,"",0),"";const a=new Uint32Array(Tae/4);n.read(a,{at:iT});const u=et(this,vt,PS).call(this,r);if(a.every((f,h)=>f===u[h])){const f=r.indexOf(0);return f===0&&n.truncate(Ii),new TextDecoder().decode(r.subarray(0,f))}else return console.warn("Disassociating file with bad digest."),et(this,vt,ac).call(this,n,"",0),""},ac=function(n,r,s){const o=new Uint8Array(qS);if(new TextEncoder().encodeInto(r,o).written>=m0)throw new Error("path too long");new DataView(o.buffer,o.byteOffset).setUint32(oT,s);const f=et(this,vt,PS).call(this,o);n.write(o,{at:0}),n.write(f,{at:iT}),n.flush(),r?(Ae(this,ir).set(r,n),Ae(this,fs).delete(n)):(n.truncate(Ii),Ae(this,fs).add(n))},PS=function(n){if(!n[0])return new Uint32Array([4274806656,2899230775]);let r=3735928559,s=1103547991;for(const o of n)r=Math.imul(r^o,2654435761),s=Math.imul(s^o,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),new Uint32Array([r>>>0,s>>>0])},cc=function(n){return(typeof n=="string"?new URL(n,"file://localhost/"):n).pathname},FS=function(n){const r=Ae(this,ir).get(n);r&&(Ae(this,ir).delete(n),et(this,vt,ac).call(this,r,"",0))};let AS=v0;const Oae=zg(1).pipe($s),aT=new Map,qae=({sqlite3:e,directory:t,fileName:n})=>z(function*(){const r=t.replaceAll(/["*/:<>?\\|]/g,"_"),o=`opfs${r.length===0?"":`-${r}`}`;if(e.vfs_registered.has(o)===!1){const f=yield*Dg(()=>AS.create(o,t,e.module));e.vfs_register(f,!1),aT.set(o,f)}const a=e.open_v2Sync(n,void 0,o),u=aT.get(o);return{dbPointer:a,vfs:u}}).pipe(Oae.withPermits(1));new TextDecoder;const Aae=({sqlite3:e})=>t=>z(function*(){if(t._tag==="in-memory"){const{dbPointer:a,vfs:u}=X2(e);return sT({sqlite3:e,metadata:{_tag:"in-memory",vfs:u,dbPointer:a,deleteDb:()=>{},configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:":memory:"}}})}const n=60;let r=t.fileName;t.fileName.length>n&&(yield*to(`dbFilename too long: '${t.fileName}'. Max ${n} chars, got ${t.fileName.length}. Hashing...`),r=`hash-${Tt(t.fileName)}.db`);const{dbPointer:s,vfs:o}=yield*qae({sqlite3:e,directory:t.opfsDirectory,fileName:r});return sT({sqlite3:e,metadata:{_tag:"opfs",vfs:o,dbPointer:s,deleteDb:()=>o.resetAccessHandle(t.fileName),configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:r,opfsDirectory:t.opfsDirectory,opfsFileName:o.getOpfsFileName(r)}}})}),cT=0x7fffffffffffffffn,uT=-0x8000000000000000n;class vr extends Error{constructor(t,n){super(t),this.code=n}}const ec=!1;function Pae(e){const t={};e.retryOps=[];const n=e._getSqliteFree(),r=e._malloc(8),s=[r,r+4];function o(E){if(typeof E!="string")return 0;const S=new TextEncoder().encode(E),_=e._sqlite3_malloc(S.byteLength+1);return e.HEAPU8.set(S,_),e.HEAPU8[_+S.byteLength]=0,_}function a(E,S){return BigInt(S)<<32n|BigInt(E)&0xffffffffn}const u=function(){const E=BigInt(Number.MAX_SAFE_INTEGER)>>32n,S=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(_,C){return C>E||C<S?a(_,C):C*4294967296+(_&2147483647)-(_&2147483648)}}(),f=new Set;function h(E){if(!f.has(E))throw new vr("not a database",Ho)}const p=new Map;function g(E){if(!p.has(E))throw new vr("not a statement",Ho)}t.bind_collection=function(E,S){g(E);const _=Array.isArray(S),C=t.bind_parameter_count(E);for(let $=1;$<=C;++$){const q=_?$-1:t.bind_parameter_name(E,$),P=S[q];P!==void 0&&t.bind(E,$,P)}return re},t.bind=function(E,S,_){switch(g(E),typeof _){case"number":return _===(_|0)?t.bind_int(E,S,_):t.bind_double(E,S,_);case"string":return t.bind_text(E,S,_);default:return _ instanceof Uint8Array||Array.isArray(_)?t.bind_blob(E,S,_):_===null?t.bind_null(E,S):typeof _=="bigint"?t.bind_int64(E,S,_):_===void 0?mae:(console.warn("unknown binding converted to null",_),t.bind_null(E,S))}},t.bind_blob=function(){const E="sqlite3_bind_blob",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=$.byteLength??$.length,P=e._sqlite3_malloc(q);e.HEAPU8.subarray(P).set($);const x=S(_,C,P,q,n);return O(E,x,p.get(_))}}(),t.bind_parameter_count=function(){const S=e.cwrap("sqlite3_bind_parameter_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.bind_double=function(){const E="sqlite3_bind_double",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){g(_);const q=S(_,C,$);return O(E,q,p.get(_))}}(),t.bind_int=function(){const E="sqlite3_bind_int",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){if(g(_),$>2147483647||$<-2147483648)return Oy;const q=S(_,C,$);return O(E,q,p.get(_))}}(),t.bind_int64=function(){const E="sqlite3_bind_int64",S=e.cwrap(E,...se("nnnn:n"));return function(_,C,$){if(g(_),$>cT||$<uT)return Oy;const q=$&0xffffffffn,P=$>>32n,x=S(_,C,Number(q),Number(P));return O(E,x,p.get(_))}}(),t.bind_null=function(){const E="sqlite3_bind_null",S=e.cwrap(E,...se("nn:n"));return function(_,C){g(_);const $=S(_,C);return O(E,$,p.get(_))}}(),t.bind_parameter_name=function(){const S=e.cwrap("sqlite3_bind_parameter_name",...se("n:s"));return function(_,C){return g(_),S(_,C)}}(),t.bind_text=function(){const E="sqlite3_bind_text",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=o($),P=S(_,C,q,-1,n);return O(E,P,p.get(_))}}(),t.changes=function(){const S=e.cwrap("sqlite3_changes",...se("n:n"));return function(_){return h(_),S(_)}}(),t.deserialize=function(){const S=e.cwrap("sqlite3_deserialize",...se("nnnnnn:n"));return function(_,C,$,q,P,x){h(_);const L=e._sqlite3_malloc(q);return e.HEAPU8.subarray(L).set($),S(_,C,L,q,P,x)}}();const k=1;t.serialize=function(){const S=e.cwrap("sqlite3_serialize",...se("nsnn:n"));return function(_,C){h(_);const $=s[0];let q=S(_,C,$,0);if(q===0){q=S(_,C,$,k);const P=e.getValue($,"*"),x=e.HEAPU8.subarray(q,q+P);return new Uint8Array(x.slice())}else{const P=e.getValue($,"*"),x=e.HEAPU8.subarray(q,q+P);return new Uint8Array(x)}}}(),t.backup=function(){const E=e.cwrap("sqlite3_backup_init",...se("nsns:n")),S=e.cwrap("sqlite3_backup_step",...se("nn:n")),_=e.cwrap("sqlite3_backup_finish",...se("n:n"));return function(C,$,q,P){h(C),h(q);const x=E(C,$,q,P);if(x===0){const L=e.ccall("sqlite3_errmsg","string",["number"],[C]);throw new vr(`backup failed: ${L}`,hae)}return S(x,-1),_(x)}}(),t.clear_bindings=function(){const E="sqlite3_clear_bindings",S=e.cwrap(E,...se("n:n"));return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}}(),t.close=function(){const E="sqlite3_close",S=e.cwrap(E,...se("n:n"),{async:ec});return function(_){h(_);const C=S(_);return f.delete(_),O(E,C,_)}}(),t.column=function(E,S){g(E);const _=t.column_type(E,S);switch(_){case tT:return t.column_blob(E,S);case ZC:return t.column_double(E,S);case XC:const C=t.column_int(E,S),$=e.getTempRet0();return u(C,$);case nT:return null;case eT:return t.column_text(E,S);default:throw new vr("unknown type",_)}},t.column_blob=function(){const S=e.cwrap("sqlite3_column_blob",...se("nn:n"));return function(_,C){g(_);const $=t.column_bytes(_,C),q=S(_,C);if(q===0)return null;const P=e.HEAPU8.subarray(q,q+$);return new Uint8Array(P)}}(),t.column_bytes=function(){const S=e.cwrap("sqlite3_column_bytes",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_count=function(){const S=e.cwrap("sqlite3_column_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.column_double=function(){const S=e.cwrap("sqlite3_column_double",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_int=function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_int64=function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){g(_);const $=S(_,C),q=e.getTempRet0();return a($,q)}}(),t.column_name=function(){const S=e.cwrap("sqlite3_column_name",...se("nn:s"));return function(_,C){return g(_),S(_,C)}}(),t.column_names=function(E){const S=[],_=t.column_count(E);for(let C=0;C<_;++C)S.push(t.column_name(E,C));return S},t.column_text=function(){const S=e.cwrap("sqlite3_column_text",...se("nn:s"));return function(_,C){return g(_),S(_,C)}}(),t.column_type=function(){const S=e.cwrap("sqlite3_column_type",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.create_function=function(E,S,_,C,$,q,P,x){h(E);function L(F){return(j,Z,ye)=>F(j,e.HEAP32.subarray(ye/4,ye/4+Z))}const B=e.create_function(E,S,_,C,$,q&&L(q),P&&L(P),x);return O("sqlite3_create_function",B,E)},t.data_count=function(){const S=e.cwrap("sqlite3_data_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.exec=function(E,S,_){const C=t.statements(E,S,{unscoped:!0});for(const $ of C){let q;for(;t.step($)===TS;)if(_){q=q??t.column_names($);const P=t.row($);_(P,q),_(P,q)}}for(const $ of C)t.finalize($);return re},t.finalize=function(){const S=e.cwrap("sqlite3_finalize",...se("n:n"),{async:ec});return function(_){const C=S(_);return p.delete(_),C}}(),t.get_autocommit=function(){const S=e.cwrap("sqlite3_get_autocommit",...se("n:n"));return function(_){return S(_)}}(),t.libversion=function(){const S=e.cwrap("sqlite3_libversion",...se(":s"));return function(){return S()}}(),t.libversion_number=function(){const S=e.cwrap("sqlite3_libversion_number",...se(":n"));return function(){return S()}}(),t.limit=function(){const S=e.cwrap("sqlite3_limit",...se("nnn:n"));return function(_,C,$){return S(_,C,$)}}(),t.open_v2=function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:ec});return async function(_,C,$){C=C||fp|YC,$=o($);try{const q=await M(()=>S(_,s[0],C,$)),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}}(),t.open_v2Sync=function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:ec});return function(_,C,$){C=C||fp|YC,$=o($);try{const q=S(_,s[0],C,$),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}}(),t.progress_handler=function(E,S,_,C){h(E),e.progress_handler(E,S,_,C)},t.reset=function(){const E="sqlite3_reset",S=e.cwrap(E,...se("n:n"),{async:ec});return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}}(),t.result=function(E,S){switch(typeof S){case"number":S===(S|0)?t.result_int(E,S):t.result_double(E,S);break;case"string":t.result_text(E,S);break;default:if(S instanceof Uint8Array||Array.isArray(S))t.result_blob(E,S);else if(S===null)t.result_null(E);else{if(typeof S=="bigint")return t.result_int64(E,S);console.warn("unknown result converted to null",S),t.result_null(E)}break}},t.result_blob=function(){const S=e.cwrap("sqlite3_result_blob",...se("nnnn:n"));return function(_,C){const $=C.byteLength??C.length,q=e._sqlite3_malloc($);e.HEAPU8.subarray(q).set(C),S(_,q,$,n)}}(),t.result_double=function(){const S=e.cwrap("sqlite3_result_double",...se("nn:n"));return function(_,C){S(_,C)}}(),t.result_int=function(){const S=e.cwrap("sqlite3_result_int",...se("nn:n"));return function(_,C){S(_,C)}}(),t.result_int64=function(){const S=e.cwrap("sqlite3_result_int64",...se("nnn:n"));return function(_,C){if(C>cT||C<uT)return Oy;const $=C&0xffffffffn,q=C>>32n;S(_,Number($),Number(q))}}(),t.result_null=function(){const S=e.cwrap("sqlite3_result_null",...se("n:n"));return function(_){S(_)}}(),t.result_text=function(){const S=e.cwrap("sqlite3_result_text",...se("nnnn:n"));return function(_,C){const $=o(C);S(_,$,-1,n)}}(),t.row=function(E){const S=[],_=t.data_count(E);for(let C=0;C<_;++C){const $=t.column(E,C);S.push(($==null?void 0:$.buffer)===e.HEAPU8.buffer?$.slice():$)}return S},t.set_authorizer=function(E,S,_){h(E);function C(P,x,L,B,F,j){return[P,x,e.UTF8ToString(L),e.UTF8ToString(B),e.UTF8ToString(F),e.UTF8ToString(j)]}function $(P){return(x,L,B,F,j,Z)=>P(...C(x,L,B,F,j,Z))}const q=e.set_authorizer(E,$(S),_);return O("sqlite3_set_authorizer",q,E)},t.sql=function(){const S=e.cwrap("sqlite3_sql",...se("n:s"));return function(_){return g(_),S(_)}}(),t.statements=function(E,S,_={}){const C=e.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!1}),$=[],q=new TextEncoder().encode(S),P=q.byteLength-q.byteLength%4+12,x=e._sqlite3_malloc(P),L=x+q.byteLength+1;e.HEAPU8.set(q,x),e.HEAPU8[L-1]=0;const B=x+P-8,F=x+P-4;let j;function Z(){j&&!_.unscoped&&t.finalize(j),j=0}e.setValue(F,x,"*");do{Z();const ye=e.getValue(F,"*"),G=C(E,ye,L-F,_.flags||0,B,F);G!==re&&O("sqlite3_prepare_v3",G,E),j=e.getValue(B,"*"),j&&(p.set(j,E),$.push(j))}while(j);return $},t.step=function(){const E="sqlite3_step",S=e.cwrap(E,...se("n:n"),{async:ec});return function(_){g(_);const C=S(_);return O(E,C,p.get(_),[TS,pae])}}(),t.commit_hook=function(E,S){h(E),e.commit_hook(E,S)},t.update_hook=function(E,S){h(E);function _($,q,P,x,L){return[$,e.UTF8ToString(q),e.UTF8ToString(P),a(x,L)]}function C($){return(q,P,x,L,B)=>$(..._(q,P,x,L,B))}e.update_hook(E,C(S))},t.session_create=function(){const E="sqlite3session_create",S=e.cwrap(E,...se("nsn:n"));return function(_,C){h(_);const $=e._malloc(4),q=S(_,C,$);return q!==re&&O(E,q,_),e.getValue($,"i32")}}(),t.session_attach=function(){const E="sqlite3session_attach",S=e.cwrap(E,...se("ns:n"));return function(_,C){if(typeof _!="number")throw new vr("Invalid session object",Ho);const $=S(_,C);return O(E,$)}}(),t.session_enable=function(){const S=e.cwrap("sqlite3session_enable",...se("nn:n"));return function(_,C){const $=C?1:0;if(typeof _!="number")throw new vr("Invalid session object",Ho);if(S(_,$)!==$)throw new vr("Failed to enable session",Ho)}}(),t.session_changeset=function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n"));return function(_){if(typeof _!="number")throw new vr("Invalid session object",Ho);const C=e._malloc(4),$=e._malloc(4);try{const q=S(_,C,$);if(q===re){const P=e.getValue(C,"i32"),x=e.getValue($,"i32");if(x===0)return{result:q,size:0,changeset:null};const L=new Uint8Array(e.HEAPU8.subarray(x,x+P));return e._sqlite3_free(x),{result:q,size:P,changeset:L}}return O(E,q)}finally{e._free(C),e._free($)}}}(),t.session_delete=function(){const S=e.cwrap("sqlite3session_delete",...se("n:v"));return function(_){if(typeof _!="number")throw new vr("Invalid session object",Ho);return S(_)}}(),t.changeset_start=function(){const E="sqlite3changeset_start",S=e.cwrap(E,...se("nnn:n"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4);try{const q=S($,_.length,C);return q!==re&&O(E,q),e.getValue($,"i32")}finally{e._sqlite3_free(C),e._free($)}}}(),t.changeset_finalize=function(){const S=e.cwrap("sqlite3changeset_finalize",...se("n:n"));return function(_){return S(_)}}(),t.changeset_invert=function(){const E="sqlite3changeset_invert",S=e.cwrap(E,...se("nn:nn"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4),q=e._malloc(4),P=S(_.length,C,$,q);P!==re&&O(E,P);const x=e.getValue($,"i32"),L=e.getValue(q,"i32"),B=new Uint8Array(e.HEAPU8.buffer,L,x).slice();return e._sqlite3_free(C),e._sqlite3_free(L),B}}(),t.session_changeset_inverted=function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n")),_="sqlite3changeset_invert",C=e.cwrap(_,...se("nn:nn"));return function($){if(typeof $!="number")throw new vr("Invalid session object",Ho);const q=e._malloc(4),P=e._malloc(4),x=e._malloc(4),L=e._malloc(4);try{const B=S($,q,P);if(B!==re)return O(E,B);const F=e.getValue(q,"i32"),j=e.getValue(P,"i32"),Z=C(F,j,x,L);if(Z!==re)return O(_,Z);const ye=e.getValue(x,"i32"),G=e.getValue(L,"i32"),we=new Uint8Array(e.HEAPU8.buffer,G,ye);return e._sqlite3_free(j),e._sqlite3_free(G),{result:B,size:F,changeset:new Uint8Array(we)}}finally{e._free(q),e._free(P),e._free(x),e._free(L)}}}(),t.changeset_apply=function(){const E="sqlite3changeset_apply",S=e.cwrap(E,...se("nnnnnn:n"));return function(_,C,$){const q=e._sqlite3_malloc(C.length);e.HEAPU8.subarray(q).set(C);const P=1,x=()=>P,L=S(_,C.length,q,null,x,null);return e._sqlite3_free(q),L!==re&&O(E,L),L}}(),t.value=function(E){const S=t.value_type(E);switch(S){case tT:return t.value_blob(E);case ZC:return t.value_double(E);case XC:const _=t.value_int(E),C=e.getTempRet0();return u(_,C);case nT:return null;case eT:return t.value_text(E);default:throw new vr("unknown type",S)}},t.value_blob=function(){const S=e.cwrap("sqlite3_value_blob",...se("n:n"));return function(_){const C=t.value_bytes(_),$=S(_);return e.HEAPU8.subarray($,$+C)}}(),t.value_bytes=function(){const S=e.cwrap("sqlite3_value_bytes",...se("n:n"));return function(_){return S(_)}}(),t.value_double=function(){const S=e.cwrap("sqlite3_value_double",...se("n:n"));return function(_){return S(_)}}(),t.value_int=function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){return S(_)}}(),t.value_int64=function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){const C=S(_),$=e.getTempRet0();return a(C,$)}}(),t.value_text=function(){const S=e.cwrap("sqlite3_value_text",...se("n:s"));return function(_){return S(_)}}(),t.value_type=function(){const S=e.cwrap("sqlite3_value_type",...se("n:n"));return function(_){return S(_)}}();const T=new Set;t.vfs_register=function(E,S){if(T.has(E.name))return;const _=e.vfs_register(E,S),C=O("sqlite3_vfs_register",_);return T.add(E.name),C},t.vfs_registered=T;function O(E,S,_=null,C=[re]){if(C.includes(S))return S;const $=_?e.ccall("sqlite3_errmsg","string",["number"],[_]):E;throw new vr($,S)}async function M(E){let S;do e.retryOps.length&&(await Promise.all(e.retryOps),e.retryOps=[]),S=await E();while(S&&e.retryOps.length);return S}return t}function se(e){const t=[],n=e.match(/([ns@]*):([nsv@])/);switch(n[2]){case"n":t.push("number");break;case"s":t.push("string");break;case"v":t.push(null);break}const r=[];for(let s of n[1])switch(s){case"n":r.push("number");break;case"s":r.push("string");break}return t.push(r),t}var Fae=(()=>{var e=import.meta.url;return function(t={}){var n,r=t,s,o,a=new Promise((i,c)=>{s=i,o=c}),u=typeof window=="object",f=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var h=Object.assign({},r),p="./this.program",g=(i,c)=>{throw c},k="";function T(i){return r.locateFile?r.locateFile(i,k):k+i}var O,M;(u||f)&&(f?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),e&&(k=e),k.startsWith("blob:")?k="":k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1),f&&(M=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),O=i=>fetch(i,{credentials:"same-origin"}).then(c=>c.ok?c.arrayBuffer():Promise.reject(new Error(c.status+" : "+c.url))));var E=r.print||console.log.bind(console),S=r.printErr||console.error.bind(console);Object.assign(r,h),h=null,r.arguments&&r.arguments,r.thisProgram&&(p=r.thisProgram);var _=r.wasmBinary,C,$=!1,q,P,x,L,B,F,j,Z,ye;function G(){var i=C.buffer;r.HEAP8=P=new Int8Array(i),r.HEAP16=L=new Int16Array(i),r.HEAPU8=x=new Uint8Array(i),r.HEAPU16=B=new Uint16Array(i),r.HEAP32=F=new Int32Array(i),r.HEAPU32=j=new Uint32Array(i),r.HEAPF32=Z=new Float32Array(i),r.HEAPF64=ye=new Float64Array(i)}var we=[],Re=[],Be=[],Ze=[];function He(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Gu(r.preRun.shift());Vd(we)}function Lt(){!r.noFSInit&&!b.initialized&&b.init(),b.ignorePermissions=!1,Vd(Re)}function An(){Vd(Be)}function Ju(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Hd(r.postRun.shift());Vd(Ze)}function Gu(i){we.unshift(i)}function Qu(i){Re.unshift(i)}function Hd(i){Ze.unshift(i)}var is=0,Lo=null;function N_(i){return i}function jr(i){var c;is++,(c=r.monitorRunDependencies)==null||c.call(r,is)}function Ua(i){var l;if(is--,(l=r.monitorRunDependencies)==null||l.call(r,is),is==0&&Lo){var c=Lo;Lo=null,c()}}function as(i){var l;(l=r.onAbort)==null||l.call(r,i),i="Aborted("+i+")",S(i),$=!0,i+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(i);throw o(c),c}var p3="data:application/octet-stream;base64,",w0=i=>i.startsWith(p3);function g3(){if(r.locateFile){var i="wa-sqlite.wasm";return w0(i)?i:T(i)}return new URL("/assets/wa-sqlite-CWx0VZcQ.wasm",import.meta.url).href}var x_;function E0(i){if(i==x_&&_)return new Uint8Array(_);if(M)return M(i);throw"both async and sync fetching of the wasm failed"}function _3(i){return _?Promise.resolve().then(()=>E0(i)):O(i).then(c=>new Uint8Array(c),()=>E0(i))}function k0(i,c,l){return _3(i).then(m=>WebAssembly.instantiate(m,c)).then(l,m=>{S(`failed to asynchronously prepare wasm: ${m}`),as(m)})}function y3(i,c,l,m){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!w0(c)&&typeof fetch=="function"?fetch(c,{credentials:"same-origin"}).then(v=>{var R=WebAssembly.instantiateStreaming(v,l);return R.then(m,function(A){return S(`wasm streaming compile failed: ${A}`),S("falling back to ArrayBuffer instantiation"),k0(c,l,m)})}):k0(c,l,m)}function b3(){return{a:SM}}function S3(){function i(m,v){return I=m.exports,C=I.la,G(),Va=I.of,Qu(I.ma),Ua(),I}jr();function c(m){i(m.instance)}var l=b3();if(r.instantiateWasm)try{return r.instantiateWasm(l,i)}catch(m){S(`Module.instantiateWasm callback failed with error: ${m}`),o(m)}return x_??(x_=g3()),y3(_,x_,l,c).catch(o),{}}var be,At;class $0{constructor(c){d(this,"name","ExitStatus");this.message=`Program terminated with exit(${c})`,this.status=c}}var Vd=i=>{for(;i.length>0;)i.shift()(r)};function C0(i,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":return P[i];case"i8":return P[i];case"i16":return L[i>>1];case"i32":return F[i>>2];case"i64":as("to do getValue(i64) use WASM_BIGINT");case"float":return Z[i>>2];case"double":return ye[i>>3];case"*":return j[i>>2];default:as(`invalid type for getValue: ${c}`)}}r.noExitRuntime;function za(i,c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":P[i]=c;break;case"i8":P[i]=c;break;case"i16":L[i>>1]=c;break;case"i32":F[i>>2]=c;break;case"i64":as("to do setValue(i64) use WASM_BIGINT");case"float":Z[i>>2]=c;break;case"double":ye[i>>3]=c;break;case"*":j[i>>2]=c;break;default:as(`invalid type for setValue: ${l}`)}}var v3=i=>z0(i),w3=()=>H0(),T0=typeof TextDecoder<"u"?new TextDecoder:void 0,Ba=(i,c=0,l=NaN)=>{for(var m=c+l,v=c;i[v]&&!(v>=m);)++v;if(v-c>16&&i.buffer&&T0)return T0.decode(i.subarray(c,v));for(var R="";c<v;){var A=i[c++];if(!(A&128)){R+=String.fromCharCode(A);continue}var N=i[c++]&63;if((A&224)==192){R+=String.fromCharCode((A&31)<<6|N);continue}var H=i[c++]&63;if((A&240)==224?A=(A&15)<<12|N<<6|H:A=(A&7)<<18|N<<12|H<<6|i[c++]&63,A<65536)R+=String.fromCharCode(A);else{var te=A-65536;R+=String.fromCharCode(55296|te>>10,56320|te&1023)}}return R},Ei=(i,c)=>i?Ba(x,i,c):"",E3=(i,c,l,m)=>as(`Assertion failed: ${Ei(i)}, at: `+[c?Ei(c):"unknown filename",l,m?Ei(m):"unknown function"]),ht={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(i).slice(1)},normalizeArray:(i,c)=>{for(var l=0,m=i.length-1;m>=0;m--){var v=i[m];v==="."?i.splice(m,1):v===".."?(i.splice(m,1),l++):l&&(i.splice(m,1),l--)}if(c)for(;l;l--)i.unshift("..");return i},normalize:i=>{var c=ht.isAbs(i),l=i.substr(-1)==="/";return i=ht.normalizeArray(i.split("/").filter(m=>!!m),!c).join("/"),!i&&!c&&(i="."),i&&l&&(i+="/"),(c?"/":"")+i},dirname:i=>{var c=ht.splitPath(i),l=c[0],m=c[1];return!l&&!m?".":(m&&(m=m.substr(0,m.length-1)),l+m)},basename:i=>{if(i==="/")return"/";i=ht.normalize(i),i=i.replace(/\/$/,"");var c=i.lastIndexOf("/");return c===-1?i:i.substr(c+1)},join:(...i)=>ht.normalize(i.join("/")),join2:(i,c)=>ht.normalize(i+"/"+c)},k3=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);as("initRandomDevice")},I0=i=>(I0=k3())(i),jo={resolve:(...i)=>{for(var c="",l=!1,m=i.length-1;m>=-1&&!l;m--){var v=m>=0?i[m]:b.cwd();if(typeof v!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!v)return"";c=v+"/"+c,l=ht.isAbs(v)}return c=ht.normalizeArray(c.split("/").filter(R=>!!R),!l).join("/"),(l?"/":"")+c||"."},relative:(i,c)=>{i=jo.resolve(i).substr(1),c=jo.resolve(c).substr(1);function l(te){for(var Ce=0;Ce<te.length&&te[Ce]==="";Ce++);for(var Oe=te.length-1;Oe>=0&&te[Oe]==="";Oe--);return Ce>Oe?[]:te.slice(Ce,Oe-Ce+1)}for(var m=l(i.split("/")),v=l(c.split("/")),R=Math.min(m.length,v.length),A=R,N=0;N<R;N++)if(m[N]!==v[N]){A=N;break}for(var H=[],N=A;N<m.length;N++)H.push("..");return H=H.concat(v.slice(A)),H.join("/")}},D_=[],Ha=i=>{for(var c=0,l=0;l<i.length;++l){var m=i.charCodeAt(l);m<=127?c++:m<=2047?c+=2:m>=55296&&m<=57343?(c+=4,++l):c+=3}return c},M_=(i,c,l,m)=>{if(!(m>0))return 0;for(var v=l,R=l+m-1,A=0;A<i.length;++A){var N=i.charCodeAt(A);if(N>=55296&&N<=57343){var H=i.charCodeAt(++A);N=65536+((N&1023)<<10)|H&1023}if(N<=127){if(l>=R)break;c[l++]=N}else if(N<=2047){if(l+1>=R)break;c[l++]=192|N>>6,c[l++]=128|N&63}else if(N<=65535){if(l+2>=R)break;c[l++]=224|N>>12,c[l++]=128|N>>6&63,c[l++]=128|N&63}else{if(l+3>=R)break;c[l++]=240|N>>18,c[l++]=128|N>>12&63,c[l++]=128|N>>6&63,c[l++]=128|N&63}}return c[l]=0,l-v};function L_(i,c,l){var m=l>0?l:Ha(i)+1,v=new Array(m),R=M_(i,v,0,v.length);return c&&(v.length=R),v}var $3=()=>{if(!D_.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`)),!i)return null;D_=L_(i,!0)}return D_.shift()},ki={ttys:[],init(){},shutdown(){},register(i,c){ki.ttys[i]={input:[],output:[],ops:c},b.registerDevice(i,ki.stream_ops)},stream_ops:{open(i){var c=ki.ttys[i.node.rdev];if(!c)throw new b.ErrnoError(43);i.tty=c,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,c,l,m,v){if(!i.tty||!i.tty.ops.get_char)throw new b.ErrnoError(60);for(var R=0,A=0;A<m;A++){var N;try{N=i.tty.ops.get_char(i.tty)}catch{throw new b.ErrnoError(29)}if(N===void 0&&R===0)throw new b.ErrnoError(6);if(N==null)break;R++,c[l+A]=N}return R&&(i.node.timestamp=Date.now()),R},write(i,c,l,m,v){if(!i.tty||!i.tty.ops.put_char)throw new b.ErrnoError(60);try{for(var R=0;R<m;R++)i.tty.ops.put_char(i.tty,c[l+R])}catch{throw new b.ErrnoError(29)}return m&&(i.node.timestamp=Date.now()),R}},default_tty_ops:{get_char(i){return $3()},put_char(i,c){c===null||c===10?(E(Ba(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(E(Ba(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,c,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,c){c===null||c===10?(S(Ba(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(S(Ba(i.output)),i.output=[])}}},C3=(i,c)=>{x.fill(0,i,i+c)},R0=(i,c)=>Math.ceil(i/c)*c,O0=i=>{i=R0(i,65536);var c=j0(65536,i);return c&&C3(c,i),c},ke={ops_table:null,mount(i){return ke.createNode(null,"/",16895,0)},createNode(i,c,l,m){if(b.isBlkdev(l)||b.isFIFO(l))throw new b.ErrnoError(63);ke.ops_table||(ke.ops_table={dir:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr,lookup:ke.node_ops.lookup,mknod:ke.node_ops.mknod,rename:ke.node_ops.rename,unlink:ke.node_ops.unlink,rmdir:ke.node_ops.rmdir,readdir:ke.node_ops.readdir,symlink:ke.node_ops.symlink},stream:{llseek:ke.stream_ops.llseek}},file:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr},stream:{llseek:ke.stream_ops.llseek,read:ke.stream_ops.read,write:ke.stream_ops.write,allocate:ke.stream_ops.allocate,mmap:ke.stream_ops.mmap,msync:ke.stream_ops.msync}},link:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr,readlink:ke.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr},stream:b.chrdev_stream_ops}});var v=b.createNode(i,c,l,m);return b.isDir(v.mode)?(v.node_ops=ke.ops_table.dir.node,v.stream_ops=ke.ops_table.dir.stream,v.contents={}):b.isFile(v.mode)?(v.node_ops=ke.ops_table.file.node,v.stream_ops=ke.ops_table.file.stream,v.usedBytes=0,v.contents=null):b.isLink(v.mode)?(v.node_ops=ke.ops_table.link.node,v.stream_ops=ke.ops_table.link.stream):b.isChrdev(v.mode)&&(v.node_ops=ke.ops_table.chrdev.node,v.stream_ops=ke.ops_table.chrdev.stream),v.timestamp=Date.now(),i&&(i.contents[c]=v,i.timestamp=v.timestamp),v},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,c){var l=i.contents?i.contents.length:0;if(!(l>=c)){var m=1024*1024;c=Math.max(c,l*(l<m?2:1.125)>>>0),l!=0&&(c=Math.max(c,256));var v=i.contents;i.contents=new Uint8Array(c),i.usedBytes>0&&i.contents.set(v.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,c){if(i.usedBytes!=c)if(c==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(c),l&&i.contents.set(l.subarray(0,Math.min(c,i.usedBytes))),i.usedBytes=c}},node_ops:{getattr(i){var c={};return c.dev=b.isChrdev(i.mode)?i.id:1,c.ino=i.id,c.mode=i.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=i.rdev,b.isDir(i.mode)?c.size=4096:b.isFile(i.mode)?c.size=i.usedBytes:b.isLink(i.mode)?c.size=i.link.length:c.size=0,c.atime=new Date(i.timestamp),c.mtime=new Date(i.timestamp),c.ctime=new Date(i.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr(i,c){c.mode!==void 0&&(i.mode=c.mode),c.timestamp!==void 0&&(i.timestamp=c.timestamp),c.size!==void 0&&ke.resizeFileStorage(i,c.size)},lookup(i,c){throw ke.doesNotExistError},mknod(i,c,l,m){return ke.createNode(i,c,l,m)},rename(i,c,l){if(b.isDir(i.mode)){var m;try{m=b.lookupNode(c,l)}catch{}if(m)for(var v in m.contents)throw new b.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,c.contents[l]=i,c.timestamp=i.parent.timestamp},unlink(i,c){delete i.contents[c],i.timestamp=Date.now()},rmdir(i,c){var l=b.lookupNode(i,c);for(var m in l.contents)throw new b.ErrnoError(55);delete i.contents[c],i.timestamp=Date.now()},readdir(i){var c=[".",".."];for(var l of Object.keys(i.contents))c.push(l);return c},symlink(i,c,l){var m=ke.createNode(i,c,41471,0);return m.link=l,m},readlink(i){if(!b.isLink(i.mode))throw new b.ErrnoError(28);return i.link}},stream_ops:{read(i,c,l,m,v){var R=i.node.contents;if(v>=i.node.usedBytes)return 0;var A=Math.min(i.node.usedBytes-v,m);if(A>8&&R.subarray)c.set(R.subarray(v,v+A),l);else for(var N=0;N<A;N++)c[l+N]=R[v+N];return A},write(i,c,l,m,v,R){if(c.buffer===P.buffer&&(R=!1),!m)return 0;var A=i.node;if(A.timestamp=Date.now(),c.subarray&&(!A.contents||A.contents.subarray)){if(R)return A.contents=c.subarray(l,l+m),A.usedBytes=m,m;if(A.usedBytes===0&&v===0)return A.contents=c.slice(l,l+m),A.usedBytes=m,m;if(v+m<=A.usedBytes)return A.contents.set(c.subarray(l,l+m),v),m}if(ke.expandFileStorage(A,v+m),A.contents.subarray&&c.subarray)A.contents.set(c.subarray(l,l+m),v);else for(var N=0;N<m;N++)A.contents[v+N]=c[l+N];return A.usedBytes=Math.max(A.usedBytes,v+m),m},llseek(i,c,l){var m=c;if(l===1?m+=i.position:l===2&&b.isFile(i.node.mode)&&(m+=i.node.usedBytes),m<0)throw new b.ErrnoError(28);return m},allocate(i,c,l){ke.expandFileStorage(i.node,c+l),i.node.usedBytes=Math.max(i.node.usedBytes,c+l)},mmap(i,c,l,m,v){if(!b.isFile(i.node.mode))throw new b.ErrnoError(43);var R,A,N=i.node.contents;if(!(v&2)&&N&&N.buffer===P.buffer)A=!1,R=N.byteOffset;else{if(A=!0,R=O0(c),!R)throw new b.ErrnoError(48);N&&((l>0||l+c<N.length)&&(N.subarray?N=N.subarray(l,l+c):N=Array.prototype.slice.call(N,l,l+c)),P.set(N,R))}return{ptr:R,allocated:A}},msync(i,c,l,m,v){return ke.stream_ops.write(i,c,0,m,l,!1),0}}},T3=(i,c,l,m)=>{var v=`al ${i}`;O(i).then(R=>{c(new Uint8Array(R)),v&&Ua()},R=>{if(l)l();else throw`Loading data file "${i}" failed.`}),v&&jr()},I3=(i,c,l,m,v,R)=>{b.createDataFile(i,c,l,m,v,R)},R3=r.preloadPlugins||[],O3=(i,c,l,m)=>{typeof Browser<"u"&&Browser.init();var v=!1;return R3.forEach(R=>{v||R.canHandle(c)&&(R.handle(i,c,l,m),v=!0)}),v},q3=(i,c,l,m,v,R,A,N,H,te)=>{var Ce=c?jo.resolve(ht.join2(i,c)):i;function Oe(Qe){function ae(le){te==null||te(),N||I3(i,c,le,m,v,H),R==null||R(),Ua()}O3(Qe,Ce,ae,()=>{A==null||A(),Ua()})||ae(Qe)}jr(),typeof l=="string"?T3(l,Oe,A):Oe(l)},A3=i=>{var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=c[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},j_=(i,c)=>{var l=0;return i&&(l|=365),c&&(l|=146),l},b={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(i){d(this,"name","ErrnoError");this.errno=i}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){d(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,c,l,m){d(this,"node_ops",{});d(this,"stream_ops",{});d(this,"readMode",365);d(this,"writeMode",146);d(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=b.nextInode++,this.name=c,this.mode=l,this.rdev=m}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return b.isDir(this.mode)}get isDevice(){return b.isChrdev(this.mode)}},lookupPath(i,c={}){if(i=jo.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(c=Object.assign(l,c),c.recurse_count>8)throw new b.ErrnoError(32);for(var m=i.split("/").filter(Oe=>!!Oe),v=b.root,R="/",A=0;A<m.length;A++){var N=A===m.length-1;if(N&&c.parent)break;if(v=b.lookupNode(v,m[A]),R=ht.join2(R,m[A]),b.isMountpoint(v)&&(!N||N&&c.follow_mount)&&(v=v.mounted.root),!N||c.follow)for(var H=0;b.isLink(v.mode);){var te=b.readlink(R);R=jo.resolve(ht.dirname(R),te);var Ce=b.lookupPath(R,{recurse_count:c.recurse_count+1});if(v=Ce.node,H++>40)throw new b.ErrnoError(32)}}return{path:R,node:v}},getPath(i){for(var c;;){if(b.isRoot(i)){var l=i.mount.mountpoint;return c?l[l.length-1]!=="/"?`${l}/${c}`:l+c:l}c=c?`${i.name}/${c}`:i.name,i=i.parent}},hashName(i,c){for(var l=0,m=0;m<c.length;m++)l=(l<<5)-l+c.charCodeAt(m)|0;return(i+l>>>0)%b.nameTable.length},hashAddNode(i){var c=b.hashName(i.parent.id,i.name);i.name_next=b.nameTable[c],b.nameTable[c]=i},hashRemoveNode(i){var c=b.hashName(i.parent.id,i.name);if(b.nameTable[c]===i)b.nameTable[c]=i.name_next;else for(var l=b.nameTable[c];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,c){var l=b.mayLookup(i);if(l)throw new b.ErrnoError(l);for(var m=b.hashName(i.id,c),v=b.nameTable[m];v;v=v.name_next){var R=v.name;if(v.parent.id===i.id&&R===c)return v}return b.lookup(i,c)},createNode(i,c,l,m){var v=new b.FSNode(i,c,l,m);return b.hashAddNode(v),v},destroyNode(i){b.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var c=["r","w","rw"][i&3];return i&512&&(c+="w"),c},nodePermissions(i,c){return b.ignorePermissions?0:c.includes("r")&&!(i.mode&292)||c.includes("w")&&!(i.mode&146)||c.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!b.isDir(i.mode))return 54;var c=b.nodePermissions(i,"x");return c||(i.node_ops.lookup?0:2)},mayCreate(i,c){var l;try{return l=b.lookupNode(i,c),20}catch{}return b.nodePermissions(i,"wx")},mayDelete(i,c,l){var m;try{m=b.lookupNode(i,c)}catch(R){return R.errno}var v=b.nodePermissions(i,"wx");if(v)return v;if(l){if(!b.isDir(m.mode))return 54;if(b.isRoot(m)||b.getPath(m)===b.cwd())return 10}else if(b.isDir(m.mode))return 31;return 0},mayOpen(i,c){return i?b.isLink(i.mode)?32:b.isDir(i.mode)&&(b.flagsToPermissionString(c)!=="r"||c&512)?31:b.nodePermissions(i,b.flagsToPermissionString(c)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=b.MAX_OPEN_FDS;i++)if(!b.streams[i])return i;throw new b.ErrnoError(33)},getStreamChecked(i){var c=b.getStream(i);if(!c)throw new b.ErrnoError(8);return c},getStream:i=>b.streams[i],createStream(i,c=-1){return i=Object.assign(new b.FSStream,i),c==-1&&(c=b.nextfd()),i.fd=c,b.streams[c]=i,i},closeStream(i){b.streams[i]=null},dupStream(i,c=-1){var m,v;var l=b.createStream(i,c);return(v=(m=l.stream_ops)==null?void 0:m.dup)==null||v.call(m,l),l},chrdev_stream_ops:{open(i){var l,m;var c=b.getDevice(i.node.rdev);i.stream_ops=c.stream_ops,(m=(l=i.stream_ops).open)==null||m.call(l,i)},llseek(){throw new b.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,c)=>i<<8|c,registerDevice(i,c){b.devices[i]={stream_ops:c}},getDevice:i=>b.devices[i],getMounts(i){for(var c=[],l=[i];l.length;){var m=l.pop();c.push(m),l.push(...m.mounts)}return c},syncfs(i,c){typeof i=="function"&&(c=i,i=!1),b.syncFSRequests++,b.syncFSRequests>1&&S(`warning: ${b.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=b.getMounts(b.root.mount),m=0;function v(A){return b.syncFSRequests--,c(A)}function R(A){if(A)return R.errored?void 0:(R.errored=!0,v(A));++m>=l.length&&v(null)}l.forEach(A=>{if(!A.type.syncfs)return R(null);A.type.syncfs(A,i,R)})},mount(i,c,l){var m=l==="/",v=!l,R;if(m&&b.root)throw new b.ErrnoError(10);if(!m&&!v){var A=b.lookupPath(l,{follow_mount:!1});if(l=A.path,R=A.node,b.isMountpoint(R))throw new b.ErrnoError(10);if(!b.isDir(R.mode))throw new b.ErrnoError(54)}var N={type:i,opts:c,mountpoint:l,mounts:[]},H=i.mount(N);return H.mount=N,N.root=H,m?b.root=H:R&&(R.mounted=N,R.mount&&R.mount.mounts.push(N)),H},unmount(i){var c=b.lookupPath(i,{follow_mount:!1});if(!b.isMountpoint(c.node))throw new b.ErrnoError(28);var l=c.node,m=l.mounted,v=b.getMounts(m);Object.keys(b.nameTable).forEach(A=>{for(var N=b.nameTable[A];N;){var H=N.name_next;v.includes(N.mount)&&b.destroyNode(N),N=H}}),l.mounted=null;var R=l.mount.mounts.indexOf(m);l.mount.mounts.splice(R,1)},lookup(i,c){return i.node_ops.lookup(i,c)},mknod(i,c,l){var m=b.lookupPath(i,{parent:!0}),v=m.node,R=ht.basename(i);if(!R||R==="."||R==="..")throw new b.ErrnoError(28);var A=b.mayCreate(v,R);if(A)throw new b.ErrnoError(A);if(!v.node_ops.mknod)throw new b.ErrnoError(63);return v.node_ops.mknod(v,R,c,l)},statfs(i){var c={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:b.nextInode,ffree:b.nextInode-1,fsid:42,flags:2,namelen:255},l=b.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(c,l.node_ops.statfs(l.mount.opts.root)),c},create(i,c=438){return c&=4095,c|=32768,b.mknod(i,c,0)},mkdir(i,c=511){return c&=1023,c|=16384,b.mknod(i,c,0)},mkdirTree(i,c){for(var l=i.split("/"),m="",v=0;v<l.length;++v)if(l[v]){m+="/"+l[v];try{b.mkdir(m,c)}catch(R){if(R.errno!=20)throw R}}},mkdev(i,c,l){return typeof l>"u"&&(l=c,c=438),c|=8192,b.mknod(i,c,l)},symlink(i,c){if(!jo.resolve(i))throw new b.ErrnoError(44);var l=b.lookupPath(c,{parent:!0}),m=l.node;if(!m)throw new b.ErrnoError(44);var v=ht.basename(c),R=b.mayCreate(m,v);if(R)throw new b.ErrnoError(R);if(!m.node_ops.symlink)throw new b.ErrnoError(63);return m.node_ops.symlink(m,v,i)},rename(i,c){var l=ht.dirname(i),m=ht.dirname(c),v=ht.basename(i),R=ht.basename(c),A,N,H;if(A=b.lookupPath(i,{parent:!0}),N=A.node,A=b.lookupPath(c,{parent:!0}),H=A.node,!N||!H)throw new b.ErrnoError(44);if(N.mount!==H.mount)throw new b.ErrnoError(75);var te=b.lookupNode(N,v),Ce=jo.relative(i,m);if(Ce.charAt(0)!==".")throw new b.ErrnoError(28);if(Ce=jo.relative(c,l),Ce.charAt(0)!==".")throw new b.ErrnoError(55);var Oe;try{Oe=b.lookupNode(H,R)}catch{}if(te!==Oe){var Qe=b.isDir(te.mode),ae=b.mayDelete(N,v,Qe);if(ae)throw new b.ErrnoError(ae);if(ae=Oe?b.mayDelete(H,R,Qe):b.mayCreate(H,R),ae)throw new b.ErrnoError(ae);if(!N.node_ops.rename)throw new b.ErrnoError(63);if(b.isMountpoint(te)||Oe&&b.isMountpoint(Oe))throw new b.ErrnoError(10);if(H!==N&&(ae=b.nodePermissions(N,"w"),ae))throw new b.ErrnoError(ae);b.hashRemoveNode(te);try{N.node_ops.rename(te,H,R),te.parent=H}catch(le){throw le}finally{b.hashAddNode(te)}}},rmdir(i){var c=b.lookupPath(i,{parent:!0}),l=c.node,m=ht.basename(i),v=b.lookupNode(l,m),R=b.mayDelete(l,m,!0);if(R)throw new b.ErrnoError(R);if(!l.node_ops.rmdir)throw new b.ErrnoError(63);if(b.isMountpoint(v))throw new b.ErrnoError(10);l.node_ops.rmdir(l,m),b.destroyNode(v)},readdir(i){var c=b.lookupPath(i,{follow:!0}),l=c.node;if(!l.node_ops.readdir)throw new b.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var c=b.lookupPath(i,{parent:!0}),l=c.node;if(!l)throw new b.ErrnoError(44);var m=ht.basename(i),v=b.lookupNode(l,m),R=b.mayDelete(l,m,!1);if(R)throw new b.ErrnoError(R);if(!l.node_ops.unlink)throw new b.ErrnoError(63);if(b.isMountpoint(v))throw new b.ErrnoError(10);l.node_ops.unlink(l,m),b.destroyNode(v)},readlink(i){var c=b.lookupPath(i),l=c.node;if(!l)throw new b.ErrnoError(44);if(!l.node_ops.readlink)throw new b.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,c){var l=b.lookupPath(i,{follow:!c}),m=l.node;if(!m)throw new b.ErrnoError(44);if(!m.node_ops.getattr)throw new b.ErrnoError(63);return m.node_ops.getattr(m)},lstat(i){return b.stat(i,!0)},chmod(i,c,l){var m;if(typeof i=="string"){var v=b.lookupPath(i,{follow:!l});m=v.node}else m=i;if(!m.node_ops.setattr)throw new b.ErrnoError(63);m.node_ops.setattr(m,{mode:c&4095|m.mode&-4096,timestamp:Date.now()})},lchmod(i,c){b.chmod(i,c,!0)},fchmod(i,c){var l=b.getStreamChecked(i);b.chmod(l.node,c)},chown(i,c,l,m){var v;if(typeof i=="string"){var R=b.lookupPath(i,{follow:!m});v=R.node}else v=i;if(!v.node_ops.setattr)throw new b.ErrnoError(63);v.node_ops.setattr(v,{timestamp:Date.now()})},lchown(i,c,l){b.chown(i,c,l,!0)},fchown(i,c,l){var m=b.getStreamChecked(i);b.chown(m.node,c,l)},truncate(i,c){if(c<0)throw new b.ErrnoError(28);var l;if(typeof i=="string"){var m=b.lookupPath(i,{follow:!0});l=m.node}else l=i;if(!l.node_ops.setattr)throw new b.ErrnoError(63);if(b.isDir(l.mode))throw new b.ErrnoError(31);if(!b.isFile(l.mode))throw new b.ErrnoError(28);var v=b.nodePermissions(l,"w");if(v)throw new b.ErrnoError(v);l.node_ops.setattr(l,{size:c,timestamp:Date.now()})},ftruncate(i,c){var l=b.getStreamChecked(i);if((l.flags&2097155)===0)throw new b.ErrnoError(28);b.truncate(l.node,c)},utime(i,c,l){var m=b.lookupPath(i,{follow:!0}),v=m.node;v.node_ops.setattr(v,{timestamp:Math.max(c,l)})},open(i,c,l=438){if(i==="")throw new b.ErrnoError(44);c=typeof c=="string"?A3(c):c,c&64?l=l&4095|32768:l=0;var m;if(typeof i=="object")m=i;else{i=ht.normalize(i);try{var v=b.lookupPath(i,{follow:!(c&131072)});m=v.node}catch{}}var R=!1;if(c&64)if(m){if(c&128)throw new b.ErrnoError(20)}else m=b.mknod(i,l,0),R=!0;if(!m)throw new b.ErrnoError(44);if(b.isChrdev(m.mode)&&(c&=-513),c&65536&&!b.isDir(m.mode))throw new b.ErrnoError(54);if(!R){var A=b.mayOpen(m,c);if(A)throw new b.ErrnoError(A)}c&512&&!R&&b.truncate(m,0),c&=-131713;var N=b.createStream({node:m,path:b.getPath(m),flags:c,seekable:!0,position:0,stream_ops:m.stream_ops,ungotten:[],error:!1});return N.stream_ops.open&&N.stream_ops.open(N),r.logReadFiles&&!(c&1)&&(i in b.readFiles||(b.readFiles[i]=1)),N},close(i){if(b.isClosed(i))throw new b.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(c){throw c}finally{b.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new b.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new b.ErrnoError(28);return i.position=i.stream_ops.llseek(i,c,l),i.ungotten=[],i.position},read(i,c,l,m,v){if(m<0||v<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===1)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.read)throw new b.ErrnoError(28);var R=typeof v<"u";if(!R)v=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var A=i.stream_ops.read(i,c,l,m,v);return R||(i.position+=A),A},write(i,c,l,m,v,R){if(m<0||v<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.write)throw new b.ErrnoError(28);i.seekable&&i.flags&1024&&b.llseek(i,0,2);var A=typeof v<"u";if(!A)v=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var N=i.stream_ops.write(i,c,l,m,v,R);return A||(i.position+=N),N},allocate(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(c<0||l<=0)throw new b.ErrnoError(28);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(!b.isFile(i.node.mode)&&!b.isDir(i.node.mode))throw new b.ErrnoError(43);if(!i.stream_ops.allocate)throw new b.ErrnoError(138);i.stream_ops.allocate(i,c,l)},mmap(i,c,l,m,v){if((m&2)!==0&&(v&2)===0&&(i.flags&2097155)!==2)throw new b.ErrnoError(2);if((i.flags&2097155)===1)throw new b.ErrnoError(2);if(!i.stream_ops.mmap)throw new b.ErrnoError(43);if(!c)throw new b.ErrnoError(28);return i.stream_ops.mmap(i,c,l,m,v)},msync(i,c,l,m,v){return i.stream_ops.msync?i.stream_ops.msync(i,c,l,m,v):0},ioctl(i,c,l){if(!i.stream_ops.ioctl)throw new b.ErrnoError(59);return i.stream_ops.ioctl(i,c,l)},readFile(i,c={}){if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error(`Invalid encoding type "${c.encoding}"`);var l,m=b.open(i,c.flags),v=b.stat(i),R=v.size,A=new Uint8Array(R);return b.read(m,A,0,R,0),c.encoding==="utf8"?l=Ba(A):c.encoding==="binary"&&(l=A),b.close(m),l},writeFile(i,c,l={}){l.flags=l.flags||577;var m=b.open(i,l.flags,l.mode);if(typeof c=="string"){var v=new Uint8Array(Ha(c)+1),R=M_(c,v,0,v.length);b.write(m,v,0,R,void 0,l.canOwn)}else if(ArrayBuffer.isView(c))b.write(m,c,0,c.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");b.close(m)},cwd:()=>b.currentPath,chdir(i){var c=b.lookupPath(i,{follow:!0});if(c.node===null)throw new b.ErrnoError(44);if(!b.isDir(c.node.mode))throw new b.ErrnoError(54);var l=b.nodePermissions(c.node,"x");if(l)throw new b.ErrnoError(l);b.currentPath=c.path},createDefaultDirectories(){b.mkdir("/tmp"),b.mkdir("/home"),b.mkdir("/home/web_user")},createDefaultDevices(){b.mkdir("/dev"),b.registerDevice(b.makedev(1,3),{read:()=>0,write:(m,v,R,A,N)=>A,llseek:()=>0}),b.mkdev("/dev/null",b.makedev(1,3)),ki.register(b.makedev(5,0),ki.default_tty_ops),ki.register(b.makedev(6,0),ki.default_tty1_ops),b.mkdev("/dev/tty",b.makedev(5,0)),b.mkdev("/dev/tty1",b.makedev(6,0));var i=new Uint8Array(1024),c=0,l=()=>(c===0&&(c=I0(i).byteLength),i[--c]);b.createDevice("/dev","random",l),b.createDevice("/dev","urandom",l),b.mkdir("/dev/shm"),b.mkdir("/dev/shm/tmp")},createSpecialDirectories(){b.mkdir("/proc");var i=b.mkdir("/proc/self");b.mkdir("/proc/self/fd"),b.mount({mount(){var c=b.createNode(i,"fd",16895,73);return c.node_ops={lookup(l,m){var v=+m,R=b.getStreamChecked(v),A={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>R.path}};return A.parent=A,A}},c}},{},"/proc/self/fd")},createStandardStreams(i,c,l){i?b.createDevice("/dev","stdin",i):b.symlink("/dev/tty","/dev/stdin"),c?b.createDevice("/dev","stdout",null,c):b.symlink("/dev/tty","/dev/stdout"),l?b.createDevice("/dev","stderr",null,l):b.symlink("/dev/tty1","/dev/stderr"),b.open("/dev/stdin",0),b.open("/dev/stdout",1),b.open("/dev/stderr",1)},staticInit(){b.nameTable=new Array(4096),b.mount(ke,{},"/"),b.createDefaultDirectories(),b.createDefaultDevices(),b.createSpecialDirectories(),b.filesystems={MEMFS:ke}},init(i,c,l){b.initialized=!0,i??(i=r.stdin),c??(c=r.stdout),l??(l=r.stderr),b.createStandardStreams(i,c,l)},quit(){b.initialized=!1;for(var i=0;i<b.streams.length;i++){var c=b.streams[i];c&&b.close(c)}},findObject(i,c){var l=b.analyzePath(i,c);return l.exists?l.object:null},analyzePath(i,c){try{var l=b.lookupPath(i,{follow:!c});i=l.path}catch{}var m={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=b.lookupPath(i,{parent:!0});m.parentExists=!0,m.parentPath=l.path,m.parentObject=l.node,m.name=ht.basename(i),l=b.lookupPath(i,{follow:!c}),m.exists=!0,m.path=l.path,m.object=l.node,m.name=l.node.name,m.isRoot=l.path==="/"}catch(v){m.error=v.errno}return m},createPath(i,c,l,m){i=typeof i=="string"?i:b.getPath(i);for(var v=c.split("/").reverse();v.length;){var R=v.pop();if(R){var A=ht.join2(i,R);try{b.mkdir(A)}catch{}i=A}}return A},createFile(i,c,l,m,v){var R=ht.join2(typeof i=="string"?i:b.getPath(i),c),A=j_(m,v);return b.create(R,A)},createDataFile(i,c,l,m,v,R){var A=c;i&&(i=typeof i=="string"?i:b.getPath(i),A=c?ht.join2(i,c):i);var N=j_(m,v),H=b.create(A,N);if(l){if(typeof l=="string"){for(var te=new Array(l.length),Ce=0,Oe=l.length;Ce<Oe;++Ce)te[Ce]=l.charCodeAt(Ce);l=te}b.chmod(H,N|146);var Qe=b.open(H,577);b.write(Qe,l,0,l.length,0,R),b.close(Qe),b.chmod(H,N)}},createDevice(i,c,l,m){var N;var v=ht.join2(typeof i=="string"?i:b.getPath(i),c),R=j_(!!l,!!m);(N=b.createDevice).major??(N.major=64);var A=b.makedev(b.createDevice.major++,0);return b.registerDevice(A,{open(H){H.seekable=!1},close(H){var te;(te=m==null?void 0:m.buffer)!=null&&te.length&&m(10)},read(H,te,Ce,Oe,Qe){for(var ae=0,le=0;le<Oe;le++){var mt;try{mt=l()}catch{throw new b.ErrnoError(29)}if(mt===void 0&&ae===0)throw new b.ErrnoError(6);if(mt==null)break;ae++,te[Ce+le]=mt}return ae&&(H.node.timestamp=Date.now()),ae},write(H,te,Ce,Oe,Qe){for(var ae=0;ae<Oe;ae++)try{m(te[Ce+ae])}catch{throw new b.ErrnoError(29)}return Oe&&(H.node.timestamp=Date.now()),ae}}),b.mkdev(v,R,A)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=M(i.url),i.usedBytes=i.contents.length}catch{throw new b.ErrnoError(29)}},createLazyFile(i,c,l,m,v){class R{constructor(){d(this,"lengthKnown",!1);d(this,"chunks",[])}get(ae){if(!(ae>this.length-1||ae<0)){var le=ae%this.chunkSize,mt=ae/this.chunkSize|0;return this.getter(mt)[le]}}setDataGetter(ae){this.getter=ae}cacheLength(){var ae=new XMLHttpRequest;if(ae.open("HEAD",l,!1),ae.send(null),!(ae.status>=200&&ae.status<300||ae.status===304))throw new Error("Couldn't load "+l+". Status: "+ae.status);var le=Number(ae.getResponseHeader("Content-length")),mt,Vn=(mt=ae.getResponseHeader("Accept-Ranges"))&&mt==="bytes",rr=(mt=ae.getResponseHeader("Content-Encoding"))&&mt==="gzip",Ur=1024*1024;Vn||(Ur=le);var zr=(cs,Ka)=>{if(cs>Ka)throw new Error("invalid range ("+cs+", "+Ka+") or no bytes requested!");if(Ka>le-1)throw new Error("only "+le+" bytes available! programmer error!");var _n=new XMLHttpRequest;if(_n.open("GET",l,!1),le!==Ur&&_n.setRequestHeader("Range","bytes="+cs+"-"+Ka),_n.responseType="arraybuffer",_n.overrideMimeType&&_n.overrideMimeType("text/plain; charset=x-user-defined"),_n.send(null),!(_n.status>=200&&_n.status<300||_n.status===304))throw new Error("Couldn't load "+l+". Status: "+_n.status);return _n.response!==void 0?new Uint8Array(_n.response||[]):L_(_n.responseText||"",!0)},Zu=this;Zu.setDataGetter(cs=>{var Ka=cs*Ur,_n=(cs+1)*Ur-1;if(_n=Math.min(_n,le-1),typeof Zu.chunks[cs]>"u"&&(Zu.chunks[cs]=zr(Ka,_n)),typeof Zu.chunks[cs]>"u")throw new Error("doXHR failed!");return Zu.chunks[cs]}),(rr||!le)&&(Ur=le=1,le=this.getter(0).length,Ur=le,E("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=le,this._chunkSize=Ur,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var A=new R,N={isDevice:!1,contents:A}}else var N={isDevice:!1,url:l};var H=b.createFile(i,c,N,m,v);N.contents?H.contents=N.contents:N.url&&(H.contents=null,H.url=N.url),Object.defineProperties(H,{usedBytes:{get:function(){return this.contents.length}}});var te={},Ce=Object.keys(H.stream_ops);Ce.forEach(Qe=>{var ae=H.stream_ops[Qe];te[Qe]=(...le)=>(b.forceLoadFile(H),ae(...le))});function Oe(Qe,ae,le,mt,Vn){var rr=Qe.node.contents;if(Vn>=rr.length)return 0;var Ur=Math.min(rr.length-Vn,mt);if(rr.slice)for(var zr=0;zr<Ur;zr++)ae[le+zr]=rr[Vn+zr];else for(var zr=0;zr<Ur;zr++)ae[le+zr]=rr.get(Vn+zr);return Ur}return te.read=(Qe,ae,le,mt,Vn)=>(b.forceLoadFile(H),Oe(Qe,ae,le,mt,Vn)),te.mmap=(Qe,ae,le,mt,Vn)=>{b.forceLoadFile(H);var rr=O0(ae);if(!rr)throw new b.ErrnoError(48);return Oe(Qe,P,rr,ae,le),{ptr:rr,allocated:!0}},H.stream_ops=te,H}},De={DEFAULT_POLLMASK:5,calculateAt(i,c,l){if(ht.isAbs(c))return c;var m;if(i===-100)m=b.cwd();else{var v=De.getStreamFromFD(i);m=v.path}if(c.length==0){if(!l)throw new b.ErrnoError(44);return m}return ht.join2(m,c)},doStat(i,c,l){var m=i(c);F[l>>2]=m.dev,F[l+4>>2]=m.mode,j[l+8>>2]=m.nlink,F[l+12>>2]=m.uid,F[l+16>>2]=m.gid,F[l+20>>2]=m.rdev,At=[m.size>>>0,(be=m.size,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+24>>2]=At[0],F[l+28>>2]=At[1],F[l+32>>2]=4096,F[l+36>>2]=m.blocks;var v=m.atime.getTime(),R=m.mtime.getTime(),A=m.ctime.getTime();return At=[Math.floor(v/1e3)>>>0,(be=Math.floor(v/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+40>>2]=At[0],F[l+44>>2]=At[1],j[l+48>>2]=v%1e3*1e3*1e3,At=[Math.floor(R/1e3)>>>0,(be=Math.floor(R/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+56>>2]=At[0],F[l+60>>2]=At[1],j[l+64>>2]=R%1e3*1e3*1e3,At=[Math.floor(A/1e3)>>>0,(be=Math.floor(A/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+72>>2]=At[0],F[l+76>>2]=At[1],j[l+80>>2]=A%1e3*1e3*1e3,At=[m.ino>>>0,(be=m.ino,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+88>>2]=At[0],F[l+92>>2]=At[1],0},doMsync(i,c,l,m,v){if(!b.isFile(c.node.mode))throw new b.ErrnoError(43);if(m&2)return 0;var R=x.slice(i,i+l);b.msync(c,R,v,l,m)},getStreamFromFD(i){var c=b.getStreamChecked(i);return c},varargs:void 0,getStr(i){var c=Ei(i);return c}};function P3(i,c){try{return i=De.getStr(i),b.chmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function F3(i,c,l,m){try{if(c=De.getStr(c),c=De.calculateAt(i,c),l&-8)return-28;var v=b.lookupPath(c,{follow:!0}),R=v.node;if(!R)return-44;var A="";return l&4&&(A+="r"),l&2&&(A+="w"),l&1&&(A+="x"),A&&b.nodePermissions(R,A)?-2:0}catch(N){if(typeof b>"u"||N.name!=="ErrnoError")throw N;return-N.errno}}function N3(i,c){try{return b.fchmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function x3(i,c,l){try{return b.fchown(i,c,l),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Wd=()=>{var i=F[+De.varargs>>2];return De.varargs+=4,i},D3=Wd;function M3(i,c,l){De.varargs=l;try{var m=De.getStreamFromFD(i);switch(c){case 0:{var v=Wd();if(v<0)return-28;for(;b.streams[v];)v++;var R;return R=b.dupStream(m,v),R.fd}case 1:case 2:return 0;case 3:return m.flags;case 4:{var v=Wd();return m.flags|=v,0}case 12:{var v=D3(),A=0;return L[v+A>>1]=2,0}case 13:case 14:return 0}return-28}catch(N){if(typeof b>"u"||N.name!=="ErrnoError")throw N;return-N.errno}}function L3(i,c){try{var l=De.getStreamFromFD(i);return De.doStat(b.stat,l.path,c)}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Yu=(i,c)=>c+2097152>>>0<4194305-!!i?(i>>>0)+c*4294967296:NaN;function j3(i,c,l){var m=Yu(c,l);try{return isNaN(m)?61:(b.ftruncate(i,m),0)}catch(v){if(typeof b>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}var Uo=(i,c,l)=>M_(i,x,c,l);function U3(i,c){try{if(c===0)return-28;var l=b.cwd(),m=Ha(l)+1;return c<m?-68:(Uo(l,i,c),m)}catch(v){if(typeof b>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function z3(i,c){try{return i=De.getStr(i),De.doStat(b.lstat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function B3(i,c,l){try{return c=De.getStr(c),c=De.calculateAt(i,c),c=ht.normalize(c),c[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),b.mkdir(c,l,0),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}function H3(i,c,l,m){try{c=De.getStr(c);var v=m&256,R=m&4096;return m=m&-6401,c=De.calculateAt(i,c,R),De.doStat(v?b.lstat:b.stat,c,l)}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return-A.errno}}function V3(i,c,l,m){De.varargs=m;try{c=De.getStr(c),c=De.calculateAt(i,c);var v=m?Wd():0;return b.open(c,l,v).fd}catch(R){if(typeof b>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function W3(i,c,l,m){try{if(c=De.getStr(c),c=De.calculateAt(i,c),m<=0)return-28;var v=b.readlink(c),R=Math.min(m,Ha(v)),A=P[l+R];return Uo(v,l,m+1),P[l+R]=A,R}catch(N){if(typeof b>"u"||N.name!=="ErrnoError")throw N;return-N.errno}}function K3(i){try{return i=De.getStr(i),b.rmdir(i),0}catch(c){if(typeof b>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function J3(i,c){try{return i=De.getStr(i),De.doStat(b.stat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function G3(i,c,l){try{return c=De.getStr(c),c=De.calculateAt(i,c),l===0?b.unlink(c):l===512?b.rmdir(c):as("Invalid flags passed to unlinkat"),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var q0=i=>j[i>>2]+F[i+4>>2]*4294967296;function Q3(i,c,l,m){try{c=De.getStr(c),c=De.calculateAt(i,c,!0);var v=Date.now(),R,A;if(!l)R=v,A=v;else{var N=q0(l),H=F[l+8>>2];H==1073741823?R=v:H==1073741822?R=-1:R=N*1e3+H/(1e3*1e3),l+=16,N=q0(l),H=F[l+8>>2],H==1073741823?A=v:H==1073741822?A=-1:A=N*1e3+H/(1e3*1e3)}return(A!=-1||R!=-1)&&b.utime(c,R,A),0}catch(te){if(typeof b>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}var Y3=i=>i%4===0&&(i%100!==0||i%400===0),X3=[0,31,60,91,121,152,182,213,244,274,305,335],Z3=[0,31,59,90,120,151,181,212,243,273,304,334],eD=i=>{var c=Y3(i.getFullYear()),l=c?X3:Z3,m=l[i.getMonth()]+i.getDate()-1;return m};function tD(i,c,l){var m=Yu(i,c),v=new Date(m*1e3);F[l>>2]=v.getSeconds(),F[l+4>>2]=v.getMinutes(),F[l+8>>2]=v.getHours(),F[l+12>>2]=v.getDate(),F[l+16>>2]=v.getMonth(),F[l+20>>2]=v.getFullYear()-1900,F[l+24>>2]=v.getDay();var R=eD(v)|0;F[l+28>>2]=R,F[l+36>>2]=-(v.getTimezoneOffset()*60);var A=new Date(v.getFullYear(),0,1),N=new Date(v.getFullYear(),6,1).getTimezoneOffset(),H=A.getTimezoneOffset(),te=(N!=H&&v.getTimezoneOffset()==Math.min(H,N))|0;F[l+32>>2]=te}function nD(i,c,l,m,v,R,A,N){var H=Yu(v,R);try{if(isNaN(H))return 61;var te=De.getStreamFromFD(m),Ce=b.mmap(te,i,H,c,l),Oe=Ce.ptr;return F[A>>2]=Ce.allocated,j[N>>2]=Oe,0}catch(Qe){if(typeof b>"u"||Qe.name!=="ErrnoError")throw Qe;return-Qe.errno}}function rD(i,c,l,m,v,R,A){var N=Yu(R,A);try{var H=De.getStreamFromFD(v);l&2&&De.doMsync(i,H,c,m,N)}catch(te){if(typeof b>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}var sD=(i,c,l,m)=>{var v=new Date().getFullYear(),R=new Date(v,0,1),A=new Date(v,6,1),N=R.getTimezoneOffset(),H=A.getTimezoneOffset(),te=Math.max(N,H);j[i>>2]=te*60,F[c>>2]=+(N!=H);var Ce=ae=>{var le=ae>=0?"-":"+",mt=Math.abs(ae),Vn=String(Math.floor(mt/60)).padStart(2,"0"),rr=String(mt%60).padStart(2,"0");return`UTC${le}${Vn}${rr}`},Oe=Ce(N),Qe=Ce(H);H<N?(Uo(Oe,l,17),Uo(Qe,m,17)):(Uo(Oe,m,17),Uo(Qe,l,17))},oD=()=>Date.now(),iD=()=>performance.now(),aD=()=>2147483648,cD=i=>{var c=C.buffer,l=(i-c.byteLength+65535)/65536|0;try{return C.grow(l),G(),1}catch{}},uD=i=>{var c=x.length;i>>>=0;var l=aD();if(i>l)return!1;for(var m=1;m<=4;m*=2){var v=c*(1+.2/m);v=Math.min(v,i+100663296);var R=Math.min(l,R0(Math.max(i,v),65536)),A=cD(R);if(A)return!0}return!1},U_={},lD=()=>p||"./this.program",Xu=()=>{if(!Xu.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:lD()};for(var l in U_)U_[l]===void 0?delete c[l]:c[l]=U_[l];var m=[];for(var l in c)m.push(`${l}=${c[l]}`);Xu.strings=m}return Xu.strings},fD=(i,c)=>{for(var l=0;l<i.length;++l)P[c++]=i.charCodeAt(l);P[c]=0},dD=(i,c)=>{var l=0;return Xu().forEach((m,v)=>{var R=c+l;j[i+v*4>>2]=R,fD(m,R),l+=m.length+1}),0},hD=(i,c)=>{var l=Xu();j[i>>2]=l.length;var m=0;return l.forEach(v=>m+=v.length+1),j[c>>2]=m,0};function mD(i){try{var c=De.getStreamFromFD(i);return b.close(c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return l.errno}}function pD(i,c){try{var l=0,m=0,v=0,R=De.getStreamFromFD(i),A=R.tty?2:b.isDir(R.mode)?3:b.isLink(R.mode)?7:4;return P[c]=A,L[c+2>>1]=v,At=[l>>>0,(be=l,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[c+8>>2]=At[0],F[c+12>>2]=At[1],At=[m>>>0,(be=m,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[c+16>>2]=At[0],F[c+20>>2]=At[1],0}catch(N){if(typeof b>"u"||N.name!=="ErrnoError")throw N;return N.errno}}var gD=(i,c,l,m)=>{for(var v=0,R=0;R<l;R++){var A=j[c>>2],N=j[c+4>>2];c+=8;var H=b.read(i,P,A,N,m);if(H<0)return-1;if(v+=H,H<N)break}return v};function _D(i,c,l,m){try{var v=De.getStreamFromFD(i),R=gD(v,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}function yD(i,c,l,m,v){var R=Yu(c,l);try{if(isNaN(R))return 61;var A=De.getStreamFromFD(i);return b.llseek(A,R,m),At=[A.position>>>0,(be=A.position,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[v>>2]=At[0],F[v+4>>2]=At[1],A.getdents&&R===0&&m===0&&(A.getdents=null),0}catch(N){if(typeof b>"u"||N.name!=="ErrnoError")throw N;return N.errno}}function bD(i){var l;try{var c=De.getStreamFromFD(i);return(l=c.stream_ops)!=null&&l.fsync?c.stream_ops.fsync(c):0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return m.errno}}var SD=(i,c,l,m)=>{for(var v=0,R=0;R<l;R++){var A=j[c>>2],N=j[c+4>>2];c+=8;var H=b.write(i,P,A,N,m);if(H<0)return-1;if(v+=H,H<N)break}return v};function vD(i,c,l,m){try{var v=De.getStreamFromFD(i),R=SD(v,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}var Ve=function(){const i=typeof Asyncify=="object"?Asyncify.handleAsync.bind(Asyncify):null;r.handleAsync=i;const c=new Map;r.setCallback=(l,m)=>c.set(l,m),r.getCallback=l=>c.get(l),r.deleteCallback=l=>c.delete(l),Ve=function(l,m,...v){const R=c.get(m);let A=null;const N=typeof R=="function"?R:R[A=Ei(v.shift())];if(l){if(i)return i(()=>N.apply(R,v));throw new Error("Synchronous WebAssembly cannot call async function")}const H=N.apply(R,v);if(typeof(H==null?void 0:H.then)=="function")throw console.error("unexpected Promise",N),new Error(`${A} unexpectedly returned a Promise`);return H}};function wD(...i){return Ve(!1,...i)}function ED(...i){return Ve(!0,...i)}function kD(...i){return Ve(!1,...i)}function $D(...i){return Ve(!0,...i)}function CD(...i){return Ve(!1,...i)}function TD(...i){return Ve(!0,...i)}function ID(...i){return Ve(!1,...i)}function RD(...i){return Ve(!0,...i)}function OD(...i){return Ve(!1,...i)}function qD(...i){return Ve(!0,...i)}function AD(...i){return Ve(!1,...i)}function PD(...i){return Ve(!0,...i)}function FD(...i){return Ve(!1,...i)}function ND(...i){return Ve(!0,...i)}function xD(...i){return Ve(!1,...i)}function DD(...i){return Ve(!0,...i)}function MD(...i){return Ve(!1,...i)}function LD(...i){return Ve(!0,...i)}function jD(...i){return Ve(!1,...i)}function UD(...i){return Ve(!0,...i)}function zD(...i){return Ve(!1,...i)}function BD(...i){return Ve(!0,...i)}function HD(...i){return Ve(!1,...i)}function VD(...i){return Ve(!0,...i)}function WD(...i){return Ve(!1,...i)}function KD(...i){return Ve(!0,...i)}function JD(...i){return Ve(!1,...i)}function GD(...i){return Ve(!0,...i)}function QD(...i){return Ve(!1,...i)}function YD(...i){return Ve(!0,...i)}function XD(...i){return Ve(!1,...i)}function ZD(...i){return Ve(!0,...i)}var eM=i=>{q=i,g(i,new $0(i))},tM=(i,c)=>{q=i,eM(i)},nM=i=>{if(i instanceof $0||i=="unwind")return q;g(1,i)},A0=(i,c)=>{i<128?c.push(i):c.push(i%128|128,i>>7)},rM=i=>{for(var c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[c[i[0]]]},m=1;m<i.length;++m)l.parameters.push(c[i[m]]);return l},sM=(i,c)=>{var l=i.slice(0,1),m=i.slice(1),v={i:127,p:127,j:126,f:125,d:124,e:111};c.push(96),A0(m.length,c);for(var R=0;R<m.length;++R)c.push(v[m[R]]);l=="v"?c.push(0):c.push(1,v[l])},oM=(i,c)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(rM(c),i);var l=[1];sM(c,l);var m=[0,97,115,109,1,0,0,0,1];A0(l.length,m),m.push(...l),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var v=new WebAssembly.Module(new Uint8Array(m)),R=new WebAssembly.Instance(v,{e:{f:i}}),A=R.exports.f;return A},Va,iM=i=>Va.get(i),aM=(i,c)=>{if(Wa)for(var l=i;l<i+c;l++){var m=iM(l);m&&Wa.set(m,l)}},Wa,cM=i=>(Wa||(Wa=new WeakMap,aM(0,Va.length)),Wa.get(i)||0),P0=[],uM=()=>{if(P0.length)return P0.pop();try{Va.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return Va.length-1},F0=(i,c)=>Va.set(i,c),lM=(i,c)=>{var l=cM(i);if(l)return l;var m=uM();try{F0(m,i)}catch(R){if(!(R instanceof TypeError))throw R;var v=oM(i,c);F0(m,v)}return Wa.set(i,m),m},N0=i=>{var c=r["_"+i];return c},x0=(i,c)=>{P.set(i,c)},D0=i=>B0(i),fM=i=>{var c=Ha(i)+1,l=D0(c);return Uo(i,l,c),l},zo=(i,c,l,m,v)=>{var R={string:le=>{var mt=0;return le!=null&&le!==0&&(mt=fM(le)),mt},array:le=>{var mt=D0(le.length);return x0(le,mt),mt}};function A(le){return c==="string"?Ei(le):c==="boolean"?!!le:le}var N=N0(i),H=[],te=0;if(m)for(var Ce=0;Ce<m.length;Ce++){var Oe=R[l[Ce]];Oe?(te===0&&(te=w3()),H[Ce]=Oe(m[Ce])):H[Ce]=m[Ce]}var Qe=N(...H);function ae(le){return te!==0&&v3(te),A(le)}return Qe=ae(Qe),Qe},dM=(i,c,l,m)=>{var v=!l||l.every(A=>A==="number"||A==="boolean"),R=c!=="string";return R&&v&&!m?N0(i):(...A)=>zo(i,c,l,A)},hM=i=>U0(),mM=(i,c,l)=>{if(l??(l=2147483647),l<2)return 0;l-=2;for(var m=c,v=l<i.length*2?l/2:i.length,R=0;R<v;++R){var A=i.charCodeAt(R);L[c>>1]=A,c+=2}return L[c>>1]=0,c-m},pM=(i,c,l)=>{if(l??(l=2147483647),l<4)return 0;for(var m=c,v=m+l-4,R=0;R<i.length;++R){var A=i.charCodeAt(R);if(A>=55296&&A<=57343){var N=i.charCodeAt(++R);A=65536+((A&1023)<<10)|N&1023}if(F[c>>2]=A,c+=4,c+4>v)break}return F[c>>2]=0,c-m},gM=i=>{for(var c="";;){var l=x[i++];if(!l)return c;c+=String.fromCharCode(l)}},M0=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,_M=(i,c)=>{for(var l=i,m=l>>1,v=m+c/2;!(m>=v)&&B[m];)++m;if(l=m<<1,l-i>32&&M0)return M0.decode(x.subarray(i,l));for(var R="",A=0;!(A>=c/2);++A){var N=L[i+A*2>>1];if(N==0)break;R+=String.fromCharCode(N)}return R},yM=(i,c)=>{for(var l=0,m="";!(l>=c/4);){var v=F[i+l*4>>2];if(v==0)break;if(++l,v>=65536){var R=v-65536;m+=String.fromCharCode(55296|R>>10,56320|R&1023)}else m+=String.fromCharCode(v)}return m};function bM(i){for(var c=[],l=0;l<i.length;l++){var m=i[l];m>255&&(m&=255),c.push(String.fromCharCode(m))}return c.join("")}b.createPreloadedFile=q3,b.staticInit(),ke.doesNotExistError=new b.ErrnoError(44),ke.doesNotExistError.stack="<generic error, no stack>",Ve();var SM={a:E3,Y:P3,$:F3,Z:N3,X:x3,b:M3,W:L3,y:j3,Q:U3,U:z3,N:B3,S:H3,L:V3,J:W3,I:K3,V:J3,G:G3,F:Q3,w:tD,u:nD,v:rD,M:sD,n:oD,m:iD,D:uD,O:dD,P:hD,o:mD,E:pD,K:_D,x:yD,R:bD,H:vD,s:wD,t:ED,ga:kD,ka:$D,i:CD,j:TD,c:ID,d:RD,ca:OD,da:qD,ea:AD,fa:PD,g:FD,h:ND,z:xD,A:DD,e:MD,f:LD,aa:jD,ba:UD,B:zD,C:BD,p:HD,q:VD,ha:WD,ia:KD,ja:JD,r:GD,k:QD,l:YD,T:XD,_:ZD},I=S3();r._sqlite3_status64=(i,c,l,m)=>(r._sqlite3_status64=I.na)(i,c,l,m),r._sqlite3_status=(i,c,l,m)=>(r._sqlite3_status=I.oa)(i,c,l,m),r._sqlite3_db_status=(i,c,l,m,v)=>(r._sqlite3_db_status=I.pa)(i,c,l,m,v),r._sqlite3_msize=i=>(r._sqlite3_msize=I.qa)(i),r._sqlite3_vfs_find=i=>(r._sqlite3_vfs_find=I.ra)(i),r._sqlite3_vfs_register=(i,c)=>(r._sqlite3_vfs_register=I.sa)(i,c),r._sqlite3_vfs_unregister=i=>(r._sqlite3_vfs_unregister=I.ta)(i),r._sqlite3_release_memory=i=>(r._sqlite3_release_memory=I.ua)(i),r._sqlite3_soft_heap_limit64=(i,c)=>(r._sqlite3_soft_heap_limit64=I.va)(i,c),r._sqlite3_memory_used=()=>(r._sqlite3_memory_used=I.wa)(),r._sqlite3_hard_heap_limit64=(i,c)=>(r._sqlite3_hard_heap_limit64=I.xa)(i,c),r._sqlite3_memory_highwater=i=>(r._sqlite3_memory_highwater=I.ya)(i),r._sqlite3_malloc=i=>(r._sqlite3_malloc=I.za)(i),r._sqlite3_malloc64=(i,c)=>(r._sqlite3_malloc64=I.Aa)(i,c),r._sqlite3_free=i=>(r._sqlite3_free=I.Ba)(i),r._sqlite3_realloc=(i,c)=>(r._sqlite3_realloc=I.Ca)(i,c),r._sqlite3_realloc64=(i,c,l)=>(r._sqlite3_realloc64=I.Da)(i,c,l),r._sqlite3_str_vappendf=(i,c,l)=>(r._sqlite3_str_vappendf=I.Ea)(i,c,l),r._sqlite3_str_append=(i,c,l)=>(r._sqlite3_str_append=I.Fa)(i,c,l),r._sqlite3_str_appendchar=(i,c,l)=>(r._sqlite3_str_appendchar=I.Ga)(i,c,l),r._sqlite3_str_appendall=(i,c)=>(r._sqlite3_str_appendall=I.Ha)(i,c),r._sqlite3_str_appendf=(i,c,l)=>(r._sqlite3_str_appendf=I.Ia)(i,c,l),r._sqlite3_str_finish=i=>(r._sqlite3_str_finish=I.Ja)(i),r._sqlite3_str_errcode=i=>(r._sqlite3_str_errcode=I.Ka)(i),r._sqlite3_str_length=i=>(r._sqlite3_str_length=I.La)(i),r._sqlite3_str_value=i=>(r._sqlite3_str_value=I.Ma)(i),r._sqlite3_str_reset=i=>(r._sqlite3_str_reset=I.Na)(i),r._sqlite3_str_new=i=>(r._sqlite3_str_new=I.Oa)(i),r._sqlite3_vmprintf=(i,c)=>(r._sqlite3_vmprintf=I.Pa)(i,c),r._sqlite3_mprintf=(i,c)=>(r._sqlite3_mprintf=I.Qa)(i,c),r._sqlite3_vsnprintf=(i,c,l,m)=>(r._sqlite3_vsnprintf=I.Ra)(i,c,l,m),r._sqlite3_snprintf=(i,c,l,m)=>(r._sqlite3_snprintf=I.Sa)(i,c,l,m),r._sqlite3_log=(i,c,l)=>(r._sqlite3_log=I.Ta)(i,c,l),r._sqlite3_randomness=(i,c)=>(r._sqlite3_randomness=I.Ua)(i,c),r._sqlite3_stricmp=(i,c)=>(r._sqlite3_stricmp=I.Va)(i,c),r._sqlite3_strnicmp=(i,c,l)=>(r._sqlite3_strnicmp=I.Wa)(i,c,l),r._sqlite3_os_init=()=>(r._sqlite3_os_init=I.Xa)(),r._sqlite3_os_end=()=>(r._sqlite3_os_end=I.Ya)(),r._sqlite3_serialize=(i,c,l,m)=>(r._sqlite3_serialize=I.Za)(i,c,l,m),r._sqlite3_prepare_v2=(i,c,l,m,v)=>(r._sqlite3_prepare_v2=I._a)(i,c,l,m,v),r._sqlite3_step=i=>(r._sqlite3_step=I.$a)(i),r._sqlite3_column_int64=(i,c)=>(r._sqlite3_column_int64=I.ab)(i,c),r._sqlite3_reset=i=>(r._sqlite3_reset=I.bb)(i),r._sqlite3_exec=(i,c,l,m,v)=>(r._sqlite3_exec=I.cb)(i,c,l,m,v),r._sqlite3_column_int=(i,c)=>(r._sqlite3_column_int=I.db)(i,c),r._sqlite3_finalize=i=>(r._sqlite3_finalize=I.eb)(i),r._sqlite3_deserialize=(i,c,l,m,v,R,A,N)=>(r._sqlite3_deserialize=I.fb)(i,c,l,m,v,R,A,N),r._sqlite3_database_file_object=i=>(r._sqlite3_database_file_object=I.gb)(i),r._sqlite3_backup_init=(i,c,l,m)=>(r._sqlite3_backup_init=I.hb)(i,c,l,m),r._sqlite3_backup_step=(i,c)=>(r._sqlite3_backup_step=I.ib)(i,c),r._sqlite3_backup_finish=i=>(r._sqlite3_backup_finish=I.jb)(i),r._sqlite3_backup_remaining=i=>(r._sqlite3_backup_remaining=I.kb)(i),r._sqlite3_backup_pagecount=i=>(r._sqlite3_backup_pagecount=I.lb)(i),r._sqlite3_clear_bindings=i=>(r._sqlite3_clear_bindings=I.mb)(i),r._sqlite3_value_blob=i=>(r._sqlite3_value_blob=I.nb)(i),r._sqlite3_value_text=i=>(r._sqlite3_value_text=I.ob)(i),r._sqlite3_value_bytes=i=>(r._sqlite3_value_bytes=I.pb)(i),r._sqlite3_value_bytes16=i=>(r._sqlite3_value_bytes16=I.qb)(i),r._sqlite3_value_double=i=>(r._sqlite3_value_double=I.rb)(i),r._sqlite3_value_int=i=>(r._sqlite3_value_int=I.sb)(i),r._sqlite3_value_int64=i=>(r._sqlite3_value_int64=I.tb)(i),r._sqlite3_value_subtype=i=>(r._sqlite3_value_subtype=I.ub)(i),r._sqlite3_value_pointer=(i,c)=>(r._sqlite3_value_pointer=I.vb)(i,c),r._sqlite3_value_text16=i=>(r._sqlite3_value_text16=I.wb)(i),r._sqlite3_value_text16be=i=>(r._sqlite3_value_text16be=I.xb)(i),r._sqlite3_value_text16le=i=>(r._sqlite3_value_text16le=I.yb)(i),r._sqlite3_value_type=i=>(r._sqlite3_value_type=I.zb)(i),r._sqlite3_value_encoding=i=>(r._sqlite3_value_encoding=I.Ab)(i),r._sqlite3_value_nochange=i=>(r._sqlite3_value_nochange=I.Bb)(i),r._sqlite3_value_frombind=i=>(r._sqlite3_value_frombind=I.Cb)(i),r._sqlite3_value_dup=i=>(r._sqlite3_value_dup=I.Db)(i),r._sqlite3_value_free=i=>(r._sqlite3_value_free=I.Eb)(i),r._sqlite3_result_blob=(i,c,l,m)=>(r._sqlite3_result_blob=I.Fb)(i,c,l,m),r._sqlite3_result_blob64=(i,c,l,m,v)=>(r._sqlite3_result_blob64=I.Gb)(i,c,l,m,v),r._sqlite3_result_double=(i,c)=>(r._sqlite3_result_double=I.Hb)(i,c),r._sqlite3_result_error=(i,c,l)=>(r._sqlite3_result_error=I.Ib)(i,c,l),r._sqlite3_result_error16=(i,c,l)=>(r._sqlite3_result_error16=I.Jb)(i,c,l),r._sqlite3_result_int=(i,c)=>(r._sqlite3_result_int=I.Kb)(i,c),r._sqlite3_result_int64=(i,c,l)=>(r._sqlite3_result_int64=I.Lb)(i,c,l),r._sqlite3_result_null=i=>(r._sqlite3_result_null=I.Mb)(i),r._sqlite3_result_pointer=(i,c,l,m)=>(r._sqlite3_result_pointer=I.Nb)(i,c,l,m),r._sqlite3_result_subtype=(i,c)=>(r._sqlite3_result_subtype=I.Ob)(i,c),r._sqlite3_result_text=(i,c,l,m)=>(r._sqlite3_result_text=I.Pb)(i,c,l,m),r._sqlite3_result_text64=(i,c,l,m,v,R)=>(r._sqlite3_result_text64=I.Qb)(i,c,l,m,v,R),r._sqlite3_result_text16=(i,c,l,m)=>(r._sqlite3_result_text16=I.Rb)(i,c,l,m),r._sqlite3_result_text16be=(i,c,l,m)=>(r._sqlite3_result_text16be=I.Sb)(i,c,l,m),r._sqlite3_result_text16le=(i,c,l,m)=>(r._sqlite3_result_text16le=I.Tb)(i,c,l,m),r._sqlite3_result_value=(i,c)=>(r._sqlite3_result_value=I.Ub)(i,c),r._sqlite3_result_error_toobig=i=>(r._sqlite3_result_error_toobig=I.Vb)(i),r._sqlite3_result_zeroblob=(i,c)=>(r._sqlite3_result_zeroblob=I.Wb)(i,c),r._sqlite3_result_zeroblob64=(i,c,l)=>(r._sqlite3_result_zeroblob64=I.Xb)(i,c,l),r._sqlite3_result_error_code=(i,c)=>(r._sqlite3_result_error_code=I.Yb)(i,c),r._sqlite3_result_error_nomem=i=>(r._sqlite3_result_error_nomem=I.Zb)(i),r._sqlite3_user_data=i=>(r._sqlite3_user_data=I._b)(i),r._sqlite3_context_db_handle=i=>(r._sqlite3_context_db_handle=I.$b)(i),r._sqlite3_vtab_nochange=i=>(r._sqlite3_vtab_nochange=I.ac)(i),r._sqlite3_vtab_in_first=(i,c)=>(r._sqlite3_vtab_in_first=I.bc)(i,c),r._sqlite3_vtab_in_next=(i,c)=>(r._sqlite3_vtab_in_next=I.cc)(i,c),r._sqlite3_aggregate_context=(i,c)=>(r._sqlite3_aggregate_context=I.dc)(i,c),r._sqlite3_get_auxdata=(i,c)=>(r._sqlite3_get_auxdata=I.ec)(i,c),r._sqlite3_set_auxdata=(i,c,l,m)=>(r._sqlite3_set_auxdata=I.fc)(i,c,l,m),r._sqlite3_column_count=i=>(r._sqlite3_column_count=I.gc)(i),r._sqlite3_data_count=i=>(r._sqlite3_data_count=I.hc)(i),r._sqlite3_column_blob=(i,c)=>(r._sqlite3_column_blob=I.ic)(i,c),r._sqlite3_column_bytes=(i,c)=>(r._sqlite3_column_bytes=I.jc)(i,c),r._sqlite3_column_bytes16=(i,c)=>(r._sqlite3_column_bytes16=I.kc)(i,c),r._sqlite3_column_double=(i,c)=>(r._sqlite3_column_double=I.lc)(i,c),r._sqlite3_column_text=(i,c)=>(r._sqlite3_column_text=I.mc)(i,c),r._sqlite3_column_value=(i,c)=>(r._sqlite3_column_value=I.nc)(i,c),r._sqlite3_column_text16=(i,c)=>(r._sqlite3_column_text16=I.oc)(i,c),r._sqlite3_column_type=(i,c)=>(r._sqlite3_column_type=I.pc)(i,c),r._sqlite3_column_name=(i,c)=>(r._sqlite3_column_name=I.qc)(i,c),r._sqlite3_column_name16=(i,c)=>(r._sqlite3_column_name16=I.rc)(i,c),r._sqlite3_bind_blob=(i,c,l,m,v)=>(r._sqlite3_bind_blob=I.sc)(i,c,l,m,v),r._sqlite3_bind_blob64=(i,c,l,m,v,R)=>(r._sqlite3_bind_blob64=I.tc)(i,c,l,m,v,R),r._sqlite3_bind_double=(i,c,l)=>(r._sqlite3_bind_double=I.uc)(i,c,l),r._sqlite3_bind_int=(i,c,l)=>(r._sqlite3_bind_int=I.vc)(i,c,l),r._sqlite3_bind_int64=(i,c,l,m)=>(r._sqlite3_bind_int64=I.wc)(i,c,l,m),r._sqlite3_bind_null=(i,c)=>(r._sqlite3_bind_null=I.xc)(i,c),r._sqlite3_bind_pointer=(i,c,l,m,v)=>(r._sqlite3_bind_pointer=I.yc)(i,c,l,m,v),r._sqlite3_bind_text=(i,c,l,m,v)=>(r._sqlite3_bind_text=I.zc)(i,c,l,m,v),r._sqlite3_bind_text64=(i,c,l,m,v,R,A)=>(r._sqlite3_bind_text64=I.Ac)(i,c,l,m,v,R,A),r._sqlite3_bind_text16=(i,c,l,m,v)=>(r._sqlite3_bind_text16=I.Bc)(i,c,l,m,v),r._sqlite3_bind_value=(i,c,l)=>(r._sqlite3_bind_value=I.Cc)(i,c,l),r._sqlite3_bind_zeroblob=(i,c,l)=>(r._sqlite3_bind_zeroblob=I.Dc)(i,c,l),r._sqlite3_bind_zeroblob64=(i,c,l,m)=>(r._sqlite3_bind_zeroblob64=I.Ec)(i,c,l,m),r._sqlite3_bind_parameter_count=i=>(r._sqlite3_bind_parameter_count=I.Fc)(i),r._sqlite3_bind_parameter_name=(i,c)=>(r._sqlite3_bind_parameter_name=I.Gc)(i,c),r._sqlite3_bind_parameter_index=(i,c)=>(r._sqlite3_bind_parameter_index=I.Hc)(i,c),r._sqlite3_db_handle=i=>(r._sqlite3_db_handle=I.Ic)(i),r._sqlite3_stmt_readonly=i=>(r._sqlite3_stmt_readonly=I.Jc)(i),r._sqlite3_stmt_isexplain=i=>(r._sqlite3_stmt_isexplain=I.Kc)(i),r._sqlite3_stmt_explain=(i,c)=>(r._sqlite3_stmt_explain=I.Lc)(i,c),r._sqlite3_stmt_busy=i=>(r._sqlite3_stmt_busy=I.Mc)(i),r._sqlite3_next_stmt=(i,c)=>(r._sqlite3_next_stmt=I.Nc)(i,c),r._sqlite3_stmt_status=(i,c,l)=>(r._sqlite3_stmt_status=I.Oc)(i,c,l),r._sqlite3_sql=i=>(r._sqlite3_sql=I.Pc)(i),r._sqlite3_expanded_sql=i=>(r._sqlite3_expanded_sql=I.Qc)(i),r._sqlite3_value_numeric_type=i=>(r._sqlite3_value_numeric_type=I.Rc)(i),r._sqlite3_blob_open=(i,c,l,m,v,R,A,N)=>(r._sqlite3_blob_open=I.Sc)(i,c,l,m,v,R,A,N),r._sqlite3_blob_close=i=>(r._sqlite3_blob_close=I.Tc)(i),r._sqlite3_blob_read=(i,c,l,m)=>(r._sqlite3_blob_read=I.Uc)(i,c,l,m),r._sqlite3_blob_write=(i,c,l,m)=>(r._sqlite3_blob_write=I.Vc)(i,c,l,m),r._sqlite3_blob_bytes=i=>(r._sqlite3_blob_bytes=I.Wc)(i),r._sqlite3_blob_reopen=(i,c,l)=>(r._sqlite3_blob_reopen=I.Xc)(i,c,l),r._sqlite3_set_authorizer=(i,c,l)=>(r._sqlite3_set_authorizer=I.Yc)(i,c,l),r._sqlite3_strglob=(i,c)=>(r._sqlite3_strglob=I.Zc)(i,c),r._sqlite3_strlike=(i,c,l)=>(r._sqlite3_strlike=I._c)(i,c,l),r._sqlite3_errmsg=i=>(r._sqlite3_errmsg=I.$c)(i),r._sqlite3_auto_extension=i=>(r._sqlite3_auto_extension=I.ad)(i),r._sqlite3_cancel_auto_extension=i=>(r._sqlite3_cancel_auto_extension=I.bd)(i),r._sqlite3_reset_auto_extension=()=>(r._sqlite3_reset_auto_extension=I.cd)(),r._sqlite3_prepare=(i,c,l,m,v)=>(r._sqlite3_prepare=I.dd)(i,c,l,m,v),r._sqlite3_prepare_v3=(i,c,l,m,v,R)=>(r._sqlite3_prepare_v3=I.ed)(i,c,l,m,v,R),r._sqlite3_prepare16=(i,c,l,m,v)=>(r._sqlite3_prepare16=I.fd)(i,c,l,m,v),r._sqlite3_prepare16_v2=(i,c,l,m,v)=>(r._sqlite3_prepare16_v2=I.gd)(i,c,l,m,v),r._sqlite3_prepare16_v3=(i,c,l,m,v,R)=>(r._sqlite3_prepare16_v3=I.hd)(i,c,l,m,v,R),r._sqlite3_get_table=(i,c,l,m,v,R)=>(r._sqlite3_get_table=I.id)(i,c,l,m,v,R),r._sqlite3_free_table=i=>(r._sqlite3_free_table=I.jd)(i),r._sqlite3_create_module=(i,c,l,m)=>(r._sqlite3_create_module=I.kd)(i,c,l,m),r._sqlite3_create_module_v2=(i,c,l,m,v)=>(r._sqlite3_create_module_v2=I.ld)(i,c,l,m,v),r._sqlite3_drop_modules=(i,c)=>(r._sqlite3_drop_modules=I.md)(i,c),r._sqlite3_declare_vtab=(i,c)=>(r._sqlite3_declare_vtab=I.nd)(i,c),r._sqlite3_vtab_on_conflict=i=>(r._sqlite3_vtab_on_conflict=I.od)(i),r._sqlite3_vtab_config=(i,c,l)=>(r._sqlite3_vtab_config=I.pd)(i,c,l),r._sqlite3_vtab_collation=(i,c)=>(r._sqlite3_vtab_collation=I.qd)(i,c),r._sqlite3_vtab_in=(i,c,l)=>(r._sqlite3_vtab_in=I.rd)(i,c,l),r._sqlite3_vtab_rhs_value=(i,c,l)=>(r._sqlite3_vtab_rhs_value=I.sd)(i,c,l),r._sqlite3_vtab_distinct=i=>(r._sqlite3_vtab_distinct=I.td)(i),r._sqlite3_keyword_name=(i,c,l)=>(r._sqlite3_keyword_name=I.ud)(i,c,l),r._sqlite3_keyword_count=()=>(r._sqlite3_keyword_count=I.vd)(),r._sqlite3_keyword_check=(i,c)=>(r._sqlite3_keyword_check=I.wd)(i,c),r._sqlite3_complete=i=>(r._sqlite3_complete=I.xd)(i),r._sqlite3_complete16=i=>(r._sqlite3_complete16=I.yd)(i),r._sqlite3_libversion=()=>(r._sqlite3_libversion=I.zd)(),r._sqlite3_libversion_number=()=>(r._sqlite3_libversion_number=I.Ad)(),r._sqlite3_threadsafe=()=>(r._sqlite3_threadsafe=I.Bd)(),r._sqlite3_initialize=()=>(r._sqlite3_initialize=I.Cd)(),r._sqlite3_shutdown=()=>(r._sqlite3_shutdown=I.Dd)(),r._sqlite3_config=(i,c)=>(r._sqlite3_config=I.Ed)(i,c),r._sqlite3_db_mutex=i=>(r._sqlite3_db_mutex=I.Fd)(i),r._sqlite3_db_release_memory=i=>(r._sqlite3_db_release_memory=I.Gd)(i),r._sqlite3_db_cacheflush=i=>(r._sqlite3_db_cacheflush=I.Hd)(i),r._sqlite3_db_config=(i,c,l)=>(r._sqlite3_db_config=I.Id)(i,c,l),r._sqlite3_last_insert_rowid=i=>(r._sqlite3_last_insert_rowid=I.Jd)(i),r._sqlite3_set_last_insert_rowid=(i,c,l)=>(r._sqlite3_set_last_insert_rowid=I.Kd)(i,c,l),r._sqlite3_changes64=i=>(r._sqlite3_changes64=I.Ld)(i),r._sqlite3_changes=i=>(r._sqlite3_changes=I.Md)(i),r._sqlite3_total_changes64=i=>(r._sqlite3_total_changes64=I.Nd)(i),r._sqlite3_total_changes=i=>(r._sqlite3_total_changes=I.Od)(i),r._sqlite3_txn_state=(i,c)=>(r._sqlite3_txn_state=I.Pd)(i,c),r._sqlite3_close=i=>(r._sqlite3_close=I.Qd)(i),r._sqlite3_close_v2=i=>(r._sqlite3_close_v2=I.Rd)(i),r._sqlite3_busy_handler=(i,c,l)=>(r._sqlite3_busy_handler=I.Sd)(i,c,l),r._sqlite3_progress_handler=(i,c,l,m)=>(r._sqlite3_progress_handler=I.Td)(i,c,l,m),r._sqlite3_busy_timeout=(i,c)=>(r._sqlite3_busy_timeout=I.Ud)(i,c),r._sqlite3_interrupt=i=>(r._sqlite3_interrupt=I.Vd)(i),r._sqlite3_is_interrupted=i=>(r._sqlite3_is_interrupted=I.Wd)(i),r._sqlite3_create_function=(i,c,l,m,v,R,A,N)=>(r._sqlite3_create_function=I.Xd)(i,c,l,m,v,R,A,N),r._sqlite3_create_function_v2=(i,c,l,m,v,R,A,N,H)=>(r._sqlite3_create_function_v2=I.Yd)(i,c,l,m,v,R,A,N,H),r._sqlite3_create_window_function=(i,c,l,m,v,R,A,N,H,te)=>(r._sqlite3_create_window_function=I.Zd)(i,c,l,m,v,R,A,N,H,te),r._sqlite3_create_function16=(i,c,l,m,v,R,A,N)=>(r._sqlite3_create_function16=I._d)(i,c,l,m,v,R,A,N),r._sqlite3_overload_function=(i,c,l)=>(r._sqlite3_overload_function=I.$d)(i,c,l),r._sqlite3_trace_v2=(i,c,l,m)=>(r._sqlite3_trace_v2=I.ae)(i,c,l,m),r._sqlite3_commit_hook=(i,c,l)=>(r._sqlite3_commit_hook=I.be)(i,c,l),r._sqlite3_update_hook=(i,c,l)=>(r._sqlite3_update_hook=I.ce)(i,c,l),r._sqlite3_rollback_hook=(i,c,l)=>(r._sqlite3_rollback_hook=I.de)(i,c,l),r._sqlite3_autovacuum_pages=(i,c,l,m)=>(r._sqlite3_autovacuum_pages=I.ee)(i,c,l,m),r._sqlite3_wal_autocheckpoint=(i,c)=>(r._sqlite3_wal_autocheckpoint=I.fe)(i,c),r._sqlite3_wal_hook=(i,c,l)=>(r._sqlite3_wal_hook=I.ge)(i,c,l),r._sqlite3_wal_checkpoint_v2=(i,c,l,m,v)=>(r._sqlite3_wal_checkpoint_v2=I.he)(i,c,l,m,v),r._sqlite3_wal_checkpoint=(i,c)=>(r._sqlite3_wal_checkpoint=I.ie)(i,c),r._sqlite3_error_offset=i=>(r._sqlite3_error_offset=I.je)(i),r._sqlite3_errmsg16=i=>(r._sqlite3_errmsg16=I.ke)(i),r._sqlite3_errcode=i=>(r._sqlite3_errcode=I.le)(i),r._sqlite3_extended_errcode=i=>(r._sqlite3_extended_errcode=I.me)(i),r._sqlite3_system_errno=i=>(r._sqlite3_system_errno=I.ne)(i),r._sqlite3_errstr=i=>(r._sqlite3_errstr=I.oe)(i),r._sqlite3_limit=(i,c,l)=>(r._sqlite3_limit=I.pe)(i,c,l),r._sqlite3_open=(i,c)=>(r._sqlite3_open=I.qe)(i,c),r._sqlite3_open_v2=(i,c,l,m)=>(r._sqlite3_open_v2=I.re)(i,c,l,m),r._sqlite3_open16=(i,c)=>(r._sqlite3_open16=I.se)(i,c),r._sqlite3_create_collation=(i,c,l,m,v)=>(r._sqlite3_create_collation=I.te)(i,c,l,m,v),r._sqlite3_create_collation_v2=(i,c,l,m,v,R)=>(r._sqlite3_create_collation_v2=I.ue)(i,c,l,m,v,R),r._sqlite3_create_collation16=(i,c,l,m,v)=>(r._sqlite3_create_collation16=I.ve)(i,c,l,m,v),r._sqlite3_collation_needed=(i,c,l)=>(r._sqlite3_collation_needed=I.we)(i,c,l),r._sqlite3_collation_needed16=(i,c,l)=>(r._sqlite3_collation_needed16=I.xe)(i,c,l),r._sqlite3_get_clientdata=(i,c)=>(r._sqlite3_get_clientdata=I.ye)(i,c),r._sqlite3_set_clientdata=(i,c,l,m)=>(r._sqlite3_set_clientdata=I.ze)(i,c,l,m),r._sqlite3_get_autocommit=i=>(r._sqlite3_get_autocommit=I.Ae)(i),r._sqlite3_table_column_metadata=(i,c,l,m,v,R,A,N,H)=>(r._sqlite3_table_column_metadata=I.Be)(i,c,l,m,v,R,A,N,H),r._sqlite3_sleep=i=>(r._sqlite3_sleep=I.Ce)(i),r._sqlite3_extended_result_codes=(i,c)=>(r._sqlite3_extended_result_codes=I.De)(i,c),r._sqlite3_file_control=(i,c,l,m)=>(r._sqlite3_file_control=I.Ee)(i,c,l,m),r._sqlite3_test_control=(i,c)=>(r._sqlite3_test_control=I.Fe)(i,c),r._sqlite3_create_filename=(i,c,l,m,v)=>(r._sqlite3_create_filename=I.Ge)(i,c,l,m,v),r._sqlite3_free_filename=i=>(r._sqlite3_free_filename=I.He)(i),r._sqlite3_uri_parameter=(i,c)=>(r._sqlite3_uri_parameter=I.Ie)(i,c),r._sqlite3_uri_key=(i,c)=>(r._sqlite3_uri_key=I.Je)(i,c),r._sqlite3_uri_boolean=(i,c,l)=>(r._sqlite3_uri_boolean=I.Ke)(i,c,l),r._sqlite3_uri_int64=(i,c,l,m)=>(r._sqlite3_uri_int64=I.Le)(i,c,l,m),r._sqlite3_filename_database=i=>(r._sqlite3_filename_database=I.Me)(i),r._sqlite3_filename_journal=i=>(r._sqlite3_filename_journal=I.Ne)(i),r._sqlite3_filename_wal=i=>(r._sqlite3_filename_wal=I.Oe)(i),r._sqlite3_db_name=(i,c)=>(r._sqlite3_db_name=I.Pe)(i,c),r._sqlite3_db_filename=(i,c)=>(r._sqlite3_db_filename=I.Qe)(i,c),r._sqlite3_db_readonly=(i,c)=>(r._sqlite3_db_readonly=I.Re)(i,c),r._sqlite3_compileoption_used=i=>(r._sqlite3_compileoption_used=I.Se)(i),r._sqlite3_compileoption_get=i=>(r._sqlite3_compileoption_get=I.Te)(i),r._sqlite3session_create=(i,c,l)=>(r._sqlite3session_create=I.Ue)(i,c,l),r._sqlite3session_delete=i=>(r._sqlite3session_delete=I.Ve)(i),r._sqlite3session_attach=(i,c)=>(r._sqlite3session_attach=I.We)(i,c),r._sqlite3session_changeset=(i,c,l)=>(r._sqlite3session_changeset=I.Xe)(i,c,l),r._sqlite3session_enable=(i,c)=>(r._sqlite3session_enable=I.Ye)(i,c),r._sqlite3changeset_start=(i,c,l)=>(r._sqlite3changeset_start=I.Ze)(i,c,l),r._sqlite3changeset_finalize=i=>(r._sqlite3changeset_finalize=I._e)(i),r._sqlite3changeset_invert=(i,c,l,m)=>(r._sqlite3changeset_invert=I.$e)(i,c,l,m),r._sqlite3changeset_apply=(i,c,l,m,v,R)=>(r._sqlite3changeset_apply=I.af)(i,c,l,m,v,R),r._sqlite3_sourceid=()=>(r._sqlite3_sourceid=I.bf)(),r._malloc=i=>(r._malloc=I.cf)(i),r._free=i=>(r._free=I.df)(i),r._RegisterExtensionFunctions=i=>(r._RegisterExtensionFunctions=I.ef)(i),r._getSqliteFree=()=>(r._getSqliteFree=I.ff)();var L0=r._main=(i,c)=>(L0=r._main=I.gf)(i,c);r._libauthorizer_set_authorizer=(i,c,l)=>(r._libauthorizer_set_authorizer=I.hf)(i,c,l),r._libfunction_create_function=(i,c,l,m,v,R,A,N)=>(r._libfunction_create_function=I.jf)(i,c,l,m,v,R,A,N),r._libhook_commit_hook=(i,c,l)=>(r._libhook_commit_hook=I.kf)(i,c,l),r._libhook_update_hook=(i,c,l)=>(r._libhook_update_hook=I.lf)(i,c,l),r._libprogress_progress_handler=(i,c,l,m)=>(r._libprogress_progress_handler=I.mf)(i,c,l,m),r._libvfs_vfs_register=(i,c,l,m,v,R)=>(r._libvfs_vfs_register=I.nf)(i,c,l,m,v,R);var j0=(i,c)=>(j0=I.pf)(i,c),U0=()=>(U0=I.qf)(),z0=i=>(z0=I.rf)(i),B0=i=>(B0=I.sf)(i),H0=()=>(H0=I.tf)();r._sqlite3_version=5472,r.getTempRet0=hM,r.ccall=zo,r.cwrap=dM,r.addFunction=lM,r.setValue=za,r.getValue=C0,r.UTF8ToString=Ei,r.stringToUTF8=Uo,r.lengthBytesUTF8=Ha,r.intArrayFromString=L_,r.intArrayToString=bM,r.AsciiToString=gM,r.UTF16ToString=_M,r.stringToUTF16=mM,r.UTF32ToString=yM,r.stringToUTF32=pM,r.writeArrayToMemory=x0;var Kd;Lo=function i(){Kd||V0(),Kd||(Lo=i)};function vM(){var i=L0,c=0,l=0;try{var m=i(c,l);return tM(m,!0),m}catch(v){return nM(v)}}function V0(){if(is>0||(He(),is>0))return;function i(){var c;Kd||(Kd=!0,r.calledRun=!0,!$&&(Lt(),An(),s(r),(c=r.onRuntimeInitialized)==null||c.call(r),W0&&vM(),Ju()))}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var W0=!0;return r.noInitialRun&&(W0=!1),V0(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.set_authorizer=function(l,m,v){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),za(c,m instanceof i?1:0,"i32");const R=zo("libauthorizer_set_authorizer","number",["number","number","number"],[l,m?1:0,c]);return!R&&m&&r.setCallback(c,(A,N,H,te,Ce,Oe)=>m(v,N,H,te,Ce,Oe)),R}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor,c=["xFunc","xStep","xFinal"],l=new Map;r.create_function=function(m,v,R,A,N,H,te,Ce){const Oe=r._sqlite3_malloc(4),Qe={xFunc:H,xStep:te,xFinal:Ce};za(Oe,c.reduce((le,mt,Vn)=>Qe[mt]instanceof i?le|1<<Vn:le,0),"i32");const ae=zo("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[m,v,R,A,Oe,H?1:0,te?1:0,Ce?1:0]);if(!ae){if(l.has(v)){const le=l.get(v);r.deleteCallback(le)}l.set(v,Oe),r.setCallback(Oe,{xFunc:H,xStep:te,xFinal:Ce})}return ae}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.update_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),za(c,m instanceof i?1:0,"i32"),zo("libhook_update_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,(v,R,A,N,H,te)=>m(R,A,N,H,te))}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.commit_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),za(c,m instanceof i?1:0,"i32"),zo("libhook_commit_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,v=>m())}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.progress_handler=function(l,m,v,R){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),za(c,v instanceof i?1:0,"i32"),zo("libprogress_progress_handler","number",["number","number","number","number"],[l,m,v?1:0,c]),v&&r.setCallback(c,A=>v(R))}}(),function(){const i=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],c=new Map;r.vfs_register=function(l,m){let v=0,R=0;i.forEach((N,H)=>{l[N]&&(v|=1<<H,l.hasAsyncMethod(N)&&(R|=1<<H))});const A=r._sqlite3_malloc(4);try{const N=zo("libvfs_vfs_register","number",["string","number","number","number","number","number"],[l.name,l.mxPathname,v,R,m?1:0,A]);if(!N){if(c.has(l.name)){const te=c.get(l.name);r.deleteCallback(te)}const H=C0(A,"*");c.set(l.name,H),r.setCallback(H,l)}return N}finally{r._sqlite3_free(A)}}}(),n=a,n}})();const Nae=async()=>{const e=await Fae(),t=Pae(e);return t.module=e,t},p0=typeof navigator>"u"||navigator.storage===void 0?new Proxy({},{get:()=>Promise.reject(new Error("Can't get OPFS root handle in this environment as navigator.storage is undefined"))}):navigator.storage.getDirectory(),xae=async e=>{const t=await p0;if(e===void 0)return t;let n=t;const r=e==null?void 0:e.split("/").filter(Boolean);for(;r.length>0;)n=await n.getDirectoryHandle(r.shift());return n},s3=async(e=p0,t=Number.POSITIVE_INFINITY,n="")=>{if(t<0)return;const r=await e,s=r.values();for await(const o of s){const a=o.kind==="directory",u=o.kind==="file"?await o.getFile().then(f=>qre(f.size)):void 0;if(console.log(`${n}${a?"📁":"📄"} ${o.name} ${u?`(${u})`:""}`),a){const f=await r.getDirectoryHandle(o.name);await s3(f,t-1,`${n}  `)}}},Dae=async e=>{if(e.kind==="directory")for await(const t of e.keys())await e.removeEntry(t,{recursive:!0})};var Mae=Object.freeze({__proto__:null,deleteAll:Dae,getDirHandle:xae,printTree:s3,rootHandlePromise:p0});class zce extends Lr()("PersistedSqliteError",{cause:Ea}){}const Lae=(e,t)=>{if(e===void 0||e===""||e==="/")return`livestore-${t}@${JC}`;if(e.includes("/"))throw new Error(`@livestore/adapter-web:worker:sanitizeOpfsDir: Nested directories are not yet supported ('${e}')`);return`${e}@${JC}`},jae=e=>`state${e.state.sqlite.migrations.strategy==="manual"?"fixed":e.state.sqlite.hash.toString()}.db`,Uae=e=>Gse({channelName:`livestore.shutdown.${e}`,schema:Mie}),zae=Y({type:Fe("opfs"),directory:We(D)}),Bae=ve(zae);Wu({key:D,value:Ro});var NS;(function(e){class t extends xn()("InitialMessage",{payload:{port:C_,storeId:D,clientId:D},success:vs,failure:Ne}){}e.InitialMessage=t;class n extends ve(t){}e.Request=n})(NS||(NS={}));var Wn;(function(e){class t extends xn()("InitialMessage",{payload:{storageOptions:Bae,devtoolsEnabled:Zr,storeId:D,clientId:D,debugInstanceId:D,syncPayload:g_(Ro)},success:vs,failure:Ne}){}e.InitialMessage=t;class n extends xn()("BootStatusStream",{payload:{},success:Soe,failure:Ne}){}e.BootStatusStream=n;class r extends xn()("PushToLeader",{payload:{batch:xe(Yoe)},success:vs,failure:ve(Ne,i0)}){}e.PushToLeader=r;class s extends xn()("PullStream",{payload:{cursor:boe},success:Y({payload:p2,mergeCounter:nt}),failure:Ne}){}e.PullStream=s;class o extends xn()("Export",{payload:{},success:Ac,failure:Ne}){}e.Export=o;class a extends xn()("ExportEventlog",{payload:{},success:Ac,failure:Ne}){}e.ExportEventlog=a;class u extends xn()("GetRecreateSnapshot",{payload:{},success:Y({snapshot:Ac,migrationsReport:woe}),failure:Ne}){}e.GetRecreateSnapshot=u;class f extends xn()("GetLeaderHead",{payload:{},success:En,failure:Ne}){}e.GetLeaderHead=f;class h extends xn()("GetLeaderSyncState",{payload:{},success:_s,failure:Ne}){}e.GetLeaderSyncState=h;class p extends xn()("Shutdown",{payload:{},success:vs,failure:Ne}){}e.Shutdown=p;class g extends xn()("ExtraDevtoolsMessage",{payload:{message:P2},success:vs,failure:Ne}){}e.ExtraDevtoolsMessage=g,e.Request=ve(t,n,r,s,o,a,u,f,h,p,g,f0)})(Wn||(Wn={}));var lT;(function(e){class t extends me("FromClientSession",{initialMessage:Wn.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends xn()("InitialMessage",{payload:{payload:ve(t,me("FromWebBridge",{})),liveStoreVersion:Fe(P_)},success:vs,failure:Ne}){}e.InitialMessage=n;class r extends xn()("UpdateMessagePort",{payload:{port:C_},success:vs,failure:Ne}){}e.UpdateMessagePort=r;class s extends ve(n,r,Wn.BootStatusStream,Wn.PushToLeader,Wn.PullStream,Wn.Export,Wn.GetRecreateSnapshot,Wn.ExportEventlog,Wn.GetLeaderHead,Wn.GetLeaderSyncState,Wn.Shutdown,Wn.ExtraDevtoolsMessage,f0){}e.Request=s})(lT||(lT={}));E_()&&(globalThis.__debugLiveStoreUtils={opfs:Mae,blobUrl:e=>URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),runSync:e=>$s(e),runFork:e=>Do(e)});const Hae=e=>{Vae(e).pipe(Do)},Vae=e=>{var n;const t=(n=e.otelOptions)!=null&&n.tracer?BP(Se(kre,HP)).pipe(zP(zw($re,e.otelOptions.tracer))):void 0;return Wae(e).pipe(Bw(soe),Qx,di,wt,$c({thread:self.name}),In(xne(self.name)),In(xse),xs?eoe(r=>console.createTask(r)):ie,t?In(t):ie,u9(ioe()),l9(4096),kee(Kv))},Wae=e=>Gx(NS.InitialMessage,{InitialMessage:({port:t,storeId:n,clientId:r})=>z(function*(){return yield*Kae(e).pipe(Bw(ooe(t)),Qx,di,Ie("@livestore/adapter-web:worker:wrapper:InitialMessage:innerFiber"),wt,In(Mf.layer({nodeName:kie.client.leader({storeId:n,clientId:r})})),Kt),M9}).pipe(Ie("@livestore/adapter-web:worker:wrapper:InitialMessage"),Hw)}),Kae=({schema:e,sync:t})=>Gx(Wn.Request,{InitialMessage:({storageOptions:n,storeId:r,clientId:s,devtoolsEnabled:o,debugInstanceId:a,syncPayload:u})=>z(function*(){const f=yield*Dg(()=>Nae()),h=Aae({sqlite3:f}),p=yield*xo(),g=E=>h({_tag:"opfs",opfsDirectory:Lae(n.directory,r),fileName:E==="state"?jae(e):"eventlog.db",configureDb:S=>z2(S,{foreignKeys:!0}).pipe(In(p),$s)}).pipe(it(S=>No(()=>S.close()).pipe(Cd))),[k,T]=yield*$d([g("state"),g("eventlog")],{concurrency:2}),O=yield*Jae({devtoolsEnabled:o,dbState:k,dbEventlog:T}),M=yield*Uae(r);return uae({schema:e,storeId:r,clientId:s,makeSqliteDb:h,syncOptions:t,dbState:k,dbEventlog:T,devtoolsOptions:O,shutdownChannel:M,syncPayload:u})}).pipe(wt,Ne.mapToUnexpectedError,WE("@livestore/adapter-web:worker:InitialMessage"),Ie("@livestore/adapter-web:worker:InitialMessage"),E9({debugInstanceId:a}),Hw),GetRecreateSnapshot:()=>z(function*(){const n=yield*Bt;return{snapshot:n.dbState.export(),migrationsReport:n.initialState.migrationsReport}}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetRecreateSnapshot")),PullStream:({cursor:n})=>z(function*(){const{syncProcessor:r}=yield*Bt;return r.pull({cursor:n})}).pipe(vx),PushToLeader:({batch:n})=>Jr(Bt,({syncProcessor:r})=>r.push(n.map(s=>new On(s)),{waitForProcessing:!0})).pipe(Qo,Ie("@livestore/adapter-web:worker:PushToLeader")),Export:()=>Jr(Bt,n=>n.dbState.export()).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:Export")),ExportEventlog:()=>Jr(Bt,n=>n.dbEventlog.export()).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:ExportEventlog")),BootStatusStream:()=>Jr(Bt,n=>Co(n.bootStatusQueue)).pipe(Sx),GetLeaderHead:()=>z(function*(){const n=yield*Bt;return V2(n.dbEventlog)}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetLeaderHead")),GetLeaderSyncState:()=>z(function*(){return yield*(yield*Bt).syncProcessor.syncState}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetLeaderSyncState")),Shutdown:()=>z(function*(){yield*ms("[@livestore/adapter-web:worker] Shutdown"),yield*tu(300)}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:Shutdown")),ExtraDevtoolsMessage:({message:n})=>Jr(Bt,r=>r.extraIncomingMessagesQueue.offer(n)).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:ExtraDevtoolsMessage")),"DevtoolsWebCommon.CreateConnection":dae}),Jae=({devtoolsEnabled:e,dbState:t,dbEventlog:n})=>z(function*(){if(e===!1)return{enabled:!1};const{node:r}=yield*Mf;return{enabled:!0,boot:z(function*(){const s={state:t.metadata.persistenceInfo,eventlog:n.metadata.persistenceInfo};return{node:r,persistenceInfo:s,mode:"direct"}})}}),g0=me("WSMessage.PullReq",{requestId:D,cursor:We(nt)}).annotations({title:"@livestore/sync-cf:PullReq"}),Gae=Y({createdAt:D}).annotations({title:"@livestore/sync-cf:SyncMetadata"}),o3=me("WSMessage.PullRes",{batch:xe(Y({eventEncoded:o0,metadata:Zi(Gae)})),requestId:Y({context:Fe("pull","push"),requestId:D}),remaining:nt}).annotations({title:"@livestore/sync-cf:PullRes"}),_0=me("WSMessage.PushReq",{requestId:D,batch:xe(o0)}).annotations({title:"@livestore/sync-cf:PushReq"}),i3=me("WSMessage.PushAck",{requestId:D}).annotations({title:"@livestore/sync-cf:PushAck"}),a3=me("WSMessage.Error",{requestId:D,message:D}).annotations({title:"@livestore/sync-cf:Error"}),c3=me("WSMessage.Ping",{requestId:Fe("ping")}).annotations({title:"@livestore/sync-cf:Ping"}),u3=me("WSMessage.Pong",{requestId:Fe("ping")}).annotations({title:"@livestore/sync-cf:Pong"}),l3=me("WSMessage.AdminResetRoomReq",{requestId:D,adminSecret:D}).annotations({title:"@livestore/sync-cf:AdminResetRoomReq"}),f3=me("WSMessage.AdminResetRoomRes",{requestId:D}).annotations({title:"@livestore/sync-cf:AdminResetRoomRes"}),d3=me("WSMessage.AdminInfoReq",{requestId:D,adminSecret:D}).annotations({title:"@livestore/sync-cf:AdminInfoReq"}),h3=me("WSMessage.AdminInfoRes",{requestId:D,info:Y({durableObjectId:D})}).annotations({title:"@livestore/sync-cf:AdminInfoRes"}),Qae=ve(g0,o3,_0,i3,a3,c3,u3,l3,f3,d3,h3).annotations({title:"@livestore/sync-cf:Message"}),Yae=ve(o3,i3,f3,h3,a3,u3);ve(g0,_0,l3,d3,c3);const Xae=Y({storeId:D,payload:cx(Ete,Fs(Ro)).pipe(g_)}),Zae=e=>({storeId:t,payload:n})=>z(function*(){const r=yield*Vu(Xae)({storeId:t,payload:n}).pipe(Ne.mapToUnexpectedError),s=$_(r),o=`${e.url}/websocket?${Xre(s)}`,{isConnected:a,incomingMessages:u,send:f}=yield*ece(o),h=[];let p=!1;return{isConnected:a,connect:fe,pull:k=>z(function*(){var E;if(p)return $e("Pull already started for this sync backend.");p=!0;let T=!1;const O=ho(),M=(E=lr(k))==null?void 0:E.cursor.global;return yield*f(g0.make({cursor:M,requestId:O})),Zm(u).pipe(vn(S=>S._tag==="WSMessage.Error"&&S.requestId===O?new nie({message:S.message}):fe),yx(S=>{var _;if(S._tag==="WSMessage.PullRes")if(S.requestId.context==="pull")if(S.requestId.requestId===O)if(T=!0,h.length>0&&S.remaining===0){const C=((_=S.batch.at(-1))==null?void 0:_.eventEncoded.seqNum)??es.global,$=h.findIndex(x=>x.eventEncoded.seqNum>C),q=$===-1?[]:h.slice($),P=[...S.batch,...q];return W({...S,batch:P,remaining:0})}else return W(S);else return V();else return T?W(S):(h.push(...S.batch),V());return V()}))}).pipe(Sx),push:k=>z(function*(){const T=yield*Me(),O=ho();yield*Zm(u).pipe(vn(M=>M._tag==="WSMessage.Error"&&M.requestId===O?jv(T,new tie({reason:{_tag:"Unexpected",message:M.message}})):fe),Ns(M=>M._tag==="WSMessage.PushAck"&&M.requestId===O),cu(1),vn(()=>ut(T,void 0)),an,wt,jg),yield*f(_0.make({batch:k,requestId:O})),yield*T}),metadata:{name:"@livestore/cf-sync",description:"LiveStore sync backend implementation using Cloudflare Workers & Durable Objects",protocol:"ws",url:e.url}}}),ece=e=>z(function*(){const t=yield*kf(!1),n={current:void 0},r=yield*Qw().pipe(it(Fm)),s=t.changes.pipe(Ns(Boolean),cu(1),an),o=u=>z(function*(){yield*s,n.current.send(Ss(Fs(Qae))(u)),xs&&(yield*Kn(`Sent message: ${u._tag}`,u._tag==="WSMessage.PushReq"?{seqNum:u.batch[0].seqNum,parentSeqNum:u.batch[0].parentSeqNum,batchLength:u.batch.length}:u._tag==="WSMessage.PullReq"?{cursor:u.cursor??"-"}:{}))});return yield*z(function*(){for(;typeof navigator<"u"&&navigator.onLine===!1;)yield*tu(1e3);const u=yield*Yse({url:e,reconnect:JF(100)});yield*Or(t,!0),n.current=u;const f=yield*Me(),h=yield*hn().pipe(it(Dt));yield*dh(u,"message",g=>z(function*(){const k=JN(Fs(Yae))(g.data);if(k._tag==="Left"){console.error("Sync: Invalid message received",k.left);return}else k.right._tag==="WSMessage.Pong"?yield*Ye(h,k.right):yield*Kg(r,k.right)})),yield*dh(u,"close",()=>ut(f,void 0)),yield*dh(u,"error",()=>z(function*(){u.close(3e3,"Sync: WebSocket error"),yield*ut(f,void 0)})),typeof self<"u"&&typeof self.addEventListener=="function"&&(yield*dh(self,"offline",()=>ut(f,void 0))),yield*Zn(()=>z(function*(){n.current=void 0,yield*Or(t,!1)}));const p=z(function*(){yield*o({_tag:"WSMessage.Ping",requestId:"ping"}),yield*ko(h).pipe(Ug(5e3)),yield*tu(25e3)}).pipe(Ie("@livestore/sync-cf:connect:checkPingPong"),Nw);yield*s.pipe(Jr(p.pipe(mf)),Nu(()=>ut(f,void 0)),Kt),yield*f}).pipe(di,Ie("@livestore/sync-cf:connect")).pipe(mf,Pt,wt,Kt),{isConnected:t,incomingMessages:r,send:o}}),Nn={entries:Ir({name:"entries",columns:{id:ct({primaryKey:!0}),spaceId:ct({default:""}),contentTypeId:ct({default:""}),name:ct({default:""}),data:ct({default:""}),storageProviderKey:ct({default:""}),tags:ct({default:"[]"}),publishedAt:kn({nullable:!0,schema:Fn}),createdAt:kn({schema:Fn}),updatedAt:kn({schema:Fn}),deletedAt:kn({nullable:!0,schema:Fn})}}),contentTypes:Ir({name:"contentTypes",columns:{id:ct({primaryKey:!0}),spaceId:ct({default:""}),name:ct({default:""}),description:ct({default:""}),properties:ct({default:"{}"}),required:ct({default:"[]"}),createdAt:kn({schema:Fn}),updatedAt:kn({schema:Fn}),deletedAt:kn({nullable:!0,schema:Fn})}}),spaces:Ir({name:"spaces",columns:{id:ct({primaryKey:!0}),name:ct({default:""}),description:ct({default:""}),storageProvider:ct({default:"storacha"}),storageProviderCredentials:ct({default:""}),storageProviderId:ct({default:""}),spaceProof:ct({default:""}),createdAt:kn({schema:Fn}),updatedAt:kn({schema:Fn}),deletedAt:kn({nullable:!0,schema:Fn})}}),AccessPolicys:Ir({name:"AccessPolicys",columns:{id:ct({primaryKey:!0}),spaceId:ct(),criteriaType:ct(),criteria:ct(),access:ct(),createdAt:kn({schema:Fn})}}),storageAuthorizations:Ir({name:"storageAuthorizations",columns:{id:ct({primaryKey:!0}),spaceId:ct(),delegationCid:ct(),clientDid:ct(),isActive:kn({default:1}),authorizedAt:kn({schema:Fn}),expiresAt:kn({nullable:!0,schema:Fn}),createdAt:kn({schema:Fn}),updatedAt:kn({schema:Fn})}}),uiState:zoe({name:"uiState",schema:Y({currentContentTypeId:D,currentSpaceId:D,formData:D,isSubmitting:Zr,uploadProgress:nt,isLoginDialogOpen:Zr,currentUserDid:D,currentLoginEmail:D,loginState:D,loginError:We(D),isShowSocialLogins:Zr}),default:{id:op,value:{currentContentTypeId:"",currentSpaceId:"",formData:"{}",isSubmitting:!1,uploadProgress:0,isLoginDialogOpen:!1,currentUserDid:"",currentLoginEmail:"",loginState:"idle",loginError:void 0,isShowSocialLogins:!1}}})},m3={entryCreated:or({name:"v1.EntryCreated",schema:Y({id:D,name:D,spaceId:D,contentTypeId:D,data:D,storageProviderKey:D,tags:D,publishedAt:We(Js)})}),entryUpdated:or({name:"v1.EntryUpdated",schema:Y({id:D,name:D,spaceId:We(D),data:We(D),storageProviderKey:We(D),tags:We(D),publishedAt:We(Js)})}),entryDeleted:or({name:"v1.EntryDeleted",schema:Y({id:D,deletedAt:Js})}),contentTypeCreated:or({name:"v1.ContentTypeCreated",schema:Y({id:D,spaceId:D,name:D,description:D,properties:D,required:D})}),contentTypeUpdated:or({name:"v1.ContentTypeUpdated",schema:Y({id:D,spaceId:We(D),name:We(D),description:We(D),properties:We(D),required:We(D)})}),contentTypeDeleted:or({name:"v1.ContentTypeDeleted",schema:Y({id:D,deletedAt:Js})}),spaceCreated:or({name:"v1.SpaceCreated",schema:Y({id:D,name:D,description:D,storageProvider:D,storageProviderCredentials:D,storageProviderId:D})}),spaceUpdated:or({name:"v1.SpaceUpdated",schema:Y({id:D,name:D,description:D,storageProvider:D,storageProviderCredentials:D,storageProviderId:D})}),spaceDeleted:or({name:"v1.SpaceDeleted",schema:Y({id:D,deletedAt:Js})}),storachaStorageAuthorized:or({name:"v1.StorachaStorageAuthorized",schema:Y({id:D,spaceId:D,delegationCid:D,delegationData:D,clientDid:D,isActive:Zr,authorizedAt:Js,expiresAt:We(Js)})}),accessPolicyCreated:or({name:"v1.AccessPolicyCreated",schema:Y({id:D,spaceId:D,criteriaType:D,criteria:D,access:D,createdAt:Js})}),accessPolicyUpdated:or({name:"v1.AccessPolicyUpdated",schema:Y({id:D,spaceId:We(D),criteriaType:We(D),criteria:We(D),access:We(D)})}),accessPolicyDeleted:or({name:"v1.AccessPolicyDeleted",schema:Y({id:D})}),uiStateSet:Nn.uiState.set},tce=joe(m3,{"v1.EntryCreated":({id:e,spaceId:t,contentTypeId:n,name:r,data:s,storageProviderKey:o,tags:a,publishedAt:u})=>Nn.entries.insert({id:e,spaceId:t,contentTypeId:n,name:r,data:s,storageProviderKey:o,tags:a,publishedAt:u,createdAt:new Date,updatedAt:new Date}),"v1.EntryUpdated":({id:e,...t})=>{const n=Object.fromEntries(Object.entries({...t,updatedAt:new Date}).filter(([r,s])=>s!==void 0));return Nn.entries.update(n).where({id:e})},"v1.EntryDeleted":({id:e,deletedAt:t})=>Nn.entries.update({deletedAt:t}).where({id:e}),"v1.ContentTypeCreated":({id:e,spaceId:t,name:n,description:r,properties:s,required:o})=>Nn.contentTypes.insert({id:e,spaceId:t,name:n,description:r,properties:s,required:o,createdAt:new Date,updatedAt:new Date}),"v1.ContentTypeUpdated":({id:e,...t})=>{const n=Object.fromEntries(Object.entries({...t,updatedAt:new Date}).filter(([r,s])=>s!==void 0));return Nn.contentTypes.update(n).where({id:e})},"v1.ContentTypeDeleted":({id:e,deletedAt:t})=>Nn.contentTypes.update({deletedAt:t}).where({id:e}),"v1.SpaceCreated":({id:e,name:t,description:n,storageProvider:r,storageProviderCredentials:s,storageProviderId:o})=>Nn.spaces.insert({id:e,name:t,description:n,storageProvider:r,storageProviderCredentials:s,storageProviderId:o,createdAt:new Date,updatedAt:new Date}),"v1.SpaceUpdated":({id:e,name:t,description:n,storageProvider:r,storageProviderCredentials:s,storageProviderId:o})=>Nn.spaces.update({name:t,description:n,storageProvider:r,storageProviderCredentials:s,storageProviderId:o,updatedAt:new Date}).where({id:e}),"v1.SpaceDeleted":({id:e,deletedAt:t})=>Nn.spaces.update({deletedAt:t}).where({id:e}),"v1.StorachaStorageAuthorized":({id:e,spaceId:t,delegationCid:n,clientDid:r,isActive:s,authorizedAt:o,expiresAt:a})=>Nn.storageAuthorizations.insert({id:e,spaceId:t,delegationCid:n,clientDid:r,isActive:s?1:0,authorizedAt:o,expiresAt:a,createdAt:new Date,updatedAt:new Date}),"v1.AccessPolicyCreated":({id:e,spaceId:t,criteriaType:n,criteria:r,access:s,createdAt:o})=>Nn.AccessPolicys.insert({id:e,spaceId:t,criteriaType:n,criteria:r,access:s,createdAt:o}),"v1.AccessPolicyUpdated":({id:e,...t})=>{const n=Object.fromEntries(Object.entries({...t}).filter(([r,s])=>s!==void 0));return Nn.AccessPolicys.update(n).where({id:e})},"v1.AccessPolicyDeleted":({id:e})=>Nn.AccessPolicys.delete().where({id:e})}),nce=Qoe({tables:Nn,materializers:tce}),rce=Koe({events:m3,state:nce});Hae({schema:rce,sync:{backend:Zae({url:"http://localhost:8787"}),initialSyncOptions:{_tag:"Blocking",timeout:5e3}}});
